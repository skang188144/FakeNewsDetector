var c_=Object.defineProperty;var d_=(t,e,n)=>e in t?c_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Fn=(t,e,n)=>d_(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function pu(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var xg={exports:{}},mu={},Pg={exports:{}},H={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pa=Symbol.for("react.element"),f_=Symbol.for("react.portal"),h_=Symbol.for("react.fragment"),p_=Symbol.for("react.strict_mode"),m_=Symbol.for("react.profiler"),g_=Symbol.for("react.provider"),y_=Symbol.for("react.context"),v_=Symbol.for("react.forward_ref"),w_=Symbol.for("react.suspense"),__=Symbol.for("react.memo"),b_=Symbol.for("react.lazy"),ap=Symbol.iterator;function E_(t){return t===null||typeof t!="object"?null:(t=ap&&t[ap]||t["@@iterator"],typeof t=="function"?t:null)}var Og={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Tg=Object.assign,Ag={};function Gs(t,e,n){this.props=t,this.context=e,this.refs=Ag,this.updater=n||Og}Gs.prototype.isReactComponent={};Gs.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Gs.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Cg(){}Cg.prototype=Gs.prototype;function wf(t,e,n){this.props=t,this.context=e,this.refs=Ag,this.updater=n||Og}var _f=wf.prototype=new Cg;_f.constructor=wf;Tg(_f,Gs.prototype);_f.isPureReactComponent=!0;var op=Array.isArray,Rg=Object.prototype.hasOwnProperty,bf={current:null},Ig={key:!0,ref:!0,__self:!0,__source:!0};function Ng(t,e,n){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)Rg.call(e,r)&&!Ig.hasOwnProperty(r)&&(s[r]=e[r]);var o=arguments.length-2;if(o===1)s.children=n;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];s.children=l}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)s[r]===void 0&&(s[r]=o[r]);return{$$typeof:Pa,type:t,key:i,ref:a,props:s,_owner:bf.current}}function k_(t,e){return{$$typeof:Pa,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Ef(t){return typeof t=="object"&&t!==null&&t.$$typeof===Pa}function S_(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var lp=/\/+/g;function Ku(t,e){return typeof t=="object"&&t!==null&&t.key!=null?S_(""+t.key):e.toString(36)}function yo(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case Pa:case f_:a=!0}}if(a)return a=t,s=s(a),t=r===""?"."+Ku(a,0):r,op(s)?(n="",t!=null&&(n=t.replace(lp,"$&/")+"/"),yo(s,e,n,"",function(u){return u})):s!=null&&(Ef(s)&&(s=k_(s,n+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(lp,"$&/")+"/")+t)),e.push(s)),1;if(a=0,r=r===""?".":r+":",op(t))for(var o=0;o<t.length;o++){i=t[o];var l=r+Ku(i,o);a+=yo(i,e,n,l,s)}else if(l=E_(t),typeof l=="function")for(t=l.call(t),o=0;!(i=t.next()).done;)i=i.value,l=r+Ku(i,o++),a+=yo(i,e,n,l,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Va(t,e,n){if(t==null)return t;var r=[],s=0;return yo(t,r,"","",function(i){return e.call(n,i,s++)}),r}function x_(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Je={current:null},vo={transition:null},P_={ReactCurrentDispatcher:Je,ReactCurrentBatchConfig:vo,ReactCurrentOwner:bf};function jg(){throw Error("act(...) is not supported in production builds of React.")}H.Children={map:Va,forEach:function(t,e,n){Va(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Va(t,function(){e++}),e},toArray:function(t){return Va(t,function(e){return e})||[]},only:function(t){if(!Ef(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};H.Component=Gs;H.Fragment=h_;H.Profiler=m_;H.PureComponent=wf;H.StrictMode=p_;H.Suspense=w_;H.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P_;H.act=jg;H.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Tg({},t.props),s=t.key,i=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=bf.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var o=t.type.defaultProps;for(l in e)Rg.call(e,l)&&!Ig.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];r.children=o}return{$$typeof:Pa,type:t.type,key:s,ref:i,props:r,_owner:a}};H.createContext=function(t){return t={$$typeof:y_,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:g_,_context:t},t.Consumer=t};H.createElement=Ng;H.createFactory=function(t){var e=Ng.bind(null,t);return e.type=t,e};H.createRef=function(){return{current:null}};H.forwardRef=function(t){return{$$typeof:v_,render:t}};H.isValidElement=Ef;H.lazy=function(t){return{$$typeof:b_,_payload:{_status:-1,_result:t},_init:x_}};H.memo=function(t,e){return{$$typeof:__,type:t,compare:e===void 0?null:e}};H.startTransition=function(t){var e=vo.transition;vo.transition={};try{t()}finally{vo.transition=e}};H.unstable_act=jg;H.useCallback=function(t,e){return Je.current.useCallback(t,e)};H.useContext=function(t){return Je.current.useContext(t)};H.useDebugValue=function(){};H.useDeferredValue=function(t){return Je.current.useDeferredValue(t)};H.useEffect=function(t,e){return Je.current.useEffect(t,e)};H.useId=function(){return Je.current.useId()};H.useImperativeHandle=function(t,e,n){return Je.current.useImperativeHandle(t,e,n)};H.useInsertionEffect=function(t,e){return Je.current.useInsertionEffect(t,e)};H.useLayoutEffect=function(t,e){return Je.current.useLayoutEffect(t,e)};H.useMemo=function(t,e){return Je.current.useMemo(t,e)};H.useReducer=function(t,e,n){return Je.current.useReducer(t,e,n)};H.useRef=function(t){return Je.current.useRef(t)};H.useState=function(t){return Je.current.useState(t)};H.useSyncExternalStore=function(t,e,n){return Je.current.useSyncExternalStore(t,e,n)};H.useTransition=function(){return Je.current.useTransition()};H.version="18.3.1";Pg.exports=H;var xe=Pg.exports;const O_=pu(xe);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var T_=xe,A_=Symbol.for("react.element"),C_=Symbol.for("react.fragment"),R_=Object.prototype.hasOwnProperty,I_=T_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,N_={key:!0,ref:!0,__self:!0,__source:!0};function $g(t,e,n){var r,s={},i=null,a=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)R_.call(e,r)&&!N_.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:A_,type:t,key:i,ref:a,props:s,_owner:I_.current}}mu.Fragment=C_;mu.jsx=$g;mu.jsxs=$g;xg.exports=mu;var C=xg.exports,Yc={},Lg={exports:{}},_t={},Mg={exports:{}},Dg={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(I,F){var V=I.length;I.push(F);e:for(;0<V;){var pe=V-1>>>1,ke=I[pe];if(0<s(ke,F))I[pe]=F,I[V]=ke,V=pe;else break e}}function n(I){return I.length===0?null:I[0]}function r(I){if(I.length===0)return null;var F=I[0],V=I.pop();if(V!==F){I[0]=V;e:for(var pe=0,ke=I.length,Ua=ke>>>1;pe<Ua;){var Er=2*(pe+1)-1,Qu=I[Er],kr=Er+1,za=I[kr];if(0>s(Qu,V))kr<ke&&0>s(za,Qu)?(I[pe]=za,I[kr]=V,pe=kr):(I[pe]=Qu,I[Er]=V,pe=Er);else if(kr<ke&&0>s(za,V))I[pe]=za,I[kr]=V,pe=kr;else break e}}return F}function s(I,F){var V=I.sortIndex-F.sortIndex;return V!==0?V:I.id-F.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var a=Date,o=a.now();t.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,d=null,f=3,g=!1,p=!1,v=!1,w=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(I){for(var F=n(u);F!==null;){if(F.callback===null)r(u);else if(F.startTime<=I)r(u),F.sortIndex=F.expirationTime,e(l,F);else break;F=n(u)}}function _(I){if(v=!1,y(I),!p)if(n(l)!==null)p=!0,Gu(b);else{var F=n(u);F!==null&&Yu(_,F.startTime-I)}}function b(I,F){p=!1,v&&(v=!1,m(O),O=-1),g=!0;var V=f;try{for(y(F),d=n(l);d!==null&&(!(d.expirationTime>F)||I&&!he());){var pe=d.callback;if(typeof pe=="function"){d.callback=null,f=d.priorityLevel;var ke=pe(d.expirationTime<=F);F=t.unstable_now(),typeof ke=="function"?d.callback=ke:d===n(l)&&r(l),y(F)}else r(l);d=n(l)}if(d!==null)var Ua=!0;else{var Er=n(u);Er!==null&&Yu(_,Er.startTime-F),Ua=!1}return Ua}finally{d=null,f=V,g=!1}}var E=!1,k=null,O=-1,$=5,M=-1;function he(){return!(t.unstable_now()-M<$)}function _n(){if(k!==null){var I=t.unstable_now();M=I;var F=!0;try{F=k(!0,I)}finally{F?br():(E=!1,k=null)}}else E=!1}var br;if(typeof h=="function")br=function(){h(_n)};else if(typeof MessageChannel<"u"){var ip=new MessageChannel,u_=ip.port2;ip.port1.onmessage=_n,br=function(){u_.postMessage(null)}}else br=function(){w(_n,0)};function Gu(I){k=I,E||(E=!0,br())}function Yu(I,F){O=w(function(){I(t.unstable_now())},F)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(I){I.callback=null},t.unstable_continueExecution=function(){p||g||(p=!0,Gu(b))},t.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<I?Math.floor(1e3/I):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(I){switch(f){case 1:case 2:case 3:var F=3;break;default:F=f}var V=f;f=F;try{return I()}finally{f=V}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(I,F){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var V=f;f=I;try{return F()}finally{f=V}},t.unstable_scheduleCallback=function(I,F,V){var pe=t.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?pe+V:pe):V=pe,I){case 1:var ke=-1;break;case 2:ke=250;break;case 5:ke=1073741823;break;case 4:ke=1e4;break;default:ke=5e3}return ke=V+ke,I={id:c++,callback:F,priorityLevel:I,startTime:V,expirationTime:ke,sortIndex:-1},V>pe?(I.sortIndex=V,e(u,I),n(l)===null&&I===n(u)&&(v?(m(O),O=-1):v=!0,Yu(_,V-pe))):(I.sortIndex=ke,e(l,I),p||g||(p=!0,Gu(b))),I},t.unstable_shouldYield=he,t.unstable_wrapCallback=function(I){var F=f;return function(){var V=f;f=F;try{return I.apply(this,arguments)}finally{f=V}}}})(Dg);Mg.exports=Dg;var j_=Mg.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $_=xe,vt=j_;function S(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Fg=new Set,Vi={};function Zr(t,e){Ls(t,e),Ls(t+"Capture",e)}function Ls(t,e){for(Vi[t]=e,t=0;t<e.length;t++)Fg.add(e[t])}var Nn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Qc=Object.prototype.hasOwnProperty,L_=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,up={},cp={};function M_(t){return Qc.call(cp,t)?!0:Qc.call(up,t)?!1:L_.test(t)?cp[t]=!0:(up[t]=!0,!1)}function D_(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function F_(t,e,n,r){if(e===null||typeof e>"u"||D_(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Xe(t,e,n,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var $e={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){$e[t]=new Xe(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];$e[e]=new Xe(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){$e[t]=new Xe(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){$e[t]=new Xe(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){$e[t]=new Xe(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){$e[t]=new Xe(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){$e[t]=new Xe(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){$e[t]=new Xe(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){$e[t]=new Xe(t,5,!1,t.toLowerCase(),null,!1,!1)});var kf=/[\-:]([a-z])/g;function Sf(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(kf,Sf);$e[e]=new Xe(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(kf,Sf);$e[e]=new Xe(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(kf,Sf);$e[e]=new Xe(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){$e[t]=new Xe(t,1,!1,t.toLowerCase(),null,!1,!1)});$e.xlinkHref=new Xe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){$e[t]=new Xe(t,1,!1,t.toLowerCase(),null,!0,!0)});function xf(t,e,n,r){var s=$e.hasOwnProperty(e)?$e[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(F_(e,n,s,r)&&(n=null),r||s===null?M_(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Dn=$_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ba=Symbol.for("react.element"),as=Symbol.for("react.portal"),os=Symbol.for("react.fragment"),Pf=Symbol.for("react.strict_mode"),Kc=Symbol.for("react.profiler"),Ug=Symbol.for("react.provider"),zg=Symbol.for("react.context"),Of=Symbol.for("react.forward_ref"),Jc=Symbol.for("react.suspense"),Xc=Symbol.for("react.suspense_list"),Tf=Symbol.for("react.memo"),Hn=Symbol.for("react.lazy"),Vg=Symbol.for("react.offscreen"),dp=Symbol.iterator;function ri(t){return t===null||typeof t!="object"?null:(t=dp&&t[dp]||t["@@iterator"],typeof t=="function"?t:null)}var de=Object.assign,Ju;function di(t){if(Ju===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Ju=e&&e[1]||""}return`
`+Ju+t}var Xu=!1;function ec(t,e){if(!t||Xu)return"";Xu=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,o=i.length-1;1<=a&&0<=o&&s[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==i[o]){if(a!==1||o!==1)do if(a--,o--,0>o||s[a]!==i[o]){var l=`
`+s[a].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=a&&0<=o);break}}}finally{Xu=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?di(t):""}function U_(t){switch(t.tag){case 5:return di(t.type);case 16:return di("Lazy");case 13:return di("Suspense");case 19:return di("SuspenseList");case 0:case 2:case 15:return t=ec(t.type,!1),t;case 11:return t=ec(t.type.render,!1),t;case 1:return t=ec(t.type,!0),t;default:return""}}function ed(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case os:return"Fragment";case as:return"Portal";case Kc:return"Profiler";case Pf:return"StrictMode";case Jc:return"Suspense";case Xc:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case zg:return(t.displayName||"Context")+".Consumer";case Ug:return(t._context.displayName||"Context")+".Provider";case Of:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Tf:return e=t.displayName||null,e!==null?e:ed(t.type)||"Memo";case Hn:e=t._payload,t=t._init;try{return ed(t(e))}catch{}}return null}function z_(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ed(e);case 8:return e===Pf?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function dr(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Bg(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function V_(t){var e=Bg(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Ha(t){t._valueTracker||(t._valueTracker=V_(t))}function Hg(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Bg(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function qo(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function td(t,e){var n=e.checked;return de({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function fp(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=dr(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function qg(t,e){e=e.checked,e!=null&&xf(t,"checked",e,!1)}function nd(t,e){qg(t,e);var n=dr(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?rd(t,e.type,n):e.hasOwnProperty("defaultValue")&&rd(t,e.type,dr(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function hp(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function rd(t,e,n){(e!=="number"||qo(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var fi=Array.isArray;function ks(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+dr(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function sd(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(S(91));return de({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function pp(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(S(92));if(fi(n)){if(1<n.length)throw Error(S(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:dr(n)}}function Wg(t,e){var n=dr(e.value),r=dr(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function mp(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Zg(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function id(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Zg(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var qa,Gg=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(qa=qa||document.createElement("div"),qa.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=qa.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Bi(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Ti={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},B_=["Webkit","ms","Moz","O"];Object.keys(Ti).forEach(function(t){B_.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ti[e]=Ti[t]})});function Yg(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Ti.hasOwnProperty(t)&&Ti[t]?(""+e).trim():e+"px"}function Qg(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=Yg(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var H_=de({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ad(t,e){if(e){if(H_[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(S(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(S(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(S(61))}if(e.style!=null&&typeof e.style!="object")throw Error(S(62))}}function od(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ld=null;function Af(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ud=null,Ss=null,xs=null;function gp(t){if(t=Aa(t)){if(typeof ud!="function")throw Error(S(280));var e=t.stateNode;e&&(e=_u(e),ud(t.stateNode,t.type,e))}}function Kg(t){Ss?xs?xs.push(t):xs=[t]:Ss=t}function Jg(){if(Ss){var t=Ss,e=xs;if(xs=Ss=null,gp(t),e)for(t=0;t<e.length;t++)gp(e[t])}}function Xg(t,e){return t(e)}function ey(){}var tc=!1;function ty(t,e,n){if(tc)return t(e,n);tc=!0;try{return Xg(t,e,n)}finally{tc=!1,(Ss!==null||xs!==null)&&(ey(),Jg())}}function Hi(t,e){var n=t.stateNode;if(n===null)return null;var r=_u(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(S(231,e,typeof n));return n}var cd=!1;if(Nn)try{var si={};Object.defineProperty(si,"passive",{get:function(){cd=!0}}),window.addEventListener("test",si,si),window.removeEventListener("test",si,si)}catch{cd=!1}function q_(t,e,n,r,s,i,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(c){this.onError(c)}}var Ai=!1,Wo=null,Zo=!1,dd=null,W_={onError:function(t){Ai=!0,Wo=t}};function Z_(t,e,n,r,s,i,a,o,l){Ai=!1,Wo=null,q_.apply(W_,arguments)}function G_(t,e,n,r,s,i,a,o,l){if(Z_.apply(this,arguments),Ai){if(Ai){var u=Wo;Ai=!1,Wo=null}else throw Error(S(198));Zo||(Zo=!0,dd=u)}}function Gr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function ny(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function yp(t){if(Gr(t)!==t)throw Error(S(188))}function Y_(t){var e=t.alternate;if(!e){if(e=Gr(t),e===null)throw Error(S(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return yp(s),t;if(i===r)return yp(s),e;i=i.sibling}throw Error(S(188))}if(n.return!==r.return)n=s,r=i;else{for(var a=!1,o=s.child;o;){if(o===n){a=!0,n=s,r=i;break}if(o===r){a=!0,r=s,n=i;break}o=o.sibling}if(!a){for(o=i.child;o;){if(o===n){a=!0,n=i,r=s;break}if(o===r){a=!0,r=i,n=s;break}o=o.sibling}if(!a)throw Error(S(189))}}if(n.alternate!==r)throw Error(S(190))}if(n.tag!==3)throw Error(S(188));return n.stateNode.current===n?t:e}function ry(t){return t=Y_(t),t!==null?sy(t):null}function sy(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=sy(t);if(e!==null)return e;t=t.sibling}return null}var iy=vt.unstable_scheduleCallback,vp=vt.unstable_cancelCallback,Q_=vt.unstable_shouldYield,K_=vt.unstable_requestPaint,me=vt.unstable_now,J_=vt.unstable_getCurrentPriorityLevel,Cf=vt.unstable_ImmediatePriority,ay=vt.unstable_UserBlockingPriority,Go=vt.unstable_NormalPriority,X_=vt.unstable_LowPriority,oy=vt.unstable_IdlePriority,gu=null,hn=null;function eb(t){if(hn&&typeof hn.onCommitFiberRoot=="function")try{hn.onCommitFiberRoot(gu,t,void 0,(t.current.flags&128)===128)}catch{}}var Gt=Math.clz32?Math.clz32:rb,tb=Math.log,nb=Math.LN2;function rb(t){return t>>>=0,t===0?32:31-(tb(t)/nb|0)|0}var Wa=64,Za=4194304;function hi(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Yo(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,a=n&268435455;if(a!==0){var o=a&~s;o!==0?r=hi(o):(i&=a,i!==0&&(r=hi(i)))}else a=n&~s,a!==0?r=hi(a):i!==0&&(r=hi(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Gt(e),s=1<<n,r|=t[n],e&=~s;return r}function sb(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ib(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var a=31-Gt(i),o=1<<a,l=s[a];l===-1?(!(o&n)||o&r)&&(s[a]=sb(o,e)):l<=e&&(t.expiredLanes|=o),i&=~o}}function fd(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function ly(){var t=Wa;return Wa<<=1,!(Wa&4194240)&&(Wa=64),t}function nc(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Oa(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Gt(e),t[e]=n}function ab(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Gt(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Rf(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Gt(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var K=0;function uy(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var cy,If,dy,fy,hy,hd=!1,Ga=[],er=null,tr=null,nr=null,qi=new Map,Wi=new Map,Gn=[],ob="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function wp(t,e){switch(t){case"focusin":case"focusout":er=null;break;case"dragenter":case"dragleave":tr=null;break;case"mouseover":case"mouseout":nr=null;break;case"pointerover":case"pointerout":qi.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Wi.delete(e.pointerId)}}function ii(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Aa(e),e!==null&&If(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function lb(t,e,n,r,s){switch(e){case"focusin":return er=ii(er,t,e,n,r,s),!0;case"dragenter":return tr=ii(tr,t,e,n,r,s),!0;case"mouseover":return nr=ii(nr,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return qi.set(i,ii(qi.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Wi.set(i,ii(Wi.get(i)||null,t,e,n,r,s)),!0}return!1}function py(t){var e=Ar(t.target);if(e!==null){var n=Gr(e);if(n!==null){if(e=n.tag,e===13){if(e=ny(n),e!==null){t.blockedOn=e,hy(t.priority,function(){dy(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function wo(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=pd(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);ld=r,n.target.dispatchEvent(r),ld=null}else return e=Aa(n),e!==null&&If(e),t.blockedOn=n,!1;e.shift()}return!0}function _p(t,e,n){wo(t)&&n.delete(e)}function ub(){hd=!1,er!==null&&wo(er)&&(er=null),tr!==null&&wo(tr)&&(tr=null),nr!==null&&wo(nr)&&(nr=null),qi.forEach(_p),Wi.forEach(_p)}function ai(t,e){t.blockedOn===e&&(t.blockedOn=null,hd||(hd=!0,vt.unstable_scheduleCallback(vt.unstable_NormalPriority,ub)))}function Zi(t){function e(s){return ai(s,t)}if(0<Ga.length){ai(Ga[0],t);for(var n=1;n<Ga.length;n++){var r=Ga[n];r.blockedOn===t&&(r.blockedOn=null)}}for(er!==null&&ai(er,t),tr!==null&&ai(tr,t),nr!==null&&ai(nr,t),qi.forEach(e),Wi.forEach(e),n=0;n<Gn.length;n++)r=Gn[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Gn.length&&(n=Gn[0],n.blockedOn===null);)py(n),n.blockedOn===null&&Gn.shift()}var Ps=Dn.ReactCurrentBatchConfig,Qo=!0;function cb(t,e,n,r){var s=K,i=Ps.transition;Ps.transition=null;try{K=1,Nf(t,e,n,r)}finally{K=s,Ps.transition=i}}function db(t,e,n,r){var s=K,i=Ps.transition;Ps.transition=null;try{K=4,Nf(t,e,n,r)}finally{K=s,Ps.transition=i}}function Nf(t,e,n,r){if(Qo){var s=pd(t,e,n,r);if(s===null)fc(t,e,r,Ko,n),wp(t,r);else if(lb(s,t,e,n,r))r.stopPropagation();else if(wp(t,r),e&4&&-1<ob.indexOf(t)){for(;s!==null;){var i=Aa(s);if(i!==null&&cy(i),i=pd(t,e,n,r),i===null&&fc(t,e,r,Ko,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else fc(t,e,r,null,n)}}var Ko=null;function pd(t,e,n,r){if(Ko=null,t=Af(r),t=Ar(t),t!==null)if(e=Gr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=ny(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ko=t,null}function my(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(J_()){case Cf:return 1;case ay:return 4;case Go:case X_:return 16;case oy:return 536870912;default:return 16}default:return 16}}var Kn=null,jf=null,_o=null;function gy(){if(_o)return _o;var t,e=jf,n=e.length,r,s="value"in Kn?Kn.value:Kn.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===s[i-r];r++);return _o=s.slice(t,1<r?1-r:void 0)}function bo(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ya(){return!0}function bp(){return!1}function bt(t){function e(n,r,s,i,a){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(n=t[o],this[o]=n?n(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Ya:bp,this.isPropagationStopped=bp,this}return de(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ya)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ya)},persist:function(){},isPersistent:Ya}),e}var Ys={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$f=bt(Ys),Ta=de({},Ys,{view:0,detail:0}),fb=bt(Ta),rc,sc,oi,yu=de({},Ta,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Lf,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==oi&&(oi&&t.type==="mousemove"?(rc=t.screenX-oi.screenX,sc=t.screenY-oi.screenY):sc=rc=0,oi=t),rc)},movementY:function(t){return"movementY"in t?t.movementY:sc}}),Ep=bt(yu),hb=de({},yu,{dataTransfer:0}),pb=bt(hb),mb=de({},Ta,{relatedTarget:0}),ic=bt(mb),gb=de({},Ys,{animationName:0,elapsedTime:0,pseudoElement:0}),yb=bt(gb),vb=de({},Ys,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),wb=bt(vb),_b=de({},Ys,{data:0}),kp=bt(_b),bb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Eb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sb(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=kb[t])?!!e[t]:!1}function Lf(){return Sb}var xb=de({},Ta,{key:function(t){if(t.key){var e=bb[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=bo(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Eb[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Lf,charCode:function(t){return t.type==="keypress"?bo(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?bo(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Pb=bt(xb),Ob=de({},yu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Sp=bt(Ob),Tb=de({},Ta,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Lf}),Ab=bt(Tb),Cb=de({},Ys,{propertyName:0,elapsedTime:0,pseudoElement:0}),Rb=bt(Cb),Ib=de({},yu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Nb=bt(Ib),jb=[9,13,27,32],Mf=Nn&&"CompositionEvent"in window,Ci=null;Nn&&"documentMode"in document&&(Ci=document.documentMode);var $b=Nn&&"TextEvent"in window&&!Ci,yy=Nn&&(!Mf||Ci&&8<Ci&&11>=Ci),xp=" ",Pp=!1;function vy(t,e){switch(t){case"keyup":return jb.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wy(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ls=!1;function Lb(t,e){switch(t){case"compositionend":return wy(e);case"keypress":return e.which!==32?null:(Pp=!0,xp);case"textInput":return t=e.data,t===xp&&Pp?null:t;default:return null}}function Mb(t,e){if(ls)return t==="compositionend"||!Mf&&vy(t,e)?(t=gy(),_o=jf=Kn=null,ls=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return yy&&e.locale!=="ko"?null:e.data;default:return null}}var Db={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Op(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Db[t.type]:e==="textarea"}function _y(t,e,n,r){Kg(r),e=Jo(e,"onChange"),0<e.length&&(n=new $f("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Ri=null,Gi=null;function Fb(t){Ry(t,0)}function vu(t){var e=ds(t);if(Hg(e))return t}function Ub(t,e){if(t==="change")return e}var by=!1;if(Nn){var ac;if(Nn){var oc="oninput"in document;if(!oc){var Tp=document.createElement("div");Tp.setAttribute("oninput","return;"),oc=typeof Tp.oninput=="function"}ac=oc}else ac=!1;by=ac&&(!document.documentMode||9<document.documentMode)}function Ap(){Ri&&(Ri.detachEvent("onpropertychange",Ey),Gi=Ri=null)}function Ey(t){if(t.propertyName==="value"&&vu(Gi)){var e=[];_y(e,Gi,t,Af(t)),ty(Fb,e)}}function zb(t,e,n){t==="focusin"?(Ap(),Ri=e,Gi=n,Ri.attachEvent("onpropertychange",Ey)):t==="focusout"&&Ap()}function Vb(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return vu(Gi)}function Bb(t,e){if(t==="click")return vu(e)}function Hb(t,e){if(t==="input"||t==="change")return vu(e)}function qb(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Jt=typeof Object.is=="function"?Object.is:qb;function Yi(t,e){if(Jt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Qc.call(e,s)||!Jt(t[s],e[s]))return!1}return!0}function Cp(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Rp(t,e){var n=Cp(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Cp(n)}}function ky(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?ky(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Sy(){for(var t=window,e=qo();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=qo(t.document)}return e}function Df(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Wb(t){var e=Sy(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&ky(n.ownerDocument.documentElement,n)){if(r!==null&&Df(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=Rp(n,i);var a=Rp(n,r);s&&a&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Zb=Nn&&"documentMode"in document&&11>=document.documentMode,us=null,md=null,Ii=null,gd=!1;function Ip(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;gd||us==null||us!==qo(r)||(r=us,"selectionStart"in r&&Df(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ii&&Yi(Ii,r)||(Ii=r,r=Jo(md,"onSelect"),0<r.length&&(e=new $f("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=us)))}function Qa(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var cs={animationend:Qa("Animation","AnimationEnd"),animationiteration:Qa("Animation","AnimationIteration"),animationstart:Qa("Animation","AnimationStart"),transitionend:Qa("Transition","TransitionEnd")},lc={},xy={};Nn&&(xy=document.createElement("div").style,"AnimationEvent"in window||(delete cs.animationend.animation,delete cs.animationiteration.animation,delete cs.animationstart.animation),"TransitionEvent"in window||delete cs.transitionend.transition);function wu(t){if(lc[t])return lc[t];if(!cs[t])return t;var e=cs[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in xy)return lc[t]=e[n];return t}var Py=wu("animationend"),Oy=wu("animationiteration"),Ty=wu("animationstart"),Ay=wu("transitionend"),Cy=new Map,Np="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function vr(t,e){Cy.set(t,e),Zr(e,[t])}for(var uc=0;uc<Np.length;uc++){var cc=Np[uc],Gb=cc.toLowerCase(),Yb=cc[0].toUpperCase()+cc.slice(1);vr(Gb,"on"+Yb)}vr(Py,"onAnimationEnd");vr(Oy,"onAnimationIteration");vr(Ty,"onAnimationStart");vr("dblclick","onDoubleClick");vr("focusin","onFocus");vr("focusout","onBlur");vr(Ay,"onTransitionEnd");Ls("onMouseEnter",["mouseout","mouseover"]);Ls("onMouseLeave",["mouseout","mouseover"]);Ls("onPointerEnter",["pointerout","pointerover"]);Ls("onPointerLeave",["pointerout","pointerover"]);Zr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Zr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Zr("onBeforeInput",["compositionend","keypress","textInput","paste"]);Zr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Zr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Zr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var pi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qb=new Set("cancel close invalid load scroll toggle".split(" ").concat(pi));function jp(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,G_(r,e,void 0,t),t.currentTarget=null}function Ry(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==i&&s.isPropagationStopped())break e;jp(s,o,u),i=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==i&&s.isPropagationStopped())break e;jp(s,o,u),i=l}}}if(Zo)throw t=dd,Zo=!1,dd=null,t}function ee(t,e){var n=e[bd];n===void 0&&(n=e[bd]=new Set);var r=t+"__bubble";n.has(r)||(Iy(e,t,2,!1),n.add(r))}function dc(t,e,n){var r=0;e&&(r|=4),Iy(n,t,r,e)}var Ka="_reactListening"+Math.random().toString(36).slice(2);function Qi(t){if(!t[Ka]){t[Ka]=!0,Fg.forEach(function(n){n!=="selectionchange"&&(Qb.has(n)||dc(n,!1,t),dc(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Ka]||(e[Ka]=!0,dc("selectionchange",!1,e))}}function Iy(t,e,n,r){switch(my(e)){case 1:var s=cb;break;case 4:s=db;break;default:s=Nf}n=s.bind(null,e,n,t),s=void 0,!cd||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function fc(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;a=a.return}for(;o!==null;){if(a=Ar(o),a===null)return;if(l=a.tag,l===5||l===6){r=i=a;continue e}o=o.parentNode}}r=r.return}ty(function(){var u=i,c=Af(n),d=[];e:{var f=Cy.get(t);if(f!==void 0){var g=$f,p=t;switch(t){case"keypress":if(bo(n)===0)break e;case"keydown":case"keyup":g=Pb;break;case"focusin":p="focus",g=ic;break;case"focusout":p="blur",g=ic;break;case"beforeblur":case"afterblur":g=ic;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=Ep;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=pb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=Ab;break;case Py:case Oy:case Ty:g=yb;break;case Ay:g=Rb;break;case"scroll":g=fb;break;case"wheel":g=Nb;break;case"copy":case"cut":case"paste":g=wb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=Sp}var v=(e&4)!==0,w=!v&&t==="scroll",m=v?f!==null?f+"Capture":null:f;v=[];for(var h=u,y;h!==null;){y=h;var _=y.stateNode;if(y.tag===5&&_!==null&&(y=_,m!==null&&(_=Hi(h,m),_!=null&&v.push(Ki(h,_,y)))),w)break;h=h.return}0<v.length&&(f=new g(f,p,null,n,c),d.push({event:f,listeners:v}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",g=t==="mouseout"||t==="pointerout",f&&n!==ld&&(p=n.relatedTarget||n.fromElement)&&(Ar(p)||p[jn]))break e;if((g||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,g?(p=n.relatedTarget||n.toElement,g=u,p=p?Ar(p):null,p!==null&&(w=Gr(p),p!==w||p.tag!==5&&p.tag!==6)&&(p=null)):(g=null,p=u),g!==p)){if(v=Ep,_="onMouseLeave",m="onMouseEnter",h="mouse",(t==="pointerout"||t==="pointerover")&&(v=Sp,_="onPointerLeave",m="onPointerEnter",h="pointer"),w=g==null?f:ds(g),y=p==null?f:ds(p),f=new v(_,h+"leave",g,n,c),f.target=w,f.relatedTarget=y,_=null,Ar(c)===u&&(v=new v(m,h+"enter",p,n,c),v.target=y,v.relatedTarget=w,_=v),w=_,g&&p)t:{for(v=g,m=p,h=0,y=v;y;y=Kr(y))h++;for(y=0,_=m;_;_=Kr(_))y++;for(;0<h-y;)v=Kr(v),h--;for(;0<y-h;)m=Kr(m),y--;for(;h--;){if(v===m||m!==null&&v===m.alternate)break t;v=Kr(v),m=Kr(m)}v=null}else v=null;g!==null&&$p(d,f,g,v,!1),p!==null&&w!==null&&$p(d,w,p,v,!0)}}e:{if(f=u?ds(u):window,g=f.nodeName&&f.nodeName.toLowerCase(),g==="select"||g==="input"&&f.type==="file")var b=Ub;else if(Op(f))if(by)b=Hb;else{b=Vb;var E=zb}else(g=f.nodeName)&&g.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(b=Bb);if(b&&(b=b(t,u))){_y(d,b,n,c);break e}E&&E(t,f,u),t==="focusout"&&(E=f._wrapperState)&&E.controlled&&f.type==="number"&&rd(f,"number",f.value)}switch(E=u?ds(u):window,t){case"focusin":(Op(E)||E.contentEditable==="true")&&(us=E,md=u,Ii=null);break;case"focusout":Ii=md=us=null;break;case"mousedown":gd=!0;break;case"contextmenu":case"mouseup":case"dragend":gd=!1,Ip(d,n,c);break;case"selectionchange":if(Zb)break;case"keydown":case"keyup":Ip(d,n,c)}var k;if(Mf)e:{switch(t){case"compositionstart":var O="onCompositionStart";break e;case"compositionend":O="onCompositionEnd";break e;case"compositionupdate":O="onCompositionUpdate";break e}O=void 0}else ls?vy(t,n)&&(O="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(O="onCompositionStart");O&&(yy&&n.locale!=="ko"&&(ls||O!=="onCompositionStart"?O==="onCompositionEnd"&&ls&&(k=gy()):(Kn=c,jf="value"in Kn?Kn.value:Kn.textContent,ls=!0)),E=Jo(u,O),0<E.length&&(O=new kp(O,t,null,n,c),d.push({event:O,listeners:E}),k?O.data=k:(k=wy(n),k!==null&&(O.data=k)))),(k=$b?Lb(t,n):Mb(t,n))&&(u=Jo(u,"onBeforeInput"),0<u.length&&(c=new kp("onBeforeInput","beforeinput",null,n,c),d.push({event:c,listeners:u}),c.data=k))}Ry(d,e)})}function Ki(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Jo(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Hi(t,n),i!=null&&r.unshift(Ki(t,i,s)),i=Hi(t,e),i!=null&&r.push(Ki(t,i,s))),t=t.return}return r}function Kr(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function $p(t,e,n,r,s){for(var i=e._reactName,a=[];n!==null&&n!==r;){var o=n,l=o.alternate,u=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&u!==null&&(o=u,s?(l=Hi(n,i),l!=null&&a.unshift(Ki(n,l,o))):s||(l=Hi(n,i),l!=null&&a.push(Ki(n,l,o)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var Kb=/\r\n?/g,Jb=/\u0000|\uFFFD/g;function Lp(t){return(typeof t=="string"?t:""+t).replace(Kb,`
`).replace(Jb,"")}function Ja(t,e,n){if(e=Lp(e),Lp(t)!==e&&n)throw Error(S(425))}function Xo(){}var yd=null,vd=null;function wd(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var _d=typeof setTimeout=="function"?setTimeout:void 0,Xb=typeof clearTimeout=="function"?clearTimeout:void 0,Mp=typeof Promise=="function"?Promise:void 0,e0=typeof queueMicrotask=="function"?queueMicrotask:typeof Mp<"u"?function(t){return Mp.resolve(null).then(t).catch(t0)}:_d;function t0(t){setTimeout(function(){throw t})}function hc(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Zi(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Zi(e)}function rr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Dp(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Qs=Math.random().toString(36).slice(2),on="__reactFiber$"+Qs,Ji="__reactProps$"+Qs,jn="__reactContainer$"+Qs,bd="__reactEvents$"+Qs,n0="__reactListeners$"+Qs,r0="__reactHandles$"+Qs;function Ar(t){var e=t[on];if(e)return e;for(var n=t.parentNode;n;){if(e=n[jn]||n[on]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Dp(t);t!==null;){if(n=t[on])return n;t=Dp(t)}return e}t=n,n=t.parentNode}return null}function Aa(t){return t=t[on]||t[jn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ds(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(S(33))}function _u(t){return t[Ji]||null}var Ed=[],fs=-1;function wr(t){return{current:t}}function te(t){0>fs||(t.current=Ed[fs],Ed[fs]=null,fs--)}function X(t,e){fs++,Ed[fs]=t.current,t.current=e}var fr={},Ve=wr(fr),it=wr(!1),Mr=fr;function Ms(t,e){var n=t.type.contextTypes;if(!n)return fr;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function at(t){return t=t.childContextTypes,t!=null}function el(){te(it),te(Ve)}function Fp(t,e,n){if(Ve.current!==fr)throw Error(S(168));X(Ve,e),X(it,n)}function Ny(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(S(108,z_(t)||"Unknown",s));return de({},n,r)}function tl(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||fr,Mr=Ve.current,X(Ve,t),X(it,it.current),!0}function Up(t,e,n){var r=t.stateNode;if(!r)throw Error(S(169));n?(t=Ny(t,e,Mr),r.__reactInternalMemoizedMergedChildContext=t,te(it),te(Ve),X(Ve,t)):te(it),X(it,n)}var On=null,bu=!1,pc=!1;function jy(t){On===null?On=[t]:On.push(t)}function s0(t){bu=!0,jy(t)}function _r(){if(!pc&&On!==null){pc=!0;var t=0,e=K;try{var n=On;for(K=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}On=null,bu=!1}catch(s){throw On!==null&&(On=On.slice(t+1)),iy(Cf,_r),s}finally{K=e,pc=!1}}return null}var hs=[],ps=0,nl=null,rl=0,kt=[],St=0,Dr=null,An=1,Cn="";function xr(t,e){hs[ps++]=rl,hs[ps++]=nl,nl=t,rl=e}function $y(t,e,n){kt[St++]=An,kt[St++]=Cn,kt[St++]=Dr,Dr=t;var r=An;t=Cn;var s=32-Gt(r)-1;r&=~(1<<s),n+=1;var i=32-Gt(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,An=1<<32-Gt(e)+s|n<<s|r,Cn=i+t}else An=1<<i|n<<s|r,Cn=t}function Ff(t){t.return!==null&&(xr(t,1),$y(t,1,0))}function Uf(t){for(;t===nl;)nl=hs[--ps],hs[ps]=null,rl=hs[--ps],hs[ps]=null;for(;t===Dr;)Dr=kt[--St],kt[St]=null,Cn=kt[--St],kt[St]=null,An=kt[--St],kt[St]=null}var gt=null,mt=null,re=!1,Bt=null;function Ly(t,e){var n=Pt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function zp(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,gt=t,mt=rr(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,gt=t,mt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Dr!==null?{id:An,overflow:Cn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Pt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,gt=t,mt=null,!0):!1;default:return!1}}function kd(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Sd(t){if(re){var e=mt;if(e){var n=e;if(!zp(t,e)){if(kd(t))throw Error(S(418));e=rr(n.nextSibling);var r=gt;e&&zp(t,e)?Ly(r,n):(t.flags=t.flags&-4097|2,re=!1,gt=t)}}else{if(kd(t))throw Error(S(418));t.flags=t.flags&-4097|2,re=!1,gt=t}}}function Vp(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;gt=t}function Xa(t){if(t!==gt)return!1;if(!re)return Vp(t),re=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!wd(t.type,t.memoizedProps)),e&&(e=mt)){if(kd(t))throw My(),Error(S(418));for(;e;)Ly(t,e),e=rr(e.nextSibling)}if(Vp(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(S(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){mt=rr(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}mt=null}}else mt=gt?rr(t.stateNode.nextSibling):null;return!0}function My(){for(var t=mt;t;)t=rr(t.nextSibling)}function Ds(){mt=gt=null,re=!1}function zf(t){Bt===null?Bt=[t]:Bt.push(t)}var i0=Dn.ReactCurrentBatchConfig;function li(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(S(309));var r=n.stateNode}if(!r)throw Error(S(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var o=s.refs;a===null?delete o[i]:o[i]=a},e._stringRef=i,e)}if(typeof t!="string")throw Error(S(284));if(!n._owner)throw Error(S(290,t))}return t}function eo(t,e){throw t=Object.prototype.toString.call(e),Error(S(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Bp(t){var e=t._init;return e(t._payload)}function Dy(t){function e(m,h){if(t){var y=m.deletions;y===null?(m.deletions=[h],m.flags|=16):y.push(h)}}function n(m,h){if(!t)return null;for(;h!==null;)e(m,h),h=h.sibling;return null}function r(m,h){for(m=new Map;h!==null;)h.key!==null?m.set(h.key,h):m.set(h.index,h),h=h.sibling;return m}function s(m,h){return m=or(m,h),m.index=0,m.sibling=null,m}function i(m,h,y){return m.index=y,t?(y=m.alternate,y!==null?(y=y.index,y<h?(m.flags|=2,h):y):(m.flags|=2,h)):(m.flags|=1048576,h)}function a(m){return t&&m.alternate===null&&(m.flags|=2),m}function o(m,h,y,_){return h===null||h.tag!==6?(h=bc(y,m.mode,_),h.return=m,h):(h=s(h,y),h.return=m,h)}function l(m,h,y,_){var b=y.type;return b===os?c(m,h,y.props.children,_,y.key):h!==null&&(h.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===Hn&&Bp(b)===h.type)?(_=s(h,y.props),_.ref=li(m,h,y),_.return=m,_):(_=To(y.type,y.key,y.props,null,m.mode,_),_.ref=li(m,h,y),_.return=m,_)}function u(m,h,y,_){return h===null||h.tag!==4||h.stateNode.containerInfo!==y.containerInfo||h.stateNode.implementation!==y.implementation?(h=Ec(y,m.mode,_),h.return=m,h):(h=s(h,y.children||[]),h.return=m,h)}function c(m,h,y,_,b){return h===null||h.tag!==7?(h=jr(y,m.mode,_,b),h.return=m,h):(h=s(h,y),h.return=m,h)}function d(m,h,y){if(typeof h=="string"&&h!==""||typeof h=="number")return h=bc(""+h,m.mode,y),h.return=m,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case Ba:return y=To(h.type,h.key,h.props,null,m.mode,y),y.ref=li(m,null,h),y.return=m,y;case as:return h=Ec(h,m.mode,y),h.return=m,h;case Hn:var _=h._init;return d(m,_(h._payload),y)}if(fi(h)||ri(h))return h=jr(h,m.mode,y,null),h.return=m,h;eo(m,h)}return null}function f(m,h,y,_){var b=h!==null?h.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return b!==null?null:o(m,h,""+y,_);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Ba:return y.key===b?l(m,h,y,_):null;case as:return y.key===b?u(m,h,y,_):null;case Hn:return b=y._init,f(m,h,b(y._payload),_)}if(fi(y)||ri(y))return b!==null?null:c(m,h,y,_,null);eo(m,y)}return null}function g(m,h,y,_,b){if(typeof _=="string"&&_!==""||typeof _=="number")return m=m.get(y)||null,o(h,m,""+_,b);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Ba:return m=m.get(_.key===null?y:_.key)||null,l(h,m,_,b);case as:return m=m.get(_.key===null?y:_.key)||null,u(h,m,_,b);case Hn:var E=_._init;return g(m,h,y,E(_._payload),b)}if(fi(_)||ri(_))return m=m.get(y)||null,c(h,m,_,b,null);eo(h,_)}return null}function p(m,h,y,_){for(var b=null,E=null,k=h,O=h=0,$=null;k!==null&&O<y.length;O++){k.index>O?($=k,k=null):$=k.sibling;var M=f(m,k,y[O],_);if(M===null){k===null&&(k=$);break}t&&k&&M.alternate===null&&e(m,k),h=i(M,h,O),E===null?b=M:E.sibling=M,E=M,k=$}if(O===y.length)return n(m,k),re&&xr(m,O),b;if(k===null){for(;O<y.length;O++)k=d(m,y[O],_),k!==null&&(h=i(k,h,O),E===null?b=k:E.sibling=k,E=k);return re&&xr(m,O),b}for(k=r(m,k);O<y.length;O++)$=g(k,m,O,y[O],_),$!==null&&(t&&$.alternate!==null&&k.delete($.key===null?O:$.key),h=i($,h,O),E===null?b=$:E.sibling=$,E=$);return t&&k.forEach(function(he){return e(m,he)}),re&&xr(m,O),b}function v(m,h,y,_){var b=ri(y);if(typeof b!="function")throw Error(S(150));if(y=b.call(y),y==null)throw Error(S(151));for(var E=b=null,k=h,O=h=0,$=null,M=y.next();k!==null&&!M.done;O++,M=y.next()){k.index>O?($=k,k=null):$=k.sibling;var he=f(m,k,M.value,_);if(he===null){k===null&&(k=$);break}t&&k&&he.alternate===null&&e(m,k),h=i(he,h,O),E===null?b=he:E.sibling=he,E=he,k=$}if(M.done)return n(m,k),re&&xr(m,O),b;if(k===null){for(;!M.done;O++,M=y.next())M=d(m,M.value,_),M!==null&&(h=i(M,h,O),E===null?b=M:E.sibling=M,E=M);return re&&xr(m,O),b}for(k=r(m,k);!M.done;O++,M=y.next())M=g(k,m,O,M.value,_),M!==null&&(t&&M.alternate!==null&&k.delete(M.key===null?O:M.key),h=i(M,h,O),E===null?b=M:E.sibling=M,E=M);return t&&k.forEach(function(_n){return e(m,_n)}),re&&xr(m,O),b}function w(m,h,y,_){if(typeof y=="object"&&y!==null&&y.type===os&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case Ba:e:{for(var b=y.key,E=h;E!==null;){if(E.key===b){if(b=y.type,b===os){if(E.tag===7){n(m,E.sibling),h=s(E,y.props.children),h.return=m,m=h;break e}}else if(E.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===Hn&&Bp(b)===E.type){n(m,E.sibling),h=s(E,y.props),h.ref=li(m,E,y),h.return=m,m=h;break e}n(m,E);break}else e(m,E);E=E.sibling}y.type===os?(h=jr(y.props.children,m.mode,_,y.key),h.return=m,m=h):(_=To(y.type,y.key,y.props,null,m.mode,_),_.ref=li(m,h,y),_.return=m,m=_)}return a(m);case as:e:{for(E=y.key;h!==null;){if(h.key===E)if(h.tag===4&&h.stateNode.containerInfo===y.containerInfo&&h.stateNode.implementation===y.implementation){n(m,h.sibling),h=s(h,y.children||[]),h.return=m,m=h;break e}else{n(m,h);break}else e(m,h);h=h.sibling}h=Ec(y,m.mode,_),h.return=m,m=h}return a(m);case Hn:return E=y._init,w(m,h,E(y._payload),_)}if(fi(y))return p(m,h,y,_);if(ri(y))return v(m,h,y,_);eo(m,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,h!==null&&h.tag===6?(n(m,h.sibling),h=s(h,y),h.return=m,m=h):(n(m,h),h=bc(y,m.mode,_),h.return=m,m=h),a(m)):n(m,h)}return w}var Fs=Dy(!0),Fy=Dy(!1),sl=wr(null),il=null,ms=null,Vf=null;function Bf(){Vf=ms=il=null}function Hf(t){var e=sl.current;te(sl),t._currentValue=e}function xd(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Os(t,e){il=t,Vf=ms=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(rt=!0),t.firstContext=null)}function Tt(t){var e=t._currentValue;if(Vf!==t)if(t={context:t,memoizedValue:e,next:null},ms===null){if(il===null)throw Error(S(308));ms=t,il.dependencies={lanes:0,firstContext:t}}else ms=ms.next=t;return e}var Cr=null;function qf(t){Cr===null?Cr=[t]:Cr.push(t)}function Uy(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,qf(e)):(n.next=s.next,s.next=n),e.interleaved=n,$n(t,r)}function $n(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var qn=!1;function Wf(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function zy(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Rn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function sr(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Z&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,$n(t,n)}return s=r.interleaved,s===null?(e.next=e,qf(r)):(e.next=s.next,s.next=e),r.interleaved=e,$n(t,n)}function Eo(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Rf(t,n)}}function Hp(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function al(t,e,n,r){var s=t.updateQueue;qn=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?i=u:a.next=u,a=l;var c=t.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==a&&(o===null?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l))}if(i!==null){var d=s.baseState;a=0,c=u=l=null,o=i;do{var f=o.lane,g=o.eventTime;if((r&f)===f){c!==null&&(c=c.next={eventTime:g,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=t,v=o;switch(f=e,g=n,v.tag){case 1:if(p=v.payload,typeof p=="function"){d=p.call(g,d,f);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=v.payload,f=typeof p=="function"?p.call(g,d,f):p,f==null)break e;d=de({},d,f);break e;case 2:qn=!0}}o.callback!==null&&o.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[o]:f.push(o))}else g={eventTime:g,lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(u=c=g,l=d):c=c.next=g,a|=f;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;f=o,o=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(c===null&&(l=d),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=c,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Ur|=a,t.lanes=a,t.memoizedState=d}}function qp(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(S(191,s));s.call(r)}}}var Ca={},pn=wr(Ca),Xi=wr(Ca),ea=wr(Ca);function Rr(t){if(t===Ca)throw Error(S(174));return t}function Zf(t,e){switch(X(ea,e),X(Xi,t),X(pn,Ca),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:id(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=id(e,t)}te(pn),X(pn,e)}function Us(){te(pn),te(Xi),te(ea)}function Vy(t){Rr(ea.current);var e=Rr(pn.current),n=id(e,t.type);e!==n&&(X(Xi,t),X(pn,n))}function Gf(t){Xi.current===t&&(te(pn),te(Xi))}var oe=wr(0);function ol(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var mc=[];function Yf(){for(var t=0;t<mc.length;t++)mc[t]._workInProgressVersionPrimary=null;mc.length=0}var ko=Dn.ReactCurrentDispatcher,gc=Dn.ReactCurrentBatchConfig,Fr=0,ue=null,be=null,Pe=null,ll=!1,Ni=!1,ta=0,a0=0;function Le(){throw Error(S(321))}function Qf(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Jt(t[n],e[n]))return!1;return!0}function Kf(t,e,n,r,s,i){if(Fr=i,ue=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ko.current=t===null||t.memoizedState===null?c0:d0,t=n(r,s),Ni){i=0;do{if(Ni=!1,ta=0,25<=i)throw Error(S(301));i+=1,Pe=be=null,e.updateQueue=null,ko.current=f0,t=n(r,s)}while(Ni)}if(ko.current=ul,e=be!==null&&be.next!==null,Fr=0,Pe=be=ue=null,ll=!1,e)throw Error(S(300));return t}function Jf(){var t=ta!==0;return ta=0,t}function sn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pe===null?ue.memoizedState=Pe=t:Pe=Pe.next=t,Pe}function At(){if(be===null){var t=ue.alternate;t=t!==null?t.memoizedState:null}else t=be.next;var e=Pe===null?ue.memoizedState:Pe.next;if(e!==null)Pe=e,be=t;else{if(t===null)throw Error(S(310));be=t,t={memoizedState:be.memoizedState,baseState:be.baseState,baseQueue:be.baseQueue,queue:be.queue,next:null},Pe===null?ue.memoizedState=Pe=t:Pe=Pe.next=t}return Pe}function na(t,e){return typeof e=="function"?e(t):e}function yc(t){var e=At(),n=e.queue;if(n===null)throw Error(S(311));n.lastRenderedReducer=t;var r=be,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var o=a=null,l=null,u=i;do{var c=u.lane;if((Fr&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=d,a=r):l=l.next=d,ue.lanes|=c,Ur|=c}u=u.next}while(u!==null&&u!==i);l===null?a=r:l.next=o,Jt(r,e.memoizedState)||(rt=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,ue.lanes|=i,Ur|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function vc(t){var e=At(),n=e.queue;if(n===null)throw Error(S(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var a=s=s.next;do i=t(i,a.action),a=a.next;while(a!==s);Jt(i,e.memoizedState)||(rt=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function By(){}function Hy(t,e){var n=ue,r=At(),s=e(),i=!Jt(r.memoizedState,s);if(i&&(r.memoizedState=s,rt=!0),r=r.queue,Xf(Zy.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Pe!==null&&Pe.memoizedState.tag&1){if(n.flags|=2048,ra(9,Wy.bind(null,n,r,s,e),void 0,null),Te===null)throw Error(S(349));Fr&30||qy(n,e,s)}return s}function qy(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ue.updateQueue,e===null?(e={lastEffect:null,stores:null},ue.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Wy(t,e,n,r){e.value=n,e.getSnapshot=r,Gy(e)&&Yy(t)}function Zy(t,e,n){return n(function(){Gy(e)&&Yy(t)})}function Gy(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Jt(t,n)}catch{return!0}}function Yy(t){var e=$n(t,1);e!==null&&Yt(e,t,1,-1)}function Wp(t){var e=sn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:na,lastRenderedState:t},e.queue=t,t=t.dispatch=u0.bind(null,ue,t),[e.memoizedState,t]}function ra(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=ue.updateQueue,e===null?(e={lastEffect:null,stores:null},ue.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Qy(){return At().memoizedState}function So(t,e,n,r){var s=sn();ue.flags|=t,s.memoizedState=ra(1|e,n,void 0,r===void 0?null:r)}function Eu(t,e,n,r){var s=At();r=r===void 0?null:r;var i=void 0;if(be!==null){var a=be.memoizedState;if(i=a.destroy,r!==null&&Qf(r,a.deps)){s.memoizedState=ra(e,n,i,r);return}}ue.flags|=t,s.memoizedState=ra(1|e,n,i,r)}function Zp(t,e){return So(8390656,8,t,e)}function Xf(t,e){return Eu(2048,8,t,e)}function Ky(t,e){return Eu(4,2,t,e)}function Jy(t,e){return Eu(4,4,t,e)}function Xy(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function ev(t,e,n){return n=n!=null?n.concat([t]):null,Eu(4,4,Xy.bind(null,e,t),n)}function eh(){}function tv(t,e){var n=At();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Qf(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function nv(t,e){var n=At();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Qf(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function rv(t,e,n){return Fr&21?(Jt(n,e)||(n=ly(),ue.lanes|=n,Ur|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,rt=!0),t.memoizedState=n)}function o0(t,e){var n=K;K=n!==0&&4>n?n:4,t(!0);var r=gc.transition;gc.transition={};try{t(!1),e()}finally{K=n,gc.transition=r}}function sv(){return At().memoizedState}function l0(t,e,n){var r=ar(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},iv(t))av(e,n);else if(n=Uy(t,e,n,r),n!==null){var s=Ge();Yt(n,t,r,s),ov(n,e,r)}}function u0(t,e,n){var r=ar(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(iv(t))av(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,o=i(a,n);if(s.hasEagerState=!0,s.eagerState=o,Jt(o,a)){var l=e.interleaved;l===null?(s.next=s,qf(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}n=Uy(t,e,s,r),n!==null&&(s=Ge(),Yt(n,t,r,s),ov(n,e,r))}}function iv(t){var e=t.alternate;return t===ue||e!==null&&e===ue}function av(t,e){Ni=ll=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function ov(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Rf(t,n)}}var ul={readContext:Tt,useCallback:Le,useContext:Le,useEffect:Le,useImperativeHandle:Le,useInsertionEffect:Le,useLayoutEffect:Le,useMemo:Le,useReducer:Le,useRef:Le,useState:Le,useDebugValue:Le,useDeferredValue:Le,useTransition:Le,useMutableSource:Le,useSyncExternalStore:Le,useId:Le,unstable_isNewReconciler:!1},c0={readContext:Tt,useCallback:function(t,e){return sn().memoizedState=[t,e===void 0?null:e],t},useContext:Tt,useEffect:Zp,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,So(4194308,4,Xy.bind(null,e,t),n)},useLayoutEffect:function(t,e){return So(4194308,4,t,e)},useInsertionEffect:function(t,e){return So(4,2,t,e)},useMemo:function(t,e){var n=sn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=sn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=l0.bind(null,ue,t),[r.memoizedState,t]},useRef:function(t){var e=sn();return t={current:t},e.memoizedState=t},useState:Wp,useDebugValue:eh,useDeferredValue:function(t){return sn().memoizedState=t},useTransition:function(){var t=Wp(!1),e=t[0];return t=o0.bind(null,t[1]),sn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=ue,s=sn();if(re){if(n===void 0)throw Error(S(407));n=n()}else{if(n=e(),Te===null)throw Error(S(349));Fr&30||qy(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,Zp(Zy.bind(null,r,i,t),[t]),r.flags|=2048,ra(9,Wy.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=sn(),e=Te.identifierPrefix;if(re){var n=Cn,r=An;n=(r&~(1<<32-Gt(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=ta++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=a0++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},d0={readContext:Tt,useCallback:tv,useContext:Tt,useEffect:Xf,useImperativeHandle:ev,useInsertionEffect:Ky,useLayoutEffect:Jy,useMemo:nv,useReducer:yc,useRef:Qy,useState:function(){return yc(na)},useDebugValue:eh,useDeferredValue:function(t){var e=At();return rv(e,be.memoizedState,t)},useTransition:function(){var t=yc(na)[0],e=At().memoizedState;return[t,e]},useMutableSource:By,useSyncExternalStore:Hy,useId:sv,unstable_isNewReconciler:!1},f0={readContext:Tt,useCallback:tv,useContext:Tt,useEffect:Xf,useImperativeHandle:ev,useInsertionEffect:Ky,useLayoutEffect:Jy,useMemo:nv,useReducer:vc,useRef:Qy,useState:function(){return vc(na)},useDebugValue:eh,useDeferredValue:function(t){var e=At();return be===null?e.memoizedState=t:rv(e,be.memoizedState,t)},useTransition:function(){var t=vc(na)[0],e=At().memoizedState;return[t,e]},useMutableSource:By,useSyncExternalStore:Hy,useId:sv,unstable_isNewReconciler:!1};function Ut(t,e){if(t&&t.defaultProps){e=de({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Pd(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:de({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var ku={isMounted:function(t){return(t=t._reactInternals)?Gr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Ge(),s=ar(t),i=Rn(r,s);i.payload=e,n!=null&&(i.callback=n),e=sr(t,i,s),e!==null&&(Yt(e,t,s,r),Eo(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Ge(),s=ar(t),i=Rn(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=sr(t,i,s),e!==null&&(Yt(e,t,s,r),Eo(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ge(),r=ar(t),s=Rn(n,r);s.tag=2,e!=null&&(s.callback=e),e=sr(t,s,r),e!==null&&(Yt(e,t,r,n),Eo(e,t,r))}};function Gp(t,e,n,r,s,i,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!Yi(n,r)||!Yi(s,i):!0}function lv(t,e,n){var r=!1,s=fr,i=e.contextType;return typeof i=="object"&&i!==null?i=Tt(i):(s=at(e)?Mr:Ve.current,r=e.contextTypes,i=(r=r!=null)?Ms(t,s):fr),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ku,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function Yp(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&ku.enqueueReplaceState(e,e.state,null)}function Od(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Wf(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Tt(i):(i=at(e)?Mr:Ve.current,s.context=Ms(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Pd(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&ku.enqueueReplaceState(s,s.state,null),al(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function zs(t,e){try{var n="",r=e;do n+=U_(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function wc(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Td(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var h0=typeof WeakMap=="function"?WeakMap:Map;function uv(t,e,n){n=Rn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){dl||(dl=!0,Dd=r),Td(t,e)},n}function cv(t,e,n){n=Rn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Td(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Td(t,e),typeof r!="function"&&(ir===null?ir=new Set([this]):ir.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function Qp(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new h0;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=O0.bind(null,t,e,n),e.then(t,t))}function Kp(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Jp(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Rn(-1,1),e.tag=2,sr(n,e,1))),n.lanes|=1),t)}var p0=Dn.ReactCurrentOwner,rt=!1;function qe(t,e,n,r){e.child=t===null?Fy(e,null,n,r):Fs(e,t.child,n,r)}function Xp(t,e,n,r,s){n=n.render;var i=e.ref;return Os(e,s),r=Kf(t,e,n,r,i,s),n=Jf(),t!==null&&!rt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Ln(t,e,s)):(re&&n&&Ff(e),e.flags|=1,qe(t,e,r,s),e.child)}function em(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!lh(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,dv(t,e,i,r,s)):(t=To(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:Yi,n(a,r)&&t.ref===e.ref)return Ln(t,e,s)}return e.flags|=1,t=or(i,r),t.ref=e.ref,t.return=e,e.child=t}function dv(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Yi(i,r)&&t.ref===e.ref)if(rt=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(rt=!0);else return e.lanes=t.lanes,Ln(t,e,s)}return Ad(t,e,n,r,s)}function fv(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},X(ys,ht),ht|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,X(ys,ht),ht|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,X(ys,ht),ht|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,X(ys,ht),ht|=r;return qe(t,e,s,n),e.child}function hv(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Ad(t,e,n,r,s){var i=at(n)?Mr:Ve.current;return i=Ms(e,i),Os(e,s),n=Kf(t,e,n,r,i,s),r=Jf(),t!==null&&!rt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Ln(t,e,s)):(re&&r&&Ff(e),e.flags|=1,qe(t,e,n,s),e.child)}function tm(t,e,n,r,s){if(at(n)){var i=!0;tl(e)}else i=!1;if(Os(e,s),e.stateNode===null)xo(t,e),lv(e,n,r),Od(e,n,r,s),r=!0;else if(t===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,u=n.contextType;typeof u=="object"&&u!==null?u=Tt(u):(u=at(n)?Mr:Ve.current,u=Ms(e,u));var c=n.getDerivedStateFromProps,d=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==u)&&Yp(e,a,r,u),qn=!1;var f=e.memoizedState;a.state=f,al(e,r,a,s),l=e.memoizedState,o!==r||f!==l||it.current||qn?(typeof c=="function"&&(Pd(e,n,c,r),l=e.memoizedState),(o=qn||Gp(e,n,o,r,f,l,u))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),a.props=r,a.state=l,a.context=u,r=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,zy(t,e),o=e.memoizedProps,u=e.type===e.elementType?o:Ut(e.type,o),a.props=u,d=e.pendingProps,f=a.context,l=n.contextType,typeof l=="object"&&l!==null?l=Tt(l):(l=at(n)?Mr:Ve.current,l=Ms(e,l));var g=n.getDerivedStateFromProps;(c=typeof g=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==d||f!==l)&&Yp(e,a,r,l),qn=!1,f=e.memoizedState,a.state=f,al(e,r,a,s);var p=e.memoizedState;o!==d||f!==p||it.current||qn?(typeof g=="function"&&(Pd(e,n,g,r),p=e.memoizedState),(u=qn||Gp(e,n,u,r,f,p,l)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,p,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,p,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),a.props=r,a.state=p,a.context=l,r=u):(typeof a.componentDidUpdate!="function"||o===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return Cd(t,e,n,r,i,s)}function Cd(t,e,n,r,s,i){hv(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&Up(e,n,!1),Ln(t,e,i);r=e.stateNode,p0.current=e;var o=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=Fs(e,t.child,null,i),e.child=Fs(e,null,o,i)):qe(t,e,o,i),e.memoizedState=r.state,s&&Up(e,n,!0),e.child}function pv(t){var e=t.stateNode;e.pendingContext?Fp(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Fp(t,e.context,!1),Zf(t,e.containerInfo)}function nm(t,e,n,r,s){return Ds(),zf(s),e.flags|=256,qe(t,e,n,r),e.child}var Rd={dehydrated:null,treeContext:null,retryLane:0};function Id(t){return{baseLanes:t,cachePool:null,transitions:null}}function mv(t,e,n){var r=e.pendingProps,s=oe.current,i=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=t!==null&&t.memoizedState===null?!1:(s&2)!==0),o?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),X(oe,s&1),t===null)return Sd(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Pu(a,r,0,null),t=jr(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Id(n),e.memoizedState=Rd,t):th(e,a));if(s=t.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return m0(t,e,a,r,o,s,n);if(i){i=r.fallback,a=e.mode,s=t.child,o=s.sibling;var l={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=or(s,l),r.subtreeFlags=s.subtreeFlags&14680064),o!==null?i=or(o,i):(i=jr(i,a,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=t.child.memoizedState,a=a===null?Id(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=t.childLanes&~n,e.memoizedState=Rd,r}return i=t.child,t=i.sibling,r=or(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function th(t,e){return e=Pu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function to(t,e,n,r){return r!==null&&zf(r),Fs(e,t.child,null,n),t=th(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function m0(t,e,n,r,s,i,a){if(n)return e.flags&256?(e.flags&=-257,r=wc(Error(S(422))),to(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Pu({mode:"visible",children:r.children},s,0,null),i=jr(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Fs(e,t.child,null,a),e.child.memoizedState=Id(a),e.memoizedState=Rd,i);if(!(e.mode&1))return to(t,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var o=r.dgst;return r=o,i=Error(S(419)),r=wc(i,r,void 0),to(t,e,a,r)}if(o=(a&t.childLanes)!==0,rt||o){if(r=Te,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,$n(t,s),Yt(r,t,s,-1))}return oh(),r=wc(Error(S(421))),to(t,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=T0.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,mt=rr(s.nextSibling),gt=e,re=!0,Bt=null,t!==null&&(kt[St++]=An,kt[St++]=Cn,kt[St++]=Dr,An=t.id,Cn=t.overflow,Dr=e),e=th(e,r.children),e.flags|=4096,e)}function rm(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),xd(t.return,e,n)}function _c(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function gv(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(qe(t,e,r.children,n),r=oe.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&rm(t,n,e);else if(t.tag===19)rm(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(X(oe,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&ol(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),_c(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&ol(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}_c(e,!0,n,null,i);break;case"together":_c(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function xo(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ln(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ur|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(S(153));if(e.child!==null){for(t=e.child,n=or(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=or(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function g0(t,e,n){switch(e.tag){case 3:pv(e),Ds();break;case 5:Vy(e);break;case 1:at(e.type)&&tl(e);break;case 4:Zf(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;X(sl,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(X(oe,oe.current&1),e.flags|=128,null):n&e.child.childLanes?mv(t,e,n):(X(oe,oe.current&1),t=Ln(t,e,n),t!==null?t.sibling:null);X(oe,oe.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return gv(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),X(oe,oe.current),r)break;return null;case 22:case 23:return e.lanes=0,fv(t,e,n)}return Ln(t,e,n)}var yv,Nd,vv,wv;yv=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Nd=function(){};vv=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Rr(pn.current);var i=null;switch(n){case"input":s=td(t,s),r=td(t,r),i=[];break;case"select":s=de({},s,{value:void 0}),r=de({},r,{value:void 0}),i=[];break;case"textarea":s=sd(t,s),r=sd(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Xo)}ad(n,r);var a;n=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var o=s[u];for(a in o)o.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Vi.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(o=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(i||(i=[]),i.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Vi.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&ee("scroll",t),i||o===l||(i=[])):(i=i||[]).push(u,l))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};wv=function(t,e,n,r){n!==r&&(e.flags|=4)};function ui(t,e){if(!re)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Me(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function y0(t,e,n){var r=e.pendingProps;switch(Uf(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Me(e),null;case 1:return at(e.type)&&el(),Me(e),null;case 3:return r=e.stateNode,Us(),te(it),te(Ve),Yf(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Xa(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Bt!==null&&(zd(Bt),Bt=null))),Nd(t,e),Me(e),null;case 5:Gf(e);var s=Rr(ea.current);if(n=e.type,t!==null&&e.stateNode!=null)vv(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(S(166));return Me(e),null}if(t=Rr(pn.current),Xa(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[on]=e,r[Ji]=i,t=(e.mode&1)!==0,n){case"dialog":ee("cancel",r),ee("close",r);break;case"iframe":case"object":case"embed":ee("load",r);break;case"video":case"audio":for(s=0;s<pi.length;s++)ee(pi[s],r);break;case"source":ee("error",r);break;case"img":case"image":case"link":ee("error",r),ee("load",r);break;case"details":ee("toggle",r);break;case"input":fp(r,i),ee("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},ee("invalid",r);break;case"textarea":pp(r,i),ee("invalid",r)}ad(n,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];a==="children"?typeof o=="string"?r.textContent!==o&&(i.suppressHydrationWarning!==!0&&Ja(r.textContent,o,t),s=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&Ja(r.textContent,o,t),s=["children",""+o]):Vi.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&ee("scroll",r)}switch(n){case"input":Ha(r),hp(r,i,!0);break;case"textarea":Ha(r),mp(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Xo)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Zg(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[on]=e,t[Ji]=r,yv(t,e,!1,!1),e.stateNode=t;e:{switch(a=od(n,r),n){case"dialog":ee("cancel",t),ee("close",t),s=r;break;case"iframe":case"object":case"embed":ee("load",t),s=r;break;case"video":case"audio":for(s=0;s<pi.length;s++)ee(pi[s],t);s=r;break;case"source":ee("error",t),s=r;break;case"img":case"image":case"link":ee("error",t),ee("load",t),s=r;break;case"details":ee("toggle",t),s=r;break;case"input":fp(t,r),s=td(t,r),ee("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=de({},r,{value:void 0}),ee("invalid",t);break;case"textarea":pp(t,r),s=sd(t,r),ee("invalid",t);break;default:s=r}ad(n,s),o=s;for(i in o)if(o.hasOwnProperty(i)){var l=o[i];i==="style"?Qg(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Gg(t,l)):i==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Bi(t,l):typeof l=="number"&&Bi(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Vi.hasOwnProperty(i)?l!=null&&i==="onScroll"&&ee("scroll",t):l!=null&&xf(t,i,l,a))}switch(n){case"input":Ha(t),hp(t,r,!1);break;case"textarea":Ha(t),mp(t);break;case"option":r.value!=null&&t.setAttribute("value",""+dr(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?ks(t,!!r.multiple,i,!1):r.defaultValue!=null&&ks(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Xo)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Me(e),null;case 6:if(t&&e.stateNode!=null)wv(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(S(166));if(n=Rr(ea.current),Rr(pn.current),Xa(e)){if(r=e.stateNode,n=e.memoizedProps,r[on]=e,(i=r.nodeValue!==n)&&(t=gt,t!==null))switch(t.tag){case 3:Ja(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Ja(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[on]=e,e.stateNode=r}return Me(e),null;case 13:if(te(oe),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(re&&mt!==null&&e.mode&1&&!(e.flags&128))My(),Ds(),e.flags|=98560,i=!1;else if(i=Xa(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(S(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(S(317));i[on]=e}else Ds(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Me(e),i=!1}else Bt!==null&&(zd(Bt),Bt=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||oe.current&1?Ee===0&&(Ee=3):oh())),e.updateQueue!==null&&(e.flags|=4),Me(e),null);case 4:return Us(),Nd(t,e),t===null&&Qi(e.stateNode.containerInfo),Me(e),null;case 10:return Hf(e.type._context),Me(e),null;case 17:return at(e.type)&&el(),Me(e),null;case 19:if(te(oe),i=e.memoizedState,i===null)return Me(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)ui(i,!1);else{if(Ee!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=ol(t),a!==null){for(e.flags|=128,ui(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,t=a.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return X(oe,oe.current&1|2),e.child}t=t.sibling}i.tail!==null&&me()>Vs&&(e.flags|=128,r=!0,ui(i,!1),e.lanes=4194304)}else{if(!r)if(t=ol(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ui(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!re)return Me(e),null}else 2*me()-i.renderingStartTime>Vs&&n!==1073741824&&(e.flags|=128,r=!0,ui(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(n=i.last,n!==null?n.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=me(),e.sibling=null,n=oe.current,X(oe,r?n&1|2:n&1),e):(Me(e),null);case 22:case 23:return ah(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ht&1073741824&&(Me(e),e.subtreeFlags&6&&(e.flags|=8192)):Me(e),null;case 24:return null;case 25:return null}throw Error(S(156,e.tag))}function v0(t,e){switch(Uf(e),e.tag){case 1:return at(e.type)&&el(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Us(),te(it),te(Ve),Yf(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Gf(e),null;case 13:if(te(oe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(S(340));Ds()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return te(oe),null;case 4:return Us(),null;case 10:return Hf(e.type._context),null;case 22:case 23:return ah(),null;case 24:return null;default:return null}}var no=!1,Fe=!1,w0=typeof WeakSet=="function"?WeakSet:Set,R=null;function gs(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){fe(t,e,r)}else n.current=null}function jd(t,e,n){try{n()}catch(r){fe(t,e,r)}}var sm=!1;function _0(t,e){if(yd=Qo,t=Sy(),Df(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,o=-1,l=-1,u=0,c=0,d=t,f=null;t:for(;;){for(var g;d!==n||s!==0&&d.nodeType!==3||(o=a+s),d!==i||r!==0&&d.nodeType!==3||(l=a+r),d.nodeType===3&&(a+=d.nodeValue.length),(g=d.firstChild)!==null;)f=d,d=g;for(;;){if(d===t)break t;if(f===n&&++u===s&&(o=a),f===i&&++c===r&&(l=a),(g=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=g}n=o===-1||l===-1?null:{start:o,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(vd={focusedElem:t,selectionRange:n},Qo=!1,R=e;R!==null;)if(e=R,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,R=t;else for(;R!==null;){e=R;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var v=p.memoizedProps,w=p.memoizedState,m=e.stateNode,h=m.getSnapshotBeforeUpdate(e.elementType===e.type?v:Ut(e.type,v),w);m.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(S(163))}}catch(_){fe(e,e.return,_)}if(t=e.sibling,t!==null){t.return=e.return,R=t;break}R=e.return}return p=sm,sm=!1,p}function ji(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&jd(e,n,i)}s=s.next}while(s!==r)}}function Su(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function $d(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function _v(t){var e=t.alternate;e!==null&&(t.alternate=null,_v(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[on],delete e[Ji],delete e[bd],delete e[n0],delete e[r0])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function bv(t){return t.tag===5||t.tag===3||t.tag===4}function im(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||bv(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Ld(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Xo));else if(r!==4&&(t=t.child,t!==null))for(Ld(t,e,n),t=t.sibling;t!==null;)Ld(t,e,n),t=t.sibling}function Md(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Md(t,e,n),t=t.sibling;t!==null;)Md(t,e,n),t=t.sibling}var Re=null,Vt=!1;function Un(t,e,n){for(n=n.child;n!==null;)Ev(t,e,n),n=n.sibling}function Ev(t,e,n){if(hn&&typeof hn.onCommitFiberUnmount=="function")try{hn.onCommitFiberUnmount(gu,n)}catch{}switch(n.tag){case 5:Fe||gs(n,e);case 6:var r=Re,s=Vt;Re=null,Un(t,e,n),Re=r,Vt=s,Re!==null&&(Vt?(t=Re,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Re.removeChild(n.stateNode));break;case 18:Re!==null&&(Vt?(t=Re,n=n.stateNode,t.nodeType===8?hc(t.parentNode,n):t.nodeType===1&&hc(t,n),Zi(t)):hc(Re,n.stateNode));break;case 4:r=Re,s=Vt,Re=n.stateNode.containerInfo,Vt=!0,Un(t,e,n),Re=r,Vt=s;break;case 0:case 11:case 14:case 15:if(!Fe&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&jd(n,e,a),s=s.next}while(s!==r)}Un(t,e,n);break;case 1:if(!Fe&&(gs(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){fe(n,e,o)}Un(t,e,n);break;case 21:Un(t,e,n);break;case 22:n.mode&1?(Fe=(r=Fe)||n.memoizedState!==null,Un(t,e,n),Fe=r):Un(t,e,n);break;default:Un(t,e,n)}}function am(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new w0),e.forEach(function(r){var s=A0.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function It(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:Re=o.stateNode,Vt=!1;break e;case 3:Re=o.stateNode.containerInfo,Vt=!0;break e;case 4:Re=o.stateNode.containerInfo,Vt=!0;break e}o=o.return}if(Re===null)throw Error(S(160));Ev(i,a,s),Re=null,Vt=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){fe(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)kv(e,t),e=e.sibling}function kv(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(It(e,t),nn(t),r&4){try{ji(3,t,t.return),Su(3,t)}catch(v){fe(t,t.return,v)}try{ji(5,t,t.return)}catch(v){fe(t,t.return,v)}}break;case 1:It(e,t),nn(t),r&512&&n!==null&&gs(n,n.return);break;case 5:if(It(e,t),nn(t),r&512&&n!==null&&gs(n,n.return),t.flags&32){var s=t.stateNode;try{Bi(s,"")}catch(v){fe(t,t.return,v)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,a=n!==null?n.memoizedProps:i,o=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&qg(s,i),od(o,a);var u=od(o,i);for(a=0;a<l.length;a+=2){var c=l[a],d=l[a+1];c==="style"?Qg(s,d):c==="dangerouslySetInnerHTML"?Gg(s,d):c==="children"?Bi(s,d):xf(s,c,d,u)}switch(o){case"input":nd(s,i);break;case"textarea":Wg(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var g=i.value;g!=null?ks(s,!!i.multiple,g,!1):f!==!!i.multiple&&(i.defaultValue!=null?ks(s,!!i.multiple,i.defaultValue,!0):ks(s,!!i.multiple,i.multiple?[]:"",!1))}s[Ji]=i}catch(v){fe(t,t.return,v)}}break;case 6:if(It(e,t),nn(t),r&4){if(t.stateNode===null)throw Error(S(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(v){fe(t,t.return,v)}}break;case 3:if(It(e,t),nn(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Zi(e.containerInfo)}catch(v){fe(t,t.return,v)}break;case 4:It(e,t),nn(t);break;case 13:It(e,t),nn(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(sh=me())),r&4&&am(t);break;case 22:if(c=n!==null&&n.memoizedState!==null,t.mode&1?(Fe=(u=Fe)||c,It(e,t),Fe=u):It(e,t),nn(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!c&&t.mode&1)for(R=t,c=t.child;c!==null;){for(d=R=c;R!==null;){switch(f=R,g=f.child,f.tag){case 0:case 11:case 14:case 15:ji(4,f,f.return);break;case 1:gs(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(v){fe(r,n,v)}}break;case 5:gs(f,f.return);break;case 22:if(f.memoizedState!==null){lm(d);continue}}g!==null?(g.return=f,R=g):lm(d)}c=c.sibling}e:for(c=null,d=t;;){if(d.tag===5){if(c===null){c=d;try{s=d.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=d.stateNode,l=d.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=Yg("display",a))}catch(v){fe(t,t.return,v)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(v){fe(t,t.return,v)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:It(e,t),nn(t),r&4&&am(t);break;case 21:break;default:It(e,t),nn(t)}}function nn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(bv(n)){var r=n;break e}n=n.return}throw Error(S(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Bi(s,""),r.flags&=-33);var i=im(t);Md(t,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,o=im(t);Ld(t,o,a);break;default:throw Error(S(161))}}catch(l){fe(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function b0(t,e,n){R=t,Sv(t)}function Sv(t,e,n){for(var r=(t.mode&1)!==0;R!==null;){var s=R,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||no;if(!a){var o=s.alternate,l=o!==null&&o.memoizedState!==null||Fe;o=no;var u=Fe;if(no=a,(Fe=l)&&!u)for(R=s;R!==null;)a=R,l=a.child,a.tag===22&&a.memoizedState!==null?um(s):l!==null?(l.return=a,R=l):um(s);for(;i!==null;)R=i,Sv(i),i=i.sibling;R=s,no=o,Fe=u}om(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,R=i):om(t)}}function om(t){for(;R!==null;){var e=R;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Fe||Su(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Fe)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Ut(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&qp(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}qp(e,a,n)}break;case 5:var o=e.stateNode;if(n===null&&e.flags&4){n=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&Zi(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(S(163))}Fe||e.flags&512&&$d(e)}catch(f){fe(e,e.return,f)}}if(e===t){R=null;break}if(n=e.sibling,n!==null){n.return=e.return,R=n;break}R=e.return}}function lm(t){for(;R!==null;){var e=R;if(e===t){R=null;break}var n=e.sibling;if(n!==null){n.return=e.return,R=n;break}R=e.return}}function um(t){for(;R!==null;){var e=R;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Su(4,e)}catch(l){fe(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){fe(e,s,l)}}var i=e.return;try{$d(e)}catch(l){fe(e,i,l)}break;case 5:var a=e.return;try{$d(e)}catch(l){fe(e,a,l)}}}catch(l){fe(e,e.return,l)}if(e===t){R=null;break}var o=e.sibling;if(o!==null){o.return=e.return,R=o;break}R=e.return}}var E0=Math.ceil,cl=Dn.ReactCurrentDispatcher,nh=Dn.ReactCurrentOwner,Ot=Dn.ReactCurrentBatchConfig,Z=0,Te=null,we=null,je=0,ht=0,ys=wr(0),Ee=0,sa=null,Ur=0,xu=0,rh=0,$i=null,nt=null,sh=0,Vs=1/0,Pn=null,dl=!1,Dd=null,ir=null,ro=!1,Jn=null,fl=0,Li=0,Fd=null,Po=-1,Oo=0;function Ge(){return Z&6?me():Po!==-1?Po:Po=me()}function ar(t){return t.mode&1?Z&2&&je!==0?je&-je:i0.transition!==null?(Oo===0&&(Oo=ly()),Oo):(t=K,t!==0||(t=window.event,t=t===void 0?16:my(t.type)),t):1}function Yt(t,e,n,r){if(50<Li)throw Li=0,Fd=null,Error(S(185));Oa(t,n,r),(!(Z&2)||t!==Te)&&(t===Te&&(!(Z&2)&&(xu|=n),Ee===4&&Yn(t,je)),ot(t,r),n===1&&Z===0&&!(e.mode&1)&&(Vs=me()+500,bu&&_r()))}function ot(t,e){var n=t.callbackNode;ib(t,e);var r=Yo(t,t===Te?je:0);if(r===0)n!==null&&vp(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&vp(n),e===1)t.tag===0?s0(cm.bind(null,t)):jy(cm.bind(null,t)),e0(function(){!(Z&6)&&_r()}),n=null;else{switch(uy(r)){case 1:n=Cf;break;case 4:n=ay;break;case 16:n=Go;break;case 536870912:n=oy;break;default:n=Go}n=Iv(n,xv.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function xv(t,e){if(Po=-1,Oo=0,Z&6)throw Error(S(327));var n=t.callbackNode;if(Ts()&&t.callbackNode!==n)return null;var r=Yo(t,t===Te?je:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=hl(t,r);else{e=r;var s=Z;Z|=2;var i=Ov();(Te!==t||je!==e)&&(Pn=null,Vs=me()+500,Nr(t,e));do try{x0();break}catch(o){Pv(t,o)}while(!0);Bf(),cl.current=i,Z=s,we!==null?e=0:(Te=null,je=0,e=Ee)}if(e!==0){if(e===2&&(s=fd(t),s!==0&&(r=s,e=Ud(t,s))),e===1)throw n=sa,Nr(t,0),Yn(t,r),ot(t,me()),n;if(e===6)Yn(t,r);else{if(s=t.current.alternate,!(r&30)&&!k0(s)&&(e=hl(t,r),e===2&&(i=fd(t),i!==0&&(r=i,e=Ud(t,i))),e===1))throw n=sa,Nr(t,0),Yn(t,r),ot(t,me()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(S(345));case 2:Pr(t,nt,Pn);break;case 3:if(Yn(t,r),(r&130023424)===r&&(e=sh+500-me(),10<e)){if(Yo(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Ge(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=_d(Pr.bind(null,t,nt,Pn),e);break}Pr(t,nt,Pn);break;case 4:if(Yn(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var a=31-Gt(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=me()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*E0(r/1960))-r,10<r){t.timeoutHandle=_d(Pr.bind(null,t,nt,Pn),r);break}Pr(t,nt,Pn);break;case 5:Pr(t,nt,Pn);break;default:throw Error(S(329))}}}return ot(t,me()),t.callbackNode===n?xv.bind(null,t):null}function Ud(t,e){var n=$i;return t.current.memoizedState.isDehydrated&&(Nr(t,e).flags|=256),t=hl(t,e),t!==2&&(e=nt,nt=n,e!==null&&zd(e)),t}function zd(t){nt===null?nt=t:nt.push.apply(nt,t)}function k0(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Jt(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Yn(t,e){for(e&=~rh,e&=~xu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Gt(e),r=1<<n;t[n]=-1,e&=~r}}function cm(t){if(Z&6)throw Error(S(327));Ts();var e=Yo(t,0);if(!(e&1))return ot(t,me()),null;var n=hl(t,e);if(t.tag!==0&&n===2){var r=fd(t);r!==0&&(e=r,n=Ud(t,r))}if(n===1)throw n=sa,Nr(t,0),Yn(t,e),ot(t,me()),n;if(n===6)throw Error(S(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Pr(t,nt,Pn),ot(t,me()),null}function ih(t,e){var n=Z;Z|=1;try{return t(e)}finally{Z=n,Z===0&&(Vs=me()+500,bu&&_r())}}function zr(t){Jn!==null&&Jn.tag===0&&!(Z&6)&&Ts();var e=Z;Z|=1;var n=Ot.transition,r=K;try{if(Ot.transition=null,K=1,t)return t()}finally{K=r,Ot.transition=n,Z=e,!(Z&6)&&_r()}}function ah(){ht=ys.current,te(ys)}function Nr(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Xb(n)),we!==null)for(n=we.return;n!==null;){var r=n;switch(Uf(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&el();break;case 3:Us(),te(it),te(Ve),Yf();break;case 5:Gf(r);break;case 4:Us();break;case 13:te(oe);break;case 19:te(oe);break;case 10:Hf(r.type._context);break;case 22:case 23:ah()}n=n.return}if(Te=t,we=t=or(t.current,null),je=ht=e,Ee=0,sa=null,rh=xu=Ur=0,nt=$i=null,Cr!==null){for(e=0;e<Cr.length;e++)if(n=Cr[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}n.pending=r}Cr=null}return t}function Pv(t,e){do{var n=we;try{if(Bf(),ko.current=ul,ll){for(var r=ue.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}ll=!1}if(Fr=0,Pe=be=ue=null,Ni=!1,ta=0,nh.current=null,n===null||n.return===null){Ee=1,sa=e,we=null;break}e:{var i=t,a=n.return,o=n,l=e;if(e=je,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=o,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var g=Kp(a);if(g!==null){g.flags&=-257,Jp(g,a,o,i,e),g.mode&1&&Qp(i,u,e),e=g,l=u;var p=e.updateQueue;if(p===null){var v=new Set;v.add(l),e.updateQueue=v}else p.add(l);break e}else{if(!(e&1)){Qp(i,u,e),oh();break e}l=Error(S(426))}}else if(re&&o.mode&1){var w=Kp(a);if(w!==null){!(w.flags&65536)&&(w.flags|=256),Jp(w,a,o,i,e),zf(zs(l,o));break e}}i=l=zs(l,o),Ee!==4&&(Ee=2),$i===null?$i=[i]:$i.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var m=uv(i,l,e);Hp(i,m);break e;case 1:o=l;var h=i.type,y=i.stateNode;if(!(i.flags&128)&&(typeof h.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(ir===null||!ir.has(y)))){i.flags|=65536,e&=-e,i.lanes|=e;var _=cv(i,o,e);Hp(i,_);break e}}i=i.return}while(i!==null)}Av(n)}catch(b){e=b,we===n&&n!==null&&(we=n=n.return);continue}break}while(!0)}function Ov(){var t=cl.current;return cl.current=ul,t===null?ul:t}function oh(){(Ee===0||Ee===3||Ee===2)&&(Ee=4),Te===null||!(Ur&268435455)&&!(xu&268435455)||Yn(Te,je)}function hl(t,e){var n=Z;Z|=2;var r=Ov();(Te!==t||je!==e)&&(Pn=null,Nr(t,e));do try{S0();break}catch(s){Pv(t,s)}while(!0);if(Bf(),Z=n,cl.current=r,we!==null)throw Error(S(261));return Te=null,je=0,Ee}function S0(){for(;we!==null;)Tv(we)}function x0(){for(;we!==null&&!Q_();)Tv(we)}function Tv(t){var e=Rv(t.alternate,t,ht);t.memoizedProps=t.pendingProps,e===null?Av(t):we=e,nh.current=null}function Av(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=v0(n,e),n!==null){n.flags&=32767,we=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ee=6,we=null;return}}else if(n=y0(n,e,ht),n!==null){we=n;return}if(e=e.sibling,e!==null){we=e;return}we=e=t}while(e!==null);Ee===0&&(Ee=5)}function Pr(t,e,n){var r=K,s=Ot.transition;try{Ot.transition=null,K=1,P0(t,e,n,r)}finally{Ot.transition=s,K=r}return null}function P0(t,e,n,r){do Ts();while(Jn!==null);if(Z&6)throw Error(S(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(S(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(ab(t,i),t===Te&&(we=Te=null,je=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||ro||(ro=!0,Iv(Go,function(){return Ts(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Ot.transition,Ot.transition=null;var a=K;K=1;var o=Z;Z|=4,nh.current=null,_0(t,n),kv(n,t),Wb(vd),Qo=!!yd,vd=yd=null,t.current=n,b0(n),K_(),Z=o,K=a,Ot.transition=i}else t.current=n;if(ro&&(ro=!1,Jn=t,fl=s),i=t.pendingLanes,i===0&&(ir=null),eb(n.stateNode),ot(t,me()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(dl)throw dl=!1,t=Dd,Dd=null,t;return fl&1&&t.tag!==0&&Ts(),i=t.pendingLanes,i&1?t===Fd?Li++:(Li=0,Fd=t):Li=0,_r(),null}function Ts(){if(Jn!==null){var t=uy(fl),e=Ot.transition,n=K;try{if(Ot.transition=null,K=16>t?16:t,Jn===null)var r=!1;else{if(t=Jn,Jn=null,fl=0,Z&6)throw Error(S(331));var s=Z;for(Z|=4,R=t.current;R!==null;){var i=R,a=i.child;if(R.flags&16){var o=i.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(R=u;R!==null;){var c=R;switch(c.tag){case 0:case 11:case 15:ji(8,c,i)}var d=c.child;if(d!==null)d.return=c,R=d;else for(;R!==null;){c=R;var f=c.sibling,g=c.return;if(_v(c),c===u){R=null;break}if(f!==null){f.return=g,R=f;break}R=g}}}var p=i.alternate;if(p!==null){var v=p.child;if(v!==null){p.child=null;do{var w=v.sibling;v.sibling=null,v=w}while(v!==null)}}R=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,R=a;else e:for(;R!==null;){if(i=R,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ji(9,i,i.return)}var m=i.sibling;if(m!==null){m.return=i.return,R=m;break e}R=i.return}}var h=t.current;for(R=h;R!==null;){a=R;var y=a.child;if(a.subtreeFlags&2064&&y!==null)y.return=a,R=y;else e:for(a=h;R!==null;){if(o=R,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:Su(9,o)}}catch(b){fe(o,o.return,b)}if(o===a){R=null;break e}var _=o.sibling;if(_!==null){_.return=o.return,R=_;break e}R=o.return}}if(Z=s,_r(),hn&&typeof hn.onPostCommitFiberRoot=="function")try{hn.onPostCommitFiberRoot(gu,t)}catch{}r=!0}return r}finally{K=n,Ot.transition=e}}return!1}function dm(t,e,n){e=zs(n,e),e=uv(t,e,1),t=sr(t,e,1),e=Ge(),t!==null&&(Oa(t,1,e),ot(t,e))}function fe(t,e,n){if(t.tag===3)dm(t,t,n);else for(;e!==null;){if(e.tag===3){dm(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ir===null||!ir.has(r))){t=zs(n,t),t=cv(e,t,1),e=sr(e,t,1),t=Ge(),e!==null&&(Oa(e,1,t),ot(e,t));break}}e=e.return}}function O0(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Ge(),t.pingedLanes|=t.suspendedLanes&n,Te===t&&(je&n)===n&&(Ee===4||Ee===3&&(je&130023424)===je&&500>me()-sh?Nr(t,0):rh|=n),ot(t,e)}function Cv(t,e){e===0&&(t.mode&1?(e=Za,Za<<=1,!(Za&130023424)&&(Za=4194304)):e=1);var n=Ge();t=$n(t,e),t!==null&&(Oa(t,e,n),ot(t,n))}function T0(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Cv(t,n)}function A0(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(S(314))}r!==null&&r.delete(e),Cv(t,n)}var Rv;Rv=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||it.current)rt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return rt=!1,g0(t,e,n);rt=!!(t.flags&131072)}else rt=!1,re&&e.flags&1048576&&$y(e,rl,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;xo(t,e),t=e.pendingProps;var s=Ms(e,Ve.current);Os(e,n),s=Kf(null,e,r,t,s,n);var i=Jf();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,at(r)?(i=!0,tl(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Wf(e),s.updater=ku,e.stateNode=s,s._reactInternals=e,Od(e,r,t,n),e=Cd(null,e,r,!0,i,n)):(e.tag=0,re&&i&&Ff(e),qe(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(xo(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=R0(r),t=Ut(r,t),s){case 0:e=Ad(null,e,r,t,n);break e;case 1:e=tm(null,e,r,t,n);break e;case 11:e=Xp(null,e,r,t,n);break e;case 14:e=em(null,e,r,Ut(r.type,t),n);break e}throw Error(S(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ut(r,s),Ad(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ut(r,s),tm(t,e,r,s,n);case 3:e:{if(pv(e),t===null)throw Error(S(387));r=e.pendingProps,i=e.memoizedState,s=i.element,zy(t,e),al(e,r,null,n);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=zs(Error(S(423)),e),e=nm(t,e,r,n,s);break e}else if(r!==s){s=zs(Error(S(424)),e),e=nm(t,e,r,n,s);break e}else for(mt=rr(e.stateNode.containerInfo.firstChild),gt=e,re=!0,Bt=null,n=Fy(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ds(),r===s){e=Ln(t,e,n);break e}qe(t,e,r,n)}e=e.child}return e;case 5:return Vy(e),t===null&&Sd(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,a=s.children,wd(r,s)?a=null:i!==null&&wd(r,i)&&(e.flags|=32),hv(t,e),qe(t,e,a,n),e.child;case 6:return t===null&&Sd(e),null;case 13:return mv(t,e,n);case 4:return Zf(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Fs(e,null,r,n):qe(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ut(r,s),Xp(t,e,r,s,n);case 7:return qe(t,e,e.pendingProps,n),e.child;case 8:return qe(t,e,e.pendingProps.children,n),e.child;case 12:return qe(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,X(sl,r._currentValue),r._currentValue=a,i!==null)if(Jt(i.value,a)){if(i.children===s.children&&!it.current){e=Ln(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){a=i.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=Rn(-1,n&-n),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}i.lanes|=n,l=i.alternate,l!==null&&(l.lanes|=n),xd(i.return,n,e),o.lanes|=n;break}l=l.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(S(341));a.lanes|=n,o=a.alternate,o!==null&&(o.lanes|=n),xd(a,n,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}qe(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Os(e,n),s=Tt(s),r=r(s),e.flags|=1,qe(t,e,r,n),e.child;case 14:return r=e.type,s=Ut(r,e.pendingProps),s=Ut(r.type,s),em(t,e,r,s,n);case 15:return dv(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ut(r,s),xo(t,e),e.tag=1,at(r)?(t=!0,tl(e)):t=!1,Os(e,n),lv(e,r,s),Od(e,r,s,n),Cd(null,e,r,!0,t,n);case 19:return gv(t,e,n);case 22:return fv(t,e,n)}throw Error(S(156,e.tag))};function Iv(t,e){return iy(t,e)}function C0(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pt(t,e,n,r){return new C0(t,e,n,r)}function lh(t){return t=t.prototype,!(!t||!t.isReactComponent)}function R0(t){if(typeof t=="function")return lh(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Of)return 11;if(t===Tf)return 14}return 2}function or(t,e){var n=t.alternate;return n===null?(n=Pt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function To(t,e,n,r,s,i){var a=2;if(r=t,typeof t=="function")lh(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case os:return jr(n.children,s,i,e);case Pf:a=8,s|=8;break;case Kc:return t=Pt(12,n,e,s|2),t.elementType=Kc,t.lanes=i,t;case Jc:return t=Pt(13,n,e,s),t.elementType=Jc,t.lanes=i,t;case Xc:return t=Pt(19,n,e,s),t.elementType=Xc,t.lanes=i,t;case Vg:return Pu(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Ug:a=10;break e;case zg:a=9;break e;case Of:a=11;break e;case Tf:a=14;break e;case Hn:a=16,r=null;break e}throw Error(S(130,t==null?t:typeof t,""))}return e=Pt(a,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function jr(t,e,n,r){return t=Pt(7,t,r,e),t.lanes=n,t}function Pu(t,e,n,r){return t=Pt(22,t,r,e),t.elementType=Vg,t.lanes=n,t.stateNode={isHidden:!1},t}function bc(t,e,n){return t=Pt(6,t,null,e),t.lanes=n,t}function Ec(t,e,n){return e=Pt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function I0(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=nc(0),this.expirationTimes=nc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nc(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function uh(t,e,n,r,s,i,a,o,l){return t=new I0(t,e,n,o,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Pt(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Wf(i),t}function N0(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:as,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Nv(t){if(!t)return fr;t=t._reactInternals;e:{if(Gr(t)!==t||t.tag!==1)throw Error(S(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(at(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(S(171))}if(t.tag===1){var n=t.type;if(at(n))return Ny(t,n,e)}return e}function jv(t,e,n,r,s,i,a,o,l){return t=uh(n,r,!0,t,s,i,a,o,l),t.context=Nv(null),n=t.current,r=Ge(),s=ar(n),i=Rn(r,s),i.callback=e??null,sr(n,i,s),t.current.lanes=s,Oa(t,s,r),ot(t,r),t}function Ou(t,e,n,r){var s=e.current,i=Ge(),a=ar(s);return n=Nv(n),e.context===null?e.context=n:e.pendingContext=n,e=Rn(i,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=sr(s,e,a),t!==null&&(Yt(t,s,a,i),Eo(t,s,a)),a}function pl(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function fm(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function ch(t,e){fm(t,e),(t=t.alternate)&&fm(t,e)}function j0(){return null}var $v=typeof reportError=="function"?reportError:function(t){console.error(t)};function dh(t){this._internalRoot=t}Tu.prototype.render=dh.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(S(409));Ou(t,e,null,null)};Tu.prototype.unmount=dh.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;zr(function(){Ou(null,t,null,null)}),e[jn]=null}};function Tu(t){this._internalRoot=t}Tu.prototype.unstable_scheduleHydration=function(t){if(t){var e=fy();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Gn.length&&e!==0&&e<Gn[n].priority;n++);Gn.splice(n,0,t),n===0&&py(t)}};function fh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Au(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function hm(){}function $0(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=pl(a);i.call(u)}}var a=jv(e,r,t,0,null,!1,!1,"",hm);return t._reactRootContainer=a,t[jn]=a.current,Qi(t.nodeType===8?t.parentNode:t),zr(),a}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var o=r;r=function(){var u=pl(l);o.call(u)}}var l=uh(t,0,!1,null,null,!1,!1,"",hm);return t._reactRootContainer=l,t[jn]=l.current,Qi(t.nodeType===8?t.parentNode:t),zr(function(){Ou(e,l,n,r)}),l}function Cu(t,e,n,r,s){var i=n._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var o=s;s=function(){var l=pl(a);o.call(l)}}Ou(e,a,t,s)}else a=$0(n,e,t,s,r);return pl(a)}cy=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=hi(e.pendingLanes);n!==0&&(Rf(e,n|1),ot(e,me()),!(Z&6)&&(Vs=me()+500,_r()))}break;case 13:zr(function(){var r=$n(t,1);if(r!==null){var s=Ge();Yt(r,t,1,s)}}),ch(t,1)}};If=function(t){if(t.tag===13){var e=$n(t,134217728);if(e!==null){var n=Ge();Yt(e,t,134217728,n)}ch(t,134217728)}};dy=function(t){if(t.tag===13){var e=ar(t),n=$n(t,e);if(n!==null){var r=Ge();Yt(n,t,e,r)}ch(t,e)}};fy=function(){return K};hy=function(t,e){var n=K;try{return K=t,e()}finally{K=n}};ud=function(t,e,n){switch(e){case"input":if(nd(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=_u(r);if(!s)throw Error(S(90));Hg(r),nd(r,s)}}}break;case"textarea":Wg(t,n);break;case"select":e=n.value,e!=null&&ks(t,!!n.multiple,e,!1)}};Xg=ih;ey=zr;var L0={usingClientEntryPoint:!1,Events:[Aa,ds,_u,Kg,Jg,ih]},ci={findFiberByHostInstance:Ar,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},M0={bundleType:ci.bundleType,version:ci.version,rendererPackageName:ci.rendererPackageName,rendererConfig:ci.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Dn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=ry(t),t===null?null:t.stateNode},findFiberByHostInstance:ci.findFiberByHostInstance||j0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var so=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!so.isDisabled&&so.supportsFiber)try{gu=so.inject(M0),hn=so}catch{}}_t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L0;_t.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!fh(e))throw Error(S(200));return N0(t,e,null,n)};_t.createRoot=function(t,e){if(!fh(t))throw Error(S(299));var n=!1,r="",s=$v;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=uh(t,1,!1,null,null,n,!1,r,s),t[jn]=e.current,Qi(t.nodeType===8?t.parentNode:t),new dh(e)};_t.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(S(188)):(t=Object.keys(t).join(","),Error(S(268,t)));return t=ry(e),t=t===null?null:t.stateNode,t};_t.flushSync=function(t){return zr(t)};_t.hydrate=function(t,e,n){if(!Au(e))throw Error(S(200));return Cu(null,t,e,!0,n)};_t.hydrateRoot=function(t,e,n){if(!fh(t))throw Error(S(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",a=$v;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=jv(e,null,t,1,n??null,s,!1,i,a),t[jn]=e.current,Qi(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Tu(e)};_t.render=function(t,e,n){if(!Au(e))throw Error(S(200));return Cu(null,t,e,!1,n)};_t.unmountComponentAtNode=function(t){if(!Au(t))throw Error(S(40));return t._reactRootContainer?(zr(function(){Cu(null,null,t,!1,function(){t._reactRootContainer=null,t[jn]=null})}),!0):!1};_t.unstable_batchedUpdates=ih;_t.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Au(n))throw Error(S(200));if(t==null||t._reactInternals===void 0)throw Error(S(38));return Cu(t,e,n,!1,r)};_t.version="18.3.1-next-f1338f8080-20240426";function Lv(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Lv)}catch(t){console.error(t)}}Lv(),Lg.exports=_t;var D0=Lg.exports,pm=D0;Yc.createRoot=pm.createRoot,Yc.hydrateRoot=pm.hydrateRoot;var ge=(t=>(t[t.VALID_QUERY=0]="VALID_QUERY",t[t.INVALID_QUERY=1]="INVALID_QUERY",t[t.QUERY_VALIDITY_ERROR=2]="QUERY_VALIDITY_ERROR",t))(ge||{}),pt=(t=>(t[t.TRUE_QUERY=0]="TRUE_QUERY",t[t.FALSE_QUERY=1]="FALSE_QUERY",t[t.QUERY_TRUTHFULNESS_ERROR=2]="QUERY_TRUTHFULNESS_ERROR",t))(pt||{}),ie=(t=>(t[t.READY_TO_RECEIVE=0]="READY_TO_RECEIVE",t[t.LOADING_VALIDITY_CHECKING=1]="LOADING_VALIDITY_CHECKING",t[t.ERROR_VALIDITY=2]="ERROR_VALIDITY",t[t.LOADING_SOURCES_SEARCHING=3]="LOADING_SOURCES_SEARCHING",t[t.ERROR_SEARCHING=4]="ERROR_SEARCHING",t[t.LOADING_FACT_CHECKING=5]="LOADING_FACT_CHECKING",t[t.ERROR_FACT_CHECKING=6]="ERROR_FACT_CHECKING",t[t.QUERY_COMPLETE=7]="QUERY_COMPLETE",t[t.ERROR_OTHER=8]="ERROR_OTHER",t))(ie||{}),W;(function(t){t.assertEqual=s=>s;function e(s){}t.assertIs=e;function n(s){throw new Error}t.assertNever=n,t.arrayToEnum=s=>{const i={};for(const a of s)i[a]=a;return i},t.getValidEnumValues=s=>{const i=t.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(const o of i)a[o]=s[o];return t.objectValues(a)},t.objectValues=s=>t.objectKeys(s).map(function(i){return s[i]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},t.find=(s,i)=>{for(const a of s)if(i(a))return a},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}t.joinValues=r,t.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(W||(W={}));var Vd;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(Vd||(Vd={}));const A=W.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Qn=t=>{switch(typeof t){case"undefined":return A.undefined;case"string":return A.string;case"number":return isNaN(t)?A.nan:A.number;case"boolean":return A.boolean;case"function":return A.function;case"bigint":return A.bigint;case"symbol":return A.symbol;case"object":return Array.isArray(t)?A.array:t===null?A.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?A.promise:typeof Map<"u"&&t instanceof Map?A.map:typeof Set<"u"&&t instanceof Set?A.set:typeof Date<"u"&&t instanceof Date?A.date:A.object;default:return A.unknown}},x=W.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),F0=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class yt extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const n=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)r._errors.push(n(a));else{let o=r,l=0;for(;l<a.path.length;){const u=a.path[l];l===a.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(n(a))):o[u]=o[u]||{_errors:[]},o=o[u],l++}}};return s(this),r}static assert(e){if(!(e instanceof yt))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,W.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},r=[];for(const s of this.issues)s.path.length>0?(n[s.path[0]]=n[s.path[0]]||[],n[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}yt.create=t=>new yt(t);const Bs=(t,e)=>{let n;switch(t.code){case x.invalid_type:t.received===A.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case x.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,W.jsonStringifyReplacer)}`;break;case x.unrecognized_keys:n=`Unrecognized key(s) in object: ${W.joinValues(t.keys,", ")}`;break;case x.invalid_union:n="Invalid input";break;case x.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${W.joinValues(t.options)}`;break;case x.invalid_enum_value:n=`Invalid enum value. Expected ${W.joinValues(t.options)}, received '${t.received}'`;break;case x.invalid_arguments:n="Invalid function arguments";break;case x.invalid_return_type:n="Invalid function return type";break;case x.invalid_date:n="Invalid date";break;case x.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:W.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case x.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case x.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case x.custom:n="Invalid input";break;case x.invalid_intersection_types:n="Intersection results could not be merged";break;case x.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case x.not_finite:n="Number must be finite";break;default:n=e.defaultError,W.assertNever(t)}return{message:n}};let Mv=Bs;function U0(t){Mv=t}function ml(){return Mv}const gl=t=>{const{data:e,path:n,errorMaps:r,issueData:s}=t,i=[...n,...s.path||[]],a={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let o="";const l=r.filter(u=>!!u).slice().reverse();for(const u of l)o=u(a,{data:e,defaultError:o}).message;return{...s,path:i,message:o}},z0=[];function T(t,e){const n=ml(),r=gl({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===Bs?void 0:Bs].filter(s=>!!s)});t.common.issues.push(r)}class Be{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const r=[];for(const s of n){if(s.status==="aborted")return L;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,n){const r=[];for(const s of n){const i=await s.key,a=await s.value;r.push({key:i,value:a})}return Be.mergeObjectSync(e,r)}static mergeObjectSync(e,n){const r={};for(const s of n){const{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return L;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(r[i.value]=a.value)}return{status:e.value,value:r}}}const L=Object.freeze({status:"aborted"}),vs=t=>({status:"dirty",value:t}),Qe=t=>({status:"valid",value:t}),Bd=t=>t.status==="aborted",Hd=t=>t.status==="dirty",ia=t=>t.status==="valid",aa=t=>typeof Promise<"u"&&t instanceof Promise;function yl(t,e,n,r){if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(t)}function Dv(t,e,n,r,s){if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n}var N;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(N||(N={}));var mi,gi;class vn{constructor(e,n,r,s){this._cachedPath=[],this.parent=e,this.data=n,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const mm=(t,e)=>{if(ia(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new yt(t.common.issues);return this._error=n,this._error}}};function D(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:r,description:s}=t;if(e&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>{var l,u;const{message:c}=t;return a.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(l=c??r)!==null&&l!==void 0?l:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(u=c??n)!==null&&u!==void 0?u:o.defaultError}},description:s}}class z{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Qn(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:Qn(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Be,ctx:{common:e.parent.common,data:e.data,parsedType:Qn(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(aa(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const r=this.safeParse(e,n);if(r.success)return r.data;throw r.error}safeParse(e,n){var r;const s={common:{issues:[],async:(r=n==null?void 0:n.async)!==null&&r!==void 0?r:!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qn(e)},i=this._parseSync({data:e,path:s.path,parent:s});return mm(s,i)}async parseAsync(e,n){const r=await this.safeParseAsync(e,n);if(r.success)return r.data;throw r.error}async safeParseAsync(e,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qn(e)},s=this._parse({data:e,path:r.path,parent:r}),i=await(aa(s)?s:Promise.resolve(s));return mm(r,i)}refine(e,n){const r=s=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(s):n;return this._refinement((s,i)=>{const a=e(s),o=()=>i.addIssue({code:x.custom,...r(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(l=>l?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,n){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof n=="function"?n(r,s):n),!1))}_refinement(e){return new Xt({schema:this,typeName:P.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return mn.create(this,this._def)}nullable(){return gr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Qt.create(this,this._def)}promise(){return qs.create(this,this._def)}or(e){return ca.create([this,e],this._def)}and(e){return da.create(this,e,this._def)}transform(e){return new Xt({...D(this._def),schema:this,typeName:P.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new ga({...D(this._def),innerType:this,defaultValue:n,typeName:P.ZodDefault})}brand(){return new hh({typeName:P.ZodBranded,type:this,...D(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new ya({...D(this._def),innerType:this,catchValue:n,typeName:P.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return Ra.create(this,e)}readonly(){return va.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const V0=/^c[^\s-]{8,}$/i,B0=/^[0-9a-z]+$/,H0=/^[0-9A-HJKMNP-TV-Z]{26}$/,q0=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,W0=/^[a-z0-9_-]{21}$/i,Z0=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,G0=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Y0="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let kc;const Q0=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,K0=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,J0=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Fv="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",X0=new RegExp(`^${Fv}$`);function Uv(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function eE(t){return new RegExp(`^${Uv(t)}$`)}function zv(t){let e=`${Fv}T${Uv(t)}`;const n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function tE(t,e){return!!((e==="v4"||!e)&&Q0.test(t)||(e==="v6"||!e)&&K0.test(t))}class Ht extends z{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==A.string){const i=this._getOrReturnCtx(e);return T(i,{code:x.invalid_type,expected:A.string,received:i.parsedType}),L}const r=new Be;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),T(s,{code:x.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),T(s,{code:x.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?T(s,{code:x.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&T(s,{code:x.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")G0.test(e.data)||(s=this._getOrReturnCtx(e,s),T(s,{validation:"email",code:x.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")kc||(kc=new RegExp(Y0,"u")),kc.test(e.data)||(s=this._getOrReturnCtx(e,s),T(s,{validation:"emoji",code:x.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")q0.test(e.data)||(s=this._getOrReturnCtx(e,s),T(s,{validation:"uuid",code:x.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")W0.test(e.data)||(s=this._getOrReturnCtx(e,s),T(s,{validation:"nanoid",code:x.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")V0.test(e.data)||(s=this._getOrReturnCtx(e,s),T(s,{validation:"cuid",code:x.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")B0.test(e.data)||(s=this._getOrReturnCtx(e,s),T(s,{validation:"cuid2",code:x.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")H0.test(e.data)||(s=this._getOrReturnCtx(e,s),T(s,{validation:"ulid",code:x.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),T(s,{validation:"url",code:x.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),T(s,{validation:"regex",code:x.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),T(s,{code:x.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),T(s,{code:x.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),T(s,{code:x.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?zv(i).test(e.data)||(s=this._getOrReturnCtx(e,s),T(s,{code:x.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?X0.test(e.data)||(s=this._getOrReturnCtx(e,s),T(s,{code:x.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?eE(i).test(e.data)||(s=this._getOrReturnCtx(e,s),T(s,{code:x.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?Z0.test(e.data)||(s=this._getOrReturnCtx(e,s),T(s,{validation:"duration",code:x.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?tE(e.data,i.version)||(s=this._getOrReturnCtx(e,s),T(s,{validation:"ip",code:x.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?J0.test(e.data)||(s=this._getOrReturnCtx(e,s),T(s,{validation:"base64",code:x.invalid_string,message:i.message}),r.dirty()):W.assertNever(i);return{status:r.value,value:e.data}}_regex(e,n,r){return this.refinement(s=>e.test(s),{validation:n,code:x.invalid_string,...N.errToObj(r)})}_addCheck(e){return new Ht({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...N.errToObj(e)})}url(e){return this._addCheck({kind:"url",...N.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...N.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...N.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...N.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...N.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...N.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...N.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...N.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...N.errToObj(e)})}datetime(e){var n,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(n=e==null?void 0:e.offset)!==null&&n!==void 0?n:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...N.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...N.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...N.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...N.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...N.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...N.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...N.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...N.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...N.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...N.errToObj(n)})}nonempty(e){return this.min(1,N.errToObj(e))}trim(){return new Ht({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ht({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ht({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Ht.create=t=>{var e;return new Ht({checks:[],typeName:P.ZodString,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...D(t)})};function nE(t,e){const n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=n>r?n:r,i=parseInt(t.toFixed(s).replace(".","")),a=parseInt(e.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}class hr extends z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==A.number){const i=this._getOrReturnCtx(e);return T(i,{code:x.invalid_type,expected:A.number,received:i.parsedType}),L}let r;const s=new Be;for(const i of this._def.checks)i.kind==="int"?W.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{code:x.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),T(r,{code:x.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),T(r,{code:x.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?nE(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),T(r,{code:x.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{code:x.not_finite,message:i.message}),s.dirty()):W.assertNever(i);return{status:s.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,N.toString(n))}gt(e,n){return this.setLimit("min",e,!1,N.toString(n))}lte(e,n){return this.setLimit("max",e,!0,N.toString(n))}lt(e,n){return this.setLimit("max",e,!1,N.toString(n))}setLimit(e,n,r,s){return new hr({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:N.toString(s)}]})}_addCheck(e){return new hr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:N.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:N.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:N.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:N.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:N.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&W.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(n)&&Number.isFinite(e)}}hr.create=t=>new hr({checks:[],typeName:P.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...D(t)});class pr extends z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==A.bigint){const i=this._getOrReturnCtx(e);return T(i,{code:x.invalid_type,expected:A.bigint,received:i.parsedType}),L}let r;const s=new Be;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),T(r,{code:x.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),T(r,{code:x.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),T(r,{code:x.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):W.assertNever(i);return{status:s.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,N.toString(n))}gt(e,n){return this.setLimit("min",e,!1,N.toString(n))}lte(e,n){return this.setLimit("max",e,!0,N.toString(n))}lt(e,n){return this.setLimit("max",e,!1,N.toString(n))}setLimit(e,n,r,s){return new pr({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:N.toString(s)}]})}_addCheck(e){return new pr({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:N.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}pr.create=t=>{var e;return new pr({checks:[],typeName:P.ZodBigInt,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...D(t)})};class oa extends z{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==A.boolean){const r=this._getOrReturnCtx(e);return T(r,{code:x.invalid_type,expected:A.boolean,received:r.parsedType}),L}return Qe(e.data)}}oa.create=t=>new oa({typeName:P.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...D(t)});class Vr extends z{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==A.date){const i=this._getOrReturnCtx(e);return T(i,{code:x.invalid_type,expected:A.date,received:i.parsedType}),L}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return T(i,{code:x.invalid_date}),L}const r=new Be;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),T(s,{code:x.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),T(s,{code:x.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):W.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Vr({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:N.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:N.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}Vr.create=t=>new Vr({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:P.ZodDate,...D(t)});class vl extends z{_parse(e){if(this._getType(e)!==A.symbol){const r=this._getOrReturnCtx(e);return T(r,{code:x.invalid_type,expected:A.symbol,received:r.parsedType}),L}return Qe(e.data)}}vl.create=t=>new vl({typeName:P.ZodSymbol,...D(t)});class la extends z{_parse(e){if(this._getType(e)!==A.undefined){const r=this._getOrReturnCtx(e);return T(r,{code:x.invalid_type,expected:A.undefined,received:r.parsedType}),L}return Qe(e.data)}}la.create=t=>new la({typeName:P.ZodUndefined,...D(t)});class ua extends z{_parse(e){if(this._getType(e)!==A.null){const r=this._getOrReturnCtx(e);return T(r,{code:x.invalid_type,expected:A.null,received:r.parsedType}),L}return Qe(e.data)}}ua.create=t=>new ua({typeName:P.ZodNull,...D(t)});class Hs extends z{constructor(){super(...arguments),this._any=!0}_parse(e){return Qe(e.data)}}Hs.create=t=>new Hs({typeName:P.ZodAny,...D(t)});class $r extends z{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Qe(e.data)}}$r.create=t=>new $r({typeName:P.ZodUnknown,...D(t)});class Mn extends z{_parse(e){const n=this._getOrReturnCtx(e);return T(n,{code:x.invalid_type,expected:A.never,received:n.parsedType}),L}}Mn.create=t=>new Mn({typeName:P.ZodNever,...D(t)});class wl extends z{_parse(e){if(this._getType(e)!==A.undefined){const r=this._getOrReturnCtx(e);return T(r,{code:x.invalid_type,expected:A.void,received:r.parsedType}),L}return Qe(e.data)}}wl.create=t=>new wl({typeName:P.ZodVoid,...D(t)});class Qt extends z{_parse(e){const{ctx:n,status:r}=this._processInputParams(e),s=this._def;if(n.parsedType!==A.array)return T(n,{code:x.invalid_type,expected:A.array,received:n.parsedType}),L;if(s.exactLength!==null){const a=n.data.length>s.exactLength.value,o=n.data.length<s.exactLength.value;(a||o)&&(T(n,{code:a?x.too_big:x.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&n.data.length<s.minLength.value&&(T(n,{code:x.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&n.data.length>s.maxLength.value&&(T(n,{code:x.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((a,o)=>s.type._parseAsync(new vn(n,a,n.path,o)))).then(a=>Be.mergeArray(r,a));const i=[...n.data].map((a,o)=>s.type._parseSync(new vn(n,a,n.path,o)));return Be.mergeArray(r,i)}get element(){return this._def.type}min(e,n){return new Qt({...this._def,minLength:{value:e,message:N.toString(n)}})}max(e,n){return new Qt({...this._def,maxLength:{value:e,message:N.toString(n)}})}length(e,n){return new Qt({...this._def,exactLength:{value:e,message:N.toString(n)}})}nonempty(e){return this.min(1,e)}}Qt.create=(t,e)=>new Qt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:P.ZodArray,...D(e)});function ns(t){if(t instanceof ae){const e={};for(const n in t.shape){const r=t.shape[n];e[n]=mn.create(ns(r))}return new ae({...t._def,shape:()=>e})}else return t instanceof Qt?new Qt({...t._def,type:ns(t.element)}):t instanceof mn?mn.create(ns(t.unwrap())):t instanceof gr?gr.create(ns(t.unwrap())):t instanceof wn?wn.create(t.items.map(e=>ns(e))):t}class ae extends z{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=W.objectKeys(e);return this._cached={shape:e,keys:n}}_parse(e){if(this._getType(e)!==A.object){const u=this._getOrReturnCtx(e);return T(u,{code:x.invalid_type,expected:A.object,received:u.parsedType}),L}const{status:r,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Mn&&this._def.unknownKeys==="strip"))for(const u in s.data)a.includes(u)||o.push(u);const l=[];for(const u of a){const c=i[u],d=s.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new vn(s,d,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof Mn){const u=this._def.unknownKeys;if(u==="passthrough")for(const c of o)l.push({key:{status:"valid",value:c},value:{status:"valid",value:s.data[c]}});else if(u==="strict")o.length>0&&(T(s,{code:x.unrecognized_keys,keys:o}),r.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const c of o){const d=s.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new vn(s,d,s.path,c)),alwaysSet:c in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const u=[];for(const c of l){const d=await c.key,f=await c.value;u.push({key:d,value:f,alwaysSet:c.alwaysSet})}return u}).then(u=>Be.mergeObjectSync(r,u)):Be.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return N.errToObj,new ae({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,r)=>{var s,i,a,o;const l=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,n,r).message)!==null&&a!==void 0?a:r.defaultError;return n.code==="unrecognized_keys"?{message:(o=N.errToObj(e).message)!==null&&o!==void 0?o:l}:{message:l}}}:{}})}strip(){return new ae({...this._def,unknownKeys:"strip"})}passthrough(){return new ae({...this._def,unknownKeys:"passthrough"})}extend(e){return new ae({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ae({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:P.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new ae({...this._def,catchall:e})}pick(e){const n={};return W.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(n[r]=this.shape[r])}),new ae({...this._def,shape:()=>n})}omit(e){const n={};return W.objectKeys(this.shape).forEach(r=>{e[r]||(n[r]=this.shape[r])}),new ae({...this._def,shape:()=>n})}deepPartial(){return ns(this)}partial(e){const n={};return W.objectKeys(this.shape).forEach(r=>{const s=this.shape[r];e&&!e[r]?n[r]=s:n[r]=s.optional()}),new ae({...this._def,shape:()=>n})}required(e){const n={};return W.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])n[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof mn;)i=i._def.innerType;n[r]=i}}),new ae({...this._def,shape:()=>n})}keyof(){return Vv(W.objectKeys(this.shape))}}ae.create=(t,e)=>new ae({shape:()=>t,unknownKeys:"strip",catchall:Mn.create(),typeName:P.ZodObject,...D(e)});ae.strictCreate=(t,e)=>new ae({shape:()=>t,unknownKeys:"strict",catchall:Mn.create(),typeName:P.ZodObject,...D(e)});ae.lazycreate=(t,e)=>new ae({shape:t,unknownKeys:"strip",catchall:Mn.create(),typeName:P.ZodObject,...D(e)});class ca extends z{_parse(e){const{ctx:n}=this._processInputParams(e),r=this._def.options;function s(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return n.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new yt(o.ctx.common.issues));return T(n,{code:x.invalid_union,unionErrors:a}),L}if(n.common.async)return Promise.all(r.map(async i=>{const a={...n,common:{...n.common,issues:[]},parent:null};return{result:await i._parseAsync({data:n.data,path:n.path,parent:a}),ctx:a}})).then(s);{let i;const a=[];for(const l of r){const u={...n,common:{...n.common,issues:[]},parent:null},c=l._parseSync({data:n.data,path:n.path,parent:u});if(c.status==="valid")return c;c.status==="dirty"&&!i&&(i={result:c,ctx:u}),u.common.issues.length&&a.push(u.common.issues)}if(i)return n.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(l=>new yt(l));return T(n,{code:x.invalid_union,unionErrors:o}),L}}get options(){return this._def.options}}ca.create=(t,e)=>new ca({options:t,typeName:P.ZodUnion,...D(e)});const kn=t=>t instanceof ha?kn(t.schema):t instanceof Xt?kn(t.innerType()):t instanceof pa?[t.value]:t instanceof mr?t.options:t instanceof ma?W.objectValues(t.enum):t instanceof ga?kn(t._def.innerType):t instanceof la?[void 0]:t instanceof ua?[null]:t instanceof mn?[void 0,...kn(t.unwrap())]:t instanceof gr?[null,...kn(t.unwrap())]:t instanceof hh||t instanceof va?kn(t.unwrap()):t instanceof ya?kn(t._def.innerType):[];class Ru extends z{_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==A.object)return T(n,{code:x.invalid_type,expected:A.object,received:n.parsedType}),L;const r=this.discriminator,s=n.data[r],i=this.optionsMap.get(s);return i?n.common.async?i._parseAsync({data:n.data,path:n.path,parent:n}):i._parseSync({data:n.data,path:n.path,parent:n}):(T(n,{code:x.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),L)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,r){const s=new Map;for(const i of n){const a=kn(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new Ru({typeName:P.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:s,...D(r)})}}function qd(t,e){const n=Qn(t),r=Qn(e);if(t===e)return{valid:!0,data:t};if(n===A.object&&r===A.object){const s=W.objectKeys(e),i=W.objectKeys(t).filter(o=>s.indexOf(o)!==-1),a={...t,...e};for(const o of i){const l=qd(t[o],e[o]);if(!l.valid)return{valid:!1};a[o]=l.data}return{valid:!0,data:a}}else if(n===A.array&&r===A.array){if(t.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<t.length;i++){const a=t[i],o=e[i],l=qd(a,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return n===A.date&&r===A.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class da extends z{_parse(e){const{status:n,ctx:r}=this._processInputParams(e),s=(i,a)=>{if(Bd(i)||Bd(a))return L;const o=qd(i.value,a.value);return o.valid?((Hd(i)||Hd(a))&&n.dirty(),{status:n.value,value:o.data}):(T(r,{code:x.invalid_intersection_types}),L)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}da.create=(t,e,n)=>new da({left:t,right:e,typeName:P.ZodIntersection,...D(n)});class wn extends z{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==A.array)return T(r,{code:x.invalid_type,expected:A.array,received:r.parsedType}),L;if(r.data.length<this._def.items.length)return T(r,{code:x.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),L;!this._def.rest&&r.data.length>this._def.items.length&&(T(r,{code:x.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const i=[...r.data].map((a,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new vn(r,a,r.path,o)):null}).filter(a=>!!a);return r.common.async?Promise.all(i).then(a=>Be.mergeArray(n,a)):Be.mergeArray(n,i)}get items(){return this._def.items}rest(e){return new wn({...this._def,rest:e})}}wn.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new wn({items:t,typeName:P.ZodTuple,rest:null,...D(e)})};class fa extends z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==A.object)return T(r,{code:x.invalid_type,expected:A.object,received:r.parsedType}),L;const s=[],i=this._def.keyType,a=this._def.valueType;for(const o in r.data)s.push({key:i._parse(new vn(r,o,r.path,o)),value:a._parse(new vn(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Be.mergeObjectAsync(n,s):Be.mergeObjectSync(n,s)}get element(){return this._def.valueType}static create(e,n,r){return n instanceof z?new fa({keyType:e,valueType:n,typeName:P.ZodRecord,...D(r)}):new fa({keyType:Ht.create(),valueType:e,typeName:P.ZodRecord,...D(n)})}}class _l extends z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==A.map)return T(r,{code:x.invalid_type,expected:A.map,received:r.parsedType}),L;const s=this._def.keyType,i=this._def.valueType,a=[...r.data.entries()].map(([o,l],u)=>({key:s._parse(new vn(r,o,r.path,[u,"key"])),value:i._parse(new vn(r,l,r.path,[u,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of a){const u=await l.key,c=await l.value;if(u.status==="aborted"||c.status==="aborted")return L;(u.status==="dirty"||c.status==="dirty")&&n.dirty(),o.set(u.value,c.value)}return{status:n.value,value:o}})}else{const o=new Map;for(const l of a){const u=l.key,c=l.value;if(u.status==="aborted"||c.status==="aborted")return L;(u.status==="dirty"||c.status==="dirty")&&n.dirty(),o.set(u.value,c.value)}return{status:n.value,value:o}}}}_l.create=(t,e,n)=>new _l({valueType:e,keyType:t,typeName:P.ZodMap,...D(n)});class Br extends z{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==A.set)return T(r,{code:x.invalid_type,expected:A.set,received:r.parsedType}),L;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(T(r,{code:x.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),n.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(T(r,{code:x.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),n.dirty());const i=this._def.valueType;function a(l){const u=new Set;for(const c of l){if(c.status==="aborted")return L;c.status==="dirty"&&n.dirty(),u.add(c.value)}return{status:n.value,value:u}}const o=[...r.data.values()].map((l,u)=>i._parse(new vn(r,l,r.path,u)));return r.common.async?Promise.all(o).then(l=>a(l)):a(o)}min(e,n){return new Br({...this._def,minSize:{value:e,message:N.toString(n)}})}max(e,n){return new Br({...this._def,maxSize:{value:e,message:N.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}Br.create=(t,e)=>new Br({valueType:t,minSize:null,maxSize:null,typeName:P.ZodSet,...D(e)});class As extends z{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==A.function)return T(n,{code:x.invalid_type,expected:A.function,received:n.parsedType}),L;function r(o,l){return gl({data:o,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,ml(),Bs].filter(u=>!!u),issueData:{code:x.invalid_arguments,argumentsError:l}})}function s(o,l){return gl({data:o,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,ml(),Bs].filter(u=>!!u),issueData:{code:x.invalid_return_type,returnTypeError:l}})}const i={errorMap:n.common.contextualErrorMap},a=n.data;if(this._def.returns instanceof qs){const o=this;return Qe(async function(...l){const u=new yt([]),c=await o._def.args.parseAsync(l,i).catch(g=>{throw u.addIssue(r(l,g)),u}),d=await Reflect.apply(a,this,c);return await o._def.returns._def.type.parseAsync(d,i).catch(g=>{throw u.addIssue(s(d,g)),u})})}else{const o=this;return Qe(function(...l){const u=o._def.args.safeParse(l,i);if(!u.success)throw new yt([r(l,u.error)]);const c=Reflect.apply(a,this,u.data),d=o._def.returns.safeParse(c,i);if(!d.success)throw new yt([s(c,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new As({...this._def,args:wn.create(e).rest($r.create())})}returns(e){return new As({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,n,r){return new As({args:e||wn.create([]).rest($r.create()),returns:n||$r.create(),typeName:P.ZodFunction,...D(r)})}}class ha extends z{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}ha.create=(t,e)=>new ha({getter:t,typeName:P.ZodLazy,...D(e)});class pa extends z{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return T(n,{received:n.data,code:x.invalid_literal,expected:this._def.value}),L}return{status:"valid",value:e.data}}get value(){return this._def.value}}pa.create=(t,e)=>new pa({value:t,typeName:P.ZodLiteral,...D(e)});function Vv(t,e){return new mr({values:t,typeName:P.ZodEnum,...D(e)})}class mr extends z{constructor(){super(...arguments),mi.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),r=this._def.values;return T(n,{expected:W.joinValues(r),received:n.parsedType,code:x.invalid_type}),L}if(yl(this,mi)||Dv(this,mi,new Set(this._def.values)),!yl(this,mi).has(e.data)){const n=this._getOrReturnCtx(e),r=this._def.values;return T(n,{received:n.data,code:x.invalid_enum_value,options:r}),L}return Qe(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return mr.create(e,{...this._def,...n})}exclude(e,n=this._def){return mr.create(this.options.filter(r=>!e.includes(r)),{...this._def,...n})}}mi=new WeakMap;mr.create=Vv;class ma extends z{constructor(){super(...arguments),gi.set(this,void 0)}_parse(e){const n=W.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==A.string&&r.parsedType!==A.number){const s=W.objectValues(n);return T(r,{expected:W.joinValues(s),received:r.parsedType,code:x.invalid_type}),L}if(yl(this,gi)||Dv(this,gi,new Set(W.getValidEnumValues(this._def.values))),!yl(this,gi).has(e.data)){const s=W.objectValues(n);return T(r,{received:r.data,code:x.invalid_enum_value,options:s}),L}return Qe(e.data)}get enum(){return this._def.values}}gi=new WeakMap;ma.create=(t,e)=>new ma({values:t,typeName:P.ZodNativeEnum,...D(e)});class qs extends z{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==A.promise&&n.common.async===!1)return T(n,{code:x.invalid_type,expected:A.promise,received:n.parsedType}),L;const r=n.parsedType===A.promise?n.data:Promise.resolve(n.data);return Qe(r.then(s=>this._def.type.parseAsync(s,{path:n.path,errorMap:n.common.contextualErrorMap})))}}qs.create=(t,e)=>new qs({type:t,typeName:P.ZodPromise,...D(e)});class Xt extends z{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===P.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:r}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{T(r,a),a.fatal?n.abort():n.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const a=s.transform(r.data,i);if(r.common.async)return Promise.resolve(a).then(async o=>{if(n.value==="aborted")return L;const l=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return l.status==="aborted"?L:l.status==="dirty"||n.value==="dirty"?vs(l.value):l});{if(n.value==="aborted")return L;const o=this._def.schema._parseSync({data:a,path:r.path,parent:r});return o.status==="aborted"?L:o.status==="dirty"||n.value==="dirty"?vs(o.value):o}}if(s.type==="refinement"){const a=o=>{const l=s.refinement(o,i);if(r.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?L:(o.status==="dirty"&&n.dirty(),a(o.value),{status:n.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?L:(o.status==="dirty"&&n.dirty(),a(o.value).then(()=>({status:n.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!ia(a))return a;const o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>ia(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:n.value,value:o})):a);W.assertNever(s)}}Xt.create=(t,e,n)=>new Xt({schema:t,typeName:P.ZodEffects,effect:e,...D(n)});Xt.createWithPreprocess=(t,e,n)=>new Xt({schema:e,effect:{type:"preprocess",transform:t},typeName:P.ZodEffects,...D(n)});class mn extends z{_parse(e){return this._getType(e)===A.undefined?Qe(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}mn.create=(t,e)=>new mn({innerType:t,typeName:P.ZodOptional,...D(e)});class gr extends z{_parse(e){return this._getType(e)===A.null?Qe(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}gr.create=(t,e)=>new gr({innerType:t,typeName:P.ZodNullable,...D(e)});class ga extends z{_parse(e){const{ctx:n}=this._processInputParams(e);let r=n.data;return n.parsedType===A.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}ga.create=(t,e)=>new ga({innerType:t,typeName:P.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...D(e)});class ya extends z{_parse(e){const{ctx:n}=this._processInputParams(e),r={...n,common:{...n.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return aa(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new yt(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new yt(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}ya.create=(t,e)=>new ya({innerType:t,typeName:P.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...D(e)});class bl extends z{_parse(e){if(this._getType(e)!==A.nan){const r=this._getOrReturnCtx(e);return T(r,{code:x.invalid_type,expected:A.nan,received:r.parsedType}),L}return{status:"valid",value:e.data}}}bl.create=t=>new bl({typeName:P.ZodNaN,...D(t)});const rE=Symbol("zod_brand");class hh extends z{_parse(e){const{ctx:n}=this._processInputParams(e),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class Ra extends z{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?L:i.status==="dirty"?(n.dirty(),vs(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?L:s.status==="dirty"?(n.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,n){return new Ra({in:e,out:n,typeName:P.ZodPipeline})}}class va extends z{_parse(e){const n=this._def.innerType._parse(e),r=s=>(ia(s)&&(s.value=Object.freeze(s.value)),s);return aa(n)?n.then(s=>r(s)):r(n)}unwrap(){return this._def.innerType}}va.create=(t,e)=>new va({innerType:t,typeName:P.ZodReadonly,...D(e)});function Bv(t,e={},n){return t?Hs.create().superRefine((r,s)=>{var i,a;if(!t(r)){const o=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,l=(a=(i=o.fatal)!==null&&i!==void 0?i:n)!==null&&a!==void 0?a:!0,u=typeof o=="string"?{message:o}:o;s.addIssue({code:"custom",...u,fatal:l})}}):Hs.create()}const sE={object:ae.lazycreate};var P;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(P||(P={}));const iE=(t,e={message:`Input not instance of ${t.name}`})=>Bv(n=>n instanceof t,e),Hv=Ht.create,qv=hr.create,aE=bl.create,oE=pr.create,Wv=oa.create,lE=Vr.create,uE=vl.create,cE=la.create,dE=ua.create,fE=Hs.create,hE=$r.create,pE=Mn.create,mE=wl.create,gE=Qt.create,yE=ae.create,vE=ae.strictCreate,wE=ca.create,_E=Ru.create,bE=da.create,EE=wn.create,kE=fa.create,SE=_l.create,xE=Br.create,PE=As.create,OE=ha.create,TE=pa.create,AE=mr.create,CE=ma.create,RE=qs.create,gm=Xt.create,IE=mn.create,NE=gr.create,jE=Xt.createWithPreprocess,$E=Ra.create,LE=()=>Hv().optional(),ME=()=>qv().optional(),DE=()=>Wv().optional(),FE={string:t=>Ht.create({...t,coerce:!0}),number:t=>hr.create({...t,coerce:!0}),boolean:t=>oa.create({...t,coerce:!0}),bigint:t=>pr.create({...t,coerce:!0}),date:t=>Vr.create({...t,coerce:!0})},UE=L;var Ze=Object.freeze({__proto__:null,defaultErrorMap:Bs,setErrorMap:U0,getErrorMap:ml,makeIssue:gl,EMPTY_PATH:z0,addIssueToContext:T,ParseStatus:Be,INVALID:L,DIRTY:vs,OK:Qe,isAborted:Bd,isDirty:Hd,isValid:ia,isAsync:aa,get util(){return W},get objectUtil(){return Vd},ZodParsedType:A,getParsedType:Qn,ZodType:z,datetimeRegex:zv,ZodString:Ht,ZodNumber:hr,ZodBigInt:pr,ZodBoolean:oa,ZodDate:Vr,ZodSymbol:vl,ZodUndefined:la,ZodNull:ua,ZodAny:Hs,ZodUnknown:$r,ZodNever:Mn,ZodVoid:wl,ZodArray:Qt,ZodObject:ae,ZodUnion:ca,ZodDiscriminatedUnion:Ru,ZodIntersection:da,ZodTuple:wn,ZodRecord:fa,ZodMap:_l,ZodSet:Br,ZodFunction:As,ZodLazy:ha,ZodLiteral:pa,ZodEnum:mr,ZodNativeEnum:ma,ZodPromise:qs,ZodEffects:Xt,ZodTransformer:Xt,ZodOptional:mn,ZodNullable:gr,ZodDefault:ga,ZodCatch:ya,ZodNaN:bl,BRAND:rE,ZodBranded:hh,ZodPipeline:Ra,ZodReadonly:va,custom:Bv,Schema:z,ZodSchema:z,late:sE,get ZodFirstPartyTypeKind(){return P},coerce:FE,any:fE,array:gE,bigint:oE,boolean:Wv,date:lE,discriminatedUnion:_E,effect:gm,enum:AE,function:PE,instanceof:iE,intersection:bE,lazy:OE,literal:TE,map:SE,nan:aE,nativeEnum:CE,never:pE,null:dE,nullable:NE,number:qv,object:yE,oboolean:DE,onumber:ME,optional:IE,ostring:LE,pipeline:$E,preprocess:jE,promise:RE,record:kE,set:xE,strictObject:vE,string:Hv,symbol:uE,transformer:gm,tuple:EE,undefined:cE,union:wE,unknown:hE,void:mE,NEVER:UE,ZodIssueCode:x,quotelessJson:F0,ZodError:yt}),Iu={exports:{}},Zv={};function Ct(t,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var zE=Ct;Ct.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Ct.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Ct.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=new Date().getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},n),this._options.unref&&this._timer.unref(),!0};Ct.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Ct.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)};Ct.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)};Ct.prototype.start=Ct.prototype.try;Ct.prototype.errors=function(){return this._errors};Ct.prototype.attempts=function(){return this._attempts};Ct.prototype.mainError=function(){if(this._errors.length===0)return null;for(var t={},e=null,n=0,r=0;r<this._errors.length;r++){var s=this._errors[r],i=s.message,a=(t[i]||0)+1;t[i]=a,a>=n&&(e=s,n=a)}return e};(function(t){var e=zE;t.operation=function(n){var r=t.timeouts(n);return new e(r,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})},t.timeouts=function(n){if(n instanceof Array)return[].concat(n);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in n)r[s]=n[s];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],a=0;a<r.retries;a++)i.push(this.createTimeout(a,r));return n&&n.forever&&!i.length&&i.push(this.createTimeout(a,r)),i.sort(function(o,l){return o-l}),i},t.createTimeout=function(n,r){var s=r.randomize?Math.random()+1:1,i=Math.round(s*Math.max(r.minTimeout,1)*Math.pow(r.factor,n));return i=Math.min(i,r.maxTimeout),i},t.wrap=function(n,r,s){if(r instanceof Array&&(s=r,r=null),!s){s=[];for(var i in n)typeof n[i]=="function"&&s.push(i)}for(var a=0;a<s.length;a++){var o=s[a],l=n[o];n[o]=(function(c){var d=t.operation(r),f=Array.prototype.slice.call(arguments,1),g=f.pop();f.push(function(p){d.retry(p)||(p&&(arguments[0]=d.mainError()),g.apply(this,arguments))}),d.attempt(function(){c.apply(n,f)})}).bind(n,l),n[o].options=r}}})(Zv);var VE=Zv;const BE=VE,HE=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class Gv extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const qE=(t,e,n)=>{const r=n.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=r,t},WE=t=>HE.includes(t),Yv=(t,e)=>new Promise((n,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};const s=BE.operation(e);s.attempt(async i=>{try{n(await t(i))}catch(a){if(!(a instanceof Error)){r(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof Gv)s.stop(),r(a.originalError);else if(a instanceof TypeError&&!WE(a.message))s.stop(),r(a);else{qE(a,i,e);try{await e.onFailedAttempt(a)}catch(o){r(o);return}s.retry(a)||r(s.mainError())}}})});Iu.exports=Yv;Iu.exports.default=Yv;Iu.exports.AbortError=Gv;var ZE=Iu.exports;const El=pu(ZE),GE=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function kl(t){return typeof t=="string"&&GE.test(t)}function YE(t){if(!kl(t))throw TypeError("Invalid UUID");var e,n=new Uint8Array(16);return n[0]=(e=parseInt(t.slice(0,8),16))>>>24,n[1]=e>>>16&255,n[2]=e>>>8&255,n[3]=e&255,n[4]=(e=parseInt(t.slice(9,13),16))>>>8,n[5]=e&255,n[6]=(e=parseInt(t.slice(14,18),16))>>>8,n[7]=e&255,n[8]=(e=parseInt(t.slice(19,23),16))>>>8,n[9]=e&255,n[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,n[11]=e/4294967296&255,n[12]=e>>>24&255,n[13]=e>>>16&255,n[14]=e>>>8&255,n[15]=e&255,n}var Ae=[];for(var Sc=0;Sc<256;++Sc)Ae.push((Sc+256).toString(16).slice(1));function Nu(t,e=0){return(Ae[t[e+0]]+Ae[t[e+1]]+Ae[t[e+2]]+Ae[t[e+3]]+"-"+Ae[t[e+4]]+Ae[t[e+5]]+"-"+Ae[t[e+6]]+Ae[t[e+7]]+"-"+Ae[t[e+8]]+Ae[t[e+9]]+"-"+Ae[t[e+10]]+Ae[t[e+11]]+Ae[t[e+12]]+Ae[t[e+13]]+Ae[t[e+14]]+Ae[t[e+15]]).toLowerCase()}var io,QE=new Uint8Array(16);function Qv(){if(!io&&(io=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!io))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return io(QE)}var xc,ao,Pc=0,Oc=0;function KE(t,e,n){var r=e&&n||0,s=e||new Array(16);t=t||{};var i=t.node,a=t.clockseq;if(t._v6||(i||(i=xc),a==null&&(a=ao)),i==null||a==null){var o=t.random||(t.rng||Qv)();i==null&&(i=[o[0],o[1],o[2],o[3],o[4],o[5]],!xc&&!t._v6&&(i[0]|=1,xc=i)),a==null&&(a=(o[6]<<8|o[7])&16383,ao===void 0&&!t._v6&&(ao=a))}var l=t.msecs!==void 0?t.msecs:Date.now(),u=t.nsecs!==void 0?t.nsecs:Oc+1,c=l-Pc+(u-Oc)/1e4;if(c<0&&t.clockseq===void 0&&(a=a+1&16383),(c<0||l>Pc)&&t.nsecs===void 0&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Pc=l,Oc=u,ao=a,l+=122192928e5;var d=((l&268435455)*1e4+u)%4294967296;s[r++]=d>>>24&255,s[r++]=d>>>16&255,s[r++]=d>>>8&255,s[r++]=d&255;var f=l/4294967296*1e4&268435455;s[r++]=f>>>8&255,s[r++]=f&255,s[r++]=f>>>24&15|16,s[r++]=f>>>16&255,s[r++]=a>>>8|128,s[r++]=a&255;for(var g=0;g<6;++g)s[r+g]=i[g];return e||Nu(s)}function JE(t){var e=typeof t=="string"?YE(t):t,n=XE(e);return typeof t=="string"?Nu(n):n}function XE(t,e=!1){return Uint8Array.of((t[6]&15)<<4|t[7]>>4&15,(t[7]&15)<<4|(t[4]&240)>>4,(t[4]&15)<<4|(t[5]&240)>>4,(t[5]&15)<<4|(t[0]&240)>>4,(t[0]&15)<<4|(t[1]&240)>>4,(t[1]&15)<<4|(t[2]&240)>>4,96|t[2]&15,t[3],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}var ek=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const ym={randomUUID:ek};function Tn(t,e,n){if(ym.randomUUID&&!e&&!t)return ym.randomUUID();t=t||{};var r=t.random||(t.rng||Qv)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Nu(r)}function vm(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function wm(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?vm(Object(n),!0).forEach(function(r){tk(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vm(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function tk(t,e,n){return(e=nk(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function nk(t){var e=rk(t,"string");return typeof e=="symbol"?e:e+""}function rk(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function sk(t={},e,n=0){var r=KE(wm(wm({},t),{},{_v6:!0}),new Uint8Array(16));return r=JE(r),Nu(r)}let ik=class{getStore(){}run(e,n){return n()}},ak=class{constructor(){Object.defineProperty(this,"asyncLocalStorage",{enumerable:!0,configurable:!0,writable:!0,value:new ik}),Object.defineProperty(this,"hasBeenInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1})}getInstance(){return this.asyncLocalStorage}initializeGlobalInstance(e){this.hasBeenInitialized||(this.hasBeenInitialized=!0,this.asyncLocalStorage=e)}};const ok=new ak,lk=()=>{const t=ok.getInstance().getStore();if(t===void 0)throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function or the tracing is enabled."].join(`
`));return t};function ph(t){return typeof t=="function"&&"langsmith:traceable"in t}var uk=function(t,e){if(typeof t!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,t.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const ck=pu(uk);var Kv={exports:{}};const dk=/[\p{Lu}]/u,fk=/[\p{Ll}]/u,_m=/^[\p{Lu}](?![\p{Lu}])/gu,Jv=/([\p{Alpha}\p{N}_]|$)/u,Xv=/[_.\- ]+/,hk=new RegExp("^"+Xv.source),bm=new RegExp(Xv.source+Jv.source,"gu"),Em=new RegExp("\\d+"+Jv.source,"gu"),pk=(t,e,n)=>{let r=!1,s=!1,i=!1;for(let a=0;a<t.length;a++){const o=t[a];r&&dk.test(o)?(t=t.slice(0,a)+"-"+t.slice(a),r=!1,i=s,s=!0,a++):s&&i&&fk.test(o)?(t=t.slice(0,a-1)+"-"+t.slice(a-1),i=s,s=!1,r=!0):(r=e(o)===o&&n(o)!==o,i=s,s=n(o)===o&&e(o)!==o)}return t},mk=(t,e)=>(_m.lastIndex=0,t.replace(_m,n=>e(n))),gk=(t,e)=>(bm.lastIndex=0,Em.lastIndex=0,t.replace(bm,(n,r)=>e(r)).replace(Em,n=>e(n))),ew=(t,e)=>{if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(i=>i.trim()).filter(i=>i.length).join("-"):t=t.trim(),t.length===0)return"";const n=e.locale===!1?i=>i.toLowerCase():i=>i.toLocaleLowerCase(e.locale),r=e.locale===!1?i=>i.toUpperCase():i=>i.toLocaleUpperCase(e.locale);return t.length===1?e.pascalCase?r(t):n(t):(t!==n(t)&&(t=pk(t,n,r)),t=t.replace(hk,""),e.preserveConsecutiveUppercase?t=mk(t,n):t=n(t),e.pascalCase&&(t=r(t.charAt(0))+t.slice(1)),gk(t,r))};Kv.exports=ew;Kv.exports.default=ew;function yk(t,e){return(e==null?void 0:e[t])||ck(t)}function vk(t,e,n){const r={};for(const s in t)Object.hasOwn(t,s)&&(r[e(s,n)]=t[s]);return r}function km(t){return Array.isArray(t)?[...t]:{...t}}function wk(t,e){const n=km(t);for(const[r,s]of Object.entries(e)){const[i,...a]=r.split(".").reverse();let o=n;for(const l of a.reverse()){if(o[l]===void 0)break;o[l]=km(o[l]),o=o[l]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[s]})}return n}function tw(t){const e=Object.getPrototypeOf(t);return typeof t.lc_name=="function"&&(typeof e.lc_name!="function"||t.lc_name()!==e.lc_name())?t.lc_name():t.name}class Hr{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,tw(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...n){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof Hr||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},n={},r=Object.keys(this.lc_kwargs).reduce((s,i)=>(s[i]=i in this?this[i]:this.lc_kwargs[i],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(n,Reflect.get(s,"lc_secrets",this)),Object.assign(r,Reflect.get(s,"lc_attributes",this));return Object.keys(n).forEach(s=>{let i=this,a=r;const[o,...l]=s.split(".").reverse();for(const u of l.reverse()){if(!(u in i)||i[u]===void 0)return;(!(u in a)||a[u]===void 0)&&(typeof i[u]=="object"&&i[u]!=null?a[u]={}:Array.isArray(i[u])&&(a[u]=[])),i=i[u],a=a[u]}o in i&&i[o]!==void 0&&(a[o]=a[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:vk(Object.keys(n).length?wk(r,n):r,yk,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}var Tc={};const _k=()=>typeof window<"u"&&typeof window.document<"u",bk=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Ek=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),nw=()=>typeof Deno<"u",kk=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!nw(),Sk=()=>{let t;return _k()?t="browser":kk()?t="node":bk()?t="webworker":Ek()?t="jsdom":nw()?t="deno":t="other",t};let Ac;async function xk(){return Ac===void 0&&(Ac={library:"langchain-js",runtime:Sk()}),Ac}function We(t){try{return typeof process<"u"?Tc==null?void 0:Tc[t]:void 0}catch{return}}class Pk{}class Ia extends Pk{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,tw(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:We("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return Hr.prototype.toJSON.call(this)}toJSONNotImplemented(){return Hr.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class n extends Ia{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Tn()}),Object.assign(this,e)}}return new n}}var mh={exports:{}};mh.exports;(function(t){const n=(i=0)=>a=>`\x1B[${38+i};5;${a}m`,r=(i=0)=>(a,o,l)=>`\x1B[${38+i};2;${a};${o};${l}m`;function s(){const i=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[o,l]of Object.entries(a)){for(const[u,c]of Object.entries(l))a[u]={open:`\x1B[${c[0]}m`,close:`\x1B[${c[1]}m`},l[u]=a[u],i.set(c[0],c[1]);Object.defineProperty(a,o,{value:l,enumerable:!1})}return Object.defineProperty(a,"codes",{value:i,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=n(),a.color.ansi16m=r(),a.bgColor.ansi256=n(10),a.bgColor.ansi16m=r(10),Object.defineProperties(a,{rgbToAnsi256:{value:(o,l,u)=>o===l&&l===u?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(l/255*5)+Math.round(u/255*5),enumerable:!1},hexToRgb:{value:o=>{const l=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!l)return[0,0,0];let{colorString:u}=l.groups;u.length===3&&(u=u.split("").map(d=>d+d).join(""));const c=Number.parseInt(u,16);return[c>>16&255,c>>8&255,c&255]},enumerable:!1},hexToAnsi256:{value:o=>a.rgbToAnsi256(...a.hexToRgb(o)),enumerable:!1}}),a}Object.defineProperty(t,"exports",{enumerable:!0,get:s})})(mh);var Ok=mh.exports;const rw=pu(Ok);function Cc(t,e){return t&&!Array.isArray(t)&&typeof t=="object"?t:{[e]:t}}function Tk(t){return t.replace(/[-:.]/g,"")}function Ak(t,e,n){const r=n.toFixed(0).slice(0,3).padStart(3,"0");return Tk(`${new Date(t).toISOString().slice(0,-1)}${r}Z`)+e}class Na extends Ia{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,n){e.child_runs.push(n)}async _startTrace(e){var s;const n=Ak(e.start_time,e.id,e.execution_order),r={...e};if(r.parent_run_id!==void 0){const i=this.runMap.get(r.parent_run_id);i&&(this._addChildRun(i,r),i.child_execution_order=Math.max(i.child_execution_order,r.child_execution_order),r.trace_id=i.trace_id,i.dotted_order!==void 0&&(r.dotted_order=[i.dotted_order,n].join(".")))}else r.trace_id=r.id,r.dotted_order=n;this.runMap.set(r.id,r),await((s=this.onRunCreate)==null?void 0:s.call(this,r))}async _endTrace(e){var r;const n=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);n?n.child_execution_order=Math.max(n.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((r=this.onRunUpdate)==null?void 0:r.call(this,e))}_getExecutionOrder(e){const n=e!==void 0&&this.runMap.get(e);return n?n.child_execution_order+1:1}async handleLLMStart(e,n,r,s,i,a,o,l){var g;const u=this._getExecutionOrder(s),c=Date.now(),d=o?{...i,metadata:o}:i,f={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:n},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:a||[]};return await this._startTrace(f),await((g=this.onLLMStart)==null?void 0:g.call(this,f)),f}async handleChatModelStart(e,n,r,s,i,a,o,l){var g;const u=this._getExecutionOrder(s),c=Date.now(),d=o?{...i,metadata:o}:i,f={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:n},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:a||[]};return await this._startTrace(f),await((g=this.onLLMStart)==null?void 0:g.call(this,f)),f}async handleLLMEnd(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onLLMEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleLLMError(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onLLMError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleChainStart(e,n,r,s,i,a,o,l){var f;const u=this._getExecutionOrder(s),c=Date.now(),d={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:n,execution_order:u,child_execution_order:u,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return await this._startTrace(d),await((f=this.onChainStart)==null?void 0:f.call(this,d)),d}async handleChainEnd(e,n,r,s,i){var o;const a=this.runMap.get(n);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=Cc(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=Cc(i.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleChainError(e,n,r,s,i){var o;const a=this.runMap.get(n);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=Cc(i.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleToolStart(e,n,r,s,i,a,o){var d;const l=this._getExecutionOrder(s),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:n},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return await this._startTrace(c),await((d=this.onToolStart)==null?void 0:d.call(this,c)),c}async handleToolEnd(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleToolError(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,n){var i;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const s=r;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,r))}async handleAgentEnd(e,n){var s;const r=this.runMap.get(n);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,r)))}async handleRetrieverStart(e,n,r,s,i,a,o){var d;const l=this._getExecutionOrder(s),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:n},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return await this._startTrace(c),await((d=this.onRetrieverStart)==null?void 0:d.call(this,c)),c}async handleRetrieverEnd(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,n){var s;const r=this.runMap.get(n);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleText(e,n){var s;const r=this.runMap.get(n);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,r)))}async handleLLMNewToken(e,n,r,s,i,a){var l;const o=this.runMap.get(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:n,chunk:a==null?void 0:a.chunk}}),await((l=this.onLLMNewToken)==null?void 0:l.call(this,o,e,{chunk:a==null?void 0:a.chunk})),o}}function He(t,e){return`${t.open}${e}${t.close}`}function Nt(t,e){try{return JSON.stringify(t,null,2)}catch{return e}}function zn(t){if(!t.end_time)return"";const e=t.end_time-t.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:tt}=rw;class Sm extends Na{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const n=[];let r=e;for(;r.parent_run_id;){const s=this.runMap.get(r.parent_run_id);if(s)n.push(s),r=s;else break}return n}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((s,i,a)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return i===a.length-1?He(rw.bold,o):o}).join(" > ");return He(tt.grey,r)}onChainStart(e){const n=this.getBreadcrumbs(e);console.log(`${He(tt.green,"[chain/start]")} [${n}] Entering Chain run with input: ${Nt(e.inputs,"[inputs]")}`)}onChainEnd(e){const n=this.getBreadcrumbs(e);console.log(`${He(tt.cyan,"[chain/end]")} [${n}] [${zn(e)}] Exiting Chain run with output: ${Nt(e.outputs,"[outputs]")}`)}onChainError(e){const n=this.getBreadcrumbs(e);console.log(`${He(tt.red,"[chain/error]")} [${n}] [${zn(e)}] Chain run errored with error: ${Nt(e.error,"[error]")}`)}onLLMStart(e){const n=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${He(tt.green,"[llm/start]")} [${n}] Entering LLM run with input: ${Nt(r,"[inputs]")}`)}onLLMEnd(e){const n=this.getBreadcrumbs(e);console.log(`${He(tt.cyan,"[llm/end]")} [${n}] [${zn(e)}] Exiting LLM run with output: ${Nt(e.outputs,"[response]")}`)}onLLMError(e){const n=this.getBreadcrumbs(e);console.log(`${He(tt.red,"[llm/error]")} [${n}] [${zn(e)}] LLM run errored with error: ${Nt(e.error,"[error]")}`)}onToolStart(e){var r;const n=this.getBreadcrumbs(e);console.log(`${He(tt.green,"[tool/start]")} [${n}] Entering Tool run with input: "${(r=e.inputs.input)==null?void 0:r.trim()}"`)}onToolEnd(e){var r,s;const n=this.getBreadcrumbs(e);console.log(`${He(tt.cyan,"[tool/end]")} [${n}] [${zn(e)}] Exiting Tool run with output: "${(s=(r=e.outputs)==null?void 0:r.output)==null?void 0:s.trim()}"`)}onToolError(e){const n=this.getBreadcrumbs(e);console.log(`${He(tt.red,"[tool/error]")} [${n}] [${zn(e)}] Tool run errored with error: ${Nt(e.error,"[error]")}`)}onRetrieverStart(e){const n=this.getBreadcrumbs(e);console.log(`${He(tt.green,"[retriever/start]")} [${n}] Entering Retriever run with input: ${Nt(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const n=this.getBreadcrumbs(e);console.log(`${He(tt.cyan,"[retriever/end]")} [${n}] [${zn(e)}] Exiting Retriever run with output: ${Nt(e.outputs,"[outputs]")}`)}onRetrieverError(e){const n=this.getBreadcrumbs(e);console.log(`${He(tt.red,"[retriever/error]")} [${n}] [${zn(e)}] Retriever run errored with error: ${Nt(e.error,"[error]")}`)}onAgentAction(e){const n=e,r=this.getBreadcrumbs(e);console.log(`${He(tt.blue,"[agent/action]")} [${r}] Agent selected action: ${Nt(n.actions[n.actions.length-1],"[action]")}`)}}let oo;const Ck=new Uint8Array(16);function Rk(){if(!oo&&(oo=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!oo))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return oo(Ck)}const Ik=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Nk(t){return typeof t=="string"&&Ik.test(t)}const Ce=[];for(let t=0;t<256;++t)Ce.push((t+256).toString(16).slice(1));function jk(t,e=0){return Ce[t[e+0]]+Ce[t[e+1]]+Ce[t[e+2]]+Ce[t[e+3]]+"-"+Ce[t[e+4]]+Ce[t[e+5]]+"-"+Ce[t[e+6]]+Ce[t[e+7]]+"-"+Ce[t[e+8]]+Ce[t[e+9]]+"-"+Ce[t[e+10]]+Ce[t[e+11]]+Ce[t[e+12]]+Ce[t[e+13]]+Ce[t[e+14]]+Ce[t[e+15]]}const $k=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),xm={randomUUID:$k};function Pm(t,e,n){if(xm.randomUUID&&!e&&!t)return xm.randomUUID();t=t||{};const r=t.random||(t.rng||Rk)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,jk(r)}var sw={},iw={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function s(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function i(l,u,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var g=new s(c,d||l,f),p=n?n+u:u;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],g]:l._events[p].push(g):(l._events[p]=g,l._eventsCount++),l}function a(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=n?n+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,g=d.length,p=new Array(g);f<g;f++)p[f]=d[f].fn;return p},o.prototype.listenerCount=function(u){var c=n?n+u:u,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,c,d,f,g,p){var v=n?n+u:u;if(!this._events[v])return!1;var w=this._events[v],m=arguments.length,h,y;if(w.fn){switch(w.once&&this.removeListener(u,w.fn,void 0,!0),m){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,c),!0;case 3:return w.fn.call(w.context,c,d),!0;case 4:return w.fn.call(w.context,c,d,f),!0;case 5:return w.fn.call(w.context,c,d,f,g),!0;case 6:return w.fn.call(w.context,c,d,f,g,p),!0}for(y=1,h=new Array(m-1);y<m;y++)h[y-1]=arguments[y];w.fn.apply(w.context,h)}else{var _=w.length,b;for(y=0;y<_;y++)switch(w[y].once&&this.removeListener(u,w[y].fn,void 0,!0),m){case 1:w[y].fn.call(w[y].context);break;case 2:w[y].fn.call(w[y].context,c);break;case 3:w[y].fn.call(w[y].context,c,d);break;case 4:w[y].fn.call(w[y].context,c,d,f);break;default:if(!h)for(b=1,h=new Array(m-1);b<m;b++)h[b-1]=arguments[b];w[y].fn.apply(w[y].context,h)}}return!0},o.prototype.on=function(u,c,d){return i(this,u,c,d,!1)},o.prototype.once=function(u,c,d){return i(this,u,c,d,!0)},o.prototype.removeListener=function(u,c,d,f){var g=n?n+u:u;if(!this._events[g])return this;if(!c)return a(this,g),this;var p=this._events[g];if(p.fn)p.fn===c&&(!f||p.once)&&(!d||p.context===d)&&a(this,g);else{for(var v=0,w=[],m=p.length;v<m;v++)(p[v].fn!==c||f&&!p[v].once||d&&p[v].context!==d)&&w.push(p[v]);w.length?this._events[g]=w.length===1?w[0]:w:a(this,g)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=n?n+u:u,this._events[c]&&a(this,c)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,t.exports=o})(iw);var Lk=iw.exports,ju={exports:{}},Mk=(t,e)=>(e=e||(()=>{}),t.then(n=>new Promise(r=>{r(e())}).then(()=>n),n=>new Promise(r=>{r(e())}).then(()=>{throw n})));const Dk=Mk;class aw extends Error{constructor(e){super(e),this.name="TimeoutError"}}const ow=(t,e,n)=>new Promise((r,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(t);return}const i=setTimeout(()=>{if(typeof n=="function"){try{r(n())}catch(l){s(l)}return}const a=typeof n=="string"?n:`Promise timed out after ${e} milliseconds`,o=n instanceof Error?n:new aw(a);typeof t.cancel=="function"&&t.cancel(),s(o)},e);Dk(t.then(r,s),()=>{clearTimeout(i)})});ju.exports=ow;ju.exports.default=ow;ju.exports.TimeoutError=aw;var Fk=ju.exports,gh={},yh={};Object.defineProperty(yh,"__esModule",{value:!0});function Uk(t,e,n){let r=0,s=t.length;for(;s>0;){const i=s/2|0;let a=r+i;n(t[a],e)<=0?(r=++a,s-=i+1):s=i}return r}yh.default=Uk;Object.defineProperty(gh,"__esModule",{value:!0});const zk=yh;class Vk{constructor(){this._queue=[]}enqueue(e,n){n=Object.assign({priority:0},n);const r={priority:n.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=n.priority){this._queue.push(r);return}const s=zk.default(this._queue,r,(i,a)=>a.priority-i.priority);this._queue.splice(s,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(n=>n.priority===e.priority).map(n=>n.run)}get size(){return this._queue.length}}gh.default=Vk;Object.defineProperty(sw,"__esModule",{value:!0});const Bk=Lk,lw=Fk,Hk=gh,lo=()=>{},qk=new lw.TimeoutError;class Wk extends Bk{constructor(e){var n,r,s,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=lo,this._resolveIdle=lo,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:Hk.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(n=e.intervalCap)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=lo,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=lo,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const n=this._intervalEnd-e;if(n<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},n)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const n=this._queue.dequeue();return n?(this.emit("active"),n(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,n={}){return new Promise((r,s)=>{const i=async()=>{this._pendingCount++,this._intervalCount++;try{const a=this._timeout===void 0&&n.timeout===void 0?e():lw.default(Promise.resolve(e()),n.timeout===void 0?this._timeout:n.timeout,()=>{(n.throwOnTimeout===void 0?this._throwOnTimeout:n.throwOnTimeout)&&s(qk)});r(await a)}catch(a){s(a)}this._next()};this._queue.enqueue(i,n),this._tryToStartAnother(),this.emit("add")})}async addAll(e,n){return Promise.all(e.map(async r=>this.add(r,n)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const n=this._resolveEmpty;this._resolveEmpty=()=>{n(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const n=this._resolveIdle;this._resolveIdle=()=>{n(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var In=sw.default=Wk;const Zk=[400,401,403,404,405,406,407,408],Gk=[409];let Om=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in In?this.queue=new In.default({concurrency:this.maxConcurrency}):this.queue=new In({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...n){const r=this.onFailedResponseHook;return this.queue.add(()=>El(()=>e(...n).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;const i=s==null?void 0:s.response,a=i==null?void 0:i.status;if(a){if(Zk.includes(+a))throw s;if(Gk.includes(+a))return;r&&await r(i)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,n,...r){return e.signal?Promise.race([this.call(n,...r),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(n,...r)}fetch(...e){return this.call(()=>fetch(...e).then(n=>n.ok?n:Promise.reject(n)))}};function Tm(t){return typeof(t==null?void 0:t._getType)=="function"}function Am(t){const e={type:t._getType(),data:{content:t.content}};return t!=null&&t.additional_kwargs&&Object.keys(t.additional_kwargs).length>0&&(e.data.additional_kwargs={...t.additional_kwargs}),e}var Mi={};let bn;const Yk=()=>typeof window<"u"&&typeof window.document<"u",Qk=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Kk=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),uw=()=>typeof Deno<"u",Jk=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!uw(),Xk=()=>bn||(Yk()?bn="browser":Jk()?bn="node":Qk()?bn="webworker":Kk()?bn="jsdom":uw()?bn="deno":bn="other",bn);let Rc;async function eS(){if(Rc===void 0){const t=Xk(),e=rS();Rc={library:"langsmith",runtime:t,sdk:"langsmith-js",sdk_version:cw,...e}}return Rc}function tS(){const t=nS()||{},e={},n=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[r,s]of Object.entries(t))r.startsWith("LANGCHAIN_")&&typeof s=="string"&&!n.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[r]=s);return e}function nS(){try{return typeof process<"u"&&Mi?Object.entries(Mi).reduce((t,[e,n])=>(t[e]=String(n),t),{}):void 0}catch{return}}function Or(t){try{return typeof process<"u"?Mi==null?void 0:Mi[t]:void 0}catch{return}}let Ic;function rS(){if(Ic!==void 0)return Ic;const t=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const n of t){const r=Or(n);r!==void 0&&(e[n]=r)}return Ic=e,e}function ne(t){if(!Nk(t))throw new Error(`Invalid UUID: ${t}`)}const Cm={};function sS(t){Cm[t]||(console.warn(t),Cm[t]=!0)}async function Rm(t){const e=await eS(),n=tS();return t.map(r=>{const s=r.extra??{},i=s.metadata;return r.extra={...s,runtime:{...e,...s==null?void 0:s.runtime},metadata:{...n,...n.revision_id||r.revision_id?{revision_id:r.revision_id??n.revision_id}:{},...i}},r})}const iS=()=>{const t=Or("LANGCHAIN_TRACING_SAMPLING_RATE");if(t===void 0)return;const e=parseFloat(t);if(e<0||e>1)throw new Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},aS=t=>{const n=t.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return n==="localhost"||n==="127.0.0.1"||n==="::1"},Vn=async(t,e)=>{const n=await t.text();if(!t.ok)throw new Error(`Failed to ${e}: ${t.status} ${t.statusText} ${n}`)};async function oS(t){const e=[];for await(const n of t)e.push(n);return e}function Nc(t){if(t!==void 0)return t.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const lS=async t=>{if((t==null?void 0:t.status)===429){const e=parseInt(t.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(n=>setTimeout(n,e)),!0}return!1};class uS{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(e){return new Promise(n=>{this.items.push([e,n])})}pop(e){if(e<1)throw new Error("Number of items to pop off may not be less than 1.");const n=[];for(;n.length<e&&this.items.length;){const r=this.items.shift();if(r)n.push(r);else break}return[n.map(r=>r[0]),()=>n.forEach(r=>r[1]())]}}const cS=20971520;class vh{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new uS}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const n=vh.getDefaultClientConfig();this.tracingSampleRate=iS(),this.apiUrl=Nc(e.apiUrl??n.apiUrl)??"",this.apiKey=Nc(e.apiKey??n.apiKey),this.webUrl=Nc(e.webUrl??n.webUrl),this.timeout_ms=e.timeout_ms??12e3,this.caller=new Om(e.callerOptions??{}),this.batchIngestCaller=new Om({...e.callerOptions??{},onFailedResponseHook:lS}),this.hideInputs=e.hideInputs??e.anonymizer??n.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??n.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){const e=Or("LANGCHAIN_API_KEY"),n=Or("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",r=Or("LANGCHAIN_HIDE_INPUTS")==="true",s=Or("LANGCHAIN_HIDE_OUTPUTS")==="true";return{apiUrl:n,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:aS(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${cw}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const n={...e};return n.inputs!==void 0&&(n.inputs=this.processInputs(n.inputs)),n.outputs!==void 0&&(n.outputs=this.processOutputs(n.outputs)),n}async _getResponse(e,n){const r=(n==null?void 0:n.toString())??"",s=`${this.apiUrl}${e}?${r}`,i=await this.caller.call(fetch,s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok)throw new Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);return i}async _get(e,n){return(await this._getResponse(e,n)).json()}async*_getPaginated(e,n=new URLSearchParams){let r=Number(n.get("offset"))||0;const s=Number(n.get("limit"))||100;for(;;){n.set("offset",String(r)),n.set("limit",String(s));const i=`${this.apiUrl}${e}?${n}`,a=await this.caller.call(fetch,i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!a.ok)throw new Error(`Failed to fetch ${e}: ${a.status} ${a.statusText}`);const o=await a.json();if(o.length===0||(yield o,o.length<s))break;r+=o.length}}async*_getCursorPaginatedList(e,n=null,r="POST",s="runs"){const i=n?{...n}:{};for(;;){const o=await(await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(i)})).json();if(!o||!o[s])break;yield o[s];const l=o.cursors;if(!l||!l.next)break;i.cursor=l.next}}_filterForSampling(e,n=!1){if(this.tracingSampleRate===void 0)return e;if(n){const r=[];for(const s of e)this.sampledPostUuids.has(s.id)&&(r.push(s),this.sampledPostUuids.delete(s.id));return r}else{const r=[];for(const s of e)Math.random()<this.tracingSampleRate&&(r.push(s),this.sampledPostUuids.add(s.id));return r}}async drainAutoBatchQueue(){for(;this.autoBatchQueue.size>=0;){const[e,n]=this.autoBatchQueue.pop(this.pendingAutoBatchedRunLimit);if(!e.length){n();return}try{await this.batchIngestRuns({runCreates:e.filter(r=>r.action==="create").map(r=>r.item),runUpdates:e.filter(r=>r.action==="update").map(r=>r.item)})}finally{n()}}}async processRunOperation(e,n){const r=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0;const s=this.autoBatchQueue.push(e);return(n||this.autoBatchQueue.size>this.pendingAutoBatchedRunLimit)&&await this.drainAutoBatchQueue(),this.autoBatchQueue.size>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},r?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),s}async _getServerInfo(){const e=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!e.ok)throw await e.text(),new Error("Failed to retrieve server info.");return e.json()}async batchEndpointIsSupported(){try{this.serverInfo=await this._getServerInfo()}catch{return!1}return!0}async createRun(e){if(!this._filterForSampling([e]).length)return;const n={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const s=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}const i=await Rm([s]),a=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:n,body:JSON.stringify(i[0]),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Vn(a,"create run")}async batchIngestRuns({runCreates:e,runUpdates:n}){var u,c;if(e===void 0&&n===void 0)return;let r=(e==null?void 0:e.map(d=>this.prepareRunCreateOrUpdateInputs(d)))??[],s=(n==null?void 0:n.map(d=>this.prepareRunCreateOrUpdateInputs(d)))??[];if(r.length>0&&s.length>0){const d=r.reduce((g,p)=>(p.id&&(g[p.id]=p),g),{}),f=[];for(const g of s)g.id!==void 0&&d[g.id]?d[g.id]={...d[g.id],...g}:f.push(g);r=Object.values(d),s=f}const i={post:this._filterForSampling(r),patch:this._filterForSampling(s,!0)};if(!i.post.length&&!i.patch.length)return;if(r=await Rm(r),this.batchEndpointSupported===void 0&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){this.autoBatchTracing=!1;for(const d of i.post)await this.createRun(d);for(const d of i.patch)d.id!==void 0&&await this.updateRun(d.id,d);return}const a=((c=(u=this.serverInfo)==null?void 0:u.batch_ingest_config)==null?void 0:c.size_limit_bytes)??cS,o={post:[],patch:[]};let l=0;for(const d of["post","patch"]){const f=d,g=i[f].reverse();let p=g.pop();for(;p!==void 0;){const v=JSON.stringify(p);l>0&&l+v.length>a&&(await this._postBatchIngestRuns(JSON.stringify(o)),l=0,o.post=[],o.patch=[]),l+=v.length,o[f].push(p),p=g.pop()}}(o.post.length>0||o.patch.length>0)&&await this._postBatchIngestRuns(JSON.stringify(o))}async _postBatchIngestRuns(e){const n={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:n,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Vn(r,"batch create run")}async updateRun(e,n){ne(e),n.inputs&&(n.inputs=this.processInputs(n.inputs)),n.outputs&&(n.outputs=this.processOutputs(n.outputs));const r={...n,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(n.end_time!==void 0&&r.parent_run_id===void 0){await this.processRunOperation({action:"update",item:r},!0);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}const s={...this.headers,"Content-Type":"application/json"},i=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Vn(i,"update run")}async readRun(e,{loadChildRuns:n}={loadChildRuns:!1}){ne(e);let r=await this._get(`/runs/${e}`);return n&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:n,projectOpts:r}){if(n!==void 0){let s;n.session_id?s=n.session_id:r!=null&&r.projectName?s=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?s=r==null?void 0:r.projectId:s=(await this.readProject({projectName:Or("LANGCHAIN_PROJECT")||"default"})).id;const i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${s}/r/${n.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const n=await oS(this.listRuns({id:e.child_run_ids})),r={},s={};n.sort((i,a)=>((i==null?void 0:i.dotted_order)??"").localeCompare((a==null?void 0:a.dotted_order)??""));for(const i of n){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.parent_run_id in r||(r[i.parent_run_id]=[]),r[i.parent_run_id].push(i),s[i.id]=i}e.child_runs=r[e.id]||[];for(const i in r)i!==e.id&&(s[i].child_runs=r[i]);return e}async*listRuns(e){const{projectId:n,projectName:r,parentRunId:s,traceId:i,referenceExampleId:a,startTime:o,executionOrder:l,isRoot:u,runType:c,error:d,id:f,query:g,filter:p,traceFilter:v,treeFilter:w,limit:m,select:h}=e;let y=[];if(n&&(y=Array.isArray(n)?n:[n]),r){const k=Array.isArray(r)?r:[r],O=await Promise.all(k.map($=>this.readProject({projectName:$}).then(M=>M.id)));y.push(...O)}const _=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],b={session:y.length?y:null,run_type:c,reference_example:a,query:g,filter:p,trace_filter:v,tree_filter:w,execution_order:l,parent_run:s,start_time:o?o.toISOString():null,error:d,id:f,limit:m,trace:i,select:h||_,is_root:u};let E=0;for await(const k of this._getCursorPaginatedList("/runs/query",b))if(m){if(E>=m)break;if(k.length+E>m){yield*k.slice(0,m-E);break}E+=k.length,yield*k}else yield*k}async shareRun(e,{shareId:n}={}){const r={run_id:e,share_token:n||Pm()};ne(e);const i=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){ne(e);const n=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Vn(n,"unshare run")}async readRunSharedLink(e){ne(e);const r=await(await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:n}={}){const r=new URLSearchParams({share_token:e});if(n!==void 0)for(const a of n)r.append("id",a);return ne(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,n){if(!e&&!n)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:n})).id),ne(e);const s=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,n){if(!e&&!n)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:n})).id);const r={dataset_id:e};ne(e);const i=await(await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){ne(e);const n=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Vn(n,"unshare dataset")}async readSharedDataset(e){return ne(e),await(await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createProject({projectName:e,description:n=null,metadata:r=null,upsert:s=!1,projectExtra:i=null,referenceDatasetId:a=null}){const o=s?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,u=i||{};r&&(u.metadata=r);const c={name:e,extra:u,description:n};a!==null&&(c.reference_dataset_id=a);const d=await this.caller.call(fetch,l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),f=await d.json();if(!d.ok)throw new Error(`Failed to create session ${e}: ${d.status} ${d.statusText}`);return f}async updateProject(e,{name:n=null,description:r=null,metadata:s=null,projectExtra:i=null,endTime:a=null}){const o=`${this.apiUrl}/sessions/${e}`;let l=i;s&&(l={...l||{},metadata:s});const u={name:n,extra:l,description:r,end_time:a?new Date(a).toISOString():null},c=await this.caller.call(fetch,o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),d=await c.json();if(!c.ok)throw new Error(`Failed to update project ${e}: ${c.status} ${c.statusText}`);return d}async hasProject({projectId:e,projectName:n}){let r="/sessions";const s=new URLSearchParams;if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ne(e),r+=`/${e}`;else if(n!==void 0)s.append("name",n);else throw new Error("Must provide projectName or projectId");const i=await this.caller.call(fetch,`${this.apiUrl}${r}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const a=await i.json();return i.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:n,includeStats:r}){let s="/sessions";const i=new URLSearchParams;if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ne(e),s+=`/${e}`;else if(n!==void 0)i.append("name",n);else throw new Error("Must provide projectName or projectId");r!==void 0&&i.append("include_stats",r.toString());const a=await this._get(s,i);let o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${n}] not found`);o=a[0]}else o=a;return o}async getProjectUrl({projectId:e,projectName:n}){if(e===void 0&&n===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:n}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:n}){if(e===void 0&&n===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:n}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const n of this._getPaginated("/sessions",e))return this._tenantId=n[0].tenant_id,n[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:n,nameContains:r,referenceDatasetId:s,referenceDatasetName:i,referenceFree:a}={}){const o=new URLSearchParams;if(e!==void 0)for(const l of e)o.append("id",l);if(n!==void 0&&o.append("name",n),r!==void 0&&o.append("name_contains",r),s!==void 0)o.append("reference_dataset",s);else if(i!==void 0){const l=await this.readDataset({datasetName:i});o.append("reference_dataset",l.id)}a!==void 0&&o.append("reference_free",a.toString());for await(const l of this._getPaginated("/sessions",o))yield*l}async deleteProject({projectId:e,projectName:n}){let r;if(e===void 0&&n===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:n})).id:r=e,ne(r);const s=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Vn(s,`delete session ${r} (${n})`)}async uploadCsv({csvFile:e,fileName:n,inputKeys:r,outputKeys:s,description:i,dataType:a,name:o}){const l=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,n),r.forEach(f=>{u.append("input_keys",f)}),s.forEach(f=>{u.append("output_keys",f)}),i&&u.append("description",i),a&&u.append("data_type",a),o&&u.append("name",o);const c=await this.caller.call(fetch,l,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!c.ok){const f=await c.json();throw f.detail&&f.detail.includes("already exists")?new Error(`Dataset ${n} already exists`):new Error(`Failed to upload CSV: ${c.status} ${c.statusText}`)}return await c.json()}async createDataset(e,{description:n,dataType:r}={}){const s={name:e,description:n};r&&(s.data_type=r);const i=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok){const o=await i.json();throw o.detail&&o.detail.includes("already exists")?new Error(`Dataset ${e} already exists`):new Error(`Failed to create dataset ${i.status} ${i.statusText}`)}return await i.json()}async readDataset({datasetId:e,datasetName:n}){let r="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)ne(e),r+=`/${e}`;else if(n!==void 0)s.append("name",n);else throw new Error("Must provide datasetName or datasetId");const i=await this._get(r,s);let a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${n}] not found`);a=i[0]}else a=i;return a}async hasDataset({datasetId:e,datasetName:n}){try{return await this.readDataset({datasetId:e,datasetName:n}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:n,fromVersion:r,toVersion:s}){let i=e;if(i===void 0&&n===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:n})).id);const a=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:n}){const r="/datasets";if(e===void 0)if(n!==void 0)e=(await this.readDataset({datasetName:n})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:n=0,datasetIds:r,datasetName:s,datasetNameContains:i}={}){const a="/datasets",o=new URLSearchParams({limit:e.toString(),offset:n.toString()});if(r!==void 0)for(const l of r)o.append("id",l);s!==void 0&&o.append("name",s),i!==void 0&&o.append("name_contains",i);for await(const l of this._getPaginated(a,o))yield*l}async updateDataset(e){const{datasetId:n,datasetName:r,...s}=e;if(!n&&!r)throw new Error("Must provide either datasetName or datasetId");const i=n??(await this.readDataset({datasetName:r})).id;ne(i);const a=await this.caller.call(fetch,`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!a.ok)throw new Error(`Failed to update dataset ${i}: ${a.status} ${a.statusText}`);return await a.json()}async deleteDataset({datasetId:e,datasetName:n}){let r="/datasets",s=e;if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(n!==void 0&&(s=(await this.readDataset({datasetName:n})).id),s!==void 0)ne(s),r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const i=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok)throw new Error(`Failed to delete ${r}: ${i.status} ${i.statusText}`);await i.json()}async createExample(e,n,{datasetId:r,datasetName:s,createdAt:i,exampleId:a,metadata:o,split:l}){let u=r;if(u===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(u!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");u===void 0&&(u=(await this.readDataset({datasetName:s})).id);const c=i||new Date,d={dataset_id:u,inputs:e,outputs:n,created_at:c==null?void 0:c.toISOString(),id:a,metadata:o,split:l},f=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!f.ok)throw new Error(`Failed to create example: ${f.status} ${f.statusText}`);return await f.json()}async createExamples(e){const{inputs:n,outputs:r,metadata:s,sourceRunIds:i,exampleIds:a,datasetId:o,datasetName:l}=e;let u=o;if(u===void 0&&l===void 0)throw new Error("Must provide either datasetName or datasetId");if(u!==void 0&&l!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");u===void 0&&(u=(await this.readDataset({datasetName:l})).id);const c=n.map((g,p)=>({dataset_id:u,inputs:g,outputs:r?r[p]:void 0,metadata:s?s[p]:void 0,split:e.splits?e.splits[p]:void 0,id:a?a[p]:void 0,source_run_id:i?i[p]:void 0})),d=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!d.ok)throw new Error(`Failed to create examples: ${d.status} ${d.statusText}`);return await d.json()}async createLLMExample(e,n,r){return this.createExample({input:e},{output:n},r)}async createChatExample(e,n,r){const s=e.map(a=>Tm(a)?Am(a):a),i=Tm(n)?Am(n):n;return this.createExample({input:s},{output:i},r)}async readExample(e){ne(e);const n=`/examples/${e}`;return await this._get(n)}async*listExamples({datasetId:e,datasetName:n,exampleIds:r,asOf:s,splits:i,inlineS3Urls:a,metadata:o,limit:l,offset:u,filter:c}={}){let d;if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)d=e;else if(n!==void 0)d=(await this.readDataset({datasetName:n})).id;else throw new Error("Must provide a datasetName or datasetId");const f=new URLSearchParams({dataset:d}),g=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;g&&f.append("as_of",g);const p=a??!0;if(f.append("inline_s3_urls",p.toString()),r!==void 0)for(const w of r)f.append("id",w);if(i!==void 0)for(const w of i)f.append("splits",w);if(o!==void 0){const w=JSON.stringify(o);f.append("metadata",w)}l!==void 0&&f.append("limit",l.toString()),u!==void 0&&f.append("offset",u.toString()),c!==void 0&&f.append("filter",c);let v=0;for await(const w of this._getPaginated("/examples",f)){for(const m of w)yield m,v++;if(l!==void 0&&v>=l)break}}async deleteExample(e){ne(e);const n=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!r.ok)throw new Error(`Failed to delete ${n}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,n){ne(e);const r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!r.ok)throw new Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);return await r.json()}async evaluateRun(e,n,{sourceInfo:r,loadChildRuns:s,referenceExample:i}={loadChildRuns:!1}){sS("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(i=await this.readExample(a.reference_example_id));const o=await n.evaluateRun(a,i),[l,u]=await this._logEvaluationFeedback(o,a,r);return u[0]}async createFeedback(e,n,{score:r,value:s,correction:i,comment:a,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:u,feedbackId:c,feedbackConfig:d,projectId:f,comparativeExperimentId:g}){var h;if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");const p={type:l??"api",metadata:o??{}};u!==void 0&&(p==null?void 0:p.metadata)!==void 0&&!p.metadata.__run&&(p.metadata.__run={run_id:u}),(p==null?void 0:p.metadata)!==void 0&&((h=p.metadata.__run)==null?void 0:h.run_id)!==void 0&&ne(p.metadata.__run.run_id);const v={id:c??Pm(),run_id:e,key:n,score:r,value:s,correction:i,comment:a,feedback_source:p,comparative_experiment_id:g,feedbackConfig:d,session_id:f},w=`${this.apiUrl}/feedback`,m=await this.caller.call(fetch,w,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(v),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Vn(m,"create feedback"),v}async updateFeedback(e,{score:n,value:r,correction:s,comment:i}){const a={};n!=null&&(a.score=n),r!=null&&(a.value=r),s!=null&&(a.correction=s),i!=null&&(a.comment=i),ne(e);const o=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Vn(o,"update feedback")}async readFeedback(e){ne(e);const n=`/feedback/${e}`;return await this._get(n)}async deleteFeedback(e){ne(e);const n=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!r.ok)throw new Error(`Failed to delete ${n}: ${r.status} ${r.statusText}`);await r.json()}async*listFeedback({runIds:e,feedbackKeys:n,feedbackSourceTypes:r}={}){const s=new URLSearchParams;if(e&&s.append("run",e.join(",")),n)for(const i of n)s.append("key",i);if(r)for(const i of r)s.append("source",i);for await(const i of this._getPaginated("/feedback",s))yield*i}async createPresignedFeedbackToken(e,n,{expiration:r,feedbackConfig:s}={}){const i={run_id:e,feedback_key:n,feedback_config:s};return r?typeof r=="string"?i.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(i.expires_in=r):i.expires_in={hours:3},await(await this.caller.call(fetch,`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:n,referenceDatasetId:r,createdAt:s,description:i,metadata:a,id:o}){var c;if(n.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:n[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const l={id:o,name:e,experiment_ids:n,reference_dataset_id:r,description:i,created_at:(c=s??new Date)==null?void 0:c.toISOString(),extra:{}};return a&&(l.extra.metadata=a),await(await this.caller.call(fetch,`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){ne(e);const n=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",n))yield*r}_selectEvalResults(e){let n;return"results"in e?n=e.results:n=[e],n}async _logEvaluationFeedback(e,n,r){const s=this._selectEvalResults(e),i=[];for(const a of s){let o=r||{};a.evaluatorInfo&&(o={...a.evaluatorInfo,...o});let l=null;a.targetRunId?l=a.targetRunId:n&&(l=n.id),i.push(await this.createFeedback(l,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:o,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[s,i]}async logEvaluationFeedback(e,n,r){const[s]=await this._logEvaluationFeedback(e,n,r);return s}}const cw="0.1.36";class dS extends Na{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:n,projectName:r,client:s}=e;this.projectName=r??We("LANGCHAIN_PROJECT")??We("LANGCHAIN_SESSION"),this.exampleId=n,this.client=s??new vh({});const i=this.getTraceableRunTree();if(i){let a=i;const o=new Set;for(;a.parent_run&&!(o.has(a.id)||(o.add(a.id),!a.parent_run));)a=a.parent_run;o.clear();const l=[a];for(;l.length>0;){const u=l.shift();!u||o.has(u.id)||(o.add(u.id),this.runMap.set(u.id,u),u.child_runs&&l.push(...u.child_runs))}this.client=i.client??this.client,this.projectName=i.project_name??this.projectName,this.exampleId=i.reference_example_id??this.exampleId}}async _convertToCreate(e,n=void 0){return{...e,extra:{...e.extra,runtime:await xk()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:n}}async persistRun(e){}async onRunCreate(e){const n=await this._convertToCreate(e,this.exampleId);await this.client.createRun(n)}async onRunUpdate(e){const n={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,n)}getRun(e){return this.runMap.get(e)}getTraceableRunTree(){try{return lk()}catch{return}}}function Im(t,e=wh){t=t.trim();const n=/```(json)?(.*)```/s.exec(t);return e(n?n[2]:t)}function wh(t){if(typeof t>"u")return null;try{return JSON.parse(t)}catch{}let e="";const n=[];let r=!1,s=!1;for(let i of t){if(r)i==='"'&&!s?r=!1:i===`
`&&!s?i="\\n":i==="\\"?s=!s:s=!1;else if(i==='"')r=!0,s=!1;else if(i==="{")n.push("}");else if(i==="[")n.push("]");else if(i==="}"||i==="]")if(n&&n[n.length-1]===i)n.pop();else return null;e+=i}r&&(e+='"');for(let i=n.length-1;i>=0;i-=1)e+=n[i];try{return JSON.parse(e)}catch{return null}}function Ks(t,e){return typeof t=="string"?typeof e=="string"?t+e:[{type:"text",text:t},...e]:Array.isArray(e)?[...t,...e]:[...t,{type:"text",text:e}]}class lr extends Hr{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,n){typeof e=="string"&&(e={content:e,additional_kwargs:n,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}}function lt(t,e){const n={...t};for(const[r,s]of Object.entries(e))if(n[r]==null)n[r]=s;else{if(s==null)continue;if(typeof n[r]!=typeof s||Array.isArray(n[r])!==Array.isArray(s))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof n[r]=="string")n[r]=n[r]+s;else if(!Array.isArray(n[r])&&typeof n[r]=="object")n[r]=lt(n[r],s);else if(Array.isArray(n[r]))n[r]=dw(n[r],s);else{if(n[r]===s)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return n}function dw(t,e){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t||e;{const n=[...t];for(const r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){const s=n.findIndex(i=>i.index===r.index);s!==-1?n[s]=lt(n[s],r):n.push(r)}else n.push(r);return n}}}class Js extends lr{}function $u(t){return typeof(t==null?void 0:t._getType)=="function"}function fS(t){return $u(t)&&typeof t.concat=="function"}class _h extends Js{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new _h({content:Ks(this.content,e.content),additional_kwargs:lt(this.additional_kwargs,e.additional_kwargs),response_metadata:lt(this.response_metadata,e.response_metadata),tool_call_id:this.tool_call_id,id:this.id??e.id})}}function hS(t){const e=[],n=[];for(const r of t)if(r.function){const s=r.function.name;try{const i=JSON.parse(r.function.arguments),a={name:s||"",args:i||{},id:r.id};e.push(a)}catch{n.push({name:s,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,n]}class bh extends lr{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,n){var s;let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:n??{}};else{r=e;const i=(s=r.additional_kwargs)==null?void 0:s.tool_calls,a=r.tool_calls;i!=null&&i.length>0&&(a===void 0||a.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(i!=null&&a===void 0){const[o,l]=hS(i);r.tool_calls=o??[],r.invalid_tool_calls=l??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}}function fw(t){return t._getType()==="ai"}class Yr extends Js{constructor(e){let n;if(typeof e=="string")n={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)n={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[]};else{const r=[],s=[];for(const i of e.tool_call_chunks){let a={};try{if(a=wh(i.args??"{}")??{},typeof a!="object"||Array.isArray(a))throw new Error("Malformed tool call chunk args.");r.push({name:i.name??"",args:a,id:i.id})}catch{s.push({name:i.name,args:i.args,id:i.id,error:"Malformed args."})}}n={...e,tool_calls:r,invalid_tool_calls:s}}super(n),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=n.tool_call_chunks??this.tool_call_chunks,this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=n.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){const n={content:Ks(this.content,e.content),additional_kwargs:lt(this.additional_kwargs,e.additional_kwargs),response_metadata:lt(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const r=dw(this.tool_call_chunks,e.tool_call_chunks);r!==void 0&&r.length>0&&(n.tool_call_chunks=r)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const r=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},s=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},i={input_tokens:r.input_tokens+s.input_tokens,output_tokens:r.output_tokens+s.output_tokens,total_tokens:r.total_tokens+s.total_tokens};n.usage_metadata=i}return new Yr(n)}}class Qr extends lr{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Qr}constructor(e,n){typeof e=="string"&&(e={content:e,role:n}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}}class Lu extends Js{static lc_name(){return"ChatMessageChunk"}constructor(e,n){typeof e=="string"&&(e={content:e,role:n}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Lu({content:Ks(this.content,e.content),additional_kwargs:lt(this.additional_kwargs,e.additional_kwargs),response_metadata:lt(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}}class Mu extends Js{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new Mu({content:Ks(this.content,e.content),additional_kwargs:lt(this.additional_kwargs,e.additional_kwargs),response_metadata:lt(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class Xs extends lr{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class Du extends Js{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new Du({content:Ks(this.content,e.content),additional_kwargs:lt(this.additional_kwargs,e.additional_kwargs),response_metadata:lt(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class hw extends lr{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class Fu extends Js{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new Fu({content:Ks(this.content,e.content),additional_kwargs:lt(this.additional_kwargs,e.additional_kwargs),response_metadata:lt(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function Nm(t){const{type:e,...n}=t;if(e==="human"||e==="user")return new Xs(n);if(e==="ai"||e==="assistant")return new bh(n);if(e==="system")return new hw(n);throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}function Xn(t){if(typeof t=="string")return new Xs(t);if($u(t))return t;if(Array.isArray(t)){const[e,n]=t;return Nm({type:e,content:n})}else return Nm(t)}function pw(t,e="Human",n="AI"){const r=[];for(const s of t){let i;if(s._getType()==="human")i=e;else if(s._getType()==="ai")i=n;else if(s._getType()==="system")i="System";else if(s._getType()==="function")i="Function";else if(s._getType()==="tool")i="Tool";else if(s._getType()==="generic")i=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);const a=s.name?`${s.name}, `:"";r.push(`${i}: ${a}${s.content}`)}return r.join(`
`)}function pS(t){var n;const e=t._getType();if(e==="human")return new Du({...t});if(e==="ai"){let r={...t};return"tool_calls"in r&&(r={...r,tool_call_chunks:(n=r.tool_calls)==null?void 0:n.map(s=>({...s,index:void 0,args:JSON.stringify(s.args)}))}),new Yr({...r})}else{if(e==="system")return new Fu({...t});if(e==="function")return new Mu({...t});if(Qr.isInstance(t))return new Lu({...t});throw new Error("Unknown message type.")}}async function mS(){return new dS}let jc;function gS(){const t="default"in In?In.default:In;return new t({autoStart:!0,concurrency:1})}async function Ne(t,e){e===!0?await t():(typeof jc>"u"&&(jc=gS()),jc.add(t))}function yS(t){return t?Array.isArray(t)||"name"in t?{callbacks:t}:t:{}}class vS{setHandler(e){return this.setHandlers([e])}}class Uu{constructor(e,n,r,s,i,a,o,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}async handleText(e){await Promise.all(this.handlers.map(n=>Ne(async()=>{var r;try{await((r=n.handleText)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${n.constructor.name}, handleText: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}}class wS extends Uu{getChild(e){const n=new Ye(this.runId);return n.setHandlers(this.inheritableHandlers),n.addTags(this.inheritableTags),n.addMetadata(this.inheritableMetadata),e&&n.addTags([e],!1),n}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(n=>Ne(async()=>{var r;if(!n.ignoreRetriever)try{await((r=n.handleRetrieverEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${n.constructor.name}, handleRetriever`),n.raiseError)throw s}},n.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(n=>Ne(async()=>{var r;if(!n.ignoreRetriever)try{await((r=n.handleRetrieverError)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${n.constructor.name}, handleRetrieverError: ${s}`),n.raiseError)throw e}},n.awaitHandlers)))}}class jm extends Uu{async handleLLMNewToken(e,n,r,s,i,a){await Promise.all(this.handlers.map(o=>Ne(async()=>{var l;if(!o.ignoreLLM)try{await((l=o.handleLLMNewToken)==null?void 0:l.call(o,e,n??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(u){if(console.error(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`),o.raiseError)throw u}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(n=>Ne(async()=>{var r;if(!n.ignoreLLM)try{await((r=n.handleLLMError)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${n.constructor.name}, handleLLMError: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(n=>Ne(async()=>{var r;if(!n.ignoreLLM)try{await((r=n.handleLLMEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${n.constructor.name}, handleLLMEnd: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}}class _S extends Uu{getChild(e){const n=new Ye(this.runId);return n.setHandlers(this.inheritableHandlers),n.addTags(this.inheritableTags),n.addMetadata(this.inheritableMetadata),e&&n.addTags([e],!1),n}async handleChainError(e,n,r,s,i){await Promise.all(this.handlers.map(a=>Ne(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if(console.error(`Error in handler ${a.constructor.name}, handleChainError: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}async handleChainEnd(e,n,r,s,i){await Promise.all(this.handlers.map(a=>Ne(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(l){if(console.error(`Error in handler ${a.constructor.name}, handleChainEnd: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(n=>Ne(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleAgentAction)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${n.constructor.name}, handleAgentAction: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(n=>Ne(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleAgentEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${n.constructor.name}, handleAgentEnd: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}}class bS extends Uu{getChild(e){const n=new Ye(this.runId);return n.setHandlers(this.inheritableHandlers),n.addTags(this.inheritableTags),n.addMetadata(this.inheritableMetadata),e&&n.addTags([e],!1),n}async handleToolError(e){await Promise.all(this.handlers.map(n=>Ne(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleToolError)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${n.constructor.name}, handleToolError: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(n=>Ne(async()=>{var r;if(!n.ignoreAgent)try{await((r=n.handleToolEnd)==null?void 0:r.call(n,e,this.runId,this._parentRunId,this.tags))}catch(s){if(console.error(`Error in handler ${n.constructor.name}, handleToolEnd: ${s}`),n.raiseError)throw s}},n.awaitHandlers)))}}class Ye extends vS{constructor(e,n){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(n==null?void 0:n.handlers)??this.handlers,this.inheritableHandlers=(n==null?void 0:n.inheritableHandlers)??this.inheritableHandlers,this.tags=(n==null?void 0:n.tags)??this.tags,this.inheritableTags=(n==null?void 0:n.inheritableTags)??this.inheritableTags,this.metadata=(n==null?void 0:n.metadata)??this.metadata,this.inheritableMetadata=(n==null?void 0:n.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,n,r=void 0,s=void 0,i=void 0,a=void 0,o=void 0,l=void 0){return Promise.all(n.map(async(u,c)=>{const d=c===0&&r?r:Tn();return await Promise.all(this.handlers.map(f=>Ne(async()=>{var g;if(!f.ignoreLLM)try{await((g=f.handleLLMStart)==null?void 0:g.call(f,e,[u],d,this._parentRunId,i,this.tags,this.metadata,l))}catch(p){if(console.error(`Error in handler ${f.constructor.name}, handleLLMStart: ${p}`),f.raiseError)throw p}},f.awaitHandlers))),new jm(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,n,r=void 0,s=void 0,i=void 0,a=void 0,o=void 0,l=void 0){return Promise.all(n.map(async(u,c)=>{const d=c===0&&r?r:Tn();return await Promise.all(this.handlers.map(f=>Ne(async()=>{var g,p;if(!f.ignoreLLM)try{if(f.handleChatModelStart)await((g=f.handleChatModelStart)==null?void 0:g.call(f,e,[u],d,this._parentRunId,i,this.tags,this.metadata,l));else if(f.handleLLMStart){const v=pw(u);await((p=f.handleLLMStart)==null?void 0:p.call(f,e,[v],d,this._parentRunId,i,this.tags,this.metadata,l))}}catch(v){if(console.error(`Error in handler ${f.constructor.name}, handleLLMStart: ${v}`),f.raiseError)throw v}},f.awaitHandlers))),new jm(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,n,r=Tn(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>Ne(async()=>{var u;if(!l.ignoreChain)try{await((u=l.handleChainStart)==null?void 0:u.call(l,e,n,r,this._parentRunId,this.tags,this.metadata,s,o))}catch(c){if(console.error(`Error in handler ${l.constructor.name}, handleChainStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers))),new _S(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,n,r=Tn(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>Ne(async()=>{var u;if(!l.ignoreAgent)try{await((u=l.handleToolStart)==null?void 0:u.call(l,e,n,r,this._parentRunId,this.tags,this.metadata,o))}catch(c){if(console.error(`Error in handler ${l.constructor.name}, handleToolStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers))),new bS(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,n,r=Tn(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>Ne(async()=>{var u;if(!l.ignoreRetriever)try{await((u=l.handleRetrieverStart)==null?void 0:u.call(l,e,n,r,this._parentRunId,this.tags,this.metadata,o))}catch(c){if(console.error(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers))),new wS(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,n=!0){this.handlers.push(e),n&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(n=>n!==e),this.inheritableHandlers=this.inheritableHandlers.filter(n=>n!==e)}setHandlers(e,n=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,n)}addTags(e,n=!0){this.removeTags(e),this.tags.push(...e),n&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(n=>!e.includes(n)),this.inheritableTags=this.inheritableTags.filter(n=>!e.includes(n))}addMetadata(e,n=!0){this.metadata={...this.metadata,...e},n&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const n of Object.keys(e))delete this.metadata[n],delete this.inheritableMetadata[n]}copy(e=[],n=!0){const r=new Ye(this._parentRunId);for(const s of this.handlers){const i=this.inheritableHandlers.includes(s);r.addHandler(s,i)}for(const s of this.tags){const i=this.inheritableTags.includes(s);r.addTags([s],i)}for(const s of Object.keys(this.metadata)){const i=Object.keys(this.inheritableMetadata).includes(s);r.addMetadata({[s]:this.metadata[s]},i)}for(const s of e)r.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===s.name)||r.addHandler(s,n);return r}static fromHandlers(e){class n extends Ia{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Tn()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new n),r}static async configure(e,n,r,s,i,a,o){var f;let l;(e||n)&&(Array.isArray(e)||!e?(l=new Ye,l.setHandlers((e==null?void 0:e.map(Sl))??[],!0)):l=e,l=l.copy(Array.isArray(n)?n.map(Sl):n==null?void 0:n.handlers,!1));const u=We("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),c=We("LANGCHAIN_TRACING_V2")==="true"||We("LANGSMITH_TRACING")==="true",d=c||(We("LANGCHAIN_TRACING")??!1);if(u||d){if(l||(l=new Ye),u&&!l.handlers.some(g=>g.name===Sm.prototype.name)){const g=new Sm;l.addHandler(g,!0)}if(d&&!l.handlers.some(g=>g.name==="langchain_tracer")&&c){const g=await mS();l.addHandler(g,!0),l._parentRunId=((f=g.getTraceableRunTree())==null?void 0:f.id)??l._parentRunId}}return(r||s)&&l&&(l.addTags(r??[]),l.addTags(s??[],!1)),(i||a)&&l&&(l.addMetadata(i??{}),l.addMetadata(a??{},!1)),l}}function Sl(t){return"name"in t?t:Ia.fromMethods(t)}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const ES=Object.prototype.hasOwnProperty;function Wd(t,e){return ES.call(t,e)}function Zd(t){if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=""+r;return n}if(Object.keys)return Object.keys(t);let e=[];for(let n in t)Wd(t,n)&&e.push(n);return e}function un(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function Gd(t){let e=0;const n=t.length;let r;for(;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Jr(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function kS(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function Yd(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(Yd(t[n]))return!0}else if(typeof t=="object"){const n=Zd(t),r=n.length;for(var e=0;e<r;e++)if(Yd(t[n[e]]))return!0}}return!1}function $m(t,e){const n=[t];for(const r in e){const s=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof s<"u"&&n.push(`${r}: ${s}`)}return n.join(`
`)}class SS extends Error{constructor(e,n,r,s,i){super($m(e,{name:n,index:r,operation:s,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=$m(e,{name:n,index:r,operation:s,tree:i})}}const ye=SS,ws={add:function(t,e,n){return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){let r=Qd(n,this.path);r&&(r=un(r));const s=Di(n,{op:"remove",path:this.from}).removed;return Di(n,{op:"add",path:this.path,value:s}),{newDocument:n,removed:r}},copy:function(t,e,n){const r=Qd(n,this.from);return Di(n,{op:"add",path:this.path,value:un(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:Pl(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}};var xS={add:function(t,e,n){return Gd(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:ws.move,copy:ws.copy,test:ws.test,_get:ws._get};function Qd(t,e){if(e=="")return t;var n={op:"_get",path:e};return Di(t,n),n.value}function Di(t,e,n=!1,r=!0,s=!0,i=0){if(n&&(typeof n=="function"?n(e,0,t,e.path):Kd(e,0)),e.path===""){let a={newDocument:t};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=t,a;if(e.op==="move"||e.op==="copy")return a.newDocument=Qd(t,e.from),e.op==="move"&&(a.removed=t),a;if(e.op==="test"){if(a.test=Pl(t,e.value),a.test===!1)throw new ye("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return a.newDocument=t,a}else{if(e.op==="remove")return a.removed=t,a.newDocument=null,a;if(e.op==="_get")return e.value=t,a;if(n)throw new ye("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,t);return a}}else{r||(t=un(t));const o=(e.path||"").split("/");let l=t,u=1,c=o.length,d,f,g;for(typeof n=="function"?g=n:g=Kd;;){if(f=o[u],f&&f.indexOf("~")!=-1&&(f=kS(f)),s&&(f=="__proto__"||f=="prototype"&&u>0&&o[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[f]===void 0?d=o.slice(0,u).join("/"):u==c-1&&(d=e.path),d!==void 0&&g(e,0,t,d)),u++,Array.isArray(l)){if(f==="-")f=l.length;else{if(n&&!Gd(f))throw new ye("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,t);Gd(f)&&(f=~~f)}if(u>=c){if(n&&e.op==="add"&&f>l.length)throw new ye("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,t);const p=xS[e.op].call(e,l,f,t);if(p.test===!1)throw new ye("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return p}}else if(u>=c){const p=ws[e.op].call(e,l,f,t);if(p.test===!1)throw new ye("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return p}if(l=l[f],n&&u<c&&(!l||typeof l!="object"))throw new ye("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,t)}}}function xl(t,e,n,r=!0,s=!0){if(n&&!Array.isArray(e))throw new ye("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=un(t));const i=new Array(e.length);for(let a=0,o=e.length;a<o;a++)i[a]=Di(t,e[a],n,!0,s,a),t=i[a].newDocument;return i.newDocument=t,i}function Kd(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new ye("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(ws[t.op]){if(typeof t.path!="string")throw new ye("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new ye('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new ye("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new ye("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&Yd(t.value))throw new ye("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var s=t.path.split("/").length,i=r.split("/").length;if(s!==i+1&&s!==i)throw new ye("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new ye("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var a={op:"_get",path:t.from,value:void 0},o=PS([a],n);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new ye("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new ye("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function PS(t,e,n){try{if(!Array.isArray(t))throw new ye("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)xl(un(e),un(t),n||!0);else{n=n||Kd;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(s){if(s instanceof ye)return s;throw s}}function Pl(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),s,i,a;if(n&&r){if(i=t.length,i!=e.length)return!1;for(s=i;s--!==0;)if(!Pl(t[s],e[s]))return!1;return!0}if(n!=r)return!1;var o=Object.keys(t);if(i=o.length,i!==Object.keys(e).length)return!1;for(s=i;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=i;s--!==0;)if(a=o[s],!Pl(t[a],e[a]))return!1;return!0}return t!==t&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function mw(t,e,n,r,s){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=Zd(e),a=Zd(t),o=!1,l=a.length-1;l>=0;l--){var u=a[l],c=t[u];if(Wd(e,u)&&!(e[u]===void 0&&c!==void 0&&Array.isArray(e)===!1)){var d=e[u];typeof c=="object"&&c!=null&&typeof d=="object"&&d!=null&&Array.isArray(c)===Array.isArray(d)?mw(c,d,n,r+"/"+Jr(u),s):c!==d&&(s&&n.push({op:"test",path:r+"/"+Jr(u),value:un(c)}),n.push({op:"replace",path:r+"/"+Jr(u),value:un(d)}))}else Array.isArray(t)===Array.isArray(e)?(s&&n.push({op:"test",path:r+"/"+Jr(u),value:un(c)}),n.push({op:"remove",path:r+"/"+Jr(u)}),o=!0):(s&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!o&&i.length==a.length))for(var l=0;l<i.length;l++){var u=i[l];!Wd(t,u)&&e[u]!==void 0&&n.push({op:"add",path:r+"/"+Jr(u),value:un(e[u])})}}}function OS(t,e,n=!1){var r=[];return mw(t,e,r,"",n),r}class TS{getStore(){}run(e,n){return n()}}const AS=new TS;class CS{getInstance(){return globalThis.__lc_tracing_async_local_storage??AS}initializeGlobalInstance(e){globalThis.__lc_tracing_async_local_storage===void 0&&(globalThis.__lc_tracing_async_local_storage=e)}}const yr=new CS;class ut extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const n=this.reader.cancel();this.reader.releaseLock(),await n}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){const n=e.getReader();return new ut({start(r){return s();function s(){return n.read().then(({done:i,value:a})=>{if(i){r.close();return}return r.enqueue(a),s()})}},cancel(){n.releaseLock()}})}static fromAsyncGenerator(e){return new ut({async pull(n){const{value:r,done:s}=await e.next();s&&n.close(),n.enqueue(r)},async cancel(n){await e.return(n)}})}}function gw(t,e=2){const n=Array.from({length:e},()=>[]);return n.map(async function*(s){for(;;)if(s.length===0){const i=await t.next();for(const a of n)a.push(i)}else{if(s[0].done)return;yield s.shift().value}})}function gn(t,e){if(Array.isArray(t)&&Array.isArray(e))return t.concat(e);if(typeof t=="string"&&typeof e=="string")return t+e;if(typeof t=="number"&&typeof e=="number")return t+e;if("concat"in t&&typeof t.concat=="function")return t.concat(e);if(typeof t=="object"&&typeof e=="object"){const n={...t};for(const[r,s]of Object.entries(e))r in n&&!Array.isArray(n[r])?n[r]=gn(n[r],s):n[r]=s;return n}else throw new Error(`Cannot concat ${typeof t} and ${typeof e}`)}class ei{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.setup=new Promise((n,r)=>{yr.getInstance().run(e.config,async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(n,r):this.firstResult.then(i=>n(void 0),r)})})}async next(...e){return this.firstResultUsed?yr.getInstance().run(this.config,async()=>this.generator.next(...e)):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}}async function RS(t,e,n,...r){const s=new ei({generator:e,startSetup:n}),i=await s.setup;return{output:t(s,i,...r),setup:i}}class Wn{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const n=this.ops.concat(e.ops),r=xl({},n);return new wa({ops:n,state:r[r.length-1].newDocument})}}class wa extends Wn{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const n=this.ops.concat(e.ops),r=xl(this.state,e.ops);return new wa({ops:n,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const n=xl({},e.ops);return new wa({ops:e.ops,state:n[n.length-1].newDocument})}}const yw=t=>t.name==="log_stream_tracer";async function Lm(t,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:n}=t;if(["retriever","llm","prompt"].includes(t.run_type))return n;if(!(Object.keys(n).length===1&&(n==null?void 0:n.input)===""))return n.input}async function Mm(t,e){const{outputs:n}=t;return e==="original"||["retriever","llm","prompt"].includes(t.run_type)?n:n!==void 0&&Object.keys(n).length===1&&(n==null?void 0:n.output)!==void 0?n.output:n}function IS(t){return t!==void 0&&t.message!==void 0}class Dm extends Na{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ut.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const n=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||n.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&n.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),r}async*tapOutputIterable(e,n){for await(const r of n){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new Wn({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Wn({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const n=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=n===1?e.name:`${e.name}:${n}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await Lm(e,this._schemaFormat)),await this.writer.write(new Wn({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const n=this.keyMapByRunId[e.id];if(n===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${n}/inputs`,value:await Lm(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${n}/final_output`,value:await Mm(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${n}/end_time`,value:new Date(e.end_time).toISOString()});const s=new Wn({ops:r});await this.writer.write(s)}finally{if(e.id===this.rootId){const n=new Wn({ops:[{op:"replace",path:"/final_output",value:await Mm(e,this._schemaFormat)}]});await this.writer.write(n),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,n,r){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const i=e.inputs.messages!==void 0;let a;i?IS(r==null?void 0:r.chunk)?a=r==null?void 0:r.chunk:a=new Yr(n):a=n;const o=new Wn({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:n},{op:"add",path:`/logs/${s}/streamed_output/-`,value:a}]});await this.writer.write(o)}}const Fm="__run";class ja{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new ja({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class Ws extends ja{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new Ws({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function uo({name:t,serialized:e}){return t!==void 0?t:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const vw=t=>t.name==="event_stream_tracer";class NS extends Na{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ut.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const n=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||n.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&n.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),r}async*tapOutputIterable(e,n){const r=await n.next();if(r.done)return;const s=this.runInfoMap.get(e);if(s===void 0){yield r.value;return}let i=this.tappedPromises.get(e);if(i===void 0){let a;i=new Promise(o=>{a=o}),this.tappedPromises.set(e,i);try{const o={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...o,data:{chunk:r.value}},s),yield r.value;for await(const l of n)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...o,data:{chunk:l}},s),yield l}finally{a()}}else{yield r.value;for await(const a of n)yield a}}async send(e,n){this._includeRun(n)&&await this.writer.write(e)}async sendEndEvent(e,n){const r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,n)}):await this.send(e,n)}async onLLMStart(e){var a,o;const n=uo(e),r=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:n,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,s);const i=`on_${r}_start`;await this.send({event:i,data:{input:e.inputs},name:n,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onLLMNewToken(e,n,r){const s=this.runInfoMap.get(e.id);let i,a;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(s.runType==="chat_model")a="on_chat_model_stream",(r==null?void 0:r.chunk)===void 0?i=new Yr({content:n}):i=r.chunk.message;else if(s.runType==="llm")a="on_llm_stream",(r==null?void 0:r.chunk)===void 0?i=new ja({text:n}):i=r.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:a,data:{chunk:i},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}async onLLMEnd(e){var a,o,l;const n=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(n===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const s=(a=e.outputs)==null?void 0:a.generations;let i;if(n.runType==="chat_model"){for(const u of s??[]){if(i!==void 0)break;i=(o=u[0])==null?void 0:o.message}r="on_chat_model_end"}else if(n.runType==="llm")i={generations:s==null?void 0:s.map(u=>u.map(c=>({text:c.text,generationInfo:c.generationInfo}))),llmOutput:((l=e.outputs)==null?void 0:l.llmOutput)??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${n.runType}`);await this.sendEndEvent({event:r,data:{output:i,input:n.inputs},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}async onChainStart(e){var a,o;const n=uo(e),r=e.run_type??"chain",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:n,runType:e.run_type};let i={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(i={},s.inputs={}):e.inputs.input!==void 0?(i.input=e.inputs.input,s.inputs=e.inputs.input):(i.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${r}_start`,data:i,name:n,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onChainEnd(e){var o;const n=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),n===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const r=`on_${e.run_type}_end`,s=e.inputs??n.inputs??{},a={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(a.input=s.input,n.inputs=s.input),await this.sendEndEvent({event:r,data:a,run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata??{}},n)}async onToolStart(e){var s,i;const n=uo(e),r={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:n,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:n,run_id:e.id,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{}},r)}async onToolEnd(e){var s;const n=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),n===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(n.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const r=((s=e.outputs)==null?void 0:s.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:n.inputs},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}async onRetrieverStart(e){var i,a;const n=uo(e),s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:n,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:n,tags:e.tags??[],run_id:e.id,metadata:((a=e.extra)==null?void 0:a.metadata)??{}},s)}async onRetrieverEnd(e){var r;const n=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),n===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((r=e.outputs)==null?void 0:r.documents)??e.outputs,input:n.inputs},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const $c=25;async function ur(t){return Ye.configure(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata)}function Ol(...t){const e={};for(const n of t.filter(r=>!!r))for(const r of Object.keys(n))if(r==="metadata")e[r]={...e[r],...n[r]};else if(r==="tags"){const s=e[r]??[];e[r]=[...new Set(s.concat(n[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...n[r]};else if(r==="callbacks"){const s=e.callbacks,i=n.callbacks;if(Array.isArray(i))if(!s)e.callbacks=i;else if(Array.isArray(s))e.callbacks=s.concat(i);else{const a=s.copy();for(const o of i)a.addHandler(Sl(o),!0);e.callbacks=a}else if(i)if(!s)e.callbacks=i;else if(Array.isArray(s)){const a=i.copy();for(const o of s)a.addHandler(Sl(o),!0);e.callbacks=a}else e.callbacks=new Ye(i._parentRunId,{handlers:s.handlers.concat(i.handlers),inheritableHandlers:s.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(i.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(i.inheritableTags))),metadata:{...s.metadata,...i.metadata}})}else{const s=r;e[s]=n[s]??e[s]}return e}const jS=new Set(["string","number","boolean"]);function Y(t){var r;const e=t??yr.getInstance().getStore();let n={tags:[],metadata:{},callbacks:void 0,recursionLimit:25,runId:void 0};if(e&&(n={...n,...e}),e!=null&&e.configurable)for(const s of Object.keys(e.configurable))jS.has(typeof e.configurable[s])&&!((r=n.metadata)!=null&&r[s])&&(n.metadata||(n.metadata={}),n.metadata[s]=e.configurable[s]);return n}function Oe(t={},{callbacks:e,maxConcurrency:n,recursionLimit:r,runName:s,configurable:i,runId:a}={}){const o=Y(t);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),n!==void 0&&(o.maxConcurrency=n),s!==void 0&&(o.runName=s),i!==void 0&&(o.configurable={...o.configurable,...i}),a!==void 0&&delete o.runId,o}const $S=[400,401,402,403,404,405,406,407,409],LS=t=>{var n,r;if(t.message.startsWith("Cancel")||t.message.startsWith("AbortError")||t.name==="AbortError"||(t==null?void 0:t.code)==="ECONNABORTED")throw t;const e=((n=t==null?void 0:t.response)==null?void 0:n.status)??(t==null?void 0:t.status);if(e&&$S.includes(+e))throw t;if(((r=t==null?void 0:t.error)==null?void 0:r.code)==="insufficient_quota"){const s=new Error(t==null?void 0:t.message);throw s.name="InsufficientQuotaError",s}};class Eh{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??LS;const n="default"in In?In.default:In;this.queue=new n({concurrency:this.maxConcurrency})}call(e,...n){return this.queue.add(()=>El(()=>e(...n).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,n,...r){return e.signal?Promise.race([this.call(n,...r),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(n,...r)}fetch(...e){return this.call(()=>fetch(...e).then(n=>n.ok?n:Promise.reject(n)))}}class ww extends Na{constructor({config:e,onStart:n,onEnd:r,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=n,this.argOnEnd=r,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(this.argOnStart.length===1?await this.argOnStart(e):this.argOnStart.length===2&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(this.argOnError.length===1?await this.argOnError(e):this.argOnError.length===2&&await this.argOnError(e,this.config)):this.argOnEnd&&(this.argOnEnd.length===1?await this.argOnEnd(e):this.argOnEnd.length===2&&await this.argOnEnd(e,this.config)))}}function kh(t){return t?t.lc_runnable:!1}class MS{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,n){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const s=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(n)),this.includeTags!==void 0&&(r=r||s.some(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(n)),this.excludeTags!==void 0&&(r=r&&s.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),r}}const DS=Symbol("Let zodToJsonSchema decide on which parser to use"),FS={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},US=t=>({...FS,...t}),zS=t=>{const e=US(t),n=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function _w(t,e,n,r){r!=null&&r.errorMessages&&n&&(t.errorMessage={...t.errorMessage,[e]:n})}function Q(t,e,n,r,s){t[e]=n,_w(t,e,r,s)}function VS(){return{}}function BS(t,e){var r,s;const n={type:"array"};return((s=(r=t.type)==null?void 0:r._def)==null?void 0:s.typeName)!==P.ZodAny&&(n.items=G(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&Q(n,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&Q(n,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(Q(n,"minItems",t.exactLength.value,t.exactLength.message,e),Q(n,"maxItems",t.exactLength.value,t.exactLength.message,e)),n}function HS(t,e){const n={type:"integer",format:"int64"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Q(n,"minimum",r.value,r.message,e):Q(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),Q(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Q(n,"maximum",r.value,r.message,e):Q(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),Q(n,"maximum",r.value,r.message,e));break;case"multipleOf":Q(n,"multipleOf",r.value,r.message,e);break}return n}function qS(){return{type:"boolean"}}function WS(t,e){return G(t.type._def,e)}const ZS=(t,e)=>G(t.innerType._def,e);function bw(t,e,n){const r=n??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,i)=>bw(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return GS(t,e)}}const GS=(t,e)=>{const n={type:"integer",format:"unix-time"};if(e.target==="openApi3")return n;for(const r of t.checks)switch(r.kind){case"min":Q(n,"minimum",r.value,r.message,e);break;case"max":Q(n,"maximum",r.value,r.message,e);break}return n};function YS(t,e){return{...G(t.innerType._def,e),default:t.defaultValue()}}function QS(t,e){return e.effectStrategy==="input"?G(t.schema._def,e):{}}function KS(t){return{type:"string",enum:t.values}}const JS=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function XS(t,e){const n=[G(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),G(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return n.forEach(i=>{if(JS(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...l}=i;a=l}else r=void 0;s.push(a)}}),s.length?{allOf:s,...r}:void 0}function ex(t,e){const n=typeof t.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[t.value]}:{type:n==="bigint"?"integer":n,const:t.value}}const Sr={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u"),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function Ew(t,e){const n={type:"string"};function r(s){return e.patternStrategy==="escape"?tx(s):s}if(t.checks)for(const s of t.checks)switch(s.kind){case"min":Q(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,s.value):s.value,s.message,e);break;case"max":Q(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":jt(n,"email",s.message,e);break;case"format:idn-email":jt(n,"idn-email",s.message,e);break;case"pattern:zod":$t(n,Sr.email,s.message,e);break}break;case"url":jt(n,"uri",s.message,e);break;case"uuid":jt(n,"uuid",s.message,e);break;case"regex":$t(n,s.regex,s.message,e);break;case"cuid":$t(n,Sr.cuid,s.message,e);break;case"cuid2":$t(n,Sr.cuid2,s.message,e);break;case"startsWith":$t(n,RegExp(`^${r(s.value)}`),s.message,e);break;case"endsWith":$t(n,RegExp(`${r(s.value)}$`),s.message,e);break;case"datetime":jt(n,"date-time",s.message,e);break;case"date":jt(n,"date",s.message,e);break;case"time":jt(n,"time",s.message,e);break;case"duration":jt(n,"duration",s.message,e);break;case"length":Q(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,s.value):s.value,s.message,e),Q(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,s.value):s.value,s.message,e);break;case"includes":{$t(n,RegExp(r(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&jt(n,"ipv4",s.message,e),s.version!=="v4"&&jt(n,"ipv6",s.message,e);break}case"emoji":$t(n,Sr.emoji,s.message,e);break;case"ulid":{$t(n,Sr.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{jt(n,"binary",s.message,e);break}case"contentEncoding:base64":{Q(n,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{$t(n,Sr.base64,s.message,e);break}}break}case"nanoid":$t(n,Sr.nanoid,s.message,e)}return n}const tx=t=>Array.from(t).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),jt=(t,e,n,r)=>{var s;t.format||(s=t.anyOf)!=null&&s.some(i=>i.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&r.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Q(t,"format",e,n,r)},$t=(t,e,n,r)=>{var s;t.pattern||(s=t.allOf)!=null&&s.some(i=>i.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&r.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:Um(e,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Q(t,"pattern",Um(e,r),n,r)},Um=(t,e)=>{var l;if(!e.applyRegexFlags||!t.flags)return t.source;const n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=n.i?t.source.toLowerCase():t.source;let s="",i=!1,a=!1,o=!1;for(let u=0;u<r.length;u++){if(i){s+=r[u],i=!1;continue}if(n.i){if(a){if(r[u].match(/[a-z]/)){o?(s+=r[u],s+=`${r[u-2]}-${r[u]}`.toUpperCase(),o=!1):r[u+1]==="-"&&((l=r[u+2])!=null&&l.match(/[a-z]/))?(s+=r[u],o=!0):s+=`${r[u]}${r[u].toUpperCase()}`;continue}}else if(r[u].match(/[a-z]/)){s+=`[${r[u]}${r[u].toUpperCase()}]`;continue}}if(n.m){if(r[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(n.s&&r[u]==="."){s+=a?`${r[u]}\r
`:`[${r[u]}\r
]`;continue}s+=r[u],r[u]==="\\"?i=!0:a&&r[u]==="]"?a=!1:!a&&r[u]==="["&&(a=!0)}try{const u=new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s};function kw(t,e){var r,s,i,a;if(e.target==="openApi3"&&((r=t.keyType)==null?void 0:r._def.typeName)===P.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((o,l)=>({...o,[l]:G(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:!1};const n={type:"object",additionalProperties:G(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return n;if(((s=t.keyType)==null?void 0:s._def.typeName)===P.ZodString&&((i=t.keyType._def.checks)!=null&&i.length)){const o=Object.entries(Ew(t.keyType._def,e)).reduce((l,[u,c])=>u==="type"?l:{...l,[u]:c},{});return{...n,propertyNames:o}}else if(((a=t.keyType)==null?void 0:a._def.typeName)===P.ZodEnum)return{...n,propertyNames:{enum:t.keyType._def.values}};return n}function nx(t,e){if(e.mapStrategy==="record")return kw(t,e);const n=G(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=G(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function rx(t){const e=t.values,r=Object.keys(t.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function sx(){return{not:{}}}function ix(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Tl={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function ax(t,e){if(e.target==="openApi3")return zm(t,e);const n=t.options instanceof Map?Array.from(t.options.values()):t.options;if(n.every(r=>r._def.typeName in Tl&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((s,i)=>{const a=Tl[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===n.length){const s=r.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:n.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,s)=>[...r,...s._def.values.filter(i=>!r.includes(i))],[])};return zm(t,e)}const zm=(t,e)=>{const n=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>G(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function ox(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:Tl[t.innerType._def.typeName],nullable:!0}:{type:[Tl[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=G(t.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=G(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function lx(t,e){const n={type:"number"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"int":n.type="integer",_w(n,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Q(n,"minimum",r.value,r.message,e):Q(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),Q(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Q(n,"maximum",r.value,r.message,e):Q(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),Q(n,"maximum",r.value,r.message,e));break;case"multipleOf":Q(n,"multipleOf",r.value,r.message,e);break}return n}function ux(t,e){return e.removeAdditionalStrategy==="strict"?t.catchall._def.typeName==="ZodNever"?t.unknownKeys!=="strict":G(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:t.catchall._def.typeName==="ZodNever"?t.unknownKeys==="passthrough":G(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function cx(t,e){const n={type:"object",...Object.entries(t.shape()).reduce((r,[s,i])=>{if(i===void 0||i._def===void 0)return r;const a=G(i._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});return a===void 0?r:{properties:{...r.properties,[s]:a},required:i.isOptional()?r.required:[...r.required,s]}},{properties:{},required:[]}),additionalProperties:ux(t,e)};return n.required.length||delete n.required,n}const dx=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return G(t.innerType._def,e);const n=G(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}},fx=(t,e)=>{if(e.pipeStrategy==="input")return G(t.in._def,e);if(e.pipeStrategy==="output")return G(t.out._def,e);const n=G(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=G(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(s=>s!==void 0)}};function hx(t,e){return G(t.type._def,e)}function px(t,e){const r={type:"array",uniqueItems:!0,items:G(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&Q(r,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&Q(r,"maxItems",t.maxSize.value,t.maxSize.message,e),r}function mx(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((n,r)=>G(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:G(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((n,r)=>G(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function gx(){return{not:{}}}function yx(){return{}}const vx=(t,e)=>G(t.innerType._def,e);function G(t,e,n=!1){var a;const r=e.seen.get(t);if(e.override){const o=(a=e.override)==null?void 0:a.call(e,t,e,r,n);if(o!==DS)return o}if(r&&!n){const o=wx(r,e);if(o!==void 0)return o}const s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);const i=bx(t,t.typeName,e);return i&&Ex(t,e,i),s.jsonSchema=i,i}const wx=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:_x(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((n,r)=>e.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},_x=(t,e)=>{let n=0;for(;n<t.length&&n<e.length&&t[n]===e[n];n++);return[(t.length-n).toString(),...e.slice(n)].join("/")},bx=(t,e,n)=>{switch(e){case P.ZodString:return Ew(t,n);case P.ZodNumber:return lx(t,n);case P.ZodObject:return cx(t,n);case P.ZodBigInt:return HS(t,n);case P.ZodBoolean:return qS();case P.ZodDate:return bw(t,n);case P.ZodUndefined:return gx();case P.ZodNull:return ix(n);case P.ZodArray:return BS(t,n);case P.ZodUnion:case P.ZodDiscriminatedUnion:return ax(t,n);case P.ZodIntersection:return XS(t,n);case P.ZodTuple:return mx(t,n);case P.ZodRecord:return kw(t,n);case P.ZodLiteral:return ex(t,n);case P.ZodEnum:return KS(t);case P.ZodNativeEnum:return rx(t);case P.ZodNullable:return ox(t,n);case P.ZodOptional:return dx(t,n);case P.ZodMap:return nx(t,n);case P.ZodSet:return px(t,n);case P.ZodLazy:return G(t.getter()._def,n);case P.ZodPromise:return hx(t,n);case P.ZodNaN:case P.ZodNever:return sx();case P.ZodEffects:return QS(t,n);case P.ZodAny:return VS();case P.ZodUnknown:return yx();case P.ZodDefault:return YS(t,n);case P.ZodBranded:return WS(t,n);case P.ZodReadonly:return vx(t,n);case P.ZodCatch:return ZS(t,n);case P.ZodPipeline:return fx(t,n);case P.ZodFunction:case P.ZodVoid:case P.ZodSymbol:return;default:return(r=>{})()}},Ex=(t,e,n)=>(t.description&&(n.description=t.description,e.markdownDescription&&(n.markdownDescription=t.description)),n),$a=(t,e)=>{const n=zS(e),r=void 0,s=e==null?void 0:e.name,i=G(t._def,n,!1)??{},a=s===void 0?r?{...i,[n.definitionPath]:r}:i:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,s].join("/"),[n.definitionPath]:{...r,[s]:i}};return n.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":n.target==="jsonSchema2019-09"&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),a};function Lc(t){return t.replace(/[^a-zA-Z-_0-9]/g,"_")}function kx(t,e){const n=e[t.source]??t.source,r=e[t.target]??t.target;return[n,r]}function Sx(t){let e="";for(const[n,r]of Object.entries(t))e+=`	classDef ${n}class fill:${r};
`;return e}function xx(t,e,n){const{firstNodeLabel:r,lastNodeLabel:s,nodeColors:i,withStyles:a=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=n??{};let u=a?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(a){const d="default",f={[d]:"{0}([{1}]):::otherclass"};r!==void 0&&(f[r]="{0}[{0}]:::startclass"),s!==void 0&&(f[s]="{0}[{0}]:::endclass");for(const g of Object.values(t)){const p=f[g]??f[d],v=Lc(g),w=g.split(":"),m=w[w.length-1];u+=`	${p.replace(/\{0\}/g,v).replace(/\{1\}/g,m)};
`}}let c="";for(const d of e){const f=d.source.includes(":")?d.source.split(":")[0]:void 0,g=d.target.includes(":")?d.target.split(":")[0]:void 0;c!==""&&(c!==f||c!==g)&&(u+=`	end
`,c=""),c===""&&f!==void 0&&f===g&&(u=`	subgraph ${f}
`,c=f);const[p,v]=kx(d,t);let w="";if(d.data!==void 0){let m=d.data;const h=m.split(" ");h.length>l&&(m=h.reduce((y,_,b)=>(b%l===0&&y.push(""),y[y.length-1]+=` ${_}`,y),[]).join("<br>")),d.conditional?w=` -. ${m} .-> `:w=` -- ${m} --> `}else d.conditional?w=" -.-> ":w=" --> ";u+=`	${Lc(p)}${w}${Lc(v)};
`}return c!==""&&(u+=`end
`),a&&i!==void 0&&(u+=Sx(i)),u}async function Px(t,e){let{backgroundColor:n="white"}=e??{};const r=btoa(t);n!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(n)||(n=`!${n}`));const s=`https://mermaid.ink/img/${r}?bgColor=${n}`,i=await fetch(s);if(!i.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${i.status}`,`Status text: ${i.statusText}`].join(`
`));return await i.blob()}const Vm=42;function Mc(t){if(kl(t.id))if(kh(t.data))try{let e=t.data.getName();return e=e.startsWith("Runnable")?e.slice(8):e,e.length>Vm&&(e=`${e.substring(0,Vm)}...`),e}catch{return t.data.getName()}else return t.data.name??"UnknownSchema";else return t.id}function Ox(t){return kh(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...$a(t.data.schema),title:t.data.name}}}let Sw=class{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){const e={};return Object.values(this.nodes).forEach((n,r)=>{e[n.id]=kl(n.id)?r:n.id}),{nodes:Object.values(this.nodes).map(n=>({id:e[n.id],...Ox(n)})),edges:this.edges.map(n=>n.data?{source:e[n.source],target:e[n.target],data:n.data}:{source:e[n.source],target:e[n.target]})}}addNode(e,n){if(n!==void 0&&this.nodes[n]!==void 0)throw new Error(`Node with id ${n} already exists`);const r=n||Tn(),s={id:r,data:e};return this.nodes[r]=s,s}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(n=>n.source!==e.id&&n.target!==e.id)}addEdge(e,n,r,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[n.id]===void 0)throw new Error(`Target node ${n.id} not in graph`);const i={source:e.id,target:n.id,data:r,conditional:s};return this.edges.push(i),i}firstNode(){const e=new Set(this.edges.map(r=>r.target)),n=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||n.push(r)}),n[0]}lastNode(){const e=new Set(this.edges.map(r=>r.source)),n=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||n.push(r)}),n[0]}extend(e,n=""){let r=n;Object.values(e.nodes).map(u=>u.id).every(kl)&&(r="");const i=u=>r?`${r}:${u}`:u;Object.entries(e.nodes).forEach(([u,c])=>{this.nodes[i(u)]={...c,id:i(u)}});const a=e.edges.map(u=>({...u,source:i(u.source),target:i(u.target)}));this.edges=[...this.edges,...a];const o=e.firstNode(),l=e.lastNode();return[o?{id:i(o.id),data:o.data}:void 0,l?{id:i(l.id),data:l.data}:void 0]}trimFirstNode(){const e=this.firstNode();if(e){const n=this.edges.filter(r=>r.source===e.id);(Object.keys(this.nodes).length===1||n.length===1)&&this.removeNode(e)}}trimLastNode(){const e=this.lastNode();if(e){const n=this.edges.filter(r=>r.target===e.id);(Object.keys(this.nodes).length===1||n.length===1)&&this.removeNode(e)}}drawMermaid(e){const{withStyles:n,curveStyle:r,nodeColors:s={start:"#ffdfba",end:"#baffc9",other:"#fad7de"},wrapLabelNWords:i}=e??{},a={};for(const d of Object.values(this.nodes))a[d.id]=Mc(d);const o=this.firstNode(),l=o?Mc(o):void 0,u=this.lastNode(),c=u?Mc(u):void 0;return xx(a,this.edges,{firstNodeLabel:l,lastNodeLabel:c,withStyles:n,curveStyle:r,nodeColors:s,wrapLabelNWords:i})}async drawMermaidPng(e){const n=this.drawMermaid(e);return Px(n,{backgroundColor:e==null?void 0:e.backgroundColor})}};function Tx(t){const e=new TextEncoder,n=new ReadableStream({async start(r){for await(const s of t)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return ut.fromReadableStream(n)}function Bm(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.iterator]=="function"&&typeof t.next=="function"}const Ax=t=>t!=null&&typeof t=="object"&&"next"in t&&typeof t.next=="function";function Jd(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.asyncIterator]=="function"}function*Hm(t,e){const n=yr.getInstance();for(;;){const{value:r,done:s}=n.run(t,e.next.bind(e));if(s)break;yield r}}async function*qm(t,e){const n=yr.getInstance(),r=e[Symbol.asyncIterator]();for(;;){const{value:s,done:i}=await n.run(t,r.next.bind(e));if(i)break;yield s}}function Ue(t,e){return t&&!Array.isArray(t)&&!(t instanceof Date)&&typeof t=="object"?t:{[e]:t}}class ce extends Hr{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const n=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${n}${e}`:n}bind(e){return new Lr({bound:this,kwargs:e,config:{}})}map(){return new Al({bound:this})}withRetry(e){return new Cx({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new Lr({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new Ix({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,n=0){if(Array.isArray(e)&&e.length!==n)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${n} inputs`);if(Array.isArray(e))return e.map(Y);if(n>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:n},(s,i)=>Y(i===0?e:r))}return Array.from({length:n},()=>Y(e))}async batch(e,n,r){var l;const s=this._getOptionsList(n??{},e.length),i=((l=s[0])==null?void 0:l.maxConcurrency)??(r==null?void 0:r.maxConcurrency),a=new Eh({maxConcurrency:i,onFailedAttempt:u=>{throw u}}),o=e.map((u,c)=>a.call(async()=>{try{return await this.invoke(u,s[c])}catch(d){if(r!=null&&r.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,n){yield this.invoke(e,n)}async stream(e,n){const r=Y(n),s=new ei({generator:this._streamIterator(e,r),config:r});return await s.setup,ut.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let n;e===void 0?n=Y(e):n=Y({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,[n,r]}async _callWithConfig(e,n,r){const s=Y(r),i=await ur(s),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),Ue(n,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{o=await e.call(this,n,s,a)}catch(l){throw await(a==null?void 0:a.handleChainError(l)),l}return await(a==null?void 0:a.handleChainEnd(Ue(o,"output"))),o}async _batchWithConfig(e,n,r,s){const i=this._getOptionsList(r??{},n.length),a=await Promise.all(i.map(ur)),o=await Promise.all(a.map(async(u,c)=>{const d=await(u==null?void 0:u.handleChainStart(this.toJSON(),Ue(n[c],"input"),i[c].runId,i[c].runType,void 0,void 0,i[c].runName??this.getName()));return delete i[c].runId,d}));let l;try{l=await e.call(this,n,i,o,s)}catch(u){throw await Promise.all(o.map(c=>c==null?void 0:c.handleChainError(u))),u}return await Promise.all(o.map(u=>u==null?void 0:u.handleChainEnd(Ue(l,"output")))),l}async*_transformStreamWithConfig(e,n,r){let s,i=!0,a,o=!0;const l=Y(r),u=await ur(l);async function*c(){for await(const f of e){if(i)if(s===void 0)s=f;else try{s=gn(s,f)}catch{s=void 0,i=!1}yield f}}let d;try{const f=await RS(n.bind(this),c(),async()=>u==null?void 0:u.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),l);delete l.runId,d=f.setup;const g=d==null?void 0:d.handlers.find(vw);let p=f.output;g!==void 0&&d!==void 0&&(p=g.tapOutputIterable(d.runId,p));const v=d==null?void 0:d.handlers.find(yw);v!==void 0&&d!==void 0&&(p=v.tapOutputIterable(d.runId,p));for await(const w of p)if(yield w,o)if(a===void 0)a=w;else try{a=gn(a,w)}catch{a=void 0,o=!1}}catch(f){throw await(d==null?void 0:d.handleChainError(f,void 0,void 0,void 0,{inputs:Ue(s,"input")})),f}await(d==null?void 0:d.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:Ue(s,"input")}))}getGraph(e){const n=new Sw,r=n.addNode({name:`${this.getName()}Input`,schema:Ze.any()}),s=n.addNode(this),i=n.addNode({name:`${this.getName()}Output`,schema:Ze.any()});return n.addEdge(r,s),n.addEdge(s,i),n}pipe(e){return new qt({first:this,last:cn(e)})}pick(e){return this.pipe(new Nx(e))}assign(e){return this.pipe(new xw(new ti({steps:e})))}async*transform(e,n){let r;for await(const s of e)r===void 0?r=s:r=gn(r,s);yield*this._streamIterator(r,Y(n))}async*streamLog(e,n,r){const s=new Dm({...r,autoClose:!1,_schemaFormat:"original"}),i=Y(n);yield*this._streamLog(e,s,i)}async*_streamLog(e,n,r){const{callbacks:s}=r;if(s===void 0)r.callbacks=[n];else if(Array.isArray(s))r.callbacks=s.concat([n]);else{const l=s.copy();l.inheritableHandlers.push(n),r.callbacks=l}const i=this.stream(e,r);async function a(){try{const l=await i;for await(const u of l){const c=new Wn({ops:[{op:"add",path:"/streamed_output/-",value:u}]});await n.writer.write(c)}}finally{await n.writer.close()}}const o=a();try{for await(const l of n)yield l}finally{await o}}streamEvents(e,n,r){let s;if(n.version==="v1")s=this._streamEventsV1(e,n,r);else if(n.version==="v2")s=this._streamEventsV2(e,n,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return n.encoding==="text/event-stream"?Tx(s):ut.fromAsyncGenerator(s)}async*_streamEventsV2(e,n,r){var g;const s=new NS({...r,autoClose:!1}),i=Y(n),a=i.runId??Tn();i.runId=a;const o=i.callbacks;if(o===void 0)i.callbacks=[s];else if(Array.isArray(o))i.callbacks=o.concat(s);else{const p=o.copy();p.inheritableHandlers.push(s),i.callbacks=p}const l=this;async function u(){try{const p=await l.stream(e,i),v=s.tapOutputIterable(a,p);for await(const w of v);}finally{await s.finish()}}const c=u();let d=!1,f;try{for await(const p of s){if(!d){p.data.input=e,d=!0,f=p.run_id,yield p;continue}p.run_id===f&&p.event.endsWith("_end")&&(g=p.data)!=null&&g.input&&delete p.data.input,yield p}}finally{await c}}async*_streamEventsV1(e,n,r){let s,i=!1;const a=Y(n),o=a.tags??[],l=a.metadata??{},u=a.runName??this.getName(),c=new Dm({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new MS({...r}),f=this._streamLog(e,c,a);for await(const p of f){if(s?s=s.concat(p):s=wa.fromRunLogPatch(p),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;const h={...s.state},y={run_id:h.id,event:`on_${h.type}_start`,name:u,tags:o,metadata:l,data:{input:e}};d.includeEvent(y,h.type)&&(yield y)}const v=p.ops.filter(h=>h.path.startsWith("/logs/")).map(h=>h.path.split("/")[2]),w=[...new Set(v)];for(const h of w){let y,_={};const b=s.state.logs[h];if(b.end_time===void 0?b.streamed_output.length>0?y="stream":y="start":y="end",y==="start")b.inputs!==void 0&&(_.input=b.inputs);else if(y==="end")b.inputs!==void 0&&(_.input=b.inputs),_.output=b.final_output;else if(y==="stream"){const E=b.streamed_output.length;if(E!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${E} instead. Encountered in: "${b.name}"`);_={chunk:b.streamed_output[0]},b.streamed_output=[]}yield{event:`on_${b.type}_${y}`,name:b.name,run_id:b.id,tags:b.tags,metadata:b.metadata,data:_}}const{state:m}=s;if(m.streamed_output.length>0){const h=m.streamed_output.length;if(h!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${h} instead. Encountered in: "${m.name}"`);const y={chunk:m.streamed_output[0]};m.streamed_output=[];const _={event:`on_${m.type}_stream`,run_id:m.id,tags:o,metadata:l,name:u,data:y};d.includeEvent(_,m.type)&&(yield _)}}const g=s==null?void 0:s.state;if(g!==void 0){const p={event:`on_${g.type}_end`,name:u,run_id:g.id,tags:o,metadata:l,data:{output:g.final_output}};d.includeEvent(p,g.type)&&(yield p)}}static isRunnable(e){return kh(e)}withListeners({onStart:e,onEnd:n,onError:r}){return new Lr({bound:this,config:{},configFactories:[s=>({callbacks:[new ww({config:s,onStart:e,onEnd:n,onError:r})]})]})}}class Lr extends ce{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const n=Ol(this.config,...e);return Ol(n,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(n))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,n){return this.bound.invoke(e,await this._mergeConfig(Y(n),this.kwargs))}async batch(e,n,r){const s=Array.isArray(n)?await Promise.all(n.map(async i=>this._mergeConfig(Y(i),this.kwargs))):await this._mergeConfig(Y(n),this.kwargs);return this.bound.batch(e,s,r)}async*_streamIterator(e,n){yield*this.bound._streamIterator(e,await this._mergeConfig(Y(n),this.kwargs))}async stream(e,n){return this.bound.stream(e,await this._mergeConfig(Y(n),this.kwargs))}async*transform(e,n){yield*this.bound.transform(e,await this._mergeConfig(Y(n),this.kwargs))}streamEvents(e,n,r){const s=this,i=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(Y(n),s.kwargs),version:n.version},r)};return ut.fromAsyncGenerator(i())}static isRunnableBinding(e){return e.bound&&ce.isRunnable(e.bound)}withListeners({onStart:e,onEnd:n,onError:r}){return new Lr({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new ww({config:s,onStart:e,onEnd:n,onError:r})]})]})}}class Al extends ce{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new Al({bound:this.bound.bind(e)})}async invoke(e,n){return this._callWithConfig(this._invoke,e,n)}async _invoke(e,n,r){return this.bound.batch(e,Oe(n,{callbacks:r==null?void 0:r.getChild()}))}withListeners({onStart:e,onEnd:n,onError:r}){return new Al({bound:this.bound.withListeners({onStart:e,onEnd:n,onError:r})})}}class Cx extends Lr{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,n,r){const s=e>1?`retry:attempt:${e}`:void 0;return Oe(n,{callbacks:r==null?void 0:r.getChild(s)})}async _invoke(e,n,r){return El(s=>super.invoke(e,this._patchConfigForRetry(s,n,r)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,n){return this._callWithConfig(this._invoke,e,n)}async _batch(e,n,r,s){const i={};try{await El(async a=>{const o=e.map((f,g)=>g).filter(f=>i[f.toString()]===void 0||i[f.toString()]instanceof Error),l=o.map(f=>e[f]),u=o.map(f=>this._patchConfigForRetry(a,n==null?void 0:n[f],r==null?void 0:r[f])),c=await super.batch(l,u,{...s,returnExceptions:!0});let d;for(let f=0;f<c.length;f+=1){const g=c[f],p=o[f];g instanceof Error&&d===void 0&&(d=g,d.input=l[f]),i[p.toString()]=g}if(d)throw d;return c},{onFailedAttempt:a=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if((s==null?void 0:s.returnExceptions)!==!0)throw a}return Object.keys(i).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>i[parseInt(a,10)])}async batch(e,n,r){return this._batchWithConfig(this._batch.bind(this),e,n,r)}}class qt extends ce{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,n){const r=Y(n),s=await ur(r),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),Ue(e,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let a=e,o;try{const l=[this.first,...this.middle];for(let u=0;u<l.length;u+=1)a=await l[u].invoke(a,Oe(r,{callbacks:i==null?void 0:i.getChild(`seq:step:${u+1}`)}));o=await this.last.invoke(a,Oe(r,{callbacks:i==null?void 0:i.getChild(`seq:step:${this.steps.length}`)}))}catch(l){throw await(i==null?void 0:i.handleChainError(l)),l}return await(i==null?void 0:i.handleChainEnd(Ue(o,"output"))),o}async batch(e,n,r){const s=this._getOptionsList(n??{},e.length),i=await Promise.all(s.map(ur)),a=await Promise.all(i.map(async(l,u)=>{const c=await(l==null?void 0:l.handleChainStart(this.toJSON(),Ue(e[u],"input"),s[u].runId,void 0,void 0,void 0,s[u].runName));return delete s[u].runId,c}));let o=e;try{for(let l=0;l<this.steps.length;l+=1)o=await this.steps[l].batch(o,a.map((c,d)=>{const f=c==null?void 0:c.getChild(`seq:step:${l+1}`);return Oe(s[d],{callbacks:f})}),r)}catch(l){throw await Promise.all(a.map(u=>u==null?void 0:u.handleChainError(l))),l}return await Promise.all(a.map(l=>l==null?void 0:l.handleChainEnd(Ue(o,"output")))),o}async*_streamIterator(e,n){const r=await ur(n),{runId:s,...i}=n??{},a=await(r==null?void 0:r.handleChainStart(this.toJSON(),Ue(e,"input"),s,void 0,void 0,void 0,i==null?void 0:i.runName)),o=[this.first,...this.middle,this.last];let l=!0,u;async function*c(){yield e}try{let d=o[0].transform(c(),Oe(i,{callbacks:a==null?void 0:a.getChild("seq:step:1")}));for(let f=1;f<o.length;f+=1)d=await o[f].transform(d,Oe(i,{callbacks:a==null?void 0:a.getChild(`seq:step:${f+1}`)}));for await(const f of d)if(yield f,l)if(u===void 0)u=f;else try{u=gn(u,f)}catch{u=void 0,l=!1}}catch(d){throw await(a==null?void 0:a.handleChainError(d)),d}await(a==null?void 0:a.handleChainEnd(Ue(u,"output")))}getGraph(e){const n=new Sw;let r=null;return this.steps.forEach((s,i)=>{const a=s.getGraph(e);i!==0&&a.trimFirstNode(),i!==this.steps.length-1&&a.trimLastNode(),n.extend(a);const o=a.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);r&&n.addEdge(r,o),r=a.lastNode()}),n}pipe(e){return qt.isRunnableSequence(e)?new qt({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new qt({first:this.first,middle:[...this.middle,this.last],last:cn(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&ce.isRunnable(e)}static from([e,...n],r){return new qt({first:cn(e),middle:n.slice(0,-1).map(cn),last:cn(n[n.length-1]),name:r})}}class ti extends ce{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[n,r]of Object.entries(e.steps))this.steps[n]=cn(r)}static from(e){return new ti({steps:e})}async invoke(e,n){const r=Y(n),s=await ur(r),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const a={};try{await Promise.all(Object.entries(this.steps).map(async([o,l])=>{a[o]=await l.invoke(e,Oe(r,{callbacks:i==null?void 0:i.getChild(`map:key:${o}`)}))}))}catch(o){throw await(i==null?void 0:i.handleChainError(o)),o}return await(i==null?void 0:i.handleChainEnd(a)),a}async*_transform(e,n,r){const s={...this.steps},i=gw(e,Object.keys(s).length),a=new Map(Object.entries(s).map(([o,l],u)=>{const c=l.transform(i[u],Oe(r,{callbacks:n==null?void 0:n.getChild(`map:key:${o}`)}));return[o,c.next().then(d=>({key:o,gen:c,result:d}))]}));for(;a.size;){const{key:o,result:l,gen:u}=await Promise.race(a.values());a.delete(o),l.done||(yield{[o]:l.value},a.set(o,u.next().then(c=>({key:o,gen:u,result:c}))))}}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=Y(n),i=new ei({generator:this.transform(r(),s),config:s});return await i.setup,ut.fromAsyncGenerator(i)}}class Sh extends ce{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!ph(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,n){const[r]=this._getOptionsList(n??{},1),s=await ur(r);return await this.func(Oe(r,{callbacks:s}),e)}async*_streamIterator(e,n){const r=await this.invoke(e,n);if(Jd(r)){for await(const s of r)yield s;return}if(Ax(r)){for(;;){const s=r.next();if(s.done)break;yield s.value}return}yield r}static from(e){return new Sh({func:e})}}function Rx(t){if(ph(t))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class zu extends ce{static lc_name(){return"RunnableLambda"}constructor(e){if(ph(e.func))return Sh.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Rx(e.func),this.func=e.func}static from(e){return new zu({func:e})}async _invoke(e,n,r){return new Promise((s,i)=>{const a=Oe(n,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((n==null?void 0:n.recursionLimit)??$c)-1});yr.getInstance().run(a,async()=>{try{let o=await this.func(e,{...a,config:a});if(o&&ce.isRunnable(o)){if((n==null?void 0:n.recursionLimit)===0)throw new Error("Recursion limit reached.");o=await o.invoke(e,{...a,recursionLimit:(a.recursionLimit??$c)-1})}else if(Jd(o)){let l;for await(const u of qm(a,o))if(l===void 0)l=u;else try{l=gn(l,u)}catch{l=u}o=l}else if(Bm(o)){let l;for(const u of Hm(a,o))if(l===void 0)l=u;else try{l=gn(l,u)}catch{l=u}o=l}s(o)}catch(o){i(o)}})})}async invoke(e,n){return this._callWithConfig(this._invoke,e,n)}async*_transform(e,n,r){let s;for await(const a of e)if(s===void 0)s=a;else try{s=gn(s,a)}catch{s=a}const i=await new Promise((a,o)=>{yr.getInstance().run(r,async()=>{try{const l=await this.func(s,{...r,config:r});a(l)}catch(l){o(l)}})});if(i&&ce.isRunnable(i)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const a=await i.stream(s,Oe(r,{callbacks:n==null?void 0:n.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??$c)-1}));for await(const o of a)yield o}else if(Jd(i))for await(const a of qm(r,i))yield a;else if(Bm(i))for(const a of Hm(r,i))yield a;else yield i}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=Y(n),i=new ei({generator:this.transform(r(),s),config:s});return await i.setup,ut.fromAsyncGenerator(i)}}class Ix extends ce{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,n){const r=await Ye.configure(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata),{runId:s,...i}=n??{},a=await(r==null?void 0:r.handleChainStart(this.toJSON(),Ue(e,"input"),s,void 0,void 0,void 0,i==null?void 0:i.runName));let o;for(const l of this.runnables())try{const u=await l.invoke(e,Oe(i,{callbacks:a==null?void 0:a.getChild()}));return await(a==null?void 0:a.handleChainEnd(Ue(u,"output"))),u}catch(u){o===void 0&&(o=u)}throw o===void 0?new Error("No error stored at end of fallback."):(await(a==null?void 0:a.handleChainError(o)),o)}async batch(e,n,r){if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(n??{},e.length),i=await Promise.all(s.map(l=>Ye.configure(l==null?void 0:l.callbacks,void 0,l==null?void 0:l.tags,void 0,l==null?void 0:l.metadata))),a=await Promise.all(i.map(async(l,u)=>{const c=await(l==null?void 0:l.handleChainStart(this.toJSON(),Ue(e[u],"input"),s[u].runId,void 0,void 0,void 0,s[u].runName));return delete s[u].runId,c}));let o;for(const l of this.runnables())try{const u=await l.batch(e,a.map((c,d)=>Oe(s[d],{callbacks:c==null?void 0:c.getChild()})),r);return await Promise.all(a.map((c,d)=>c==null?void 0:c.handleChainEnd(Ue(u[d],"output")))),u}catch(u){o===void 0&&(o=u)}throw o?(await Promise.all(a.map(l=>l==null?void 0:l.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function cn(t){if(typeof t=="function")return new zu({func:t});if(ce.isRunnable(t))return t;if(!Array.isArray(t)&&typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))e[n]=cn(r);return new ti({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class xw extends ce{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof ti&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,n){const r=await this.mapper.invoke(e,n);return{...e,...r}}async*_transform(e,n,r){const s=this.mapper.getStepsKeys(),[i,a]=gw(e),o=this.mapper.transform(a,Oe(r,{callbacks:n==null?void 0:n.getChild()})),l=o.next();for await(const u of i){if(typeof u!="object"||Array.isArray(u))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof u}`);const c=Object.fromEntries(Object.entries(u).filter(([d])=>!s.includes(d)));Object.keys(c).length>0&&(yield c)}yield(await l).value;for await(const u of o)yield u}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=Y(n),i=new ei({generator:this.transform(r(),s),config:s});return await i.setup,ut.fromAsyncGenerator(i)}}class Nx extends ce{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const n=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return n.length===0?void 0:Object.fromEntries(n)}}async invoke(e,n){return this._callWithConfig(this._pick.bind(this),e,n)}async*_transform(e){for await(const n of e){const r=await this._pick(n);r!==void 0&&(yield r)}}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=Y(n),i=new ei({generator:this.transform(r(),s),config:s});return await i.setup,ut.fromAsyncGenerator(i)}}class _a extends ce{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,n){const r=Y(n);return this.func&&await this.func(e,r),this._callWithConfig(s=>Promise.resolve(s),e,r)}async*transform(e,n){const r=Y(n);let s,i=!0;for await(const a of this._transformStreamWithConfig(e,o=>o,r))if(yield a,i)if(s===void 0)s=a;else try{s=gn(s,a)}catch{s=void 0,i=!1}this.func&&s!==void 0&&await this.func(s,r)}static assign(e){return new xw(new ti({steps:e}))}}const Xd="__pregel_send",Ao="__pregel_read",Cs="__interrupt__",xt="langsmith:hidden";class Vu extends ce{constructor(e){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langgraph"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"recurse",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.name=e.name??e.func.name,this.func=e.func,this.config=e.tags?{tags:e.tags}:void 0,this.trace=e.trace??this.trace,this.recurse=e.recurse??this.recurse}async _tracedInvoke(e,n,r){return new Promise((s,i)=>{const a=Oe(n,{callbacks:r==null?void 0:r.getChild()});yr.getInstance().run(a,async()=>{try{const o=await this.func(e,a);s(o)}catch(o){i(o)}})})}async invoke(e,n){let r;return this.trace?r=await this._callWithConfig(this._tracedInvoke,e,Ol(this.config,n)):r=await this.func(e,Ol(this.config,n)),ce.isRunnable(r)&&this.recurse?await r.invoke(e,n):r}}const ef={},cr={},Dc=Symbol("IS_WRITER");class ze extends Vu{constructor(e,n){const r=`ChannelWrite<${e.map(({channel:s})=>s).join(",")}>`;super({writes:e,name:r,tags:n,func:async(s,i)=>this._write(s,i??{})}),Object.defineProperty(this,"writes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.writes=e}async _getWriteValues(e,n){return Promise.all(this.writes.map(r=>({channel:r.channel,value:r.value===cr?e:r.value,skipNone:r.skipNone,mapper:r.mapper})).map(async r=>({channel:r.channel,value:r.mapper?await r.mapper.invoke(r.value,n):r.value,skipNone:r.skipNone,mapper:r.mapper}))).then(r=>r.filter(s=>!s.skipNone||s.value!==null).reduce((s,i)=>(s[i.channel]=i.value,s),{}))}async _write(e,n){const r=await this._getWriteValues(e,n);ze.doWrite(n,r)}static doWrite(e,n){var s;((s=e.configurable)==null?void 0:s[Xd])(Object.entries(n).filter(([i,a])=>a!==ef))}static isWriter(e){return e instanceof ze||Dc in e&&!!e[Dc]}static registerWriter(e){return Object.defineProperty(e,Dc,{value:!0})}}class xh extends Vu{constructor(e,n,r=!1){super({func:(s,i)=>xh.doRead(i,this.channel,this.fresh,this.mapper)}),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"ChannelRead"}),Object.defineProperty(this,"channel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fresh",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.fresh=r,this.mapper=n,this.channel=e,this.name=Array.isArray(e)?`ChannelRead<${e.join(",")}>`:`ChannelRead<${e}>`}static doRead(e,n,r,s){var a;const i=(a=e.configurable)==null?void 0:a[Ao];if(!i)throw new Error(`Runnable ${this} is not configured with a read function. Make sure to call in the context of a Pregel process`);return s?s(i(n,r)):i(n,r)}}const Xr=new _a;class dn extends Lr{constructor(e){var u;const{channels:n,triggers:r,mapper:s,writers:i,bound:a,kwargs:o}=e,l=[...(u=e.config)!=null&&u.tags?e.config.tags:[],...e.tags?e.tags:[]];super({...e,bound:e.bound??Xr,config:{...e.config?e.config:{},tags:l}}),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"PregelNode"}),Object.defineProperty(this,"channels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"triggers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:Xr}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:{}}),this.channels=n,this.triggers=r,this.mapper=s,this.writers=i??this.writers,this.bound=a??this.bound,this.kwargs=o??this.kwargs}getWriters(){const e=[...this.writers];for(;e.length>1&&e[e.length-1]instanceof ze&&e[e.length-2]instanceof ze;)e[e.length-2].writes.push(...e[e.length-1].writes),e.pop();return e}getNode(){const e=this.getWriters();if(!(this.bound===Xr&&e.length===0))return this.bound===Xr&&e.length===1?e[0]:this.bound===Xr?new qt({first:e[0],middle:e.slice(1,e.length-1),last:e[e.length-1]}):e.length>0?new qt({first:this.bound,middle:e.slice(0,e.length-1),last:e[e.length-1]}):this.bound}join(e){if(!Array.isArray(e))throw new Error("channels must be a list");if(typeof this.channels!="object")throw new Error("all channels must be named when using .join()");return new dn({channels:{...this.channels,...Object.fromEntries(e.map(n=>[n,n]))},triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:this.bound,kwargs:this.kwargs,config:this.config})}pipe(e){return ze.isWriter(e)?new dn({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:[...this.writers,e],bound:this.bound,config:this.config,kwargs:this.kwargs}):this.bound===Xr?new dn({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:cn(e),config:this.config,kwargs:this.kwargs}):new dn({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:this.bound.pipe(e),config:this.config,kwargs:this.kwargs})}}/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var jx=typeof window=="object"?window:{},U="0123456789abcdef".split(""),$x=[-2147483648,8388608,32768,128],Lt=[24,16,8,0],Se=[];function en(t){t?(Se[0]=Se[16]=Se[1]=Se[2]=Se[3]=Se[4]=Se[5]=Se[6]=Se[7]=Se[8]=Se[9]=Se[10]=Se[11]=Se[12]=Se[13]=Se[14]=Se[15]=0,this.blocks=Se):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}en.prototype.update=function(t){if(!this.finalized){var e=typeof t!="string";e&&t.constructor===jx.ArrayBuffer&&(t=new Uint8Array(t));for(var n,r=0,s,i=t.length||0,a=this.blocks;r<i;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),e)for(s=this.start;r<i&&s<64;++r)a[s>>2]|=t[r]<<Lt[s++&3];else for(s=this.start;r<i&&s<64;++r)n=t.charCodeAt(r),n<128?a[s>>2]|=n<<Lt[s++&3]:n<2048?(a[s>>2]|=(192|n>>6)<<Lt[s++&3],a[s>>2]|=(128|n&63)<<Lt[s++&3]):n<55296||n>=57344?(a[s>>2]|=(224|n>>12)<<Lt[s++&3],a[s>>2]|=(128|n>>6&63)<<Lt[s++&3],a[s>>2]|=(128|n&63)<<Lt[s++&3]):(n=65536+((n&1023)<<10|t.charCodeAt(++r)&1023),a[s>>2]|=(240|n>>18)<<Lt[s++&3],a[s>>2]|=(128|n>>12&63)<<Lt[s++&3],a[s>>2]|=(128|n>>6&63)<<Lt[s++&3],a[s>>2]|=(128|n&63)<<Lt[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=a[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};en.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[16]=this.block,t[e>>2]|=$x[e&3],this.block=t[16],e>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}};en.prototype.hash=function(){var t=this.h0,e=this.h1,n=this.h2,r=this.h3,s=this.h4,i,a,o,l=this.blocks;for(a=16;a<80;++a)o=l[a-3]^l[a-8]^l[a-14]^l[a-16],l[a]=o<<1|o>>>31;for(a=0;a<20;a+=5)i=e&n|~e&r,o=t<<5|t>>>27,s=o+i+s+1518500249+l[a]<<0,e=e<<30|e>>>2,i=t&e|~t&n,o=s<<5|s>>>27,r=o+i+r+1518500249+l[a+1]<<0,t=t<<30|t>>>2,i=s&t|~s&e,o=r<<5|r>>>27,n=o+i+n+1518500249+l[a+2]<<0,s=s<<30|s>>>2,i=r&s|~r&t,o=n<<5|n>>>27,e=o+i+e+1518500249+l[a+3]<<0,r=r<<30|r>>>2,i=n&r|~n&s,o=e<<5|e>>>27,t=o+i+t+1518500249+l[a+4]<<0,n=n<<30|n>>>2;for(;a<40;a+=5)i=e^n^r,o=t<<5|t>>>27,s=o+i+s+1859775393+l[a]<<0,e=e<<30|e>>>2,i=t^e^n,o=s<<5|s>>>27,r=o+i+r+1859775393+l[a+1]<<0,t=t<<30|t>>>2,i=s^t^e,o=r<<5|r>>>27,n=o+i+n+1859775393+l[a+2]<<0,s=s<<30|s>>>2,i=r^s^t,o=n<<5|n>>>27,e=o+i+e+1859775393+l[a+3]<<0,r=r<<30|r>>>2,i=n^r^s,o=e<<5|e>>>27,t=o+i+t+1859775393+l[a+4]<<0,n=n<<30|n>>>2;for(;a<60;a+=5)i=e&n|e&r|n&r,o=t<<5|t>>>27,s=o+i+s-1894007588+l[a]<<0,e=e<<30|e>>>2,i=t&e|t&n|e&n,o=s<<5|s>>>27,r=o+i+r-1894007588+l[a+1]<<0,t=t<<30|t>>>2,i=s&t|s&e|t&e,o=r<<5|r>>>27,n=o+i+n-1894007588+l[a+2]<<0,s=s<<30|s>>>2,i=r&s|r&t|s&t,o=n<<5|n>>>27,e=o+i+e-1894007588+l[a+3]<<0,r=r<<30|r>>>2,i=n&r|n&s|r&s,o=e<<5|e>>>27,t=o+i+t-1894007588+l[a+4]<<0,n=n<<30|n>>>2;for(;a<80;a+=5)i=e^n^r,o=t<<5|t>>>27,s=o+i+s-899497514+l[a]<<0,e=e<<30|e>>>2,i=t^e^n,o=s<<5|s>>>27,r=o+i+r-899497514+l[a+1]<<0,t=t<<30|t>>>2,i=s^t^e,o=r<<5|r>>>27,n=o+i+n-899497514+l[a+2]<<0,s=s<<30|s>>>2,i=r^s^t,o=n<<5|n>>>27,e=o+i+e-899497514+l[a+3]<<0,r=r<<30|r>>>2,i=n^r^s,o=e<<5|e>>>27,t=o+i+t-899497514+l[a+4]<<0,n=n<<30|n>>>2;this.h0=this.h0+t<<0,this.h1=this.h1+e<<0,this.h2=this.h2+n<<0,this.h3=this.h3+r<<0,this.h4=this.h4+s<<0};en.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,n=this.h2,r=this.h3,s=this.h4;return U[t>>28&15]+U[t>>24&15]+U[t>>20&15]+U[t>>16&15]+U[t>>12&15]+U[t>>8&15]+U[t>>4&15]+U[t&15]+U[e>>28&15]+U[e>>24&15]+U[e>>20&15]+U[e>>16&15]+U[e>>12&15]+U[e>>8&15]+U[e>>4&15]+U[e&15]+U[n>>28&15]+U[n>>24&15]+U[n>>20&15]+U[n>>16&15]+U[n>>12&15]+U[n>>8&15]+U[n>>4&15]+U[n&15]+U[r>>28&15]+U[r>>24&15]+U[r>>20&15]+U[r>>16&15]+U[r>>12&15]+U[r>>8&15]+U[r>>4&15]+U[r&15]+U[s>>28&15]+U[s>>24&15]+U[s>>20&15]+U[s>>16&15]+U[s>>12&15]+U[s>>8&15]+U[s>>4&15]+U[s&15]};en.prototype.toString=en.prototype.hex;en.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,n=this.h2,r=this.h3,s=this.h4;return[t>>24&255,t>>16&255,t>>8&255,t&255,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24&255,n>>16&255,n>>8&255,n&255,r>>24&255,r>>16&255,r>>8&255,r&255,s>>24&255,s>>16&255,s>>8&255,s&255]};en.prototype.array=en.prototype.digest;en.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(20),e=new DataView(t);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),t};const Lx=t=>new en(!0).update(t).hex(),Wm=(...t)=>Lx(t.join("_"));class Mx{}const Dx=new Map;class Ph extends Mx{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,n){return Promise.resolve(this.cache.get(Wm(e,n))??null)}async update(e,n,r){this.cache.set(Wm(e,n),r)}static global(){return new Ph(Dx)}}class Oh extends Hr{}class Pw extends Oh{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Xs(this.value)]}}class Ow extends Oh{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return pw(this.messages)}toChatMessages(){return this.messages}}class Fx extends Oh{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new Xs({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}var Bu={};Bu.byteLength=Vx;Bu.toByteArray=Hx;Bu.fromByteArray=Zx;var ln=[],Et=[],Ux=typeof Uint8Array<"u"?Uint8Array:Array,Fc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var es=0,zx=Fc.length;es<zx;++es)ln[es]=Fc[es],Et[Fc.charCodeAt(es)]=es;Et[45]=62;Et[95]=63;function Tw(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function Vx(t){var e=Tw(t),n=e[0],r=e[1];return(n+r)*3/4-r}function Bx(t,e,n){return(e+n)*3/4-n}function Hx(t){var e,n=Tw(t),r=n[0],s=n[1],i=new Ux(Bx(t,r,s)),a=0,o=s>0?r-4:r,l;for(l=0;l<o;l+=4)e=Et[t.charCodeAt(l)]<<18|Et[t.charCodeAt(l+1)]<<12|Et[t.charCodeAt(l+2)]<<6|Et[t.charCodeAt(l+3)],i[a++]=e>>16&255,i[a++]=e>>8&255,i[a++]=e&255;return s===2&&(e=Et[t.charCodeAt(l)]<<2|Et[t.charCodeAt(l+1)]>>4,i[a++]=e&255),s===1&&(e=Et[t.charCodeAt(l)]<<10|Et[t.charCodeAt(l+1)]<<4|Et[t.charCodeAt(l+2)]>>2,i[a++]=e>>8&255,i[a++]=e&255),i}function qx(t){return ln[t>>18&63]+ln[t>>12&63]+ln[t>>6&63]+ln[t&63]}function Wx(t,e,n){for(var r,s=[],i=e;i<n;i+=3)r=(t[i]<<16&16711680)+(t[i+1]<<8&65280)+(t[i+2]&255),s.push(qx(r));return s.join("")}function Zx(t){for(var e,n=t.length,r=n%3,s=[],i=16383,a=0,o=n-r;a<o;a+=i)s.push(Wx(t,a,a+i>o?o:a+i));return r===1?(e=t[n-1],s.push(ln[e>>2]+ln[e<<4&63]+"==")):r===2&&(e=(t[n-2]<<8)+t[n-1],s.push(ln[e>>10]+ln[e>>4&63]+ln[e<<2&63]+"=")),s.join("")}var Gx=Object.defineProperty,Yx=(t,e,n)=>e in t?Gx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Qx=(t,e,n)=>(Yx(t,e+"",n),n);function Kx(t,e){let n=Array.from({length:t.length},(r,s)=>({start:s,end:s+1}));for(;n.length>1;){let r=null;for(let s=0;s<n.length-1;s++){const i=t.slice(n[s].start,n[s+1].end),a=e.get(i.join(","));a!=null&&(r==null||a<r[0])&&(r=[a,s])}if(r!=null){const s=r[1];n[s]={start:n[s].start,end:n[s+1].end},n.splice(s+1,1)}else break}return n}function Jx(t,e){return t.length===1?[e.get(t.join(","))]:Kx(t,e).map(n=>e.get(t.slice(n.start,n.end).join(","))).filter(n=>n!=null)}function Xx(t){return t.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var tf=class{constructor(t,e){Fn(this,"specialTokens");Fn(this,"inverseSpecialTokens");Fn(this,"patStr");Fn(this,"textEncoder",new TextEncoder);Fn(this,"textDecoder",new TextDecoder("utf-8"));Fn(this,"rankMap",new Map);Fn(this,"textMap",new Map);this.patStr=t.pat_str;const n=t.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{const[i,a,...o]=s.split(" "),l=Number.parseInt(a,10);return o.forEach((u,c)=>r[u]=l+c),r},{});for(const[r,s]of Object.entries(n)){const i=Bu.toByteArray(r);this.rankMap.set(i.join(","),s),this.textMap.set(s,i)}this.specialTokens={...t.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,i])=>(r[i]=this.textEncoder.encode(s),r),{})}encode(t,e=[],n="all"){const r=new RegExp(this.patStr,"ug"),s=tf.specialTokenRegex(Object.keys(this.specialTokens)),i=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(n==="all"?Object.keys(this.specialTokens).filter(u=>!a.has(u)):n);if(o.size>0){const u=tf.specialTokenRegex([...o]),c=t.match(u);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let l=0;for(;;){let u=null,c=l;for(;s.lastIndex=c,u=s.exec(t),!(u==null||a.has(u[0]));)c=u.index+1;const d=(u==null?void 0:u.index)??t.length;for(const g of t.substring(l,d).matchAll(r)){const p=this.textEncoder.encode(g[0]),v=this.rankMap.get(p.join(","));if(v!=null){i.push(v);continue}i.push(...Jx(p,this.rankMap))}if(u==null)break;let f=this.specialTokens[u[0]];i.push(f),l=u.index+u[0].length}return i}decode(t){const e=[];let n=0;for(let i=0;i<t.length;++i){const a=t[i],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),n+=o.length)}const r=new Uint8Array(n);let s=0;for(const i of e)r.set(i,s),s+=i.length;return this.textDecoder.decode(r)}},Aw=tf;Qx(Aw,"specialTokenRegex",t=>new RegExp(t.map(e=>Xx(e)).join("|"),"g"));function e1(t){switch(t){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":return"o200k_base";default:throw new Error("Unknown model")}}const co={},t1=new Eh({});async function n1(t){return t in co||(co[t]=t1.fetch(`https://tiktoken.pages.dev/js/${t}.json`).then(e=>e.json()).then(e=>new Aw(e)).catch(e=>{throw delete co[t],e})),await co[t]}async function r1(t){return n1(e1(t))}const s1=t=>t.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":t.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":t.startsWith("gpt-4-32k")?"gpt-4-32k":t.startsWith("gpt-4-")?"gpt-4":t.startsWith("gpt-4o")?"gpt-4o":t,i1=()=>!1;class Cw extends ce{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??i1(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class a1 extends Cw{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:n,...r}){super({callbacks:e??n,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r.cache=="object"?this.cache=r.cache:r.cache?this.cache=Ph.global():this.cache=void 0,this.caller=new Eh(r??{})}async getNumTokens(e){if(typeof e!="string")return 0;let n=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await r1("modelName"in this?s1(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{n=this._encoding.encode(e).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return n}static _convertInputToPromptValue(e){return typeof e=="string"?new Pw(e):Array.isArray(e)?new Ow(e.map(Xn)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...n}){const r={...this._identifyingParams(),...n,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([a,o])=>o!==void 0).map(([a,o])=>`${a}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}function o1(t){return typeof(t==null?void 0:t.parse)=="function"}class Zn extends a1{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(e){const[n,r]=super._separateRunnableConfigFromCallOptions(e);return r!=null&&r.timeout&&!r.signal&&(r.signal=AbortSignal.timeout(r.timeout)),[n,r]}async invoke(e,n){const r=Zn._convertInputToPromptValue(e);return(await this.generatePrompt([r],n,n==null?void 0:n.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,n,r){throw new Error("Not implemented.")}async*_streamIterator(e,n){if(this._streamResponseChunks===Zn.prototype._streamResponseChunks)yield this.invoke(e,n);else{const s=Zn._convertInputToPromptValue(e).toChatMessages(),[i,a]=this._separateRunnableConfigFromCallOptions(n),o={...i.metadata,...this.getLsParams(a)},l=await Ye.configure(i.callbacks,this.callbacks,i.tags,this.tags,o,this.metadata,{verbose:this.verbose}),u={options:a,invocation_params:this==null?void 0:this.invocationParams(a),batch_size:1},c=await(l==null?void 0:l.handleChatModelStart(this.toJSON(),[s],i.runId,void 0,u,void 0,void 0,i.runName));let d;try{for await(const f of this._streamResponseChunks(s,a,c==null?void 0:c[0]))f.message.response_metadata={...f.generationInfo,...f.message.response_metadata},yield f.message,d?d=d.concat(f):d=f}catch(f){throw await Promise.all((c??[]).map(g=>g==null?void 0:g.handleLLMError(f))),f}await Promise.all((c??[]).map(f=>f==null?void 0:f.handleLLMEnd({generations:[[d]]})))}}getLsParams(e){return{ls_model_type:"chat",ls_stop:e.stop}}async _generateUncached(e,n,r){var g;const s=e.map(p=>p.map(Xn)),i={...r.metadata,...this.getLsParams(n)},a=await Ye.configure(r.callbacks,this.callbacks,r.tags,this.tags,i,this.metadata,{verbose:this.verbose}),o={options:n,invocation_params:this==null?void 0:this.invocationParams(n),batch_size:1},l=await(a==null?void 0:a.handleChatModelStart(this.toJSON(),s,r.runId,void 0,o,void 0,void 0,r.runName)),u=[],c=[];if(!!(l!=null&&l[0].handlers.find(p=>vw(p)||yw(p)))&&s.length===1&&this._streamResponseChunks!==Zn.prototype._streamResponseChunks)try{const p=await this._streamResponseChunks(s[0],n,l==null?void 0:l[0]);let v;for await(const w of p)v===void 0?v=w:v=gn(v,w);if(v===void 0)throw new Error("Received empty response from chat model call.");u.push([v]),await(l==null?void 0:l[0].handleLLMEnd({generations:u,llmOutput:{}}))}catch(p){throw await(l==null?void 0:l[0].handleLLMError(p)),p}else{const p=await Promise.allSettled(s.map((v,w)=>this._generate(v,{...n,promptIndex:w},l==null?void 0:l[w])));await Promise.all(p.map(async(v,w)=>{var m,h;if(v.status==="fulfilled"){const y=v.value;for(const _ of y.generations)_.message.response_metadata={..._.generationInfo,..._.message.response_metadata};return y.generations.length===1&&(y.generations[0].message.response_metadata={...y.llmOutput,...y.generations[0].message.response_metadata}),u[w]=y.generations,c[w]=y.llmOutput,(m=l==null?void 0:l[w])==null?void 0:m.handleLLMEnd({generations:[y.generations],llmOutput:y.llmOutput})}else return await((h=l==null?void 0:l[w])==null?void 0:h.handleLLMError(v.reason)),Promise.reject(v.reason)}))}const f={generations:u,llmOutput:c.length?(g=this._combineLLMOutput)==null?void 0:g.call(this,...c):void 0};return Object.defineProperty(f,Fm,{value:l?{runIds:l==null?void 0:l.map(p=>p.runId)}:void 0,configurable:!0}),f}async _generateCached({messages:e,cache:n,llmStringKey:r,parsedOptions:s,handledOptions:i}){const a=e.map(w=>w.map(Xn)),o={...i.metadata,...this.getLsParams(s)},l=await Ye.configure(i.callbacks,this.callbacks,i.tags,this.tags,o,this.metadata,{verbose:this.verbose}),u={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1,cached:!0},c=await(l==null?void 0:l.handleChatModelStart(this.toJSON(),a,i.runId,void 0,u,void 0,void 0,i.runName)),d=[],g=(await Promise.allSettled(a.map(async(w,m)=>{const h=Zn._convertInputToPromptValue(w).toString(),y=await n.lookup(h,r);return y==null&&d.push(m),y}))).map((w,m)=>({result:w,runManager:c==null?void 0:c[m]})).filter(({result:w})=>w.status==="fulfilled"&&w.value!=null||w.status==="rejected"),p=[];await Promise.all(g.map(async({result:w,runManager:m},h)=>{if(w.status==="fulfilled"){const y=w.value;return p[h]=y,y.length&&await(m==null?void 0:m.handleLLMNewToken(y[0].text)),m==null?void 0:m.handleLLMEnd({generations:[y]})}else return await(m==null?void 0:m.handleLLMError(w.reason)),Promise.reject(w.reason)}));const v={generations:p,missingPromptIndices:d};return Object.defineProperty(v,Fm,{value:c?{runIds:c==null?void 0:c.map(w=>w.runId)}:void 0,configurable:!0}),v}async generate(e,n,r){let s;Array.isArray(n)?s={stop:n}:s=n;const i=e.map(g=>g.map(Xn)),[a,o]=this._separateRunnableConfigFromCallOptions(s);if(a.callbacks=a.callbacks??r,!this.cache)return this._generateUncached(i,o,a);const{cache:l}=this,u=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:d}=await this._generateCached({messages:i,cache:l,llmStringKey:u,parsedOptions:o,handledOptions:a});let f={};if(d.length>0){const g=await this._generateUncached(d.map(p=>i[p]),o,a);await Promise.all(g.generations.map(async(p,v)=>{const w=d[v];c[w]=p;const m=Zn._convertInputToPromptValue(i[w]).toString();return l.update(m,u,p)})),f=g.llmOutput??{}}return{generations:c,llmOutput:f}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,n,r){const s=e.map(i=>i.toChatMessages());return this.generate(s,n,r)}async call(e,n,r){return(await this.generate([e.map(Xn)],n,r)).generations[0][0].message}async callPrompt(e,n,r){const s=e.toChatMessages();return this.call(s,n,r)}async predictMessages(e,n,r){return this.call(e,n,r)}async predict(e,n,r){const s=new Xs(e),i=await this.call([s],n,r);if(typeof i.content!="string")throw new Error("Cannot use predict when output is not a string.");return i.content}withStructuredOutput(e,n){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');const r=e,s=n==null?void 0:n.name,i=r.description??"A function available to call.",a=n==null?void 0:n.method,o=n==null?void 0:n.includeRaw;if(a==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let l=s??"extract",u;o1(r)?u=[{type:"function",function:{name:l,description:i,parameters:$a(r)}}]:("name"in r&&(l=r.name),u=[{type:"function",function:{name:l,description:i,parameters:r}}]);const c=this.bindTools(u),d=zu.from(v=>{if(!v.tool_calls||v.tool_calls.length===0)throw new Error("No tool calls found in the response.");const w=v.tool_calls.find(m=>m.name===l);if(!w)throw new Error(`No tool call found with name ${l}.`);return w.args});if(!o)return c.pipe(d).withConfig({runName:"StructuredOutput"});const f=_a.assign({parsed:(v,w)=>d.invoke(v.raw,w)}),g=_a.assign({parsed:()=>null}),p=f.withFallbacks({fallbacks:[g]});return qt.from([{raw:c},p]).withConfig({runName:"StructuredOutputRunnable"})}}class Th extends ce{parseResultWithPrompt(e,n,r){return this.parseResult(e,r)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,n){return typeof e=="string"?this._callWithConfig(async(r,s)=>this.parseResult([{text:r}],s==null?void 0:s.callbacks),e,{...n,runType:"parser"}):this._callWithConfig(async(r,s)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],s==null?void 0:s.callbacks),e,{...n,runType:"parser"})}}class Rw extends Th{parseResult(e,n){return this.parse(e[0].text,n)}async parseWithPrompt(e,n,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}class Ah extends Error{constructor(e,n,r,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=n,this.observation=r,this.sendToLLM=s,s&&(r===void 0||n===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}}function nf(t,e){const n=typeof t;if(n!==typeof e)return!1;if(Array.isArray(t)){if(!Array.isArray(e))return!1;const r=t.length;if(r!==e.length)return!1;for(let s=0;s<r;s++)if(!nf(t[s],e[s]))return!1;return!0}if(n==="object"){if(!t||!e)return t===e;const r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(const a of r)if(!nf(t[a],e[a]))return!1;return!0}return t===e}class l1 extends Rw{async*_transform(e){for await(const n of e)typeof n=="string"?yield this.parseResult([{text:n}]):yield this.parseResult([{message:n,text:this._baseMessageToString(n)}])}async*transform(e,n){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...n,runType:"parser"})}}class u1 extends l1{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let n,r;for await(const s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let i;if(fS(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new Ws({message:s,text:s.content})}else if($u(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new Ws({message:pS(s),text:s.content})}else i=new ja({text:s});r===void 0?r=i:r=r.concat(i);const a=await this.parsePartialResult([r]);a!=null&&!nf(a,n)&&(this.diff?yield this._diff(n,a):yield a,n=a)}}}class c1 extends Rw{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const n=Ze.object(Object.fromEntries(Object.entries(e).map(([r,s])=>[r,Ze.string().describe(s)])));return new this(n)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify($a(this.schema))}
\`\`\`
`}async parse(e){try{const r=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(s,i)=>`"${i.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(r))}catch(n){throw new Ah(`Failed to parse. Text: "${e}". Error: ${n}`,e)}}}class d1 extends u1{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,n){if(n)return e?OS(e,n):[{op:"replace",path:"",value:n}]}async parsePartialResult(e){return Im(e[0].text)}async parse(e){return Im(e,JSON.parse)}getFormatInstructions(){return""}}const f1="modulepreload",h1=function(t){return"/FakeNewsDetector/"+t},Zm={},Uc=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));s=Promise.all(n.map(o=>{if(o=h1(o),o in Zm)return;Zm[o]=!0;const l=o.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${u}`))return;const c=document.createElement("link");if(c.rel=l?"stylesheet":f1,l||(c.as="script",c.crossOrigin=""),c.href=o,a&&c.setAttribute("nonce",a),document.head.appendChild(c),l)return new Promise((d,f)=>{c.addEventListener("load",d),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${o}`)))})}))}return s.then(()=>e()).catch(i=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i})};class Ch extends ce{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:n}=e;if(n.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const n=this.partialVariables??{},r={};for(const[i,a]of Object.entries(n))typeof a=="string"?r[i]=a:r[i]=await a();return{...r,...e}}async invoke(e,n){return this._callWithConfig(r=>this.formatPromptValue(r),e,{...n,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:n}=await Uc(async()=>{const{PromptTemplate:r}=await Promise.resolve().then(()=>Qm);return{PromptTemplate:r}},void 0);return n.deserialize(e)}case void 0:{const{PromptTemplate:n}=await Uc(async()=>{const{PromptTemplate:r}=await Promise.resolve().then(()=>Qm);return{PromptTemplate:r}},void 0);return n.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:n}=await Uc(async()=>{const{FewShotPromptTemplate:r}=await import("./few_shot-CVfMGQbk.js");return{FewShotPromptTemplate:r}},[]);return n.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class rf extends Ch{async formatPromptValue(e){const n=await this.format(e);return new Pw(n)}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var p1=Object.prototype.toString,ni=Array.isArray||function(e){return p1.call(e)==="[object Array]"};function Rh(t){return typeof t=="function"}function m1(t){return ni(t)?"array":typeof t}function zc(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function Gm(t,e){return t!=null&&typeof t=="object"&&e in t}function g1(t,e){return t!=null&&typeof t!="object"&&t.hasOwnProperty&&t.hasOwnProperty(e)}var y1=RegExp.prototype.test;function v1(t,e){return y1.call(t,e)}var w1=/\S/;function _1(t){return!v1(w1,t)}var b1={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function E1(t){return String(t).replace(/[&<>"'`=\/]/g,function(n){return b1[n]})}var k1=/\s*/,S1=/\s+/,Ym=/\s*=/,x1=/\s*\}/,P1=/#|\^|\/|>|\{|&|=|!/;function O1(t,e){if(!t)return[];var n=!1,r=[],s=[],i=[],a=!1,o=!1,l="",u=0;function c(){if(a&&!o)for(;i.length;)delete s[i.pop()];else i=[];a=!1,o=!1}var d,f,g;function p(O){if(typeof O=="string"&&(O=O.split(S1,2)),!ni(O)||O.length!==2)throw new Error("Invalid tags: "+O);d=new RegExp(zc(O[0])+"\\s*"),f=new RegExp("\\s*"+zc(O[1])),g=new RegExp("\\s*"+zc("}"+O[1]))}p(e||ct.tags);for(var v=new La(t),w,m,h,y,_,b;!v.eos();){if(w=v.pos,h=v.scanUntil(d),h)for(var E=0,k=h.length;E<k;++E)y=h.charAt(E),_1(y)?(i.push(s.length),l+=y):(o=!0,n=!0,l+=" "),s.push(["text",y,w,w+1]),w+=1,y===`
`&&(c(),l="",u=0,n=!1);if(!v.scan(d))break;if(a=!0,m=v.scan(P1)||"name",v.scan(k1),m==="="?(h=v.scanUntil(Ym),v.scan(Ym),v.scanUntil(f)):m==="{"?(h=v.scanUntil(g),v.scan(x1),v.scanUntil(f),m="&"):h=v.scanUntil(f),!v.scan(f))throw new Error("Unclosed tag at "+v.pos);if(m==">"?_=[m,h,w,v.pos,l,u,n]:_=[m,h,w,v.pos],u++,s.push(_),m==="#"||m==="^")r.push(_);else if(m==="/"){if(b=r.pop(),!b)throw new Error('Unopened section "'+h+'" at '+w);if(b[1]!==h)throw new Error('Unclosed section "'+b[1]+'" at '+w)}else m==="name"||m==="{"||m==="&"?o=!0:m==="="&&p(h)}if(c(),b=r.pop(),b)throw new Error('Unclosed section "'+b[1]+'" at '+v.pos);return A1(T1(s))}function T1(t){for(var e=[],n,r,s=0,i=t.length;s<i;++s)n=t[s],n&&(n[0]==="text"&&r&&r[0]==="text"?(r[1]+=n[1],r[3]=n[3]):(e.push(n),r=n));return e}function A1(t){for(var e=[],n=e,r=[],s,i,a=0,o=t.length;a<o;++a)switch(s=t[a],s[0]){case"#":case"^":n.push(s),r.push(s),n=s[4]=[];break;case"/":i=r.pop(),i[5]=s[2],n=r.length>0?r[r.length-1][4]:e;break;default:n.push(s)}return e}function La(t){this.string=t,this.tail=t,this.pos=0}La.prototype.eos=function(){return this.tail===""};La.prototype.scan=function(e){var n=this.tail.match(e);if(!n||n.index!==0)return"";var r=n[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};La.prototype.scanUntil=function(e){var n=this.tail.search(e),r;switch(n){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=r.length,r};function Zs(t,e){this.view=t,this.cache={".":this.view},this.parent=e}Zs.prototype.push=function(e){return new Zs(e,this)};Zs.prototype.lookup=function(e){var n=this.cache,r;if(n.hasOwnProperty(e))r=n[e];else{for(var s=this,i,a,o,l=!1;s;){if(e.indexOf(".")>0)for(i=s.view,a=e.split("."),o=0;i!=null&&o<a.length;)o===a.length-1&&(l=Gm(i,a[o])||g1(i,a[o])),i=i[a[o++]];else i=s.view[e],l=Gm(s.view,e);if(l){r=i;break}s=s.parent}n[e]=r}return Rh(r)&&(r=r.call(this.view)),r};function et(){this.templateCache={_cache:{},set:function(e,n){this._cache[e]=n},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}et.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};et.prototype.parse=function(e,n){var r=this.templateCache,s=e+":"+(n||ct.tags).join(":"),i=typeof r<"u",a=i?r.get(s):void 0;return a==null&&(a=O1(e,n),i&&r.set(s,a)),a};et.prototype.render=function(e,n,r,s){var i=this.getConfigTags(s),a=this.parse(e,i),o=n instanceof Zs?n:new Zs(n,void 0);return this.renderTokens(a,o,r,e,s)};et.prototype.renderTokens=function(e,n,r,s,i){for(var a="",o,l,u,c=0,d=e.length;c<d;++c)u=void 0,o=e[c],l=o[0],l==="#"?u=this.renderSection(o,n,r,s,i):l==="^"?u=this.renderInverted(o,n,r,s,i):l===">"?u=this.renderPartial(o,n,r,i):l==="&"?u=this.unescapedValue(o,n):l==="name"?u=this.escapedValue(o,n,i):l==="text"&&(u=this.rawValue(o)),u!==void 0&&(a+=u);return a};et.prototype.renderSection=function(e,n,r,s,i){var a=this,o="",l=n.lookup(e[1]);function u(f){return a.render(f,n,r,i)}if(l){if(ni(l))for(var c=0,d=l.length;c<d;++c)o+=this.renderTokens(e[4],n.push(l[c]),r,s,i);else if(typeof l=="object"||typeof l=="string"||typeof l=="number")o+=this.renderTokens(e[4],n.push(l),r,s,i);else if(Rh(l)){if(typeof s!="string")throw new Error("Cannot use higher-order sections without the original template");l=l.call(n.view,s.slice(e[3],e[5]),u),l!=null&&(o+=l)}else o+=this.renderTokens(e[4],n,r,s,i);return o}};et.prototype.renderInverted=function(e,n,r,s,i){var a=n.lookup(e[1]);if(!a||ni(a)&&a.length===0)return this.renderTokens(e[4],n,r,s,i)};et.prototype.indentPartial=function(e,n,r){for(var s=n.replace(/[^ \t]/g,""),i=e.split(`
`),a=0;a<i.length;a++)i[a].length&&(a>0||!r)&&(i[a]=s+i[a]);return i.join(`
`)};et.prototype.renderPartial=function(e,n,r,s){if(r){var i=this.getConfigTags(s),a=Rh(r)?r(e[1]):r[e[1]];if(a!=null){var o=e[6],l=e[5],u=e[4],c=a;l==0&&u&&(c=this.indentPartial(a,u,o));var d=this.parse(c,i);return this.renderTokens(d,n,r,c,s)}}};et.prototype.unescapedValue=function(e,n){var r=n.lookup(e[1]);if(r!=null)return r};et.prototype.escapedValue=function(e,n,r){var s=this.getConfigEscape(r)||ct.escape,i=n.lookup(e[1]);if(i!=null)return typeof i=="number"&&s===ct.escape?String(i):s(i)};et.prototype.rawValue=function(e){return e[1]};et.prototype.getConfigTags=function(e){return ni(e)?e:e&&typeof e=="object"?e.tags:void 0};et.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!ni(e))return e.escape};var ct={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){ba.templateCache=t},get templateCache(){return ba.templateCache}},ba=new et;ct.clearCache=function(){return ba.clearCache()};ct.parse=function(e,n){return ba.parse(e,n)};ct.render=function(e,n,r,s){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+m1(e)+'" was given as the first argument for mustache#render(template, view, partials)');return ba.render(e,n,r,s)};ct.escape=E1;ct.Scanner=La;ct.Context=Zs;ct.Writer=et;function Iw(){ct.escape=t=>t}const Cl=t=>{const e=t.split(""),n=[],r=(i,a)=>{for(let o=a;o<e.length;o+=1)if(i.includes(e[o]))return o;return-1};let s=0;for(;s<e.length;)if(e[s]==="{"&&s+1<e.length&&e[s+1]==="{")n.push({type:"literal",text:"{"}),s+=2;else if(e[s]==="}"&&s+1<e.length&&e[s+1]==="}")n.push({type:"literal",text:"}"}),s+=2;else if(e[s]==="{"){const i=r("}",s);if(i<0)throw new Error("Unclosed '{' in template.");n.push({type:"variable",name:e.slice(s+1,i).join("")}),s=i+1}else{if(e[s]==="}")throw new Error("Single '}' in template.");{const i=r("{}",s),a=(i<0?e.slice(s):e.slice(s,i)).join("");n.push({type:"literal",text:a}),s=i<0?e.length:i}}return n},C1=t=>t.map(e=>e[0]==="name"?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:["#","&","^",">"].includes(e[0])?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),sf=t=>{Iw();const e=ct.parse(t);return C1(e)},R1=(t,e)=>Cl(t).reduce((n,r)=>{if(r.type==="variable"){if(r.name in e)return n+e[r.name];throw new Error(`(f-string) Missing value for input ${r.name}`)}return n+r.text},""),I1=(t,e)=>(Iw(),ct.render(t,e)),af={"f-string":R1,mustache:I1},N1={"f-string":Cl,mustache:sf},_s=(t,e,n)=>af[e](t,n),j1=(t,e)=>N1[e](t),Nw=(t,e,n)=>{if(!(e in af)){const r=Object.keys(af);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{const r=n.reduce((s,i)=>(s[i]="foo",s),{});Array.isArray(t)?t.forEach(s=>{if(s.type==="text")_s(s.text,e,r);else if(s.type==="image_url")if(typeof s.image_url=="string")_s(s.image_url,e,r);else{const i=s.image_url.url;_s(i,e,r)}else throw new Error(`Invalid message template received. ${JSON.stringify(s,null,2)}`)}):_s(t,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}};class Wt extends rf{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let n=this.inputVariables;this.partialVariables&&(n=n.concat(Object.keys(this.partialVariables))),Nw(this.template,this.templateFormat,n)}}_getPromptType(){return"prompt"}async format(e){const n=await this.mergePartialAndUserVariables(e);return _s(this.template,this.templateFormat,n)}static fromExamples(e,n,r,s=`

`,i=""){const a=[i,...e,n].join(s);return new Wt({inputVariables:r,template:a})}static fromTemplate(e,n){const{templateFormat:r="f-string",...s}=n??{},i=new Set;return j1(e,r).forEach(a=>{a.type==="variable"&&i.add(a.name)}),new Wt({inputVariables:[...i],templateFormat:r,template:e,...s})}async partial(e){const n=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:n,partialVariables:r};return new Wt(s)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new Wt({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}const Qm=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate:Wt},Symbol.toStringTag,{value:"Module"}));class Fi extends Ch{static lc_name(){return"ImagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.validateTemplate){let n=this.inputVariables;this.partialVariables&&(n=n.concat(Object.keys(this.partialVariables))),Nw([{type:"image_url",image_url:this.template}],this.templateFormat,n)}}_getPromptType(){return"prompt"}async partial(e){const n=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:n,partialVariables:r};return new Fi(s)}async format(e){const n={};for(const[a,o]of Object.entries(this.template))typeof o=="string"?n[a]=_s(o,this.templateFormat,e):n[a]=o;const r=e.url||n.url,s=e.detail||n.detail;if(!r)throw new Error("Must provide either an image URL.");if(typeof r!="string")throw new Error("url must be a string.");const i={url:r};return s&&(i.detail=s),i}async formatPromptValue(e){const n=await this.format(e);return new Fx(n)}}class Ih extends ce{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,n){return this._callWithConfig(r=>this.formatMessages(r),e,{...n,runType:"prompt"})}}class $1 extends Ih{static lc_name(){return"MessagesPlaceholder"}constructor(e){typeof e=="string"&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}async formatMessages(e){const n=e[this.variableName];if(this.optional&&!n)return[];if(!n){const s=new Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw s.name="InputFormatError",s}let r;try{Array.isArray(n)?r=n.map(Xn):r=[Xn(n)]}catch(s){const i=typeof n=="string"?n:JSON.stringify(n,null,2),a=new Error([`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.`,`Received value: ${i}`,`Additional message: ${s.message}`].join(`

`));throw a.name="InputFormatError",a}return r}}class L1 extends Ih{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class M1 extends Ch{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const n=await this.formatMessages(e);return new Ow(n)}}class D1 extends L1{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,n){"prompt"in e||(e={prompt:e,role:n}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new Qr(await this.prompt.format(e),this.role)}static fromTemplate(e,n,r){return new this(Wt.fromTemplate(e,{templateFormat:r==null?void 0:r.templateFormat}),n)}}class Nh extends Ih{static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(e,n){if("prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,Array.isArray(this.prompt)){let r=[];this.prompt.forEach(s=>{"inputVariables"in s&&(r=r.concat(s.inputVariables))}),this.inputVariables=r}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=n??this.additionalOptions}createMessage(e){const n=this.constructor;if(n._messageClass()){const r=n._messageClass();return new r({content:e})}else if(n.chatMessageClass){const r=n.chatMessageClass();return new r({content:e,role:this.getRoleFromMessageClass(r.lc_name())})}else throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,n){if(typeof e=="string")return new this(Wt.fromTemplate(e,n));const r=[];for(const s of e)if(typeof s=="string"||typeof s=="object"&&"text"in s){let i="";typeof s=="string"?i=s:typeof s.text=="string"&&(i=s.text??""),r.push(Wt.fromTemplate(i,n))}else if(typeof s=="object"&&"image_url"in s){let i=s.image_url??"",a,o=[];if(typeof i=="string"){let l;(n==null?void 0:n.templateFormat)==="mustache"?l=sf(i):l=Cl(i);const u=l.flatMap(c=>c.type==="variable"?[c.name]:[]);if(((u==null?void 0:u.length)??0)>0){if(u.length>1)throw new Error(`Only one format variable allowed per image template.
Got: ${u}
From: ${i}`);o=[u[0]]}else o=[];i={url:i},a=new Fi({template:i,inputVariables:o,templateFormat:n==null?void 0:n.templateFormat})}else if(typeof i=="object"){if("url"in i){let l;(n==null?void 0:n.templateFormat)==="mustache"?l=sf(i.url):l=Cl(i.url),o=l.flatMap(u=>u.type==="variable"?[u.name]:[])}else o=[];a=new Fi({template:i,inputVariables:o,templateFormat:n==null?void 0:n.templateFormat})}else throw new Error("Invalid image template");r.push(a)}return new this({prompt:r,additionalOptions:n})}async format(e){if(this.prompt instanceof rf){const n=await this.prompt.format(e);return this.createMessage(n)}else{const n=[];for(const r of this.prompt){let s={};if(!("inputVariables"in r))throw new Error(`Prompt ${r} does not have inputVariables defined.`);for(const i of r.inputVariables)s||(s={[i]:e[i]}),s={...s,[i]:e[i]};if(r instanceof rf){const i=await r.format(s);n.push({type:"text",text:i})}else if(r instanceof Fi){const i=await r.format(s);n.push({type:"image_url",image_url:i})}}return this.createMessage(n)}}async formatMessages(e){return[await this.format(e)]}}class jw extends Nh{static _messageClass(){return Xs}static lc_name(){return"HumanMessagePromptTemplate"}}class F1 extends Nh{static _messageClass(){return bh}static lc_name(){return"AIMessagePromptTemplate"}}class U1 extends Nh{static _messageClass(){return hw}static lc_name(){return"SystemMessagePromptTemplate"}}function z1(t){return typeof t.formatMessages=="function"}function V1(t,e){if(z1(t)||$u(t))return t;if(Array.isArray(t)&&t[0]==="placeholder"){const s=t[1];if(typeof s!="string"||s[0]!=="{"||s[s.length-1]!=="}")throw new Error(`Invalid placeholder template: "${t[1]}". Expected a variable name surrounded by curly braces.`);const i=s.slice(1,-1);return new $1({variableName:i,optional:!0})}const n=Xn(t);let r;if(typeof n.content=="string"?r=n.content:r=n.content.map(s=>"text"in s?{text:s.text}:"image_url"in s?{image_url:s.image_url}:s),n._getType()==="human")return jw.fromTemplate(r,e);if(n._getType()==="ai")return F1.fromTemplate(r,e);if(n._getType()==="system")return U1.fromTemplate(r,e);if(Qr.isInstance(n))return D1.fromTemplate(n.content,n.role,e);throw new Error(`Could not coerce message prompt template from input. Received message type: "${n._getType()}".`)}function B1(t){return t.constructor.lc_name()==="MessagesPlaceholder"}class Kt extends M1{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){const n=new Set;for(const o of this.promptMessages)if(!(o instanceof lr))for(const l of o.inputVariables)n.add(l);const r=this.inputVariables,s=new Set(this.partialVariables?r.concat(Object.keys(this.partialVariables)):r),i=new Set([...s].filter(o=>!n.has(o)));if(i.size>0)throw new Error(`Input variables \`${[...i]}\` are not used in any of the prompt messages.`);const a=new Set([...n].filter(o=>!s.has(o)));if(a.size>0)throw new Error(`Input variables \`${[...a]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,n){if(typeof e.content=="string")return e;const r=await Promise.all(e.content.map(async s=>{if(s.type!=="image_url")return s;let i="";typeof s.image_url=="string"?i=s.image_url:i=s.image_url.url;const o=await Wt.fromTemplate(i,{templateFormat:this.templateFormat}).format(n);return typeof s.image_url!="string"&&"url"in s.image_url?s.image_url.url=o:s.image_url=o,s}));return e.content=r,e}async formatMessages(e){const n=await this.mergePartialAndUserVariables(e);let r=[];for(const s of this.promptMessages)if(s instanceof lr)r.push(await this._parseImagePrompts(s,n));else{const i=s.inputVariables.reduce((o,l)=>{if(!(l in n)&&!(B1(s)&&s.optional))throw new Error(`Missing value for input variable \`${l.toString()}\``);return o[l]=n[l],o},{}),a=await s.formatMessages(i);r=r.concat(a)}return r}async partial(e){const n=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:n,partialVariables:r};return new Kt(s)}static fromTemplate(e,n){const r=Wt.fromTemplate(e,n),s=new jw({prompt:r});return this.fromMessages([s])}static fromMessages(e,n){const r=e.reduce((a,o)=>a.concat(o instanceof Kt?o.promptMessages:[V1(o,n)]),[]),s=e.reduce((a,o)=>o instanceof Kt?Object.assign(a,o.partialVariables):a,Object.create(null)),i=new Set;for(const a of r)if(!(a instanceof lr))for(const o of a.inputVariables)o in s||i.add(o);return new this({...n,inputVariables:[...i],promptMessages:r,partialVariables:s,templateFormat:n==null?void 0:n.templateFormat})}static fromPromptMessages(e){return this.fromMessages(e)}}class H1 extends Error{constructor(e,n){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=n}}class q1 extends Cw{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1})}async invoke(e,n){return this.call(e,Y(n))}async call(e,n,r){let s;try{s=await this.schema.parseAsync(e)}catch{throw new H1("Received tool input did not match expected schema",JSON.stringify(e))}const i=yS(n),a=await Ye.configure(i.callbacks,this.callbacks,i.tags||r,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),o=await(a==null?void 0:a.handleToolStart(this.toJSON(),typeof s=="string"?s:JSON.stringify(s),i.runId,void 0,void 0,void 0,i.runName));delete i.runId;let l;try{l=await this._call(s,o,i)}catch(u){throw await(o==null?void 0:o.handleToolError(u)),u}return await(o==null?void 0:o.handleToolEnd(l)),l}}class W1 extends q1{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:Ze.object({input:Ze.string().optional()}).transform(n=>n.input)})}call(e,n){return super.call(typeof e=="string"||!e?{input:e}:e,n)}}function Z1(t){return{name:t.name,description:t.description,parameters:$a(t.schema)}}function Km(t){return G1(t)?{type:"function",function:Z1(t)}:t}function G1(t){return t!==void 0&&Array.isArray(t.lc_namespace)}function $w(t){return sk({clockseq:t})}function Lw(t,e){return t.channel_versions[e]??0}function Mw(t,e,n){var r;return((r=t.versions_seen[e])==null?void 0:r[n])??0}function jh(t){if(typeof t!="object"||t===null)return t;const e=Array.isArray(t)?[]:{};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=jh(t[n]));return e}function Vc(){return{v:1,id:$w(-2),ts:new Date().toISOString(),channel_values:{},channel_versions:{},versions_seen:{}}}function Rl(t){return{v:t.v,id:t.id,ts:t.ts,channel_values:{...t.channel_values},channel_versions:{...t.channel_versions},versions_seen:jh(t.versions_seen)}}class Y1 extends Error{constructor(e){super(e),this.name="GraphRecursionError"}static get unminifiable_name(){return"GraphRecursionError"}}class ts extends Error{constructor(e){super(e),this.name="GraphValueError"}static get unminifiable_name(){return"GraphValueError"}}class Rt extends Error{constructor(e){super(e),this.name="EmptyChannelError"}static get unminifiable_name(){return"EmptyChannelError"}}class qr extends Error{constructor(e){super(e),this.name="InvalidUpdateError"}static get unminifiable_name(){return"InvalidUpdateError"}}class Hu{}function yi(t,e){const n={};for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const s=e.channel_values[r];n[r]=t[r].fromCheckpoint(s)}return n}function Co(t,e,n){const r={};for(const s of Object.keys(e))try{r[s]=e[s].checkpoint()}catch(i){if(i.name!==Rt.unminifiable_name)throw i}return{v:1,id:$w(n),ts:new Date().toISOString(),channel_values:r,channel_versions:{...t.channel_versions},versions_seen:jh(t.versions_seen)}}class En extends Error{constructor(e){super(e),this.name="GraphValidationError"}}function Q1({nodes:t,channels:e,inputChannels:n,outputChannels:r,streamChannels:s,interruptAfterNodes:i,interruptBeforeNodes:a}){if(!e)throw new En("Channels not provided");const o=new Set,l=new Set;for(const[u,c]of Object.entries(t)){if(u===Cs)throw new En(`"Node name ${Cs} is reserved"`);if(c.constructor===dn)c.triggers.forEach(d=>o.add(d));else throw new En(`Invalid node type ${typeof c}, expected PregelNode`)}for(const u of o)if(!(u in e))throw new En(`Subcribed channel '${String(u)}' not in channels`);if(Array.isArray(n)){if(n.every(u=>!o.has(u)))throw new En(`None of the input channels ${n} are subscribed to by any node`)}else if(!o.has(n))throw new En(`Input channel ${String(n)} is not subscribed to by any node`);Array.isArray(r)?r.forEach(u=>l.add(u)):l.add(r),s&&!Array.isArray(s)?l.add(s):Array.isArray(s)&&s.forEach(u=>l.add(u));for(const u of l)if(!(u in e))throw new En(`Output channel '${String(u)}' not in channels`);if(i&&i!=="*"){for(const u of i)if(!(u in t))throw new En(`Node ${String(u)} not in nodes`)}if(a&&a!=="*"){for(const u of a)if(!(u in t))throw new En(`Node ${String(u)} not in nodes`)}}function Jm(t,e){if(Array.isArray(t)){for(const n of t)if(!(n in e))throw new Error(`Key ${String(n)} not found in channels`)}else if(!(t in e))throw new Error(`Key ${String(t)} not found in channels`)}function Rs(t,e,n=!0,r=!1){try{return t[e].get()}catch(s){if(s.name===Rt.unminifiable_name){if(r)return s;if(n)return null}throw s}}function Ea(t,e,n=!0){if(Array.isArray(e)){const r={};for(const s of e)try{r[s]=Rs(t,s,!n)}catch(i){if(i.name===Rt.unminifiable_name)continue}return r}else return Rs(t,e)}function*K1(t,e){if(e!=null)if(Array.isArray(t)&&typeof e=="object"&&!Array.isArray(e))for(const n in e)t.includes(n)&&(yield[n,e[n]]);else{if(Array.isArray(t))throw new Error("Input chunk must be an object when inputChannels is an array");yield[t,e]}}function*Xm(t,e,n){Array.isArray(t)?e.find(([r,s])=>t.includes(r))&&(yield Ea(n,t)):e.some(([r,s])=>r===t)&&(yield Rs(n,t))}function*eg(t,e){const n=e.filter(r=>{var s;return r.config===void 0||!((s=r.config.tags)!=null&&s.includes(xt))});if(Array.isArray(t)){const r={};for(const s of n)if(s.writes.some(([i,a])=>t.includes(i))){const i={};for(const[a,o]of s.writes)t.includes(a)&&(i[a]=o);r[s.name]=i}Object.keys(r).length>0&&(yield r)}else{const r={};for(const s of n)for(const[i,a]of s.writes)i===t&&(r[s.name]=a);Object.keys(r).length>0&&(yield r)}}function J1(t){for(const e of t)return e;return null}const X1=25;function eP(t){return typeof t=="string"}class tP{static subscribeTo(e,n){const{key:r,tags:s}=n??{};if(Array.isArray(e)&&r!==void 0)throw new Error("Can't specify a key when subscribing to multiple channels");let i;eP(e)?r?i={[r]:e}:i=[e]:i=Object.fromEntries(e.map(o=>[o,o]));const a=Array.isArray(e)?e:[e];return new dn({channels:i,triggers:a,tags:s})}static writeTo(e,n){const r=[];for(const s of e)r.push({channel:s,value:cr,skipNone:!1});for(const[s,i]of Object.entries(n??{}))ce.isRunnable(i)||typeof i=="function"?r.push({channel:s,value:cr,skipNone:!0,mapper:cn(i)}):r.push({channel:s,value:i,skipNone:!1});return new ze(r)}}class nP extends ce{static lc_name(){return"LangGraph"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langgraph","pregel"]}),Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoValidate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"streamMode",{enumerable:!0,configurable:!0,writable:!0,value:"values"}),Object.defineProperty(this,"streamChannels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"interruptAfter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"interruptBefore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stepTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"checkpointer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.nodes=e.nodes,this.channels=e.channels,this.autoValidate=e.autoValidate??this.autoValidate,this.streamMode=e.streamMode??this.streamMode,this.outputs=e.outputs,this.streamChannels=e.streamChannels??this.streamChannels,this.interruptAfter=e.interruptAfter,this.interruptBefore=e.interruptBefore,this.inputs=e.inputs,this.stepTimeout=e.stepTimeout??this.stepTimeout,this.debug=e.debug??this.debug,this.checkpointer=e.checkpointer,this._transform=this._transform.bind(this),this.autoValidate&&this.validate()}validate(){return Q1({nodes:this.nodes,channels:this.channels,outputChannels:this.outputs,inputChannels:this.inputs,streamChannels:this.streamChannels,interruptAfterNodes:this.interruptAfter,interruptBeforeNodes:this.interruptBefore}),this}get streamChannelsList(){return Array.isArray(this.streamChannels)?this.streamChannels:this.streamChannels?[this.streamChannels]:Object.keys(this.channels)}get streamChannelsAsIs(){return this.streamChannels?this.streamChannels:Object.keys(this.channels)}async getState(e){if(!this.checkpointer)throw new ts("No checkpointer set");const n=await this.checkpointer.getTuple(e),r=n?n.checkpoint:Vc(),s=yi(this.channels,r),[i,a]=fo(r,this.nodes,s,!1);return{values:Ea(s,this.streamChannelsAsIs),next:a.map(o=>o.name),metadata:n==null?void 0:n.metadata,config:n?n.config:e,createdAt:n==null?void 0:n.checkpoint.ts,parentConfig:n==null?void 0:n.parentConfig}}async*getStateHistory(e,n,r){if(!this.checkpointer)throw new ts("No checkpointer set");for await(const s of this.checkpointer.list(e,n,r)){const i=yi(this.channels,s.checkpoint),[a,o]=fo(s.checkpoint,this.nodes,i,!1);yield{values:Ea(i,this.streamChannelsAsIs),next:o.map(l=>l.name),metadata:s.metadata,config:s.config,createdAt:s.checkpoint.ts,parentConfig:s.parentConfig}}}async updateState(e,n,r){var d;if(!this.checkpointer)throw new ts("No checkpointer set");const s=await this.checkpointer.getTuple(e),i=s?Rl(s.checkpoint):Vc(),a=Object.entries(i.versions_seen).reduce((f,[g,p])=>{const v=Math.max(...Object.values(p));return v&&(f[v]||(f[v]=[]),f[v].push(g)),f},{});if(!r&&!Object.keys(a).length)!Array.isArray(this.inputs)&&this.inputs in this.nodes&&(r=this.inputs);else if(!r){const f=Math.max(...Object.keys(a).map(Number)),g=a[f];g.length===1&&(r=g[0])}if(!r)throw new qr("Ambiguous update, specify as_node");const o=yi(this.channels,i),l=this.nodes[r].getWriters();if(!l.length)throw new qr(`No writers found for node ${r}`);const u={name:r,input:n,proc:l.length>1?qt.from(l):l[0],writes:[],config:void 0};await u.proc.invoke(u.input,Oe(e,{runName:`${this.name}UpdateState`,configurable:{[Xd]:f=>u.writes.push(...f),[Ao]:ng.bind(void 0,i,o,u.writes)}})),Ro(i,o,u.writes);const c=(((d=s==null?void 0:s.metadata)==null?void 0:d.step)??-2)+1;return await this.checkpointer.put((s==null?void 0:s.config)??e,Co(i,o,c),{source:"update",step:c,writes:{[r]:n}})}_defaults(e){const{debug:n,streamMode:r,inputKeys:s,outputKeys:i,interruptAfter:a,interruptBefore:o,...l}=e,u=n!==void 0?n:this.debug;let c=i;c===void 0?c=this.streamChannelsAsIs:Jm(c,this.channels);let d=s;d===void 0?d=this.inputs:Jm(d,this.channels);const f=o??this.interruptBefore??[],g=a??this.interruptAfter??[];let p;return r!==void 0?p=r:p=this.streamMode,e.configurable!==void 0&&e.configurable[Ao]!==void 0&&(p="values"),[u,p,d,c,l,f,g]}async*_transform(e,n,r={}){var i;const s=[];try{if(r.recursionLimit&&r.recursionLimit<1)throw new ts(`Recursion limit must be greater than 0, got ${r.recursionLimit}`);if(this.checkpointer&&!r.configurable)throw new ts("Checkpointer requires one or more of the following 'configurable' keys: thread_id, checkpoint_id");const[a,o,l,u,c,d,f]=this._defaults(r),g={...this.nodes},p=this.checkpointer?await this.checkpointer.getTuple(r):null;let v=p?p.checkpoint:Vc(),w=p?p.config:r,m=(((i=p==null?void 0:p.metadata)==null?void 0:i.step)??-2)+1;const h=yi(this.channels,v),y=[];for await(const b of e)for(const E of K1(l,b))y.push(E);if(y.length)v=fo(v,g,h,!0)[0],Ro(v,h,y),this.checkpointer&&(v=Co(v,h,m),s.push(this.checkpointer.put(w,v,{source:"input",step:m,writes:Object.fromEntries(y)})),w={configurable:{...w.configurable,checkpoint_id:v.id}}),m+=1;else{v=Rl(v);for(const b of this.streamChannelsList){const E=v.channel_versions[b]??0;v.versions_seen[Cs]||(v.versions_seen[Cs]={}),v.versions_seen[Cs][b]=E}}const _=m+(r.recursionLimit??X1);for(let b=m;b<_+1;b+=1){const[E,k]=fo(v,g,h,!0);if(k.length===0&&b===m)throw new ts("No tasks to run in graph.");if(k.length===0)break;if(b===_)throw new Y1(`Recursion limit of ${r.recursionLimit} reached without hitting a stop condition. You can increase the limit by setting the "recursionLimit" config key.`);if(tg(v,d,this.streamChannelsList,k))break;v=E,a&&console.log(k);const $=k.map(he=>[he.proc,he.input,Oe(c,{callbacks:n==null?void 0:n.getChild(`graph:step:${b}`),runName:he.name,configurable:{...r.configurable,[Xd]:_n=>he.writes.push(..._n),[Ao]:ng.bind(void 0,v,h,he.writes)}})]).map(([he,_n,br])=>()=>he.invoke(_n,br));await sP($,this.stepTimeout);const M=[];for(const he of k)M.push(...he.writes);if(Ro(v,h,M),o==="values"?yield*Xm(u,M,h):o==="updates"&&(yield*eg(u,k)),this.checkpointer&&(v=Co(v,h,b),s.push(this.checkpointer.put(w,v,{source:"loop",step:b,writes:J1(this.streamMode==="values"?Xm(u,M,h):eg(u,k))})),w={configurable:{...w.configurable,checkpoint_id:v.id}}),tg(v,f,this.streamChannelsList,k))break}}finally{await Promise.all(s)}}async invoke(e,n){const r=Y(n);r!=null&&r.outputKeys||(r.outputKeys=this.outputs),r!=null&&r.streamMode||(r.streamMode="values");let s;for await(const i of await this.stream(e,r))s=i;if(s)return s}async stream(e,n){const r=async function*(){yield e}();return ut.fromAsyncGenerator(this.transform(r,n))}async*transform(e,n){for await(const r of this._transformStreamWithConfig(e,this._transform,n))yield r}}function rP(t){return new Promise(e=>{setTimeout(e,t)})}async function sP(t,e){const n=t.map(s=>e?Promise.race([s(),e?rP(e):Promise.resolve()]):s()),r=await Promise.allSettled(n);for(const s of r)if(s.status==="rejected")throw s.reason}function tg(t,e,n,r){const s=n.some(a=>Lw(t,a)>Mw(t,Cs,a)),i=r.some(a=>{var o,l;return e==="*"?!((l=(o=a.config)==null?void 0:o.tags)!=null&&l.includes(xt)):e.includes(a.name)});return s&&i}function ng(t,e,n,r,s=!1){if(s){const i=Co(t,e,-1),a=yi(e,i);return Ro(Rl(i),a,n),Ea(a,r)}else return Ea(e,r)}function Ro(t,e,n){const r={};for(const[a,o]of n)a in r?r[a].push(o):r[a]=[o];let s=0;Object.keys(t.channel_versions).length>0&&(s=Math.max(...Object.values(t.channel_versions)));const i=new Set;for(const[a,o]of Object.entries(r))if(a in e){try{e[a].update(o)}catch(l){if(l.name===qr.unminifiable_name)throw new qr(`Invalid update for channel ${a}. Values: ${o}`)}t.channel_versions[a]=s+1,i.add(a)}else console.warn(`Skipping write for channel ${a} which has no readers`);for(const a in e)i.has(a)||e[a].update([])}function fo(t,e,n,r){const s=Rl(t),i=[],a=[];for(const[o,l]of Object.entries(e))if(l.triggers.filter(u=>{try{return Rs(n,u,!1),!0}catch{return!1}}).some(u=>Lw(s,u)>Mw(s,o,u))){let u;if(Array.isArray(l.channels)){let c=0;for(const d of l.channels)try{u=Rs(n,d,!1);break}catch(f){if(f.name===Rt.unminifiable_name){c+=1;continue}else throw f}if(c===l.channels.length)continue}else if(typeof l.channels=="object"){u={};try{for(const[c,d]of Object.entries(l.channels))u[c]=Rs(n,d,!l.triggers.includes(d))}catch(c){if(c.name===Rt.unminifiable_name)continue;throw c}}else throw new Error(`Invalid channels type, expected list or dict, got ${l.channels}`);if(l.mapper!==void 0&&(u=l.mapper(u)),r){s.versions_seen[o]||(s.versions_seen[o]={}),l.triggers.forEach(d=>{const f=s.channel_versions[d];f!==void 0&&(s.versions_seen[o][d]=f)});const c=l.getNode();c!==void 0&&i.push({name:o,input:u,proc:c,writes:[],config:l.config})}else a.push({name:o,input:u})}return[s,r?i:a]}class yn extends Hu{constructor(e=!0){super(),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"EphemeralValue"}),Object.defineProperty(this,"guard",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.guard=e}fromCheckpoint(e){const n=new yn;return e&&(n.value=e),n}update(e){if(e.length===0){this.value=void 0;return}if(e.length!==1&&this.guard)throw new qr("EphemeralValue can only receive one value per step.");this.value=e[e.length-1]}get(){if(this.value===void 0)throw new Rt;return this.value}checkpoint(){if(this.value===void 0)throw new Rt;return this.value}}const ve="__start__",le="__end__";class iP{constructor(e){Object.defineProperty(this,"condition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ends",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.condition=e.path,this.ends=Array.isArray(e.pathMap)?e.pathMap.reduce((n,r)=>(n[r]=r,n),{}):e.pathMap}compile(e,n){return ze.registerWriter(new Vu({func:(r,s)=>this._route(r,s,e,n)}))}async _route(e,n,r,s){let i=await this.condition(s?s(n):e,n);Array.isArray(i)||(i=[i]);let a;if(this.ends?a=i.map(o=>this.ends[o]):a=i,a.some(o=>!o))throw new Error("Branch condition returned unknown or null destination");return r(a)}}class aP{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"branches",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"entryPoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"compiled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"supportMultipleEdges",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.nodes={},this.edges=new Set,this.branches={}}warnIfCompiled(e){this.compiled&&console.warn(e)}get allEdges(){return this.edges}addNode(e,n){if(this.warnIfCompiled("Adding a node to a graph that has already been compiled. This will not be reflected in the compiled graph."),e in this.nodes)throw new Error(`Node \`${e}\` already present.`);if(e===le)throw new Error(`Node \`${e}\` is reserved.`);return this.nodes[e]=cn(n),this}addEdge(e,n){if(this.warnIfCompiled("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph."),e===le)throw new Error("END cannot be a start node");if(n===ve)throw new Error("START cannot be an end node");if(!this.supportMultipleEdges&&Array.from(this.edges).some(([r])=>r===e))throw new Error(`Already found path for ${e}`);return this.edges.add([e,n]),this}addConditionalEdges(e,n,r){const s=typeof e=="object"?e:{source:e,path:n,pathMap:r};this.warnIfCompiled("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph.");const i=s.path.name||"condition";if(this.branches[s.source]&&this.branches[s.source][i])throw new Error(`Condition \`${i}\` already present for node \`${e}\``);return this.branches[s.source]||(this.branches[s.source]={}),this.branches[s.source][i]=new iP(s),this}setEntryPoint(e){return this.warnIfCompiled("Setting the entry point of a graph that has already been compiled. This will not be reflected in the compiled graph."),this.addEdge(ve,e)}setFinishPoint(e){return this.warnIfCompiled("Setting a finish point of a graph that has already been compiled. This will not be reflected in the compiled graph."),this.addEdge(e,le)}compile({checkpointer:e,interruptBefore:n,interruptAfter:r}={}){this.validate([...Array.isArray(n)?n:[],...Array.isArray(r)?r:[]]);const s=new Dw({builder:this,checkpointer:e,interruptAfter:r,interruptBefore:n,autoValidate:!1,nodes:{},channels:{[ve]:new yn,[le]:new yn},inputs:ve,outputs:le,streamChannels:[],streamMode:"values"});for(const[i,a]of Object.entries(this.nodes))s.attachNode(i,a);for(const[i,a]of this.edges)s.attachEdge(i,a);for(const[i,a]of Object.entries(this.branches))for(const[o,l]of Object.entries(a))s.attachBranch(i,o,l);return s.validate()}validate(e){const n=new Set([...this.allEdges].map(([s,i])=>s));for(const[s]of Object.entries(this.branches))n.add(s);for(const s of Object.keys(this.nodes))if(!n.has(s))throw new Error(`Node \`${s}\` is a dead-end`);for(const s of n)if(s!==ve&&!(s in this.nodes))throw new Error(`Found edge starting at unknown node \`${s}\``);const r=new Set([...this.allEdges].map(([s,i])=>i));for(const[s,i]of Object.entries(this.branches))for(const a of Object.values(i))if(a.ends)for(const o of Object.values(a.ends))r.add(o);else{r.add(le);for(const o of Object.keys(this.nodes))o!==s&&r.add(o)}for(const s of Object.keys(this.nodes))if(!r.has(s))throw new Error(`Node \`${s}\` is not reachable`);for(const s of r)if(s!==le&&!(s in this.nodes))throw new Error(`Found edge ending at unknown node \`${s}\``);if(e){for(const s of e)if(!(s in this.nodes))throw new Error(`Interrupt node \`${s}\` is not present`)}this.compiled=!0}}class Dw extends nP{constructor({builder:e,...n}){super(n),Object.defineProperty(this,"builder",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.builder=e}attachNode(e,n){this.channels[e]=new yn,this.nodes[e]=new dn({channels:[],triggers:[]}).pipe(n).pipe(new ze([{channel:e,value:cr}],[xt])),this.streamChannels.push(e)}attachEdge(e,n){if(n===le){if(e===ve)throw new Error("Cannot have an edge from START to END");this.nodes[e].writers.push(new ze([{channel:le,value:cr}],[xt]))}else this.nodes[n].triggers.push(e),this.nodes[n].channels.push(e)}attachBranch(e,n,r){e===ve&&this.nodes[ve]&&(this.nodes[ve]=tP.subscribeTo(ve,{tags:[xt]})),this.nodes[e].pipe(r.compile(i=>{const a=i.map(o=>o===le?le:`branch:${e}:${n}:${o}`);return new ze(a.map(o=>({channel:o,value:cr})),[xt])}));const s=r.ends?Object.values(r.ends):Object.keys(this.nodes);for(const i of s)if(i!==le){const a=`branch:${e}:${n}:${i}`;this.channels[a]=new yn,this.nodes[i].triggers.push(a),this.nodes[i].channels.push(a)}}}class Il extends Hu{constructor(e,n){super(),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"BinaryOperatorAggregate"}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"operator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initialValueFactory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.operator=e,this.initialValueFactory=n,this.value=n==null?void 0:n()}fromCheckpoint(e){const n=new Il(this.operator,this.initialValueFactory);return e&&(n.value=e),n}update(e){let n=e;if(n.length){this.value===void 0&&([this.value]=n,n=n.slice(1));for(const r of n)this.value!==void 0&&(this.value=this.operator(this.value,r))}}get(){if(this.value===void 0)throw new Rt;return this.value}checkpoint(){if(this.value===void 0)throw new Rt;return this.value}}class $h extends Hu{constructor(){super(...arguments),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"LastValue"}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}fromCheckpoint(e){const n=new $h;return e&&(n.value=e),n}update(e){if(e.length!==0){if(e.length!==1)throw new qr;this.value=e[e.length-1]}}get(){if(this.value===void 0)throw new Rt;return this.value}checkpoint(){if(this.value===void 0)throw new Rt;return this.value}}const rg=(t,e)=>t.size===e.size&&[...t].every(n=>e.has(n));class Lh extends Hu{constructor(e){super(),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"NamedBarrierValue"}),Object.defineProperty(this,"names",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"seen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.names=e,this.seen=new Set}fromCheckpoint(e){const n=new Lh(this.names);return e&&(n.seen=new Set(e)),n}update(e){rg(this.names,this.seen)&&(this.seen=new Set);for(const n of e)if(this.names.has(n))this.seen.add(n);else throw new Error(`Value ${JSON.stringify(n)} not in names ${JSON.stringify(this.names)}`)}get(){if(!rg(this.names,this.seen))throw new Rt}checkpoint(){return[...this.seen]}}const Nl="__root__";class oP extends aP{constructor(e){super(),Object.defineProperty(this,"channels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"waitingEdges",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),this.channels=lP(e.channels);for(const n of Object.values(this.channels))if(n.lc_graph_name==="BinaryOperatorAggregate"){this.supportMultipleEdges=!0;break}}get allEdges(){return new Set([...this.edges,...Array.from(this.waitingEdges).flatMap(([e,n])=>e.map(r=>[r,n]))])}addNode(e,n){if(e in this.channels)throw new Error(`${e} is already being used as a state attribute (a.k.a. a channel), cannot also be used as a node name.`);return super.addNode(e,n)}addEdge(e,n){if(typeof e=="string")return super.addEdge(e,n);this.compiled&&console.warn("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph.");for(const r of e){if(r===le)throw new Error("END cannot be a start node");if(!Object.keys(this.nodes).some(s=>s===r))throw new Error(`Need to add_node ${r} first`)}if(n===le)throw new Error("END cannot be an end node");if(!Object.keys(this.nodes).some(r=>r===n))throw new Error(`Need to add_node ${n} first`);return this.waitingEdges.add([e,n]),this}compile({checkpointer:e,interruptBefore:n,interruptAfter:r}={}){this.validate([...Array.isArray(n)?n:[],...Array.isArray(r)?r:[]]);const s=Object.keys(this.channels),i=s.length===1&&s[0]===Nl?s[0]:s,a=new uP({builder:this,checkpointer:e,interruptAfter:r,interruptBefore:n,autoValidate:!1,nodes:{},channels:{...this.channels,[ve]:new yn},inputs:ve,outputs:i,streamChannels:i,streamMode:"updates"});a.attachNode(ve);for(const[o,l]of Object.entries(this.nodes))a.attachNode(o,l);for(const[o,l]of this.edges)a.attachEdge(o,l);for(const[o,l]of this.waitingEdges)a.attachEdge(o,l);for(const[o,l]of Object.entries(this.branches))for(const[u,c]of Object.entries(l))a.attachBranch(o,u,c);return a.validate()}}function lP(t){const e={};for(const[n,r]of Object.entries(t))e[n]=sg(r);return e}function sg(t){return typeof t=="object"&&t&&"reducer"in t&&t.reducer?new Il(t.reducer,t.default):typeof t=="object"&&t&&"value"in t&&t.value?new Il(t.value,t.default):new $h}class uP extends Dw{attachNode(e,n){const r=Object.keys(this.builder.channels);function s(a,o){if(o){if(typeof o!="object"||Array.isArray(o))throw new qr(`Expected dict, got ${typeof o}`);return a in o?o[a]:ef}else return ef}const i=r.map(a=>a===Nl?{channel:a,value:cr,skipNone:!0}:{channel:a,value:cr,mapper:new Vu({func:s.bind(null,a),trace:!1,recurse:!1})});e===ve?this.nodes[e]=new dn({tags:[xt],triggers:[ve],channels:[ve],writers:[new ze(i,[xt])]}):(this.channels[e]=new yn,this.nodes[e]=new dn({triggers:[],channels:r.length===1&&r[0]===Nl?r:r.reduce((a,o)=>(a[o]=o,a),{}),writers:[new ze(i.concat({channel:e,value:e}),[xt])],bound:n}))}attachEdge(e,n){if(n!==le)if(Array.isArray(e)){const r=`join:${e.join("+")}:${n}`;this.channels[r]=new Lh(new Set(e)),this.nodes[n].triggers.push(r);for(const s of e)this.nodes[s].writers.push(new ze([{channel:r,value:s}],[xt]))}else if(e===ve){const r=`start:${n}`;this.channels[r]=new yn,this.nodes[n].triggers.push(r),this.nodes[ve].writers.push(new ze([{channel:r,value:ve}],[xt]))}else this.nodes[n].triggers.push(e)}attachBranch(e,n,r){this.nodes[e].writers.push(r.compile(i=>{const a=i.filter(l=>l!==le);if(!a.length)return;const o=a.map(l=>({channel:`branch:${e}:${n}:${l}`,value:e}));return new ze(o,[xt])},i=>xh.doRead(i,this.outputs,!0)));const s=r.ends?Object.values(r.ends):Object.keys(this.builder.nodes);for(const i of s){if(i===le)continue;const a=`branch:${e}:${n}:${i}`;this.channels[a]=new yn,this.nodes[i].triggers.push(a)}}}const rs="4.52.4";let ig=!1,Ui,Fw,Uw,of,zw,Vw,Bw,Hw,qw;function cP(t,e={auto:!1}){if(ig)throw new Error(`you must \`import 'openai/shims/${t.kind}'\` before importing anything else from openai`);if(Ui)throw new Error(`can't \`import 'openai/shims/${t.kind}'\` after \`import 'openai/shims/${Ui}'\``);ig=e.auto,Ui=t.kind,Fw=t.fetch,Uw=t.FormData,of=t.File,zw=t.ReadableStream,Vw=t.getMultipartRequestOptions,Bw=t.getDefaultAgent,Hw=t.fileFromPath,qw=t.isFsReadStream}class dP{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function fP({manuallyImported:t}={}){const e=t?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,r,s,i;try{n=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:n,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new dP(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}Ui||cP(fP(),{auto:!0});class fn{constructor(e,n){this.iterator=e,this.controller=n}static fromSSEResponse(e,n){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of hP(e,n))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null){let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(o&&o.error)throw new Ke(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(a.event=="error")throw new Ke(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||n.abort()}}return new fn(s,n)}static fromReadableStream(e,n){let r=!1;async function*s(){const a=new Wr,o=Ww(e);for await(const l of o)for(const u of a.decode(l))yield u;for(const l of a.flush())yield l}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||n.abort()}}return new fn(i,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],n=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),n.push(a)}return i.shift()}});return[new fn(()=>s(e),this.controller),new fn(()=>s(n),this.controller)]}toReadableStream(){const e=this;let n;const r=new TextEncoder;return new zw({async start(){n=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await n.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=n.return)==null?void 0:s.call(n))}})}}async function*hP(t,e){if(!t.body)throw e.abort(),new q("Attempted to iterate over a response with no body");const n=new gP,r=new Wr,s=Ww(t.body);for await(const i of pP(s))for(const a of r.decode(i)){const o=n.decode(a);o&&(yield o)}for(const i of r.flush()){const a=n.decode(i);a&&(yield a)}}async function*pP(t){let e=new Uint8Array;for await(const n of t){if(n==null)continue;const r=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?new TextEncoder().encode(n):n;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=mP(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function mP(t){for(let r=0;r<t.length-2;r++){if(t[r]===10&&t[r+1]===10||t[r]===13&&t[r+1]===13)return r+2;if(t[r]===13&&t[r+1]===10&&r+3<t.length&&t[r+2]===13&&t[r+3]===10)return r+4}return-1}class gP{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,s]=yP(e,":");return s.startsWith(" ")&&(s=s.substring(1)),n==="event"?this.event=s:n==="data"&&this.data.push(s),null}}class Wr{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let n=this.decodeText(e);if(this.trailingCR&&(n="\r"+n,this.trailingCR=!1),n.endsWith("\r")&&(this.trailingCR=!0,n=n.slice(0,-1)),!n)return[];const r=Wr.NEWLINE_CHARS.has(n[n.length-1]||"");let s=n.split(Wr.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new q(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new q(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new q("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}Wr.NEWLINE_CHARS=new Set([`
`,"\r"]);Wr.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function yP(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}function Ww(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Zw=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function",Gw=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&Mh(t),Mh=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",vP=t=>Gw(t)||Zw(t)||qw(t);async function Yw(t,e,n){var s;if(t=await t,n??(n=Gw(t)?{lastModified:t.lastModified,type:t.type}:{}),Zw(t)){const i=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new of([i],e,n)}const r=await wP(t);if(e||(e=bP(t)??"unknown_file"),!n.type){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(n={...n,type:i})}return new of(r,e,n)}async function wP(t){var n;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(Mh(t))e.push(await t.arrayBuffer());else if(EP(t))for await(const r of t)e.push(r);else throw new Error(`Unexpected data type: ${typeof t}; constructor: ${(n=t==null?void 0:t.constructor)==null?void 0:n.name}; props: ${_P(t)}`);return e}function _P(t){return`[${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}function bP(t){var e;return Bc(t.name)||Bc(t.filename)||((e=Bc(t.path))==null?void 0:e.split(/[\\/]/).pop())}const Bc=t=>{if(typeof t=="string")return t;if(typeof Buffer<"u"&&t instanceof Buffer)return String(t)},EP=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",ag=t=>t&&typeof t=="object"&&t.body&&t[Symbol.toStringTag]==="MultipartBody",ka=async t=>{const e=await kP(t.body);return Vw(e,t)},kP=async t=>{const e=new Uw;return await Promise.all(Object.entries(t||{}).map(([n,r])=>lf(e,n,r))),e},lf=async(t,e,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")t.append(e,String(n));else if(vP(n)){const r=await Yw(n);t.append(e,r)}else if(Array.isArray(n))await Promise.all(n.map(r=>lf(t,e+"[]",r)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([r,s])=>lf(t,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}};var Is={},SP=function(t,e,n,r,s){if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n},xP=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},ho;async function Qw(t){const{response:e}=t;if(t.options.stream)return Ns("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller):fn.fromSSEResponse(e,t.controller);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const n=e.headers.get("content-type");if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.includes("application/vnd.api+json"))){const i=await e.json();return Ns("response",e.status,e.url,e.headers,i),i}const s=await e.text();return Ns("response",e.status,e.url,e.headers,s),s}class qu extends Promise{constructor(e,n=Qw){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=n}_thenUnwrap(e){return new qu(this.responsePromise,async n=>e(await this.parseResponse(n)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class PP{constructor({baseURL:e,maxRetries:n=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Hc("maxRetries",n),this.timeout=Hc("timeout",r),this.httpAgent=s,this.fetch=i??Fw}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...IP(),...this.authHeaders(e)}}validateHeaders(e,n){}defaultIdempotencyKey(){return`stainless-node-retry-${LP()}`}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&Mh(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:n,...s,body:i}}))}getAPIList(e,n,r){return this.requestAPIList(n,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e){var p;const{method:n,path:r,query:s,headers:i={}}=e,a=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:ag(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,o=this.calculateContentLength(a),l=this.buildURL(r,s);"timeout"in e&&Hc("timeout",e.timeout);const u=e.timeout??this.timeout,c=e.httpAgent??this.httpAgent??Bw(l),d=u+1e3;typeof((p=c==null?void 0:c.options)==null?void 0:p.timeout)=="number"&&d>(c.options.timeout??0)&&(c.options.timeout=d),this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const f=this.buildHeaders({options:e,headers:i,contentLength:o});return{req:{method:n,...a&&{body:a},headers:f,...c&&{agent:c},signal:e.signal??null},url:l,timeout:u}}buildHeaders({options:e,headers:n,contentLength:r}){const s={};r&&(s["content-length"]=r);const i=this.defaultHeaders(e);return cg(s,i),cg(s,n),ag(e.body)&&Ui!=="node"&&delete s["content-type"],this.validateHeaders(s,n),s}async prepareOptions(e){}async prepareRequest(e,{url:n,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(n=>[...n])):{...e}:{}}makeStatusError(e,n,r,s){return Ke.generate(e,n,r,s)}request(e,n=null){return new qu(this.makeRequest(e,n))}async makeRequest(e,n){var c,d;const r=await e;n==null&&(n=r.maxRetries??this.maxRetries),await this.prepareOptions(r);const{req:s,url:i,timeout:a}=this.buildRequest(r);if(await this.prepareRequest(s,{url:i,options:r}),Ns("request",i,r,s.headers),(c=r.signal)!=null&&c.aborted)throw new st;const o=new AbortController,l=await this.fetchWithTimeout(i,s,a,o).catch(uf);if(l instanceof Error){if((d=r.signal)!=null&&d.aborted)throw new st;if(n)return this.retryRequest(r,n);throw l.name==="AbortError"?new Wu:new Da({cause:l})}const u=TP(l.headers);if(!l.ok){if(n&&this.shouldRetry(l)){const m=`retrying, ${n} attempts remaining`;return Ns(`response (error; ${m})`,l.status,i,u),this.retryRequest(r,n,u)}const f=await l.text().catch(m=>uf(m).message),g=NP(f),p=g?void 0:f;throw Ns(`response (error; ${n?"(error; no more retries left)":"(error; not retryable)"})`,l.status,i,u,p),this.makeStatusError(l.status,g,p,u)}return{response:l,options:r,controller:o}}requestAPIList(e,n){const r=this.makeRequest(n,null);return new OP(this,r,e)}buildURL(e,n){const r=$P(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Jw(s)||(n={...s,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(r.search=this.stringifyQuery(n)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new q(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,n,r,s){const{signal:i,...a}=n||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...a}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(n,o)}return await Ma(s),this.makeRequest(e,n-1)}calculateDefaultRetryTimeoutMillis(e,n){const i=n-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${rs}`}}class Kw{constructor(e,n,r,s){ho.set(this,void 0),SP(this,ho,e),this.options=s,this.response=n,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new q("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const n={...this.options};if("params"in e&&typeof n.query=="object")n.query={...n.query,...e.params};else if("url"in e){const r=[...Object.entries(n.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);n.query=void 0,n.path=e.url.toString()}return await xP(this,ho,"f").requestAPIList(this.constructor,n)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(ho=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const n of e.getPaginatedItems())yield n}}class OP extends qu{constructor(e,n,r){super(n,async s=>new r(e,s.response,await Qw(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const n of e)yield n}}const TP=t=>new Proxy(Object.fromEntries(t.entries()),{get(e,n){const r=n.toString();return e[r.toLowerCase()]||e[r]}}),AP={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},wt=t=>typeof t=="object"&&t!==null&&!Jw(t)&&Object.keys(t).every(e=>Xw(AP,e)),CP=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rs,"X-Stainless-OS":lg(Deno.build.os),"X-Stainless-Arch":og(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rs,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rs,"X-Stainless-OS":lg(process.platform),"X-Stainless-Arch":og(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const t=RP();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rs,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rs,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function RP(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const r=n.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const og=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",lg=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let ug;const IP=()=>ug??(ug=CP()),NP=t=>{try{return JSON.parse(t)}catch{return}},jP=new RegExp("^(?:[a-z]+:)?//","i"),$P=t=>jP.test(t),Ma=t=>new Promise(e=>setTimeout(e,t)),Hc=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new q(`${t} must be an integer`);if(e<0)throw new q(`${t} must be a positive integer`);return e},uf=t=>t instanceof Error?t:new Error(t),po=t=>{var e,n,r,s;if(typeof process<"u")return((e=Is==null?void 0:Is[t])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(r=(n=Deno.env)==null?void 0:n.get)==null?void 0:r.call(n,t))==null?void 0:s.trim()};function Jw(t){if(!t)return!0;for(const e in t)return!1;return!0}function Xw(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function cg(t,e){for(const n in e){if(!Xw(e,n))continue;const r=n.toLowerCase();if(!r)continue;const s=e[n];s===null?delete t[r]:s!==void 0&&(t[r]=s)}}function Ns(t,...e){typeof process<"u"&&(Is==null?void 0:Is.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${t}`,...e)}const LP=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)}),MP=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function dg(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}let q=class extends Error{},Ke=class cf extends q{constructor(e,n,r,s){super(`${cf.makeMessage(e,n,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"];const i=n;this.error=i,this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,n,r){const s=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,n,r,s){if(!e)return new Da({cause:uf(n)});const i=n==null?void 0:n.error;return e===400?new Dh(e,i,r,s):e===401?new Fh(e,i,r,s):e===403?new Uh(e,i,r,s):e===404?new zh(e,i,r,s):e===409?new Vh(e,i,r,s):e===422?new Bh(e,i,r,s):e===429?new Hh(e,i,r,s):e>=500?new qh(e,i,r,s):new cf(e,i,r,s)}},st=class extends Ke{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},Da=class extends Ke{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,n&&(this.cause=n)}},Wu=class extends Da{constructor({message:e}={}){super({message:e??"Request timed out."})}},Dh=class extends Ke{constructor(){super(...arguments),this.status=400}},Fh=class extends Ke{constructor(){super(...arguments),this.status=401}},Uh=class extends Ke{constructor(){super(...arguments),this.status=403}},zh=class extends Ke{constructor(){super(...arguments),this.status=404}},Vh=class extends Ke{constructor(){super(...arguments),this.status=409}},Bh=class extends Ke{constructor(){super(...arguments),this.status=422}},Hh=class extends Ke{constructor(){super(...arguments),this.status=429}},qh=class extends Ke{};const DP=Object.freeze(Object.defineProperty({__proto__:null,APIConnectionError:Da,APIConnectionTimeoutError:Wu,APIError:Ke,APIUserAbortError:st,AuthenticationError:Fh,BadRequestError:Dh,ConflictError:Vh,InternalServerError:qh,NotFoundError:zh,OpenAIError:q,PermissionDeniedError:Uh,RateLimitError:Hh,UnprocessableEntityError:Bh},Symbol.toStringTag,{value:"Module"}));class Wh extends Kw{constructor(e,n,r,s){super(e,n,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class tn extends Kw{constructor(e,n,r,s){super(e,n,r,s),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const n=Object.fromEntries(e.url.searchParams);return Object.keys(n).length?n:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const n=(r=e[e.length-1])==null?void 0:r.id;return n?{params:{after:n}}:null}}class J{constructor(e){this._client=e}}let jl=class extends J{create(e,n){return this._client.post("/chat/completions",{body:e,...n,stream:e.stream??!1})}};jl||(jl={});let $l=class extends J{constructor(){super(...arguments),this.completions=new jl(this._client)}};(function(t){t.Completions=jl})($l||($l={}));class Ll extends J{create(e,n){return this._client.post("/audio/speech",{body:e,...n,__binaryResponse:!0})}}Ll||(Ll={});class Ml extends J{create(e,n){return this._client.post("/audio/transcriptions",ka({body:e,...n}))}}Ml||(Ml={});class Dl extends J{create(e,n){return this._client.post("/audio/translations",ka({body:e,...n}))}}Dl||(Dl={});class Fl extends J{constructor(){super(...arguments),this.transcriptions=new Ml(this._client),this.translations=new Dl(this._client),this.speech=new Ll(this._client)}}(function(t){t.Transcriptions=Ml,t.Translations=Dl,t.Speech=Ll})(Fl||(Fl={}));class Ul extends J{create(e,n){return this._client.post("/batches",{body:e,...n})}retrieve(e,n){return this._client.get(`/batches/${e}`,n)}list(e={},n){return wt(e)?this.list({},e):this._client.getAPIList("/batches",Zh,{query:e,...n})}cancel(e,n){return this._client.post(`/batches/${e}/cancel`,n)}}class Zh extends tn{}(function(t){t.BatchesPage=Zh})(Ul||(Ul={}));class zl extends J{create(e,n){return this._client.post("/assistants",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,r){return this._client.post(`/assistants/${e}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},n){return wt(e)?this.list({},e):this._client.getAPIList("/assistants",Gh,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/assistants/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Gh extends tn{}(function(t){t.AssistantsPage=Gh})(zl||(zl={}));function fg(t){return typeof t.parse=="function"}const js=t=>(t==null?void 0:t.role)==="assistant",e_=t=>(t==null?void 0:t.role)==="function",t_=t=>(t==null?void 0:t.role)==="tool";var Mt=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},B=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},De,Io,No,vi,wi,jo,_i,Sn,bi,$o,Lo,ss,df,Vl,ff,hf,pf,mf,n_,gf;const hg=10;class r_{constructor(){De.add(this),this.controller=new AbortController,Io.set(this,void 0),No.set(this,()=>{}),vi.set(this,()=>{}),wi.set(this,void 0),jo.set(this,()=>{}),_i.set(this,()=>{}),Sn.set(this,{}),this._chatCompletions=[],this.messages=[],bi.set(this,!1),$o.set(this,!1),Lo.set(this,!1),ss.set(this,!1),mf.set(this,e=>{if(Mt(this,$o,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new st),e instanceof st)return Mt(this,Lo,!0,"f"),this._emit("abort",e);if(e instanceof q)return this._emit("error",e);if(e instanceof Error){const n=new q(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new q(String(e)))}),Mt(this,Io,new Promise((e,n)=>{Mt(this,No,e,"f"),Mt(this,vi,n,"f")}),"f"),Mt(this,wi,new Promise((e,n)=>{Mt(this,jo,e,"f"),Mt(this,_i,n,"f")}),"f"),B(this,Io,"f").catch(()=>{}),B(this,wi,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},B(this,mf,"f"))},0)}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const n=(r=e.choices[0])==null?void 0:r.message;return n&&this._addMessage(n),e}_addMessage(e,n=!0){if("content"in e||(e.content=null),this.messages.push(e),n){if(this._emit("message",e),(e_(e)||t_(e))&&e.content)this._emit("functionCallResult",e.content);else if(js(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(js(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}_connected(){this.ended||(B(this,No,"f").call(this),this._emit("connect"))}get ended(){return B(this,bi,"f")}get errored(){return B(this,$o,"f")}get aborted(){return B(this,Lo,"f")}abort(){this.controller.abort()}on(e,n){return(B(this,Sn,"f")[e]||(B(this,Sn,"f")[e]=[])).push({listener:n}),this}off(e,n){const r=B(this,Sn,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===n);return s>=0&&r.splice(s,1),this}once(e,n){return(B(this,Sn,"f")[e]||(B(this,Sn,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,r)=>{Mt(this,ss,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,n)})}async done(){Mt(this,ss,!0,"f"),await B(this,wi,"f")}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new q("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),B(this,De,"m",df).call(this)}async finalMessage(){return await this.done(),B(this,De,"m",Vl).call(this)}async finalFunctionCall(){return await this.done(),B(this,De,"m",ff).call(this)}async finalFunctionCallResult(){return await this.done(),B(this,De,"m",hf).call(this)}async totalUsage(){return await this.done(),B(this,De,"m",pf).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...n){if(B(this,bi,"f"))return;e==="end"&&(Mt(this,bi,!0,"f"),B(this,jo,"f").call(this));const r=B(this,Sn,"f")[e];if(r&&(B(this,Sn,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...n))),e==="abort"){const s=n[0];!B(this,ss,"f")&&!(r!=null&&r.length)&&Promise.reject(s),B(this,vi,"f").call(this,s),B(this,_i,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=n[0];!B(this,ss,"f")&&!(r!=null&&r.length)&&Promise.reject(s),B(this,vi,"f").call(this,s),B(this,_i,"f").call(this,s),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const n=B(this,De,"m",Vl).call(this);n&&this._emit("finalMessage",n);const r=B(this,De,"m",df).call(this);r&&this._emit("finalContent",r);const s=B(this,De,"m",ff).call(this);s&&this._emit("finalFunctionCall",s);const i=B(this,De,"m",hf).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",B(this,De,"m",pf).call(this))}async _createChatCompletion(e,n,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),B(this,De,"m",n_).call(this,n);const i=await e.create({...n,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(i)}async _runChatCompletion(e,n,r){for(const s of n.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,n,r)}async _runFunctions(e,n,r){var f;const s="function",{function_call:i="auto",stream:a,...o}=n,l=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:u=hg}=r||{},c={};for(const g of n.functions)c[g.name||g.function.name]=g;const d=n.functions.map(g=>({name:g.name||g.function.name,parameters:g.parameters,description:g.description}));for(const g of n.messages)this._addMessage(g,!1);for(let g=0;g<u;++g){const v=(f=(await this._createChatCompletion(e,{...o,function_call:i,functions:d,messages:[...this.messages]},r)).choices[0])==null?void 0:f.message;if(!v)throw new q("missing message in ChatCompletion response");if(!v.function_call)return;const{name:w,arguments:m}=v.function_call,h=c[w];if(h){if(l&&l!==w){const E=`Invalid function_call: ${JSON.stringify(w)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:w,content:E});continue}}else{const E=`Invalid function_call: ${JSON.stringify(w)}. Available options are: ${d.map(k=>JSON.stringify(k.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:w,content:E});continue}let y;try{y=fg(h)?await h.parse(m):m}catch(E){this._addMessage({role:s,name:w,content:E instanceof Error?E.message:String(E)});continue}const _=await h.function(y,this),b=B(this,De,"m",gf).call(this,_);if(this._addMessage({role:s,name:w,content:b}),l)return}}async _runTools(e,n,r){var f,g;const s="tool",{tool_choice:i="auto",stream:a,...o}=n,l=typeof i!="string"&&((f=i==null?void 0:i.function)==null?void 0:f.name),{maxChatCompletions:u=hg}=r||{},c={};for(const p of n.tools)p.type==="function"&&(c[p.function.name||p.function.function.name]=p.function);const d="tools"in n?n.tools.map(p=>p.type==="function"?{type:"function",function:{name:p.function.name||p.function.function.name,parameters:p.function.parameters,description:p.function.description}}:p):void 0;for(const p of n.messages)this._addMessage(p,!1);for(let p=0;p<u;++p){const w=(g=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:d,messages:[...this.messages]},r)).choices[0])==null?void 0:g.message;if(!w)throw new q("missing message in ChatCompletion response");if(!w.tool_calls)return;for(const m of w.tool_calls){if(m.type!=="function")continue;const h=m.id,{name:y,arguments:_}=m.function,b=c[y];if(b){if(l&&l!==y){const $=`Invalid tool_call: ${JSON.stringify(y)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:h,content:$});continue}}else{const $=`Invalid tool_call: ${JSON.stringify(y)}. Available options are: ${d.map(M=>JSON.stringify(M.function.name)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:h,content:$});continue}let E;try{E=fg(b)?await b.parse(_):_}catch($){const M=$ instanceof Error?$.message:String($);this._addMessage({role:s,tool_call_id:h,content:M});continue}const k=await b.function(E,this),O=B(this,De,"m",gf).call(this,k);if(this._addMessage({role:s,tool_call_id:h,content:O}),l)return}}}}Io=new WeakMap,No=new WeakMap,vi=new WeakMap,wi=new WeakMap,jo=new WeakMap,_i=new WeakMap,Sn=new WeakMap,bi=new WeakMap,$o=new WeakMap,Lo=new WeakMap,ss=new WeakMap,mf=new WeakMap,De=new WeakSet,df=function(){return B(this,De,"m",Vl).call(this).content??null},Vl=function(){let e=this.messages.length;for(;e-- >0;){const n=this.messages[e];if(js(n)){const{function_call:r,...s}=n,i={...s,content:n.content??null};return r&&(i.function_call=r),i}}throw new q("stream ended without producing a ChatCompletionMessage with role=assistant")},ff=function(){var e,n;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(js(s)&&(s!=null&&s.function_call))return s.function_call;if(js(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(n=s.tool_calls.at(-1))==null?void 0:n.function}},hf=function(){for(let e=this.messages.length-1;e>=0;e--){const n=this.messages[e];if(e_(n)&&n.content!=null||t_(n)&&n.content!=null&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===n.tool_call_id))}))return n.content}},pf=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:n}of this._chatCompletions)n&&(e.completion_tokens+=n.completion_tokens,e.prompt_tokens+=n.prompt_tokens,e.total_tokens+=n.total_tokens);return e},n_=function(e){if(e.n!=null&&e.n>1)throw new q("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},gf=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Sa extends r_{static runFunctions(e,n,r){const s=new Sa,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,n,i)),s}static runTools(e,n,r){const s=new Sa,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,n,i)),s}_addMessage(e){super._addMessage(e),js(e)&&e.content&&this._emit("content",e.content)}}var Dt=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},qc=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},rn,Bn,Wc,Zc,mo,pg;class xa extends r_{constructor(){super(...arguments),rn.add(this),Bn.set(this,void 0)}get currentChatCompletionSnapshot(){return Dt(this,Bn,"f")}static fromReadableStream(e){const n=new xa;return n._run(()=>n._fromReadableStream(e)),n}static createChatCompletion(e,n,r){const s=new xa;return s._run(()=>s._runChatCompletion(e,{...n,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,n,r){var a;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Dt(this,rn,"m",Wc).call(this);const i=await e.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)Dt(this,rn,"m",Zc).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new st;return this._addChatCompletion(Dt(this,rn,"m",mo).call(this))}async _fromReadableStream(e,n){var a;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Dt(this,rn,"m",Wc).call(this),this._connected();const s=fn.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(Dt(this,rn,"m",mo).call(this)),Dt(this,rn,"m",Zc).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new st;return this._addChatCompletion(Dt(this,rn,"m",mo).call(this))}[(Bn=new WeakMap,rn=new WeakSet,Wc=function(){this.ended||qc(this,Bn,void 0,"f")},Zc=function(n){var a,o,l;if(this.ended)return;const r=Dt(this,rn,"m",pg).call(this,n);this._emit("chunk",n,r);const s=(o=(a=n.choices[0])==null?void 0:a.delta)==null?void 0:o.content,i=(l=r.choices[0])==null?void 0:l.message;s!=null&&(i==null?void 0:i.role)==="assistant"&&(i!=null&&i.content)&&this._emit("content",s,i.content)},mo=function(){if(this.ended)throw new q("stream has ended, this shouldn't happen");const n=Dt(this,Bn,"f");if(!n)throw new q("request ended without sending any chunks");return qc(this,Bn,void 0,"f"),FP(n)},pg=function(n){var r,s,i;let a=Dt(this,Bn,"f");const{choices:o,...l}=n;a?Object.assign(a,l):a=qc(this,Bn,{...l,choices:[]},"f");for(const{delta:u,finish_reason:c,index:d,logprobs:f=null,...g}of n.choices){let p=a.choices[d];if(p||(p=a.choices[d]={finish_reason:c,index:d,message:{},logprobs:f,...g}),f)if(!p.logprobs)p.logprobs=Object.assign({},f);else{const{content:_,...b}=f;Object.assign(p.logprobs,b),_&&((r=p.logprobs).content??(r.content=[]),p.logprobs.content.push(..._))}if(c&&(p.finish_reason=c),Object.assign(p,g),!u)continue;const{content:v,function_call:w,role:m,tool_calls:h,...y}=u;if(Object.assign(p.message,y),v&&(p.message.content=(p.message.content||"")+v),m&&(p.message.role=m),w&&(p.message.function_call?(w.name&&(p.message.function_call.name=w.name),w.arguments&&((s=p.message.function_call).arguments??(s.arguments=""),p.message.function_call.arguments+=w.arguments)):p.message.function_call=w),h){p.message.tool_calls||(p.message.tool_calls=[]);for(const{index:_,id:b,type:E,function:k,...O}of h){const $=(i=p.message.tool_calls)[_]??(i[_]={});Object.assign($,O),b&&($.id=b),E&&($.type=E),k&&($.function??($.function={arguments:""})),k!=null&&k.name&&($.function.name=k.name),k!=null&&k.arguments&&($.function.arguments+=k.arguments)}}}return a},Symbol.asyncIterator)](){const e=[],n=[];let r=!1;return this.on("chunk",s=>{const i=n.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const i of n)i.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const i of n)i.reject(s);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>n.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new fn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function FP(t){const{id:e,choices:n,created:r,model:s,system_fingerprint:i,...a}=t;return{...a,id:e,choices:n.map(({message:o,finish_reason:l,index:u,logprobs:c,...d})=>{if(!l)throw new q(`missing finish_reason for choice ${u}`);const{content:f=null,function_call:g,tool_calls:p,...v}=o,w=o.role;if(!w)throw new q(`missing role for choice ${u}`);if(g){const{arguments:m,name:h}=g;if(m==null)throw new q(`missing function_call.arguments for choice ${u}`);if(!h)throw new q(`missing function_call.name for choice ${u}`);return{...d,message:{content:f,function_call:{arguments:m,name:h},role:w},finish_reason:l,index:u,logprobs:c}}return p?{...d,index:u,finish_reason:l,logprobs:c,message:{...v,role:w,content:f,tool_calls:p.map((m,h)=>{const{function:y,type:_,id:b,...E}=m,{arguments:k,name:O,...$}=y||{};if(b==null)throw new q(`missing choices[${u}].tool_calls[${h}].id
${go(t)}`);if(_==null)throw new q(`missing choices[${u}].tool_calls[${h}].type
${go(t)}`);if(O==null)throw new q(`missing choices[${u}].tool_calls[${h}].function.name
${go(t)}`);if(k==null)throw new q(`missing choices[${u}].tool_calls[${h}].function.arguments
${go(t)}`);return{...E,id:b,type:_,function:{...$,name:O,arguments:k}}})}}:{...d,message:{...v,content:f,role:w},finish_reason:l,index:u,logprobs:c}}),created:r,model:s,object:"chat.completion",...i?{system_fingerprint:i}:{}}}function go(t){return JSON.stringify(t)}class $s extends xa{static fromReadableStream(e){const n=new $s;return n._run(()=>n._fromReadableStream(e)),n}static runFunctions(e,n,r){const s=new $s,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,n,i)),s}static runTools(e,n,r){const s=new $s,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,n,i)),s}}let s_=class extends J{runFunctions(e,n){return e.stream?$s.runFunctions(this._client.chat.completions,e,n):Sa.runFunctions(this._client.chat.completions,e,n)}runTools(e,n){return e.stream?$s.runTools(this._client.chat.completions,e,n):Sa.runTools(this._client.chat.completions,e,n)}stream(e,n){return xa.createChatCompletion(this._client.chat.completions,e,n)}};class Bl extends J{constructor(){super(...arguments),this.completions=new s_(this._client)}}(function(t){t.Completions=s_})(Bl||(Bl={}));var Ft=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},se=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},Mo,Do,Ei,ki,Fo,Si,xn,xi,Uo,zo,is,yf;class UP{constructor(){this.controller=new AbortController,Mo.set(this,void 0),Do.set(this,()=>{}),Ei.set(this,()=>{}),ki.set(this,void 0),Fo.set(this,()=>{}),Si.set(this,()=>{}),xn.set(this,{}),xi.set(this,!1),Uo.set(this,!1),zo.set(this,!1),is.set(this,!1),yf.set(this,e=>{if(Ft(this,Uo,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new st),e instanceof st)return Ft(this,zo,!0,"f"),this._emit("abort",e);if(e instanceof q)return this._emit("error",e);if(e instanceof Error){const n=new q(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new q(String(e)))}),Ft(this,Mo,new Promise((e,n)=>{Ft(this,Do,e,"f"),Ft(this,Ei,n,"f")}),"f"),Ft(this,ki,new Promise((e,n)=>{Ft(this,Fo,e,"f"),Ft(this,Si,n,"f")}),"f"),se(this,Mo,"f").catch(()=>{}),se(this,ki,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emit("end")},se(this,yf,"f"))},0)}_addRun(e){return e}_connected(){this.ended||(se(this,Do,"f").call(this),this._emit("connect"))}get ended(){return se(this,xi,"f")}get errored(){return se(this,Uo,"f")}get aborted(){return se(this,zo,"f")}abort(){this.controller.abort()}on(e,n){return(se(this,xn,"f")[e]||(se(this,xn,"f")[e]=[])).push({listener:n}),this}off(e,n){const r=se(this,xn,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===n);return s>=0&&r.splice(s,1),this}once(e,n){return(se(this,xn,"f")[e]||(se(this,xn,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,r)=>{Ft(this,is,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,n)})}async done(){Ft(this,is,!0,"f"),await se(this,ki,"f")}_emit(e,...n){if(se(this,xi,"f"))return;e==="end"&&(Ft(this,xi,!0,"f"),se(this,Fo,"f").call(this));const r=se(this,xn,"f")[e];if(r&&(se(this,xn,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...n))),e==="abort"){const s=n[0];!se(this,is,"f")&&!(r!=null&&r.length)&&Promise.reject(s),se(this,Ei,"f").call(this,s),se(this,Si,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=n[0];!se(this,is,"f")&&!(r!=null&&r.length)&&Promise.reject(s),se(this,Ei,"f").call(this,s),se(this,Si,"f").call(this,s),this._emit("end")}}async _threadAssistantStream(e,n,r){return await this._createThreadAssistantStream(n,e,r)}async _runAssistantStream(e,n,r,s){return await this._createAssistantStream(n,e,r,s)}async _runToolAssistantStream(e,n,r,s,i){return await this._createToolAssistantStream(r,e,n,s,i)}async _createThreadAssistantStream(e,n,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i=await e.createAndRun({...n,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addRun(i)}async _createToolAssistantStream(e,n,r,s,i){const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o=await e.submitToolOutputs(n,r,{...s,stream:!1},{...i,signal:this.controller.signal});return this._connected(),this._addRun(o)}async _createAssistantStream(e,n,r,s){const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a=await e.create(n,{...r,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addRun(a)}}Mo=new WeakMap,Do=new WeakMap,Ei=new WeakMap,ki=new WeakMap,Fo=new WeakMap,Si=new WeakMap,xn=new WeakMap,xi=new WeakMap,Uo=new WeakMap,zo=new WeakMap,is=new WeakMap,yf=new WeakMap;var j=function(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)},dt=function(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n},Ie,vf,an,Vo,zt,Ir,bs,Tr,Hl,ft,Bo,Ho,zi,Pi,Oi,mg,gg,yg,vg,wg,_g,bg;class Zt extends UP{constructor(){super(...arguments),Ie.add(this),vf.set(this,[]),an.set(this,{}),Vo.set(this,{}),zt.set(this,void 0),Ir.set(this,void 0),bs.set(this,void 0),Tr.set(this,void 0),Hl.set(this,void 0),ft.set(this,void 0),Bo.set(this,void 0),Ho.set(this,void 0),zi.set(this,void 0)}[(vf=new WeakMap,an=new WeakMap,Vo=new WeakMap,zt=new WeakMap,Ir=new WeakMap,bs=new WeakMap,Tr=new WeakMap,Hl=new WeakMap,ft=new WeakMap,Bo=new WeakMap,Ho=new WeakMap,zi=new WeakMap,Ie=new WeakSet,Symbol.asyncIterator)](){const e=[],n=[];let r=!1;return this.on("event",s=>{const i=n.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const i of n)i.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const i of n)i.reject(s);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>n.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const n=new Zt;return n._run(()=>n._fromReadableStream(e)),n}async _fromReadableStream(e,n){var i;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=fn.fromReadableStream(e,this.controller);for await(const a of s)j(this,Ie,"m",Pi).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new st;return this._addRun(j(this,Ie,"m",Oi).call(this))}toReadableStream(){return new fn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,n,r,s,i){const a=new Zt;return a._run(()=>a._runToolAssistantStream(e,n,r,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,n,r,s,i){var u;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},l=await e.submitToolOutputs(n,r,o,{...i,signal:this.controller.signal});this._connected();for await(const c of l)j(this,Ie,"m",Pi).call(this,c);if((u=l.controller.signal)!=null&&u.aborted)throw new st;return this._addRun(j(this,Ie,"m",Oi).call(this))}static createThreadAssistantStream(e,n,r){const s=new Zt;return s._run(()=>s._threadAssistantStream(e,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,n,r,s){const i=new Zt;return i._run(()=>i._runAssistantStream(e,n,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return j(this,Bo,"f")}currentRun(){return j(this,Ho,"f")}currentMessageSnapshot(){return j(this,zt,"f")}currentRunStepSnapshot(){return j(this,zi,"f")}async finalRunSteps(){return await this.done(),Object.values(j(this,an,"f"))}async finalMessages(){return await this.done(),Object.values(j(this,Vo,"f"))}async finalRun(){if(await this.done(),!j(this,Ir,"f"))throw Error("Final run was not received.");return j(this,Ir,"f")}async _createThreadAssistantStream(e,n,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},a=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const l of a)j(this,Ie,"m",Pi).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new st;return this._addRun(j(this,Ie,"m",Oi).call(this))}async _createAssistantStream(e,n,r,s){var l;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.create(n,a,{...s,signal:this.controller.signal});this._connected();for await(const u of o)j(this,Ie,"m",Pi).call(this,u);if((l=o.controller.signal)!=null&&l.aborted)throw new st;return this._addRun(j(this,Ie,"m",Oi).call(this))}static accumulateDelta(e,n){for(const[r,s]of Object.entries(n)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(dg(i)&&dg(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}}Pi=function(e){if(!this.ended)switch(dt(this,Bo,e,"f"),j(this,Ie,"m",yg).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":j(this,Ie,"m",bg).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":j(this,Ie,"m",gg).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":j(this,Ie,"m",mg).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Oi=function(){if(this.ended)throw new q("stream has ended, this shouldn't happen");if(!j(this,Ir,"f"))throw Error("Final run has not been received");return j(this,Ir,"f")},mg=function(e){const[n,r]=j(this,Ie,"m",wg).call(this,e,j(this,zt,"f"));dt(this,zt,n,"f"),j(this,Vo,"f")[n.id]=n;for(const s of r){const i=n.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,n),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=n.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=j(this,bs,"f")){if(j(this,Tr,"f"))switch(j(this,Tr,"f").type){case"text":this._emit("textDone",j(this,Tr,"f").text,j(this,zt,"f"));break;case"image_file":this._emit("imageFileDone",j(this,Tr,"f").image_file,j(this,zt,"f"));break}dt(this,bs,s.index,"f")}dt(this,Tr,n.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(j(this,bs,"f")!==void 0){const s=e.data.content[j(this,bs,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,j(this,zt,"f"));break;case"text":this._emit("textDone",s.text,j(this,zt,"f"));break}}j(this,zt,"f")&&this._emit("messageDone",e.data),dt(this,zt,void 0,"f")}},gg=function(e){const n=j(this,Ie,"m",vg).call(this,e);switch(dt(this,zi,n,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&n.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==j(this,Hl,"f")?this._emit("toolCallDelta",i,n.step_details.tool_calls[i.index]):(j(this,ft,"f")&&this._emit("toolCallDone",j(this,ft,"f")),dt(this,Hl,i.index,"f"),dt(this,ft,n.step_details.tool_calls[i.index],"f"),j(this,ft,"f")&&this._emit("toolCallCreated",j(this,ft,"f")));this._emit("runStepDelta",e.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":dt(this,zi,void 0,"f"),e.data.step_details.type=="tool_calls"&&j(this,ft,"f")&&(this._emit("toolCallDone",j(this,ft,"f")),dt(this,ft,void 0,"f")),this._emit("runStepDone",e.data,n);break}},yg=function(e){j(this,vf,"f").push(e),this._emit("event",e)},vg=function(e){switch(e.event){case"thread.run.step.created":return j(this,an,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let n=j(this,an,"f")[e.data.id];if(!n)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=Zt.accumulateDelta(n,r.delta);j(this,an,"f")[e.data.id]=s}return j(this,an,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":j(this,an,"f")[e.data.id]=e.data;break}if(j(this,an,"f")[e.data.id])return j(this,an,"f")[e.data.id];throw new Error("No snapshot available")},wg=function(e,n){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in n.content){let a=n.content[i.index];n.content[i.index]=j(this,Ie,"m",_g).call(this,i,a)}else n.content[i.index]=i,r.push(i);return[n,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},_g=function(e,n){return Zt.accumulateDelta(n,e)},bg=function(e){switch(dt(this,Ho,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":dt(this,Ir,e.data,"f"),j(this,ft,"f")&&(this._emit("toolCallDone",j(this,ft,"f")),dt(this,ft,void 0,"f"));break}};class ql extends J{create(e,n,r){return this._client.post(`/threads/${e}/messages`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,n,r){return this._client.get(`/threads/${e}/messages/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,n,r,s){return this._client.post(`/threads/${e}/messages/${n}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,n={},r){return wt(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/messages`,Yh,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,n,r){return this._client.delete(`/threads/${e}/messages/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class Yh extends tn{}(function(t){t.MessagesPage=Yh})(ql||(ql={}));class Wl extends J{retrieve(e,n,r,s){return this._client.get(`/threads/${e}/runs/${n}/steps/${r}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,n,r={},s){return wt(r)?this.list(e,n,{},r):this._client.getAPIList(`/threads/${e}/runs/${n}/steps`,Qh,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class Qh extends tn{}(function(t){t.RunStepsPage=Qh})(Wl||(Wl={}));class Zl extends J{constructor(){super(...arguments),this.steps=new Wl(this._client)}create(e,n,r){return this._client.post(`/threads/${e}/runs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:n.stream??!1})}retrieve(e,n,r){return this._client.get(`/threads/${e}/runs/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,n,r,s){return this._client.post(`/threads/${e}/runs/${n}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,n={},r){return wt(n)?this.list(e,{},n):this._client.getAPIList(`/threads/${e}/runs`,Kh,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,n,r){return this._client.post(`/threads/${e}/runs/${n}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,n,r){const s=await this.create(e,n,r);return await this.poll(e,s.id,r)}createAndStream(e,n,r){return Zt.createAssistantStream(e,this._client.beta.threads.runs,n,r)}async poll(e,n,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,n,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Ma(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,n,r){return Zt.createAssistantStream(e,this._client.beta.threads.runs,n,r)}submitToolOutputs(e,n,r,s){return this._client.post(`/threads/${e}/runs/${n}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,n,r,s){const i=await this.submitToolOutputs(e,n,r,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,n,r,s){return Zt.createToolAssistantStream(e,n,this._client.beta.threads.runs,r,s)}}class Kh extends tn{}(function(t){t.RunsPage=Kh,t.Steps=Wl,t.RunStepsPage=Qh})(Zl||(Zl={}));class Gl extends J{constructor(){super(...arguments),this.runs=new Zl(this._client),this.messages=new ql(this._client)}create(e={},n){return wt(e)?this.create({},e):this._client.post("/threads",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,r){return this._client.post(`/threads/${e}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,n){return this._client.delete(`/threads/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}createAndRun(e,n){return this._client.post("/threads/runs",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:e.stream??!1})}async createAndRunPoll(e,n){const r=await this.createAndRun(e,n);return await this.runs.poll(r.thread_id,r.id,n)}createAndRunStream(e,n){return Zt.createThreadAssistantStream(e,this._client.beta.threads,n)}}(function(t){t.Runs=Zl,t.RunsPage=Kh,t.Messages=ql,t.MessagesPage=Yh})(Gl||(Gl={}));const zP=async t=>{const e=await Promise.allSettled(t),n=e.filter(s=>s.status==="rejected");if(n.length){for(const s of n)console.error(s.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};let Yl=class extends J{create(e,n,r){return this._client.post(`/vector_stores/${e}/files`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,n,r){return this._client.get(`/vector_stores/${e}/files/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,n={},r){return wt(n)?this.list(e,{},n):this._client.getAPIList(`/vector_stores/${e}/files`,Zu,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,n,r){return this._client.delete(`/vector_stores/${e}/files/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,n,r){const s=await this.create(e,n,r);return await this.poll(e,s.id,r)}async poll(e,n,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const i=await this.retrieve(e,n,{...r,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=i.response.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Ma(o);break;case"failed":case"completed":return a}}}async upload(e,n,r){const s=await this._client.files.create({file:n,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,n,r){const s=await this.upload(e,n,r);return await this.poll(e,s.id,r)}};class Zu extends tn{}(function(t){t.VectorStoreFilesPage=Zu})(Yl||(Yl={}));class Ql extends J{create(e,n,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,n,r){return this._client.get(`/vector_stores/${e}/file_batches/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,n,r){return this._client.post(`/vector_stores/${e}/file_batches/${n}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,n,r){const s=await this.create(e,n);return await this.poll(e,s.id,r)}listFiles(e,n,r={},s){return wt(r)?this.listFiles(e,n,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${n}/files`,Zu,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,n,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,n,{...r,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Ma(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:n,fileIds:r=[]},s){if(n===null||n.length==0)throw new Error("No files provided to process.");const i=(s==null?void 0:s.maxConcurrency)??5,a=Math.min(i,n.length),o=this._client,l=n.values(),u=[...r];async function c(f){for(let g of f){const p=await o.files.create({file:g,purpose:"assistants"},s);u.push(p.id)}}const d=Array(a).fill(l).map(c);return await zP(d),await this.createAndPoll(e,{file_ids:u})}}Ql||(Ql={});class Kl extends J{constructor(){super(...arguments),this.files=new Yl(this._client),this.fileBatches=new Ql(this._client)}create(e,n){return this._client.post("/vector_stores",{body:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,n){return this._client.get(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,n,r){return this._client.post(`/vector_stores/${e}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},n){return wt(e)?this.list({},e):this._client.getAPIList("/vector_stores",Jh,{query:e,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,n){return this._client.delete(`/vector_stores/${e}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Jh extends tn{}(function(t){t.VectorStoresPage=Jh,t.Files=Yl,t.VectorStoreFilesPage=Zu,t.FileBatches=Ql})(Kl||(Kl={}));class Jl extends J{constructor(){super(...arguments),this.vectorStores=new Kl(this._client),this.chat=new Bl(this._client),this.assistants=new zl(this._client),this.threads=new Gl(this._client)}}(function(t){t.VectorStores=Kl,t.VectorStoresPage=Jh,t.Chat=Bl,t.Assistants=zl,t.AssistantsPage=Gh,t.Threads=Gl})(Jl||(Jl={}));class Xl extends J{create(e,n){return this._client.post("/completions",{body:e,...n,stream:e.stream??!1})}}Xl||(Xl={});class eu extends J{create(e,n){return this._client.post("/embeddings",{body:e,...n})}}eu||(eu={});class tu extends J{create(e,n){return this._client.post("/files",ka({body:e,...n}))}retrieve(e,n){return this._client.get(`/files/${e}`,n)}list(e={},n){return wt(e)?this.list({},e):this._client.getAPIList("/files",Xh,{query:e,...n})}del(e,n){return this._client.delete(`/files/${e}`,n)}content(e,n){return this._client.get(`/files/${e}/content`,{...n,__binaryResponse:!0})}retrieveContent(e,n){return this._client.get(`/files/${e}/content`,{...n,headers:{Accept:"application/json",...n==null?void 0:n.headers}})}async waitForProcessing(e,{pollInterval:n=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await Ma(n),a=await this.retrieve(e),Date.now()-i>r)throw new Wu({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class Xh extends Wh{}(function(t){t.FileObjectsPage=Xh})(tu||(tu={}));class nu extends J{list(e,n={},r){return wt(n)?this.list(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,ep,{query:n,...r})}}class ep extends tn{}(function(t){t.FineTuningJobCheckpointsPage=ep})(nu||(nu={}));class ru extends J{constructor(){super(...arguments),this.checkpoints=new nu(this._client)}create(e,n){return this._client.post("/fine_tuning/jobs",{body:e,...n})}retrieve(e,n){return this._client.get(`/fine_tuning/jobs/${e}`,n)}list(e={},n){return wt(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",tp,{query:e,...n})}cancel(e,n){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,n)}listEvents(e,n={},r){return wt(n)?this.listEvents(e,{},n):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,np,{query:n,...r})}}class tp extends tn{}class np extends tn{}(function(t){t.FineTuningJobsPage=tp,t.FineTuningJobEventsPage=np,t.Checkpoints=nu,t.FineTuningJobCheckpointsPage=ep})(ru||(ru={}));class su extends J{constructor(){super(...arguments),this.jobs=new ru(this._client)}}(function(t){t.Jobs=ru,t.FineTuningJobsPage=tp,t.FineTuningJobEventsPage=np})(su||(su={}));class iu extends J{createVariation(e,n){return this._client.post("/images/variations",ka({body:e,...n}))}edit(e,n){return this._client.post("/images/edits",ka({body:e,...n}))}generate(e,n){return this._client.post("/images/generations",{body:e,...n})}}iu||(iu={});class au extends J{retrieve(e,n){return this._client.get(`/models/${e}`,n)}list(e){return this._client.getAPIList("/models",rp,e)}del(e,n){return this._client.delete(`/models/${e}`,n)}}class rp extends Wh{}(function(t){t.ModelsPage=rp})(au||(au={}));class ou extends J{create(e,n){return this._client.post("/moderations",{body:e,...n})}}ou||(ou={});var i_;let _e=class extends PP{constructor({baseURL:e=po("OPENAI_BASE_URL"),apiKey:n=po("OPENAI_API_KEY"),organization:r=po("OPENAI_ORG_ID")??null,project:s=po("OPENAI_PROJECT_ID")??null,...i}={}){if(n===void 0)throw new q("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:n,organization:r,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&MP())throw new q(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new Xl(this),this.chat=new $l(this),this.embeddings=new eu(this),this.files=new tu(this),this.images=new iu(this),this.audio=new Fl(this),this.moderations=new ou(this),this.models=new au(this),this.fineTuning=new su(this),this.beta=new Jl(this),this.batches=new Ul(this),this._options=a,this.apiKey=n,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}};i_=_e;_e.OpenAI=i_;_e.OpenAIError=q;_e.APIError=Ke;_e.APIConnectionError=Da;_e.APIConnectionTimeoutError=Wu;_e.APIUserAbortError=st;_e.NotFoundError=zh;_e.ConflictError=Vh;_e.RateLimitError=Hh;_e.BadRequestError=Dh;_e.AuthenticationError=Fh;_e.InternalServerError=qh;_e.PermissionDeniedError=Uh;_e.UnprocessableEntityError=Bh;_e.toFile=Yw;_e.fileFromPath=Hw;const{OpenAIError:JO,APIError:XO,APIConnectionError:eT,APIConnectionTimeoutError:VP,APIUserAbortError:BP,NotFoundError:tT,ConflictError:nT,RateLimitError:rT,BadRequestError:sT,AuthenticationError:iT,InternalServerError:aT,PermissionDeniedError:oT,UnprocessableEntityError:lT}=DP;(function(t){t.Page=Wh,t.CursorPage=tn,t.Completions=Xl,t.Chat=$l,t.Embeddings=eu,t.Files=tu,t.FileObjectsPage=Xh,t.Images=iu,t.Audio=Fl,t.Moderations=ou,t.Models=au,t.ModelsPage=rp,t.FineTuning=su,t.Beta=Jl,t.Batches=Ul,t.BatchesPage=Zh})(_e||(_e={}));function a_(t,e){if(t.function===void 0)return;let n;if(e!=null&&e.partial)try{n=wh(t.function.arguments??"{}")}catch{return}else try{n=JSON.parse(t.function.arguments)}catch(s){throw new Ah([`Function "${t.function.name}" arguments:`,"",t.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const r={name:t.function.name,args:n};return e!=null&&e.returnId&&(r.id=t.id),r}function HP(t){if(t.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:t.id,type:"function",function:{name:t.name,arguments:JSON.stringify(t.args)}}}function qP(t,e){var n,r;return{name:(n=t.function)==null?void 0:n.name,args:(r=t.function)==null?void 0:r.arguments,id:t.id,error:e}}class WP extends Th{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}async parseResult(e){const n=e[0].message.additional_kwargs.tool_calls;if(!n)throw new Error(`No tools_call in message ${JSON.stringify(e)}`);const r=JSON.parse(JSON.stringify(n)),s=[];for(const i of r){const a=a_(i,{partial:!0});if(a!==void 0){const o={type:a.name,args:a.args,id:a.id};Object.defineProperty(o,"name",{get(){return this.type}}),Object.defineProperty(o,"arguments",{get(){return this.args}}),s.push(o)}}return s}}class Eg extends Th{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"initialParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.initialParser=new WP(e),this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const n=await this.zodSchema.safeParseAsync(e);if(n.success)return n.data;throw new Ah(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(n.error.errors)}`,JSON.stringify(e,null,2))}async parseResult(e){const r=(await this.initialParser.parseResult(e)).filter(a=>a.type===this.keyName);let s=r;return this.returnId||(s=r.map(a=>a.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(a=>this._validateResult(a)))}}function ZP(t){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:n,azureOpenAIApiKey:r,azureOpenAIBasePath:s,baseURL:i,azureADTokenProvider:a}=t;if((r||a)&&s&&e)return`${s}/${e}`;if(r||a){if(!n)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${n}.openai.azure.com/openai/deployments/${e}`}return i}function GP(t){let e;return t.constructor.name===VP.name?(e=new Error(t.message),e.name="TimeoutError"):t.constructor.name===BP.name?(e=new Error(t.message),e.name="AbortError"):e=t,e}function YP(t){return t.anyOf!==void 0&&Array.isArray(t.anyOf)}function QP(t){const e=["namespace functions {",""];for(const n of t)n.description&&e.push(`// ${n.description}`),Object.keys(n.parameters.properties??{}).length>0?(e.push(`type ${n.name} = (_: {`),e.push(o_(n.parameters,0)),e.push("}) => any;")):e.push(`type ${n.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function o_(t,e){var r;const n=[];for(const[s,i]of Object.entries(t.properties??{}))i.description&&e<2&&n.push(`// ${i.description}`),(r=t.required)!=null&&r.includes(s)?n.push(`${s}: ${lu(i,e)},`):n.push(`${s}?: ${lu(i,e)},`);return n.map(s=>" ".repeat(e)+s).join(`
`)}function lu(t,e){if(YP(t))return t.anyOf.map(n=>lu(n,e)).join(" | ");switch(t.type){case"string":return t.enum?t.enum.map(n=>`"${n}"`).join(" | "):"string";case"number":return t.enum?t.enum.map(n=>`${n}`).join(" | "):"number";case"integer":return t.enum?t.enum.map(n=>`${n}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",o_(t,e+2),"}"].join(`
`);case"array":return t.items?`${lu(t.items,e)}[]`:"any[]";default:return""}}function KP(t){return t.role!=="system"&&t.role!=="assistant"&&t.role!=="user"&&t.role!=="function"&&t.role!=="tool"&&console.warn(`Unknown message role: ${t.role}`),t.role}function l_(t){const e=t._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Qr.isInstance(t))throw new Error("Invalid generic chat message");return KP(t)}default:throw new Error(`Unknown message type: ${e}`)}}function JP(t,e){const n=t.tool_calls;switch(t.role){case"assistant":{const r=[],s=[];for(const i of n??[])try{r.push(a_(i,{returnId:!0}))}catch(a){s.push(qP(i,a.message))}return new bh({content:t.content||"",tool_calls:r,invalid_tool_calls:s,additional_kwargs:{function_call:t.function_call,tool_calls:n},id:e})}default:return new Qr(t.content||"",t.role??"unknown")}}function XP(t,e,n){var a,o;const r=t.role??n,s=t.content??"";let i;if(t.function_call?i={function_call:t.function_call}:t.tool_calls?i={tool_calls:t.tool_calls}:i={},r==="user")return new Du({content:s});if(r==="assistant"){const l=[];if(Array.isArray(t.tool_calls))for(const u of t.tool_calls)l.push({name:(a=u.function)==null?void 0:a.name,args:(o=u.function)==null?void 0:o.arguments,id:u.id,index:u.index});return new Yr({content:s,tool_call_chunks:l,additional_kwargs:i,id:e})}else return r==="system"?new Fu({content:s}):r==="function"?new Mu({content:s,additional_kwargs:i,name:t.name}):r==="tool"?new _h({content:s,additional_kwargs:i,tool_call_id:t.tool_call_id}):new Lu({content:s,role:r})}function kg(t){return t.map(e=>{var r;const n={role:l_(e),content:e.content};return e.name!=null&&(n.name=e.name),e.additional_kwargs.function_call!=null&&(n.function_call=e.additional_kwargs.function_call,n.content=null),fw(e)&&((r=e.tool_calls)!=null&&r.length)?(n.tool_calls=e.tool_calls.map(HP),n.content=null):(e.additional_kwargs.tool_calls!=null&&(n.tool_calls=e.additional_kwargs.tool_calls),e.tool_call_id!=null&&(n.tool_call_id=e.tool_call_id)),n})}class Gc extends Zn{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,n){var r,s,i,a,o,l,u,c;if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureADTokenProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??We("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=(e==null?void 0:e.azureOpenAIApiKey)??We("AZURE_OPENAI_API_KEY"),this.azureADTokenProvider=(e==null?void 0:e.azureADTokenProvider)??void 0,!this.azureOpenAIApiKey&&!this.apiKey&&!this.azureADTokenProvider)throw new Error("OpenAI or Azure OpenAI API key or Token Provider not found");if(this.azureOpenAIApiInstanceName=(e==null?void 0:e.azureOpenAIApiInstanceName)??We("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=(e==null?void 0:e.azureOpenAIApiDeploymentName)??We("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=(e==null?void 0:e.azureOpenAIApiVersion)??We("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=(e==null?void 0:e.azureOpenAIBasePath)??We("AZURE_OPENAI_BASE_PATH"),this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??We("OPENAI_ORGANIZATION"),this.modelName=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.model=this.modelName,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this==null?void 0:this.stop,this.user=e==null?void 0:e.user,this.azureOpenAIApiKey||this.azureADTokenProvider){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??"",this.streamUsage=!1}this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:(n==null?void 0:n.basePath)??((s=e==null?void 0:e.configuration)==null?void 0:s.basePath),dangerouslyAllowBrowser:!0,defaultHeaders:((i=n==null?void 0:n.baseOptions)==null?void 0:i.headers)??((o=(a=e==null?void 0:e.configuration)==null?void 0:a.baseOptions)==null?void 0:o.headers),defaultQuery:((l=n==null?void 0:n.baseOptions)==null?void 0:l.params)??((c=(u=e==null?void 0:e.configuration)==null?void 0:u.baseOptions)==null?void 0:c.params),...n,...e==null?void 0:e.configuration}}getLsParams(e){const n=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:n.temperature??void 0,ls_max_tokens:n.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,n){return this.bind({tools:e.map(Km),...n})}invocationParams(e){function n(i){return i!==void 0&&i.every(a=>Array.isArray(a.lc_namespace))}let r={};return(e==null?void 0:e.stream_options)!==void 0?r={stream_options:e.stream_options}:this.streamUsage&&this.streaming&&(r={stream_options:{include_usage:!0}}),{model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:n(e==null?void 0:e.tools)?e==null?void 0:e.tools.map(Km):e==null?void 0:e.tools,tool_choice:e==null?void 0:e.tool_choice,response_format:e==null?void 0:e.response_format,seed:e==null?void 0:e.seed,...r,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.modelKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,n,r){var u;const s=kg(e),i={...this.invocationParams(n),messages:s,stream:!0};let a;const o=await this.completionWithRetry(i,n);let l;for await(const c of o){const d=c==null?void 0:c.choices[0];if(c.usage&&(l=c.usage),!d)continue;const{delta:f}=d;if(!f)continue;const g=XP(f,c.id,a);a=f.role??a;const p={prompt:n.promptIndex??0,completion:d.index??0};if(typeof g.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const v={...p};d.finish_reason!==void 0&&(v.finish_reason=d.finish_reason),this.logprobs&&(v.logprobs=d.logprobs);const w=new Ws({message:g,text:g.content,generationInfo:v});yield w,r==null||r.handleLLMNewToken(w.text??"",p,void 0,void 0,void 0,{chunk:w})}if(l&&(yield new Ws({message:new Yr({content:"",usage_metadata:{input_tokens:l.prompt_tokens,output_tokens:l.completion_tokens,total_tokens:l.total_tokens}}),text:""})),(u=n.signal)!=null&&u.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,n,r){var o,l;const s={},i=this.invocationParams(n),a=kg(e);if(i.stream){const u=this._streamResponseChunks(e,n,r),c={};for await(const w of u){w.message.response_metadata={...w.generationInfo,...w.message.response_metadata};const m=((o=w.generationInfo)==null?void 0:o.completion)??0;c[m]===void 0?c[m]=w:c[m]=c[m].concat(w)}const d=Object.entries(c).sort(([w],[m])=>parseInt(w,10)-parseInt(m,10)).map(([w,m])=>m),{functions:f,function_call:g}=this.invocationParams(n),p=await this.getEstimatedTokenCountFromPrompt(e,f,g),v=await this.getNumTokensFromGenerations(d);return s.promptTokens=p,s.completionTokens=v,s.totalTokens=p+v,{generations:d,llmOutput:{estimatedTokenUsage:s}}}else{const u=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:n==null?void 0:n.signal,...n==null?void 0:n.options}),{completion_tokens:c,prompt_tokens:d,total_tokens:f}=(u==null?void 0:u.usage)??{};c&&(s.completionTokens=(s.completionTokens??0)+c),d&&(s.promptTokens=(s.promptTokens??0)+d),f&&(s.totalTokens=(s.totalTokens??0)+f);const g=[];for(const p of(u==null?void 0:u.choices)??[]){const w={text:((l=p.message)==null?void 0:l.content)??"",message:JP(p.message??{role:"assistant"},u.id)};w.generationInfo={...p.finish_reason?{finish_reason:p.finish_reason}:{},...p.logprobs?{logprobs:p.logprobs}:{}},fw(w.message)&&(w.message.usage_metadata={input_tokens:s.promptTokens??0,output_tokens:s.completionTokens??0,total_tokens:s.totalTokens??0}),g.push(w)}return{generations:g,llmOutput:{tokenUsage:s}}}}async getEstimatedTokenCountFromPrompt(e,n,r){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(n&&r!=="auto"){const i=QP(n);s+=await this.getNumTokens(i),s+=9}return n&&e.find(i=>i._getType()==="system")&&(s-=4),r==="none"?s+=1:typeof r=="object"&&(s+=await this.getNumTokens(r.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>{var s;return(s=r.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)}))).reduce((r,s)=>r+s,0)}async getNumTokensFromMessages(e){let n=0,r=0,s=0;this.model==="gpt-3.5-turbo-0301"?(r=4,s=-1):(r=3,s=1);const i=await Promise.all(e.map(async a=>{var f,g,p,v,w,m;const o=await this.getNumTokens(a.content),l=await this.getNumTokens(l_(a)),u=a.name!==void 0?s+await this.getNumTokens(a.name):0;let c=o+r+l+u;const d=a;if(d._getType()==="function"&&(c-=2),(f=d.additional_kwargs)!=null&&f.function_call&&(c+=3),(g=d==null?void 0:d.additional_kwargs.function_call)!=null&&g.name&&(c+=await this.getNumTokens((p=d.additional_kwargs.function_call)==null?void 0:p.name)),(v=d.additional_kwargs.function_call)!=null&&v.arguments)try{c+=await this.getNumTokens(JSON.stringify(JSON.parse((w=d.additional_kwargs.function_call)==null?void 0:w.arguments)))}catch(h){console.error("Error parsing function arguments",h,JSON.stringify(d.additional_kwargs.function_call)),c+=await this.getNumTokens((m=d.additional_kwargs.function_call)==null?void 0:m.arguments)}return n+=c,c}));return n+=3,{totalCount:n,countPerMessage:i}}async completionWithRetry(e,n){const r=this._getClientOptions(n);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(s){throw GP(s)}})}_getClientOptions(e){if(!this.client){const r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},s=ZP(r),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new _e(i)}const n={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(n.headers={"api-key":this.azureOpenAIApiKey,...n.headers},n.query={"api-version":this.azureOpenAIApiVersion,...n.query}),n}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((n,r)=>(r&&r.tokenUsage&&(n.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,n.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,n.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),n),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,n){let r,s,i,a;eO(e)?(r=e.schema,s=e.name,i=e.method,a=e.includeRaw):(r=e,s=n==null?void 0:n.name,i=n==null?void 0:n.method,a=n==null?void 0:n.includeRaw);let o,l;if(i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),Sg(r)?l=c1.fromZodSchema(r):l=new d1;else{let f=s??"extract";if(Sg(r)){const g=$a(r);o=this.bind({tools:[{type:"function",function:{name:f,description:g.description,parameters:g}}],tool_choice:{type:"function",function:{name:f}}}),l=new Eg({returnSingle:!0,keyName:f,zodSchema:r})}else{let g;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(g=r,f=r.name):(f=r.title??f,g={name:f,description:r.description??"",parameters:r}),o=this.bind({tools:[{type:"function",function:g}],tool_choice:{type:"function",function:{name:f}}}),l=new Eg({returnSingle:!0,keyName:f})}}if(!a)return o.pipe(l);const u=_a.assign({parsed:(f,g)=>l.invoke(f.raw,g)}),c=_a.assign({parsed:()=>null}),d=u.withFallbacks({fallbacks:[c]});return qt.from([{raw:o},d])}}function Sg(t){return typeof(t==null?void 0:t.parse)=="function"}function eO(t){return t!==void 0&&typeof t.schema=="object"}const Fa=Ze.object({validity:Ze.string().describe("The string VALID_QUERY or INVALID_QUERY, determined by the criteria provided in the prompt"),reasoning:Ze.string().describe("The reasoning to the conclusion VALID_QUERY or INVALID_QUERY")}),tO=Ze.object({sourcesTruthfulness:Ze.string().describe("The string TRUE_QUERY or FALSE_QUERY depending on your determination based solely on the sources"),sourcesRatio:Ze.string().describe("A fraction in the form of x/y representing the number of sources that agreed with the initial query, out of the total number of sources analyzed"),sourcesReasoning:Ze.string().describe("A short paragraph detailing a summary of why the sources that agreed with your determination, did so"),internalTruthfulness:Ze.string().describe("The string TRUE_QUERY or FALSE_QUERY depending on your determination based solely on your knowledge, and excluding any of the sources that you analyzed in the prior part"),internalReasoning:Ze.string().describe("A short paragraph detailing why you came to your determination")});async function nO(t){const{query:e,setQueryState:n}=t,r=t.llm.withStructuredOutput(Fa);n(ie.LOADING_VALIDITY_CHECKING);const a=await Kt.fromMessages([["system",`You are an AI agent for a certain web application. Your job is to receive queries, anddetermine if a query can pass through to the next AI agent in the chain. The next agent in the chain is a fact checker agent, so your role is NOT to determine if a query is true or false. Again, it does not matter if a query you receive is false, misinformation,conspiracy theories, or etc. It only matters if the query can be evaluated for its truthfulness.
`],["user",`The query is valid and may pass through if it meets the following criteria:
1. The query has a determinable meaning in English. A query is valid if it is sufficiently grammatically correct and complete, and if a clear meaning can be determined from it.
Here is the query:
{query}
`]]).pipe(r).invoke({query:e});return a.validity==="VALID_QUERY"?t.queryValidity=ge.VALID_QUERY:a.validity==="INVALID_QUERY"?(t.queryValidity=ge.INVALID_QUERY,t.queryValidityReasoning=a.reasoning):(t.queryValidity=ge.QUERY_VALIDITY_ERROR,t.queryValidityReasoning=a.reasoning),t}function rO(t){const{queryValidity:e,setQueryState:n}=t;return e===ge.VALID_QUERY?"propositionFilterAgent":(n(ie.ERROR_VALIDITY),"end")}async function sO(t){const{query:e}=t,n=t.llm.withStructuredOutput(Fa),i=await Kt.fromMessages([["system",`You are an AI agent for a certain web application. Your job is to receive queries, anddetermine if a query can pass through to the next AI agent in the chain. The next agent in the chain is a fact checker agent, so your role is NOT to determine if a query is true or false. Again, it does not matter if a query you receive is false, misinformation,conspiracy theories, or etc. It only matters if the query can be evaluated for its truthfulness.
`],["user",`The query is valid and may pass through if it meets the following criteria:
1. The query is a proposition. A proposition is a statement or assertion that asserts something to be true. It is the type of statement that can be determined to be true or false. A query is still valid even if it is objectively false.
Here is the query:
{query}
`]]).pipe(n).invoke({query:e});return i.validity==="VALID_QUERY"?t.queryValidity=ge.VALID_QUERY:i.validity==="INVALID_QUERY"?(t.queryValidity=ge.INVALID_QUERY,t.queryValidityReasoning=i.reasoning):(t.queryValidity=ge.QUERY_VALIDITY_ERROR,t.queryValidityReasoning=i.reasoning),t}function iO(t){const{queryValidity:e,setQueryState:n}=t;return e===ge.VALID_QUERY?"questionFilterAgent":(n(ie.ERROR_VALIDITY),"end")}async function aO(t){const{query:e}=t,n=t.llm.withStructuredOutput(Fa),i=await Kt.fromMessages([["system",`You are an AI agent for a certain web application. Your job is to receive queries, anddetermine if a query can pass through to the next AI agent in the chain. The next agent in the chain is a fact checker agent, so your role is NOT to determine if a query is true or false. Again, it does not matter if a query you receive is false, misinformation,conspiracy theories, or etc. It only matters if the query can be evaluated for its truthfulness.
`],["user",`The query is valid and may pass through if it meets the following criteria:
1. The query is not a question, but is an assertion.
Here is the query:
{query}
`]]).pipe(n).invoke({query:e});return i.validity==="VALID_QUERY"?t.queryValidity=ge.VALID_QUERY:i.validity==="INVALID_QUERY"?(t.queryValidity=ge.INVALID_QUERY,t.queryValidityReasoning=i.reasoning):(t.queryValidity=ge.QUERY_VALIDITY_ERROR,t.queryValidityReasoning=i.reasoning),t}function oO(t){const{queryValidity:e,setQueryState:n}=t;return e===ge.VALID_QUERY?"opinionFilterAgent":(n(ie.ERROR_VALIDITY),"end")}async function lO(t){const{query:e}=t,n=t.llm.withStructuredOutput(Fa),i=await Kt.fromMessages([["system",`You are an AI agent for a certain web application. Your job is to receive queries, anddetermine if a query can pass through to the next AI agent in the chain. The next agent in the chain is a fact checker agent, so your role is NOT to determine if a query is true or false. Again, it does not matter if a query you receive is false, misinformation,conspiracy theories, or etc. It only matters if the query can be evaluated for its truthfulness.
`],["user",`The query is valid and may pass through if it meets the following criteria:
1. The query can be determined to be objectively true or false, and can be proven to be so. A query is invalid if it is an opinion, or is a subjective expression of personal belief, preference, or interpretation that may vary from person to person and cannot be definitively proven true or false. For example, the query 'Pizza is good' is invalid, as it is a subjective opinion. However, the query 'Lemons are limes' is valid, as even though it is false, it can be proven to be objectively false.
Here is the query:
{query}
`]]).pipe(n).invoke({query:e});return i.validity==="VALID_QUERY"?t.queryValidity=ge.VALID_QUERY:i.validity==="INVALID_QUERY"?(t.queryValidity=ge.INVALID_QUERY,t.queryValidityReasoning=i.reasoning):(t.queryValidity=ge.QUERY_VALIDITY_ERROR,t.queryValidityReasoning=i.reasoning),t}function uO(t){const{queryValidity:e,setQueryState:n}=t;return e===ge.VALID_QUERY?"publicKnowledgeFilterAgent":(n(ie.ERROR_VALIDITY),"end")}async function cO(t){const{query:e}=t,n=t.llm.withStructuredOutput(Fa),i=await Kt.fromMessages([["system",`You are an AI agent for a certain web application. Your job is to receive queries, anddetermine if a query can pass through to the next AI agent in the chain. The next agent in the chain is a fact checker agent, so your role is NOT to determine if a query is true or false. Again, it does not matter if a query you receive is false, misinformation,conspiracy theories, or etc. It only matters if the query can be evaluated for its truthfulness.
`],["user",`The query is valid and may pass through if it meets the following criteria:
1. The query is relating to something that is known to the public, and can reasonably be investigated and proven to be true or false, using information that the public has access to. A query is invalid if it is a fact about something or someone unknown to the general public.
Here is the query:
{query}
`]]).pipe(n).invoke({query:e});return i.validity==="VALID_QUERY"?t.queryValidity=ge.VALID_QUERY:i.validity==="INVALID_QUERY"?(t.queryValidity=ge.INVALID_QUERY,t.queryValidityReasoning=i.reasoning):(t.queryValidity=ge.QUERY_VALIDITY_ERROR,t.queryValidityReasoning=i.reasoning),t}function dO(t){const{queryValidity:e,setQueryState:n}=t;return e===ge.VALID_QUERY?"questionifierAgent":(n(ie.ERROR_VALIDITY),"end")}async function fO(t){const{llm:e,query:n}=t,i=await Kt.fromMessages([["system",`You are an AI agent for a certain web application. Your job is to receive a query, and turn that query into a question. Queries are guaranteed to be a statement that can be either true or false. You are to extract the core statement from the query, and turn it into a question about the truthfulness or falsity of that statement.
`],["user",`Here is the query:
{query}
Please return nothing but the question that has been converted from the query.`]]).pipe(e).invoke({query:n});return t.querySearchQuestion=i.content.toString(),t}class hO extends W1{static lc_name(){return"TavilySearchResults"}constructor(e){if(super(e),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A search engine optimized for comprehensive, accurate, and trusted results. Useful for when you need to answer questions about current events. Input should be a search query."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"tavily_search_results_json"}),Object.defineProperty(this,"maxResults",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:{}}),this.maxResults=(e==null?void 0:e.maxResults)??this.maxResults,this.kwargs=(e==null?void 0:e.kwargs)??this.kwargs,this.apiKey=(e==null?void 0:e.apiKey)??We("TAVILY_API_KEY"),this.apiKey===void 0)throw new Error('No Tavily API key found. Either set an environment variable named "TAVILY_API_KEY" or pass an API key as "apiKey".')}async _call(e,n){const r={query:e,max_results:this.maxResults,api_key:this.apiKey},s=await fetch("https://api.tavily.com/search",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({...r,...this.kwargs})}),i=await s.json();if(!s.ok)throw new Error(`Request failed with status code ${s.status}: ${i.error}`);if(!Array.isArray(i.results))throw new Error("Could not parse Tavily results. Please try again.");return JSON.stringify(i.results)}}async function pO(t){const{query:e,setQueryState:n}=t;n(ie.LOADING_SOURCES_SEARCHING);const r=new hO({apiKey:"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",maxResults:10}),s=JSON.parse(await r.invoke(e).then());return t.querySearchResults=s,t}async function mO(t){const{query:e,querySearchResults:n,setQueryState:r}=t,s=t.llm.withStructuredOutput(tO);r(ie.LOADING_FACT_CHECKING);const o=await Kt.fromMessages([["system",`You are a fact checker for a misinformation detector application. Your sole job is to determine if the query you receive is true or false. You will be given a list of sources from the Internet to parse through. You must extract a detailed summary of each source, and determine if each source points to the initial query being true or false. In your final output, you must include how many sources pointed to your conclusion, and how many did not agree. In a separate section, include your own determination of whether the query is true or false, based solely on the knowledge that you have, and without the list of sources that was initially provided to you.
`],["user",`Here is the original query:
{query}
Here is the list of sources:
{querySearchResults}`]]).pipe(s).invoke({query:e,querySearchResults:n.map(l=>l.url).join(" , ")});return o.sourcesTruthfulness==="TRUE_QUERY"?t.querySourcesTruthfulness=pt.TRUE_QUERY:o.sourcesTruthfulness==="FALSE_QUERY"?t.querySourcesTruthfulness=pt.FALSE_QUERY:t.querySourcesTruthfulness=pt.QUERY_TRUTHFULNESS_ERROR,o.internalTruthfulness==="TRUE_QUERY"?t.queryInternalTruthfulness=pt.TRUE_QUERY:o.internalTruthfulness==="FALSE_QUERY"?t.queryInternalTruthfulness=pt.FALSE_QUERY:t.queryInternalTruthfulness=pt.QUERY_TRUTHFULNESS_ERROR,t.querySourcesTruthfulnessRatio=o.sourcesRatio,t.querySourcesTruthfulnessReasoning=o.sourcesReasoning,t.queryInternalTruthfulnessReasoning=o.internalReasoning,r(ie.QUERY_COMPLETE),t}class uu{constructor(e,n){this.graphState={llm:{value:()=>new Gc({modelName:"gpt-4o",temperature:0}),default:()=>new Gc({modelName:"gpt-4o",temperature:0})},query:null,queryValidity:null,queryValidityReasoning:null,querySearchQuestion:null,querySearchResults:null,querySourcesTruthfulness:null,querySourcesTruthfulnessRatio:null,querySourcesTruthfulnessReasoning:null,queryInternalTruthfulness:null,queryInternalTruthfulnessReasoning:null,setQueryState:null},this.chatGPTModelName=e,this.graph=this.createGraph(),uu.setComponentQueryState=n}createGraph(){return new oP({channels:this.graphState}).addNode("grammaticalFilterAgent",nO).addNode("propositionFilterAgent",sO).addNode("questionFilterAgent",aO).addNode("opinionFilterAgent",lO).addNode("publicKnowledgeFilterAgent",cO).addNode("questionifierAgent",fO).addNode("searcherAgent",pO).addNode("factCheckerAgent",mO).addEdge(ve,"grammaticalFilterAgent").addConditionalEdges("grammaticalFilterAgent",rO,{propositionFilterAgent:"propositionFilterAgent",end:le}).addConditionalEdges("propositionFilterAgent",iO,{questionFilterAgent:"questionFilterAgent",end:le}).addConditionalEdges("questionFilterAgent",oO,{opinionFilterAgent:"opinionFilterAgent",end:le}).addConditionalEdges("opinionFilterAgent",uO,{publicKnowledgeFilterAgent:"publicKnowledgeFilterAgent",end:le}).addConditionalEdges("publicKnowledgeFilterAgent",dO,{questionifierAgent:"questionifierAgent",end:le}).addEdge("questionifierAgent","searcherAgent").addEdge("searcherAgent","factCheckerAgent").addEdge("factCheckerAgent",le).compile()}setQueryState(e){uu.setComponentQueryState(e)}runQuery(e){try{return this.graph.invoke({llm:new Gc({modelName:this.chatGPTModelName,temperature:0}),query:e,setQueryState:this.setQueryState})}catch(n){return console.log(n),this.setQueryState(ie.ERROR_OTHER),{}}}}var gO={cm:!0,mm:!0,in:!0,px:!0,pt:!0,pc:!0,em:!0,ex:!0,ch:!0,rem:!0,vw:!0,vh:!0,vmin:!0,vmax:!0,"%":!0};function sp(t){if(typeof t=="number")return{value:t,unit:"px"};var e,n=(t.match(/^[0-9.]*/)||"").toString();n.includes(".")?e=parseFloat(n):e=parseInt(n,10);var r=(t.match(/[^0-9]*$/)||"").toString();return gO[r]?{value:e,unit:r}:(console.warn("React Spinners: ".concat(t," is not a valid css value. Defaulting to ").concat(e,"px.")),{value:e,unit:"px"})}function Es(t){var e=sp(t);return"".concat(e.value).concat(e.unit)}var cu=function(t,e,n){var r="react-spinners-".concat(t,"-").concat(n);if(typeof window>"u"||!window.document)return r;var s=document.createElement("style");document.head.appendChild(s);var i=s.sheet,a=`
    @keyframes `.concat(r,` {
      `).concat(e,`
    }
  `);return i&&i.insertRule(a,0),r},du;(function(t){t.maroon="#800000",t.red="#FF0000",t.orange="#FFA500",t.yellow="#FFFF00",t.olive="#808000",t.green="#008000",t.purple="#800080",t.fuchsia="#FF00FF",t.lime="#00FF00",t.teal="#008080",t.aqua="#00FFFF",t.blue="#0000FF",t.navy="#000080",t.black="#000000",t.gray="#808080",t.silver="#C0C0C0",t.white="#FFFFFF"})(du||(du={}));var yO=function(t,e){if(t.includes("/"))return t.replace("rgb(","rgba(");var n=t.substring(t.startsWith("rgba(")?5:4,t.length-1).trim(),r=n.split(",");return r.length===4?t.replace("rgb(","rgba("):r.length===3?"rgba(".concat(n,", ").concat(e,")"):"rgba(".concat(n," / ").concat(e,")")},vO=function(t,e){if(t.startsWith("rgb"))return yO(t,e);if(Object.keys(du).includes(t)&&(t=du[t]),t[0]==="#"&&(t=t.slice(1)),t.length===3){var n="";t.split("").forEach(function(s){n+=s,n+=s}),t=n}var r=(t.match(/.{2}/g)||[]).map(function(s){return parseInt(s,16)}).join(", ");return"rgba(".concat(r,", ").concat(e,")")},fu=function(){return fu=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},fu.apply(this,arguments)},wO=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n};function _O(t){var e=t.loading,n=e===void 0?!0:e,r=t.color,s=r===void 0?"#000000":r,i=t.speedMultiplier,a=i===void 0?1:i,o=t.cssOverride,l=o===void 0?{}:o,u=t.size,c=u===void 0?50:u,d=wO(t,["loading","color","speedMultiplier","cssOverride","size"]),f=sp(c),g=f.value,p=f.unit,v=fu({display:"inherit",position:"relative",width:Es(c),height:Es(c),transform:"rotate(165deg)"},l),w=g/5,m=(g-w)/2,h=m-w,y=vO(s,.75),_=cu("HashLoader","0% {width: ".concat(w,"px; box-shadow: ").concat(m,"px ").concat(-h,"px ").concat(y,", ").concat(-m,"px ").concat(h,"px ").concat(y,`}
    35% {width: `).concat(Es(c),"; box-shadow: 0 ").concat(-h,"px ").concat(y,", 0 ").concat(h,"px ").concat(y,`}
    70% {width: `).concat(w,"px; box-shadow: ").concat(-m,"px ").concat(-h,"px ").concat(y,", ").concat(m,"px ").concat(h,"px ").concat(y,`}
    100% {box-shadow: `).concat(m,"px ").concat(-h,"px ").concat(y,", ").concat(-m,"px ").concat(h,"px ").concat(y,"}"),"before"),b=cu("HashLoader","0% {height: ".concat(w,"px; box-shadow: ").concat(h,"px ").concat(m,"px ").concat(s,", ").concat(-h,"px ").concat(-m,"px ").concat(s,`}
    35% {height: `).concat(Es(c),"; box-shadow: ").concat(h,"px 0 ").concat(s,", ").concat(-h,"px 0 ").concat(s,`}
    70% {height: `).concat(w,"px; box-shadow: ").concat(h,"px ").concat(-m,"px ").concat(s,", ").concat(-h,"px ").concat(m,"px ").concat(s,`}
    100% {box-shadow: `).concat(h,"px ").concat(m,"px ").concat(s,", ").concat(-h,"px ").concat(-m,"px ").concat(s,"}"),"after"),E=function(k){return{position:"absolute",top:"50%",left:"50%",display:"block",width:"".concat(g/5).concat(p),height:"".concat(g/5).concat(p),borderRadius:"".concat(g/10).concat(p),transform:"translate(-50%, -50%)",animationFillMode:"none",animation:"".concat(k===1?_:b," ").concat(2/a,"s infinite")}};return n?xe.createElement("span",fu({style:v},d),xe.createElement("span",{style:E(1)}),xe.createElement("span",{style:E(2)})):null}var hu=function(){return hu=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},hu.apply(this,arguments)},bO=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n},EO=cu("RingLoader","0% {transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)} 100% {transform: rotateX(180deg) rotateY(360deg) rotateZ(360deg)}","right"),kO=cu("RingLoader","0% {transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg)} 100% {transform: rotateX(360deg) rotateY(180deg) rotateZ(360deg)}","left");function SO(t){var e=t.loading,n=e===void 0?!0:e,r=t.color,s=r===void 0?"#000000":r,i=t.speedMultiplier,a=i===void 0?1:i,o=t.cssOverride,l=o===void 0?{}:o,u=t.size,c=u===void 0?60:u,d=bO(t,["loading","color","speedMultiplier","cssOverride","size"]),f=sp(c),g=f.value,p=f.unit,v=hu({display:"inherit",width:Es(c),height:Es(c),position:"relative"},l),w=function(m){return{position:"absolute",top:"0",left:"0",width:"".concat(g).concat(p),height:"".concat(g).concat(p),border:"".concat(g/10).concat(p," solid ").concat(s),opacity:"0.4",borderRadius:"100%",animationFillMode:"forwards",perspective:"800px",animation:"".concat(m===1?EO:kO," ").concat(2/a,"s 0s infinite linear")}};return n?xe.createElement("span",hu({style:v},d),xe.createElement("span",{style:w(1)}),xe.createElement("span",{style:w(2)})):null}const xO=()=>{const[t,e]=xe.useState(""),[n,r]=xe.useState([C.jsx(C.Fragment,{})]),[s,i]=xe.useState(ie.READY_TO_RECEIVE),[a,o]=xe.useState({}),[l,u]=xe.useState(C.jsx(C.Fragment,{})),[c,d]=xe.useState(!1),f=new uu("gpt-4o",i),g=C.jsxs("div",{className:"VersionDisplay",children:[C.jsx(SO,{className:"RingLoader",color:"white",loading:!0,size:"5vw"}),C.jsx("div",{className:"Status",children:"Waiting for Query"}),C.jsxs("div",{className:"AppTitleVersion",children:["fake news detector",C.jsx("br",{}),"v0.0.1"]})]}),p=C.jsxs("div",{className:"LoadingDisplay",children:[C.jsx(_O,{className:"HashLoader",color:"white",loading:!0}),C.jsx("div",{className:"LoadingText",children:"Loading. . ."}),C.jsx("div",{className:"LoadingStatus",children:"Validating query"})]}),v=C.jsxs("div",{className:"ValidityErrorDisplay",children:[C.jsx("div",{className:"Error",children:"Error"}),C.jsxs("div",{className:"ErrorDetails",children:["Your query was invalid. ",C.jsx("a",{href:"https://www.github.com/skang188144/FakeNewsDetector",children:"Find out why."})]})]}),w=C.jsxs("div",{className:"UnknownErrorDisplay",children:[C.jsx("div",{className:"Error",children:"Error"}),C.jsx("div",{className:"ErrorDetails",children:"We ran into an unknown error. Please try again later."})]}),m=E=>C.jsxs("div",{className:"ResultsHeaderDisplay",children:[C.jsx("div",{className:"Bar"}),C.jsxs("div",{className:"Query",children:['"',E.query,'"']})]}),h=E=>C.jsxs("div",{className:"SourcesResultsDisplay",children:[C.jsxs("div",{className:"SourcesHeader",children:[C.jsx("div",{className:"Dot",children:""}),C.jsx("div",{className:"Text",children:"FROM OUR SOURCES,"})]}),C.jsxs("div",{className:"SourcesResult",children:[C.jsx("div",{className:"Bar",style:E.querySourcesTruthfulness===pt.TRUE_QUERY?{backgroundColor:"#70AE6E"}:{backgroundColor:"#FF6C58"}}),E.querySourcesTruthfulness===pt.TRUE_QUERY?C.jsx("div",{className:"Result",style:{color:"#70AE6E"},children:"this statement is true"}):C.jsx("div",{className:"Result",style:{color:"#FF6C58"},children:"this statement is false"}),C.jsx("div",{className:"RatioBeginning",style:E.querySourcesTruthfulness===pt.TRUE_QUERY?{color:"#70AE6E"}:{color:"#FF6C58"},children:E.querySourcesTruthfulnessRatio}),C.jsxs("div",{className:"RatioEnding",style:E.querySourcesTruthfulness===pt.TRUE_QUERY?{color:"#70AE6E"}:{color:"#FF6C58"},children:["sources agree with",C.jsx("br",{}),"this statement"]})]}),C.jsx("div",{className:"SourcesReasoning",children:E.querySourcesTruthfulnessReasoning})]}),y=E=>{const k=E.querySearchResults.map(O=>C.jsx("div",{className:"Source",children:C.jsxs("a",{href:O.url,children:[" ",O.title]})}));return C.jsxs("div",{className:"SourcesList",children:[...k]})},_=E=>C.jsxs("div",{className:"InternalResultsDisplay",children:[C.jsxs("div",{className:"InternalHeader",children:[C.jsx("div",{className:"Dot",children:""}),C.jsx("div",{className:"Text",children:"FROM CHATGPT-4o,"})]}),C.jsxs("div",{className:"InternalResult",children:[C.jsx("div",{className:"Bar",style:E.querySourcesTruthfulness===pt.TRUE_QUERY?{backgroundColor:"#70AE6E"}:{backgroundColor:"#FF6C58"}}),E.queryInternalTruthfulness===pt.TRUE_QUERY?C.jsx("div",{className:"Result",style:{color:"#70AE6E"},children:"this statement is true"}):C.jsx("div",{className:"Result",style:{color:"#FF6C58"},children:"this statement is false"})]}),C.jsx("div",{className:"InternalReasoning",children:E.queryInternalTruthfulnessReasoning})]}),b=E=>{E.key==="Enter"&&s===ie.READY_TO_RECEIVE&&o(f.runQuery(t))};return xe.useEffect(()=>{r([g])},[]),xe.useEffect(()=>{async function E(k,O,$){switch(s){case ie.READY_TO_RECEIVE:$([k]);break;case ie.LOADING_VALIDITY_CHECKING:$([O]);break;case ie.ERROR_VALIDITY:$([v]);break;case ie.LOADING_SOURCES_SEARCHING:document.body.getElementsByClassName("LoadingStatus")[0].innerHTML="Searching for sources";break;case ie.LOADING_FACT_CHECKING:document.body.getElementsByClassName("LoadingStatus")[0].innerHTML="Fact checking";break;case ie.QUERY_COMPLETE:document.body.getElementsByClassName("LoadingStatus")[0].innerHTML="Query complete",$([m(await a),h(await a),_(await a)]);break;case ie.ERROR_OTHER:$([w]);break}}E(g,p,r)},[s]),xe.useEffect(()=>{async function E(){document.body.getElementsByClassName("ToggleTriangle")[0]!==void 0&&(c&&s===ie.QUERY_COMPLETE?(document.body.getElementsByClassName("ToggleTriangle")[0].innerHTML="",u(y(await a))):(document.body.getElementsByClassName("ToggleTriangle")[0].innerHTML="",u(C.jsx(C.Fragment,{}))))}E()},[c]),C.jsxs("div",{className:"App",children:[C.jsx("div",{className:"BackgroundLeft"}),C.jsx("div",{className:"BackgroundRight"}),C.jsxs("div",{className:"TitleContainer",children:[C.jsx("div",{className:"TitleStart",children:"fake"}),C.jsxs("div",{className:"TitleEndContainer",children:[C.jsx("div",{className:"TitleEnd",children:"news detector"}),C.jsxs("div",{className:"Byline",children:["by Sanghyeok Kang, powered by",C.jsx("div",{className:"TavilyText",children:"Tavily AI"}),C.jsx("img",{className:"TavilyIcon",src:"https://tavily.com/_next/static/media/logo.b3d36071.svg"})]})]})]}),C.jsxs("div",{className:"OutputDisplayContainer",children:[s===ie.READY_TO_RECEIVE&&C.jsx("input",{className:"QueryInput",placeholder:"Enter a statement to fact check.",onChange:E=>{e(E.target.value)},onKeyDown:b}),C.jsxs("div",{className:"OutputDisplay",children:[n[0],n.length>=2&&n[1],s===ie.QUERY_COMPLETE&&C.jsxs("div",{className:"SourcesListDisplay",children:[C.jsxs("div",{className:"HeaderContainer",onClick:()=>{d(!c)},children:[C.jsx("div",{className:"ToggleTriangle",children:""}),C.jsx("div",{className:"Header",children:"View Our Sources"})]}),l]}),n.length>=3&&n[2]]})]})]})};Yc.createRoot(document.getElementById("root")).render(C.jsx(O_.StrictMode,{children:C.jsx(xO,{})}));export{rf as B,Wt as P,Nw as c,_s as r};
